# åç«¯é¡¹ç›®å¼€å‘æç¤ºè¯ - Node.js + MongoDB æ¶æ„

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**ï¼šå°ç¨‹åºå•†åŸåç«¯æœåŠ¡  
**æŠ€æœ¯æ ˆ**ï¼šNode.js + Express + MongoDB  
**ä¸»è¦åŠŸèƒ½**ï¼šæä¾›å°ç¨‹åºå’Œ Web å‰ç«¯çš„ API æ¥å£æœåŠ¡  
**å¼€å‘å‘¨æœŸ**ï¼šå®Œæ•´çš„åç«¯ç³»ç»Ÿæ­å»º

---

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

### 1. é¡¹ç›®åˆå§‹åŒ–

**æ¡†æ¶é€‰æ‹©**ï¼šExpress.js  
**æ•°æ®åº“**ï¼šMongoDBï¼ˆä½¿ç”¨ Mongoose ODMï¼‰  
**è®¤è¯**ï¼šJWT Tokenï¼ˆå¾®ä¿¡ç™»å½•é›†æˆï¼‰  
**éƒ¨ç½²**ï¼šæ”¯æŒ Docker å®¹å™¨åŒ–éƒ¨ç½²

**å¿…éœ€çš„ä¾èµ–åŒ…**ï¼š
```json
{
  "express": "^4.18.2",
  "mongoose": "^7.0.0",
  "jsonwebtoken": "^9.0.0",
  "bcryptjs": "^2.4.3",
  "dotenv": "^16.0.3",
  "cors": "^2.8.5",
  "helmet": "^7.0.0",
  "morgan": "^1.10.0",
  "axios": "^1.4.0",
  "multer": "^1.4.5-lts.1",
  "joi": "^17.9.2"
}
```

### 2. é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.js      # MongoDB è¿æ¥é…ç½®
â”‚   â”‚   â”œâ”€â”€ jwt.js           # JWT é…ç½®
â”‚   â”‚   â””â”€â”€ wechat.js        # å¾®ä¿¡ API é…ç½®
â”‚   â”œâ”€â”€ models/              # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ User.js          # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Goods.js         # å•†å“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Order.js         # è®¢å•æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Cart.js          # è´­ç‰©è½¦æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Favorite.js      # æ”¶è—æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Address.js       # åœ°å€æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Coupon.js        # ä¼˜æƒ åˆ¸æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Bargain.js       # ç ä»·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Category.js      # åˆ†ç±»æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Style.js         # é£æ ¼æ¨¡å‹
â”‚   â”‚   â””â”€â”€ Package.js       # å¥—é¤æ¨¡å‹
â”‚   â”œâ”€â”€ routes/              # è·¯ç”±æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.js          # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ user.js          # ç”¨æˆ·è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ goods.js         # å•†å“è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ orders.js        # è®¢å•è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ cart.js          # è´­ç‰©è½¦è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ favorites.js     # æ”¶è—è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ addresses.js     # åœ°å€è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ coupons.js       # ä¼˜æƒ åˆ¸è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ bargain.js       # ç ä»·è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ home.js          # é¦–é¡µè·¯ç”±
â”‚   â”‚   â””â”€â”€ packages.js      # å¥—é¤è·¯ç”±
â”‚   â”œâ”€â”€ controllers/         # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â”œâ”€â”€ userController.js
â”‚   â”‚   â”œâ”€â”€ goodsController.js
â”‚   â”‚   â”œâ”€â”€ orderController.js
â”‚   â”‚   â”œâ”€â”€ cartController.js
â”‚   â”‚   â”œâ”€â”€ favoriteController.js
â”‚   â”‚   â”œâ”€â”€ addressController.js
â”‚   â”‚   â”œâ”€â”€ couponController.js
â”‚   â”‚   â”œâ”€â”€ bargainController.js
â”‚   â”‚   â”œâ”€â”€ homeController.js
â”‚   â”‚   â””â”€â”€ packageController.js
â”‚   â”œâ”€â”€ middleware/          # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.js          # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ errorHandler.js  # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ validation.js    # æ•°æ®éªŒè¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ wechatService.js # å¾®ä¿¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ orderService.js  # è®¢å•æœåŠ¡
â”‚   â”‚   â””â”€â”€ bargainService.js# ç ä»·æœåŠ¡
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ response.js      # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â”œâ”€â”€ logger.js        # æ—¥å¿—å·¥å…·
â”‚   â”‚   â””â”€â”€ validators.js    # éªŒè¯å·¥å…·
â”‚   â””â”€â”€ app.js               # åº”ç”¨ä¸»æ–‡ä»¶
â”œâ”€â”€ .env                     # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json
â”œâ”€â”€ server.js                # å¯åŠ¨æ–‡ä»¶
â””â”€â”€ README.md
```

---

## ğŸ”Œ API æ¥å£è§„èŒƒ

### 1. ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰æ¥å£å¿…é¡»è¿”å›ç»Ÿä¸€æ ¼å¼ï¼š

```javascript
// æˆåŠŸå“åº”
{
  "code": 0,
  "message": "success",
  "data": { /* å®é™…æ•°æ® */ }
}

// å¤±è´¥å“åº”
{
  "code": 400,
  "message": "é”™è¯¯ä¿¡æ¯æè¿°",
  "data": null
}
```

### 2. HTTP çŠ¶æ€ç è§„èŒƒ

- `200`ï¼šè¯·æ±‚æˆåŠŸ
- `400`ï¼šè¯·æ±‚å‚æ•°é”™è¯¯
- `401`ï¼šæœªæˆæƒï¼ˆéœ€è¦ç™»å½•ï¼‰
- `403`ï¼šç¦æ­¢è®¿é—®
- `404`ï¼šèµ„æºä¸å­˜åœ¨
- `500`ï¼šæœåŠ¡å™¨é”™è¯¯

### 3. è®¤è¯æ–¹å¼

éœ€è¦è®¤è¯çš„æ¥å£ï¼Œè¯·æ±‚å¤´éœ€åŒ…å«ï¼š
```
Authorization: Bearer {token}
```

Token ç”±å¾®ä¿¡ç™»å½•æ¥å£è¿”å›ï¼Œå‰ç«¯å­˜å‚¨åœ¨æœ¬åœ°ã€‚

---

## ğŸ“¦ æ•°æ®æ¨¡å‹è®¾è®¡

### 1. ç”¨æˆ·æ¨¡å‹ï¼ˆUserï¼‰

```javascript
{
  _id: ObjectId,
  openId: String,           // å¾®ä¿¡ openIdï¼ˆå”¯ä¸€ï¼‰
  unionId: String,          // å¾®ä¿¡ unionId
  nickname: String,         // æ˜µç§°
  avatar: String,           // å¤´åƒ
  phone: String,            // æ‰‹æœºå·
  email: String,            // é‚®ç®±
  token: String,            // JWT Token
  createdAt: Date,
  updatedAt: Date
}
```

### 2. å•†å“æ¨¡å‹ï¼ˆGoodsï¼‰

```javascript
{
  _id: ObjectId,
  id: String,               // å•†å“IDï¼ˆè‡ªå®šä¹‰ï¼‰
  name: String,             // å•†å“åç§°
  code: String,             // å•†å“ç¼–ç 
  price: Number,            // åŸºç¡€ä»·æ ¼
  thumb: String,            // ç¼©ç•¥å›¾
  images: [String],         // å•†å“å›¾ç‰‡æ•°ç»„
  detailImages: [String],   // è¯¦æƒ…å›¾ç‰‡æ•°ç»„
  category: String,         // åˆ†ç±»åç§°
  categoryId: String,       // åˆ†ç±»ID
  style: String,            // é£æ ¼
  styleId: String,          // é£æ ¼ID
  description: String,      // å•†å“æè¿°
  stock: Number,            // åº“å­˜
  sales: Number,            // é”€é‡
  
  // è§„æ ¼é…ç½®
  sizes: [{
    id: String,
    name: String,
    dims: String,           // å°ºå¯¸æè¿°
    img: String,
    extra: Number           // é¢å¤–åŠ ä»·
  }],
  
  materialsGroups: [{
    id: String,
    name: String,
    extra: Number,
    better: Boolean,
    img: String,
    colors: [{
      id: String,
      name: String
    }]
  }],
  
  fills: [{
    id: String,
    name: String,
    extra: Number,
    better: Boolean,
    img: String
  }],
  
  frames: [{
    id: String,
    name: String,
    extra: Number,
    better: Boolean,
    img: String
  }],
  
  legs: [{
    id: String,
    name: String,
    extra: Number,
    better: Boolean,
    img: String
  }],
  
  createdAt: Date,
  updatedAt: Date
}
```

### 3. è®¢å•æ¨¡å‹ï¼ˆOrderï¼‰

```javascript
{
  _id: ObjectId,
  id: String,               // è®¢å•ID
  orderNo: String,          // è®¢å•å·ï¼ˆå”¯ä¸€ï¼‰
  userId: ObjectId,         // ç”¨æˆ·ID
  type: String,             // è®¢å•ç±»å‹ï¼šnormal æˆ– package
  status: Number,           // çŠ¶æ€ï¼š1-å¾…ä»˜æ¬¾, 2-å¾…å‘è´§, 3-å¾…æ”¶è´§, 4-å·²å®Œæˆ, 5-å·²å–æ¶ˆ
  totalPrice: Number,       // è®¢å•æ€»ä»·
  
  goods: [{
    id: String,
    name: String,
    code: String,
    price: Number,
    count: Number,
    thumb: String,
    specs: {
      size: String,
      material: String,
      materialColor: String,
      fill: String,
      frame: String,
      leg: String
    }
  }],
  
  // æ”¶è´§ä¿¡æ¯
  name: String,             // æ”¶è´§äººå§“å
  phone: String,            // æ”¶è´§äººç”µè¯
  address: String,          // æ”¶è´§åœ°å€
  
  // æ—¶é—´æˆ³
  createTime: Date,
  payTime: Date,
  shipTime: Date,
  completeTime: Date,
  
  createdAt: Date,
  updatedAt: Date
}
```

### 4. è´­ç‰©è½¦æ¨¡å‹ï¼ˆCartï¼‰

```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  goodsId: String,
  goodsName: String,
  price: Number,
  count: Number,
  specs: {
    size: String,
    material: String,
    materialColor: String,
    fill: String,
    frame: String,
    leg: String
  },
  createdAt: Date,
  updatedAt: Date
}
```

### 5. æ”¶è—æ¨¡å‹ï¼ˆFavoriteï¼‰

```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  goodsId: String,
  goodsName: String,
  thumb: String,
  price: Number,
  createdAt: Date
}
```

### 6. åœ°å€æ¨¡å‹ï¼ˆAddressï¼‰

```javascript
{
  _id: ObjectId,
  userId: ObjectId,
  name: String,
  phone: String,
  province: String,
  city: String,
  district: String,
  address: String,
  isDefault: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

### 7. ä¼˜æƒ åˆ¸æ¨¡å‹ï¼ˆCouponï¼‰

```javascript
{
  _id: ObjectId,
  code: String,             // ä¼˜æƒ åˆ¸ç 
  type: String,             // ç±»å‹ï¼šfixedï¼ˆå›ºå®šé‡‘é¢ï¼‰æˆ– percentï¼ˆç™¾åˆ†æ¯”ï¼‰
  value: Number,            // ä¼˜æƒ å€¼
  minAmount: Number,        // æœ€ä½æ¶ˆè´¹é‡‘é¢
  maxAmount: Number,        // æœ€é«˜ä¼˜æƒ é‡‘é¢
  validFrom: Date,          // æœ‰æ•ˆæœŸå¼€å§‹
  validTo: Date,            // æœ‰æ•ˆæœŸç»“æŸ
  usageLimit: Number,       // ä½¿ç”¨æ¬¡æ•°é™åˆ¶
  usageCount: Number,       // å·²ä½¿ç”¨æ¬¡æ•°
  createdAt: Date,
  updatedAt: Date
}
```

### 8. ç ä»·æ¨¡å‹ï¼ˆBargainï¼‰

```javascript
{
  _id: ObjectId,
  goodsId: String,
  goodsName: String,
  originalPrice: Number,    // åŸä»·
  targetPrice: Number,      // ç›®æ ‡ä»·æ ¼
  currentPrice: Number,     // å½“å‰ä»·æ ¼
  userId: ObjectId,         // å‘èµ·äºº
  status: String,           // çŠ¶æ€ï¼šactive æˆ– completed
  helpers: [{
    userId: ObjectId,
    bargainAmount: Number,  // ç ä»·é‡‘é¢
    createdAt: Date
  }],
  createdAt: Date,
  updatedAt: Date
}
```

---

## ğŸ”Œ å®Œæ•´ API æ¥å£åˆ—è¡¨

### 1. è®¤è¯æ¥å£

#### 1.1 å¾®ä¿¡ç™»å½•
```
POST /api/auth/wxlogin
è¯·æ±‚ä½“ï¼š{ code: String }
å“åº”ï¼š{ token: String, userInfo: Object }
è®¤è¯ï¼šå¦
```

#### 1.2 è·å–ç”¨æˆ·ä¿¡æ¯
```
GET /api/user/info
å“åº”ï¼š{ id, openId, nickname, avatar, phone, email }
è®¤è¯ï¼šæ˜¯
```

---

### 2. é¦–é¡µæ¥å£

#### 2.1 è·å–é¦–é¡µæ•°æ®
```
GET /api/home
å“åº”ï¼š{
  fullscreenImage: String,
  newProductsImage: String,
  banners: [String],
  styles: [Object],
  hots: [Object]
}
è®¤è¯ï¼šå¦
```

---

### 3. å•†å“æ¥å£

#### 3.1 è·å–å•†å“åˆ—è¡¨
```
GET /api/goods/list
æŸ¥è¯¢å‚æ•°ï¼š
  - page: Number (é»˜è®¤ 1)
  - pageSize: Number (é»˜è®¤ 10)
  - category: String (å¯é€‰)
  - style: String (å¯é€‰)
  - sort: String (å¯é€‰ï¼šprice_asc, price_desc, sales_desc)

å“åº”ï¼š{
  list: [Object],
  total: Number,
  page: Number,
  pageSize: Number
}
è®¤è¯ï¼šå¦
```

#### 3.2 æœç´¢å•†å“
```
GET /api/goods/search
æŸ¥è¯¢å‚æ•°ï¼š
  - keyword: String
  - page: Number (é»˜è®¤ 1)
  - pageSize: Number (é»˜è®¤ 10)

å“åº”ï¼š{
  list: [Object],
  total: Number
}
è®¤è¯ï¼šå¦
```

#### 3.3 è·å–å•†å“è¯¦æƒ…
```
GET /api/goods/:id
å“åº”ï¼šå®Œæ•´çš„å•†å“å¯¹è±¡ï¼ˆåŒ…å«æ‰€æœ‰è§„æ ¼é…ç½®ï¼‰
è®¤è¯ï¼šå¦
```

#### 3.4 è·å–åˆ†ç±»åˆ—è¡¨
```
GET /api/categories
å“åº”ï¼š[{ id, name, icon, sort }]
è®¤è¯ï¼šå¦
```

#### 3.5 è·å–é£æ ¼åˆ—è¡¨
```
GET /api/styles
å“åº”ï¼š[{ id, name, icon, sort }]
è®¤è¯ï¼šå¦
```

---

### 4. è´­ç‰©è½¦æ¥å£

#### 4.1 è·å–è´­ç‰©è½¦
```
GET /api/cart
å“åº”ï¼š[{ _id, goodsId, goodsName, price, count, specs }]
è®¤è¯ï¼šæ˜¯
```

#### 4.2 æ·»åŠ åˆ°è´­ç‰©è½¦
```
POST /api/cart
è¯·æ±‚ä½“ï¼š{
  goodsId: String,
  count: Number,
  specs: {
    size: String,
    material: String,
    materialColor: String,
    fill: String,
    frame: String,
    leg: String
  }
}
å“åº”ï¼š{ _id, message: "æ·»åŠ æˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

#### 4.3 æ›´æ–°è´­ç‰©è½¦å•†å“æ•°é‡
```
PUT /api/cart/:cartId
è¯·æ±‚ä½“ï¼š{ count: Number }
å“åº”ï¼š{ message: "æ›´æ–°æˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

#### 4.4 åˆ é™¤è´­ç‰©è½¦å•†å“
```
DELETE /api/cart/:cartId
å“åº”ï¼š{ message: "åˆ é™¤æˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

---

### 5. æ”¶è—æ¥å£

#### 5.1 è·å–æ”¶è—åˆ—è¡¨
```
GET /api/favorites
æŸ¥è¯¢å‚æ•°ï¼š
  - page: Number (é»˜è®¤ 1)
  - pageSize: Number (é»˜è®¤ 10)

å“åº”ï¼š{
  list: [Object],
  total: Number
}
è®¤è¯ï¼šæ˜¯
```

#### 5.2 æ·»åŠ æ”¶è—
```
POST /api/favorites
è¯·æ±‚ä½“ï¼š{ goodsId: String }
å“åº”ï¼š{ message: "æ”¶è—æˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

#### 5.3 å–æ¶ˆæ”¶è—
```
DELETE /api/favorites/:goodsId
å“åº”ï¼š{ message: "å–æ¶ˆæ”¶è—æˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

---

### 6. è®¢å•æ¥å£

#### 6.1 åˆ›å»ºè®¢å•
```
POST /api/orders
è¯·æ±‚ä½“ï¼š{
  type: String,           // "normal" æˆ– "package"
  totalPrice: Number,
  goods: [{
    id: String,
    name: String,
    price: Number,
    count: Number,
    specs: Object
  }],
  name: String,           // æ”¶è´§äºº
  phone: String,
  address: String
}
å“åº”ï¼š{ orderId: String, orderNo: String }
è®¤è¯ï¼šæ˜¯
```

#### 6.2 è·å–è®¢å•åˆ—è¡¨
```
GET /api/orders
æŸ¥è¯¢å‚æ•°ï¼š
  - status: Number (å¯é€‰ï¼š1-5)
  - page: Number (é»˜è®¤ 1)
  - pageSize: Number (é»˜è®¤ 10)

å“åº”ï¼š{
  list: [Object],
  total: Number
}
è®¤è¯ï¼šæ˜¯
```

#### 6.3 è·å–è®¢å•è¯¦æƒ…
```
GET /api/orders/:orderId
å“åº”ï¼šå®Œæ•´çš„è®¢å•å¯¹è±¡
è®¤è¯ï¼šæ˜¯
```

#### 6.4 å–æ¶ˆè®¢å•
```
POST /api/orders/:orderId/cancel
å“åº”ï¼š{ message: "å–æ¶ˆæˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

#### 6.5 ç¡®è®¤æ”¶è´§
```
POST /api/orders/:orderId/confirm
å“åº”ï¼š{ message: "ç¡®è®¤æˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

---

### 7. åœ°å€æ¥å£

#### 7.1 è·å–åœ°å€åˆ—è¡¨
```
GET /api/addresses
å“åº”ï¼š[{ _id, name, phone, province, city, district, address, isDefault }]
è®¤è¯ï¼šæ˜¯
```

#### 7.2 æ·»åŠ åœ°å€
```
POST /api/addresses
è¯·æ±‚ä½“ï¼š{
  name: String,
  phone: String,
  province: String,
  city: String,
  district: String,
  address: String,
  isDefault: Boolean
}
å“åº”ï¼š{ _id, message: "æ·»åŠ æˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

#### 7.3 æ›´æ–°åœ°å€
```
PUT /api/addresses/:addressId
è¯·æ±‚ä½“ï¼š{ åŒæ·»åŠ åœ°å€ }
å“åº”ï¼š{ message: "æ›´æ–°æˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

#### 7.4 åˆ é™¤åœ°å€
```
DELETE /api/addresses/:addressId
å“åº”ï¼š{ message: "åˆ é™¤æˆåŠŸ" }
è®¤è¯ï¼šæ˜¯
```

---

### 8. ä¼˜æƒ åˆ¸æ¥å£

#### 8.1 è·å–ä¼˜æƒ åˆ¸åˆ—è¡¨
```
GET /api/coupons
æŸ¥è¯¢å‚æ•°ï¼š
  - status: String (å¯é€‰ï¼šavailable, used, expired)

å“åº”ï¼š[{
  _id, code, type, value, minAmount, maxAmount,
  validFrom, validTo, usageLimit, usageCount
}]
è®¤è¯ï¼šæ˜¯
```

---

### 9. ç ä»·æ¥å£

#### 9.1 è·å–ç ä»·å•†å“åˆ—è¡¨
```
GET /api/bargain/goods
æŸ¥è¯¢å‚æ•°ï¼š
  - page: Number (é»˜è®¤ 1)
  - pageSize: Number (é»˜è®¤ 10)

å“åº”ï¼š{
  list: [Object],
  total: Number
}
è®¤è¯ï¼šå¦
```

#### 9.2 å‘èµ·ç ä»·
```
POST /api/bargain/start
è¯·æ±‚ä½“ï¼š{ goodsId: String }
å“åº”ï¼š{ bargainId: String }
è®¤è¯ï¼šæ˜¯
```

#### 9.3 è·å–æˆ‘çš„ç ä»·åˆ—è¡¨
```
GET /api/bargain/my
å“åº”ï¼š[Object]
è®¤è¯ï¼šæ˜¯
```

#### 9.4 å¸®å¥½å‹ç ä»·
```
POST /api/bargain/:bargainId/help
å“åº”ï¼š{ message: "ç ä»·æˆåŠŸ", currentPrice: Number }
è®¤è¯ï¼šæ˜¯
```

---

### 10. å¥—é¤æ¥å£

#### 10.1 è·å–å¥—é¤åˆ—è¡¨
```
GET /api/packages
æŸ¥è¯¢å‚æ•°ï¼š
  - page: Number (é»˜è®¤ 1)
  - pageSize: Number (é»˜è®¤ 10)

å“åº”ï¼š{
  list: [Object],
  total: Number
}
è®¤è¯ï¼šå¦
```

#### 10.2 è·å–å¥—é¤è¯¦æƒ…
```
GET /api/packages/:packageId
å“åº”ï¼šå®Œæ•´çš„å¥—é¤å¯¹è±¡
è®¤è¯ï¼šå¦
```

---

## ğŸ› ï¸ å¼€å‘è¦æ±‚

### 1. ä¸­é—´ä»¶é…ç½®

- **CORS**ï¼šå…è®¸å°ç¨‹åºå’Œ Web å‰ç«¯è·¨åŸŸè¯·æ±‚
- **è®¤è¯ä¸­é—´ä»¶**ï¼šéªŒè¯ JWT Token
- **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- **è¯·æ±‚éªŒè¯**ï¼šä½¿ç”¨ Joi è¿›è¡Œæ•°æ®éªŒè¯

### 2. å¾®ä¿¡é›†æˆ

- ä½¿ç”¨å¾®ä¿¡å®˜æ–¹ API éªŒè¯ç™»å½• code
- è·å–ç”¨æˆ·çš„ openId å’Œ unionId
- ç”Ÿæˆ JWT Token è¿”å›ç»™å‰ç«¯

### 3. æ•°æ®éªŒè¯

- æ‰€æœ‰è¾“å…¥æ•°æ®å¿…é¡»è¿›è¡ŒéªŒè¯
- è¿”å›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

### 4. é”™è¯¯å¤„ç†

- ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

### 5. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨æ•°æ®åº“ç´¢å¼•
- å®ç°åˆ†é¡µæŸ¥è¯¢
- ç¼“å­˜å¸¸ç”¨æ•°æ®ï¼ˆå¯é€‰ï¼‰

### 6. å®‰å…¨æ€§

- å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆbcryptjsï¼‰
- JWT Token éªŒè¯
- è¾“å…¥æ•°æ®éªŒè¯å’Œæ¸…ç†
- é˜²æ­¢ SQL æ³¨å…¥ï¼ˆMongoDB æ³¨å…¥ï¼‰

---

## ğŸ“ ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```
# æœåŠ¡å™¨é…ç½®
PORT=5000
NODE_ENV=development

# æ•°æ®åº“é…ç½®
MONGODB_URI=mongodb://localhost:27017/xiaodiyanxuan
MONGODB_USER=
MONGODB_PASSWORD=

# JWT é…ç½®
JWT_SECRET=your_jwt_secret_key_here
JWT_EXPIRE=7d

# å¾®ä¿¡é…ç½®
WECHAT_APPID=your_wechat_appid
WECHAT_APPSECRET=your_wechat_appsecret

# æ—¥å¿—é…ç½®
LOG_LEVEL=debug

# CORS é…ç½®
CORS_ORIGIN=http://localhost:3000,http://localhost:8080
```

---

## ğŸš€ å¯åŠ¨å’Œéƒ¨ç½²

### 1. æœ¬åœ°å¼€å‘

```bash
npm install
npm run dev
```

### 2. ç”Ÿäº§ç¯å¢ƒ

```bash
npm run build
npm start
```

### 3. Docker éƒ¨ç½²

åˆ›å»º `Dockerfile`ï¼š

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY src ./src

EXPOSE 5000

CMD ["node", "server.js"]
```

---

## âœ… å¼€å‘æ£€æŸ¥æ¸…å•

- [ ] é¡¹ç›®åˆå§‹åŒ–å’Œä¾èµ–å®‰è£…
- [ ] MongoDB æ•°æ®åº“è¿æ¥
- [ ] ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆå¾®ä¿¡ç™»å½•ï¼‰
- [ ] JWT Token ç”Ÿæˆå’ŒéªŒè¯
- [ ] å•†å“æ¨¡å—ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€æœç´¢ï¼‰
- [ ] è´­ç‰©è½¦æ¨¡å—
- [ ] è®¢å•æ¨¡å—
- [ ] æ”¶è—æ¨¡å—
- [ ] åœ°å€ç®¡ç†æ¨¡å—
- [ ] ä¼˜æƒ åˆ¸æ¨¡å—
- [ ] ç ä»·æ¨¡å—
- [ ] å¥—é¤æ¨¡å—
- [ ] é¦–é¡µæ•°æ®æ¥å£
- [ ] é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- [ ] æ•°æ®éªŒè¯
- [ ] API æ–‡æ¡£ç”Ÿæˆï¼ˆSwaggerï¼‰
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å®‰å…¨å®¡è®¡

---

## ğŸ“š å‚è€ƒèµ„æº

- Express.js å®˜æ–¹æ–‡æ¡£ï¼šhttps://expressjs.com/
- Mongoose å®˜æ–¹æ–‡æ¡£ï¼šhttps://mongoosejs.com/
- JWT è®¤è¯ï¼šhttps://jwt.io/
- å¾®ä¿¡å°ç¨‹åºå¼€å‘æ–‡æ¡£ï¼šhttps://developers.weixin.qq.com/miniprogram/

---

## âš ï¸ é‡è¦æç¤º

1. **HTTPS è¦æ±‚**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
2. **åŸŸåå¤‡æ¡ˆ**ï¼šå°ç¨‹åºä½¿ç”¨çš„åŸŸåå¿…é¡»å·²å¤‡æ¡ˆ
3. **æ•°æ®å®‰å…¨**ï¼šæ•æ„Ÿä¿¡æ¯ä¸è¦ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
4. **API é™æµ**ï¼šå»ºè®®å®ç° API é™æµé˜²æ­¢æ»¥ç”¨
5. **æ—¥å¿—è®°å½•**ï¼šè®°å½•æ‰€æœ‰é‡è¦æ“ä½œä¾¿äºè°ƒè¯•å’Œå®¡è®¡

---

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

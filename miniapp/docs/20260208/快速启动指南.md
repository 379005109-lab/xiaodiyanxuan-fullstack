# å°è¿ªä¸¥é€‰ - åç«¯å¿«é€Ÿå¯åŠ¨æŒ‡å—

## å¿«é€Ÿæ¦‚è§ˆ

| é¡¹ç›® | è¯´æ˜ |
|-----|------|
| æ¥å£æ€»æ•° | 26ä¸ª |
| è®¤è¯æ–¹å¼ | JWT Bearer Token |
| æ•°æ®æ ¼å¼ | JSON |
| å¿…é¡»HTTPS | æ˜¯ï¼ˆå°ç¨‹åºè¦æ±‚ï¼‰ |

---

## ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåç«¯é¡¹ç›®

```bash
mkdir xiaodi-backend && cd xiaodi-backend
npm init -y
npm install express mongoose jsonwebtoken axios cors dotenv
```

---

## ç¬¬äºŒæ­¥ï¼šé¡¹ç›®ç»“æ„

```
xiaodi-backend/
â”œâ”€â”€ server.js           # å…¥å£æ–‡ä»¶
â”œâ”€â”€ config/
â”‚   â””â”€â”€ db.js          # æ•°æ®åº“é…ç½®
â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ User.js
â”‚   â”œâ”€â”€ Goods.js
â”‚   â”œâ”€â”€ Order.js
â”‚   â”œâ”€â”€ Cart.js
â”‚   â””â”€â”€ Address.js
â”œâ”€â”€ routes/            # è·¯ç”±
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ goods.js
â”‚   â”œâ”€â”€ cart.js
â”‚   â”œâ”€â”€ orders.js
â”‚   â””â”€â”€ addresses.js
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.js        # JWTéªŒè¯ä¸­é—´ä»¶
â””â”€â”€ .env
```

---

## ç¬¬ä¸‰æ­¥ï¼šæ ¸å¿ƒä»£ç ç¤ºä¾‹

### server.js
```javascript
const express = require('express')
const mongoose = require('mongoose')
const cors = require('cors')
require('dotenv').config()

const app = express()
app.use(cors())
app.use(express.json())

// æ•°æ®åº“è¿æ¥
mongoose.connect(process.env.MONGODB_URI)

// è·¯ç”±
app.use('/api/auth', require('./routes/auth'))
app.use('/api/goods', require('./routes/goods'))
app.use('/api/cart', require('./routes/cart'))
app.use('/api/orders', require('./routes/orders'))
app.use('/api/addresses', require('./routes/addresses'))
app.use('/api/favorites', require('./routes/favorites'))
app.use('/api/bargain', require('./routes/bargain'))
app.use('/api/coupons', require('./routes/coupons'))

// é¦–é¡µæ•°æ®
app.get('/api/home', (req, res) => {
  res.json({ code: 0, data: { banners: [], hotGoods: [] } })
})

// ç”¨æˆ·ä¿¡æ¯
app.get('/api/user/info', authMiddleware, (req, res) => {
  res.json({ code: 0, data: req.user })
})

const PORT = process.env.PORT || 5000
app.listen(PORT, () => console.log(`Server running on port ${PORT}`))
```

### JWTä¸­é—´ä»¶ (middleware/auth.js)
```javascript
const jwt = require('jsonwebtoken')

module.exports = (req, res, next) => {
  const token = req.headers.authorization?.split(' ')[1]
  if (!token) {
    return res.status(401).json({ code: 401, message: 'æœªç™»å½•' })
  }
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET)
    req.user = decoded
    next()
  } catch (err) {
    return res.status(401).json({ code: 401, message: 'tokenæ— æ•ˆ' })
  }
}
```

---

## ç¬¬å››æ­¥ï¼šä¼˜å…ˆå®ç°çš„æ¥å£

æŒ‰é‡è¦ç¨‹åº¦æ’åºï¼Œå»ºè®®æŒ‰æ­¤é¡ºåºå®ç°ï¼š

### ğŸ”´ å¿…é¡»å®ç°ï¼ˆæ ¸å¿ƒæµç¨‹ï¼‰
1. `POST /api/auth/wxlogin` - å¾®ä¿¡ç™»å½•
2. `GET /api/goods/list` - å•†å“åˆ—è¡¨
3. `GET /api/goods/:id` - å•†å“è¯¦æƒ…
4. `POST /api/orders` - åˆ›å»ºè®¢å•
5. `GET /api/orders` - è®¢å•åˆ—è¡¨

### ğŸŸ¡ é‡è¦åŠŸèƒ½
6. `GET /api/cart` - è´­ç‰©è½¦
7. `POST /api/cart` - æ·»åŠ è´­ç‰©è½¦
8. `PUT /api/cart/:id` - æ›´æ–°è´­ç‰©è½¦
9. `DELETE /api/cart/:id` - åˆ é™¤è´­ç‰©è½¦
10. `POST /api/orders/:id/cancel` - å–æ¶ˆè®¢å•

### ğŸŸ¢ æ¬¡è¦åŠŸèƒ½
11. æ”¶è—ç›¸å…³ (3ä¸ª)
12. åœ°å€ç›¸å…³ (4ä¸ª)
13. ç ä»·ç›¸å…³ (4ä¸ª)
14. ä¼˜æƒ åˆ¸ (1ä¸ª)

---

## ç¬¬äº”æ­¥ï¼šå“åº”æ ¼å¼ç»Ÿä¸€

**æˆåŠŸå“åº”ï¼š**
```json
{
  "code": 0,
  "data": { ... },
  "message": "success"
}
```

**é”™è¯¯å“åº”ï¼š**
```json
{
  "code": é”™è¯¯ç ,
  "message": "é”™è¯¯ä¿¡æ¯"
}
```

---

## ç¬¬å…­æ­¥ï¼šæµ‹è¯•æ¥å£

ä½¿ç”¨ Postman æˆ– curl æµ‹è¯•ï¼š

```bash
# æµ‹è¯•å•†å“åˆ—è¡¨
curl https://your-domain.com/api/goods/list

# æµ‹è¯•åˆ›å»ºè®¢å•ï¼ˆéœ€è¦tokenï¼‰
curl -X POST https://your-domain.com/api/orders \
  -H "Authorization: Bearer your_token" \
  -H "Content-Type: application/json" \
  -d '{"goods":[...],"totalPrice":9999}'
```

---

## ç¬¬ä¸ƒæ­¥ï¼šéƒ¨ç½²ä¸Šçº¿

1. é…ç½®HTTPSè¯ä¹¦
2. è®¾ç½®ç¯å¢ƒå˜é‡
3. å¯åŠ¨æœåŠ¡
4. å°ç¨‹åºåå°é…ç½®åŸŸåç™½åå•
5. ä¿®æ”¹å‰ç«¯ `config/api.js` çš„ baseURL

---

## è”è°ƒæ³¨æ„äº‹é¡¹

1. **æ‰€æœ‰æ¥å£å¿…é¡»è¿”å›JSONæ ¼å¼**
2. **è®¤è¯æ¥å£éœ€è¦éªŒè¯JWT token**
3. **è®¢å•çŠ¶æ€ç ï¼š1å¾…ä»˜æ¬¾ 2å¾…å‘è´§ 3å¾…æ”¶è´§ 4å·²å®Œæˆ 5å·²å–æ¶ˆ**
4. **å›¾ç‰‡URLå¿…é¡»æ˜¯HTTPS**

---

## æœ‰é—®é¢˜ï¼Ÿ

æŸ¥çœ‹ `åç«¯å¯¹æ¥æ–‡æ¡£.md` è·å–è¯¦ç»†æ¥å£è¯´æ˜ã€‚

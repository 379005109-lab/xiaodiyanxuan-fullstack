<navigation-bar title="{{storeName}}" back="{{false}}" color="black" background="#FFF"></navigation-bar>
<scroll-view class="page-scroll" scroll-y enhanced show-scrollbar="{{false}}" bounces="{{true}}" bindscrolltolower="onReachBottom">
<view class="page" style="background-color: {{pageBgColor}}; {{pageBgImage ? 'background-image: url(' + pageBgImage + '); background-size: cover;' : ''}}">

	<!-- åŠ è½½ä¸­ -->
	<view wx:if="{{loading}}" class="loading-container">
		<view class="loading-spinner"></view>
		<text class="loading-text">åŠ è½½ä¸­...</text>
	</view>

	<!-- åŠ è½½å¤±è´¥ -->
	<view wx:elif="{{loaded && loadError && components.length === 0}}" class="empty-container">
		<text class="empty-icon">âš ï¸</text>
		<text class="empty-text">{{loadError}}</text>
		<view class="empty-retry" bindtap="retryLoad">ç‚¹å‡»é‡è¯•</view>
	</view>

	<!-- åŠ¨æ€è£…ä¿®ç»„ä»¶å¾ªç¯æ¸²æŸ“ -->
	<block wx:for="{{components}}" wx:key="id">
		<view class="deco-comp" style="margin: {{item.style.marginTop || 0}}rpx {{item.style.marginLR || 0}}rpx {{item.style.marginBottom || 0}}rpx; background-color: {{item.style.bgColor || ''}}; border-radius: {{item.style.borderRadius || 0}}rpx; overflow: hidden;">

		<!-- ========== åº—é“ºå¤´éƒ¨ storeHeader ========== -->
		<view wx:if="{{item.type === 'storeHeader'}}" class="deco-store-header">
			<view class="shop-card">
				<view class="shop-main">
					<image class="shop-logo" src="{{item.config.logo}}" mode="aspectFill" wx:if="{{item.config.logo}}"></image>
					<view class="shop-logo-placeholder" wx:else>
						<text>{{item.config.name[0] || 'åº—'}}</text>
					</view>
					<view class="shop-info">
						<view class="shop-name-row">
							<text class="shop-name">{{item.config.name || 'åº—é“ºåç§°'}}</text>
							<view class="shop-verified" wx:if="{{item.config.isVerified}}">
								<text>âœ“ å·²è®¤è¯</text>
							</view>
						</view>
						<view class="shop-contact" wx:if="{{item.config.contactName || item.config.phone}}">
							<text class="shop-contact-name">è”ç³»äºº: {{item.config.contactName}}</text>
							<text class="shop-contact-phone" wx:if="{{item.config.phone}}"> {{item.config.phone}}</text>
						</view>
						<view class="shop-address text-ellipsis" wx:if="{{item.config.address}}">ğŸ“ {{item.config.address}}</view>
						<view class="shop-desc text-ellipsis" wx:if="{{item.config.description}}">{{item.config.description}}</view>
					</view>
				</view>
				<view class="shop-actions">
					<view class="shop-action-btn" catchtap="goShopInfo">
						<text class="action-icon">ğŸª</text>
						<text>åº—é“ºä¿¡æ¯</text>
					</view>
					<view class="shop-action-btn" catchtap="goShopPoster">
						<text class="action-icon">ğŸ–¼</text>
						<text>åº—é“ºæµ·æŠ¥</text>
					</view>
				</view>
			</view>
		</view>

		<!-- ========== è½®æ’­å›¾ banner ========== -->
		<view wx:elif="{{item.type === 'banner' && item.config.items.length > 0}}" class="deco-banner">
			<swiper class="deco-banner-swiper" indicator-dots="{{false}}" autoplay="{{true}}" interval="5000" duration="700" circular current="{{currentBanner}}" bindchange="onBannerChange" style="border-radius: {{item.style.innerRadius || 0}}rpx; overflow: hidden;">
				<block wx:for="{{item.config.items}}" wx:for-item="banner" wx:for-index="bIdx" wx:key="bIdx">
					<swiper-item wx:if="{{banner.status !== false && banner.image}}">
						<view class="deco-banner-slide" bindtap="onBannerTap" data-link="{{banner.link}}">
							<image class="deco-banner-img" src="{{banner.image}}" mode="aspectFill"></image>
						</view>
					</swiper-item>
				</block>
			</swiper>
			<!-- æŒ‡ç¤ºå™¨ -->
			<view class="deco-banner-dots">
				<block wx:for="{{item.config.items}}" wx:for-item="banner" wx:for-index="bIdx" wx:key="bIdx">
					<view wx:if="{{banner.status !== false && banner.image}}" class="deco-dot {{currentBanner === bIdx ? 'active' : ''}}"></view>
				</block>
			</view>
		</view>

		<!-- ========== ç ä»·ä¸“åŒº bargain ========== -->
		<view wx:elif="{{item.type === 'bargain' && item.config.products && item.config.products.length > 0}}" class="deco-bargain" style="background: linear-gradient(180deg, {{item.config.headerBgColor || '#faad14'}} 0%, {{item.config.headerBgColor || '#faad14'}} 120rpx, {{item.config.contentBgColor || '#FFFFFF'}} 120rpx);">
			<view class="deco-bargain-header">
				<text class="deco-bargain-title" style="color: {{item.config.hintTextColor || '#FFFFFF'}};">{{item.config.title || 'ç ä»·ä¸“åŒº'}}</text>
			</view>

			<!-- æ¨ªå‘æ»‘åŠ¨å¸ƒå±€ layoutStyle=0 -->
			<scroll-view wx:if="{{!item.config.layoutStyle || item.config.layoutStyle === 0}}" class="deco-bargain-scroll" scroll-x enhanced show-scrollbar="{{false}}">
				<view class="deco-bargain-list">
					<block wx:for="{{item.config.products}}" wx:for-item="bp" wx:for-index="bpIdx" wx:key="_id">
						<view class="deco-bargain-card" bindtap="goBargainDetail" data-id="{{bp._id}}">
							<view class="deco-bargain-img-wrap">
								<image class="deco-bargain-img" src="{{bp.coverImage}}" mode="aspectFill"></image>
								<view class="deco-bargain-countdown">
									<text class="countdown-icon">â±</text>
									<text>{{bp.countdown || '00:00:00'}}</text>
								</view>
							</view>
							<view class="deco-bargain-info">
								<text wx:if="{{item.config.showName !== false}}" class="deco-bargain-name text-ellipsis" style="color: {{item.config.nameColor || '#333'}};">{{bp.name}}</text>
								<view wx:if="{{item.config.showTag !== false}}" class="deco-bargain-tags">
									<text class="deco-bargain-tag" style="color: {{item.config.headerBgColor || '#faad14'}}; border-color: {{item.config.headerBgColor || '#faad14'}};">ç ä»·</text>
									<text class="deco-bargain-discount" wx:if="{{bp.discount > 0}}">{{bp.discount}}%</text>
								</view>
								<view class="deco-bargain-price-row">
									<text wx:if="{{item.config.showPrice !== false}}" class="deco-bargain-price" style="color: {{item.config.headerBgColor || '#e8530e'}};">Â¥{{bp.targetPrice}}</text>
									<text wx:if="{{item.config.showOriginalPrice !== false}}" class="deco-bargain-origin-price" style="color: {{item.config.originalPriceColor || '#999'}};">Â¥{{bp.originalPrice}}</text>
								</view>
								<view wx:if="{{item.config.showButton}}" class="deco-bargain-btn" style="background: {{item.config.headerBgColor || '#faad14'}}; color: {{item.config.buttonTextColor || '#fff'}};">å»ç ä»·</view>
							</view>
						</view>
					</block>
				</view>
			</scroll-view>

			<!-- åˆ—è¡¨å¸ƒå±€ layoutStyle=1 -->
			<view wx:elif="{{item.config.layoutStyle === 1}}" class="deco-bargain-list-vertical">
				<block wx:for="{{item.config.products}}" wx:for-item="bp" wx:for-index="bpIdx" wx:key="_id">
					<view class="deco-bargain-list-item" bindtap="goBargainDetail" data-id="{{bp._id}}" style="background: {{item.config.contentBgColor || '#fff'}};">
						<view class="deco-bargain-list-img">
							<image src="{{bp.coverImage}}" mode="aspectFill"></image>
							<view class="deco-bargain-countdown">
								<text class="countdown-icon">â±</text>
								<text>{{bp.countdown || '00:00:00'}}</text>
							</view>
						</view>
						<view class="deco-bargain-list-info">
							<text wx:if="{{item.config.showName !== false}}" class="deco-bargain-name text-ellipsis-2" style="color: {{item.config.nameColor || '#333'}};">{{bp.name}}</text>
							<view wx:if="{{item.config.showTag !== false}}" class="deco-bargain-tags">
								<text class="deco-bargain-tag" style="color: {{item.config.headerBgColor || '#faad14'}}; border-color: {{item.config.headerBgColor || '#faad14'}};">ç ä»·</text>
							</view>
							<view class="deco-bargain-price-row">
								<text wx:if="{{item.config.showPrice !== false}}" class="deco-bargain-price" style="color: {{item.config.headerBgColor || '#e8530e'}};">Â¥{{bp.targetPrice}}</text>
								<text wx:if="{{item.config.showOriginalPrice !== false}}" class="deco-bargain-origin-price" style="color: {{item.config.originalPriceColor || '#999'}};">Â¥{{bp.originalPrice}}</text>
							</view>
							<view wx:if="{{item.config.showButton}}" class="deco-bargain-btn-sm" style="background: {{item.config.headerBgColor || '#faad14'}}; color: {{item.config.buttonTextColor || '#fff'}};">å»ç ä»·</view>
						</view>
					</view>
				</block>
			</view>

			<!-- ä¸¤åˆ—ç½‘æ ¼å¸ƒå±€ layoutStyle=2 -->
			<view wx:elif="{{item.config.layoutStyle === 2}}" class="deco-bargain-grid deco-bargain-grid-2">
				<block wx:for="{{item.config.products}}" wx:for-item="bp" wx:for-index="bpIdx" wx:key="_id">
					<view class="deco-bargain-grid-card" bindtap="goBargainDetail" data-id="{{bp._id}}" style="background: {{item.config.contentBgColor || '#fff'}};">
						<view class="deco-bargain-grid-img">
							<image src="{{bp.coverImage}}" mode="aspectFill"></image>
							<view class="deco-bargain-countdown-sm">
								<text class="countdown-icon">â±</text>
								<text>{{bp.countdown || '00:00:00'}}</text>
							</view>
						</view>
						<view class="deco-bargain-grid-info">
							<text wx:if="{{item.config.showName !== false}}" class="deco-bargain-name text-ellipsis" style="color: {{item.config.nameColor || '#333'}};">{{bp.name}}</text>
							<view wx:if="{{item.config.showTag !== false}}" class="deco-bargain-tags">
								<text class="deco-bargain-tag" style="color: {{item.config.headerBgColor || '#faad14'}}; border-color: {{item.config.headerBgColor || '#faad14'}};">ç ä»·</text>
							</view>
							<view class="deco-bargain-price-row">
								<text wx:if="{{item.config.showPrice !== false}}" class="deco-bargain-price" style="color: {{item.config.headerBgColor || '#e8530e'}};">Â¥{{bp.targetPrice}}</text>
								<text wx:if="{{item.config.showOriginalPrice !== false}}" class="deco-bargain-origin-price" style="color: {{item.config.originalPriceColor || '#999'}};">Â¥{{bp.originalPrice}}</text>
							</view>
							<view wx:if="{{item.config.showButton}}" class="deco-bargain-btn" style="background: {{item.config.headerBgColor || '#faad14'}}; color: {{item.config.buttonTextColor || '#fff'}};">å»ç ä»·</view>
						</view>
					</view>
				</block>
			</view>

			<!-- ä¸‰åˆ—ç½‘æ ¼å¸ƒå±€ layoutStyle=3 -->
			<view wx:elif="{{item.config.layoutStyle === 3}}" class="deco-bargain-grid deco-bargain-grid-3">
				<block wx:for="{{item.config.products}}" wx:for-item="bp" wx:for-index="bpIdx" wx:key="_id">
					<view class="deco-bargain-grid-card" bindtap="goBargainDetail" data-id="{{bp._id}}" style="background: {{item.config.contentBgColor || '#fff'}};">
						<view class="deco-bargain-grid-img deco-bargain-grid-img-sm">
							<image src="{{bp.coverImage}}" mode="aspectFill"></image>
						</view>
						<view class="deco-bargain-grid-info">
							<text wx:if="{{item.config.showName !== false}}" class="deco-bargain-name text-ellipsis" style="font-size: 24rpx; color: {{item.config.nameColor || '#333'}};">{{bp.name}}</text>
							<view class="deco-bargain-price-row">
								<text wx:if="{{item.config.showPrice !== false}}" class="deco-bargain-price" style="font-size: 28rpx; color: {{item.config.headerBgColor || '#e8530e'}};">Â¥{{bp.targetPrice}}</text>
								<text wx:if="{{item.config.showOriginalPrice !== false}}" class="deco-bargain-origin-price" style="font-size: 20rpx; color: {{item.config.originalPriceColor || '#999'}};">Â¥{{bp.originalPrice}}</text>
							</view>
							<view wx:if="{{item.config.showButton}}" class="deco-bargain-btn-sm" style="background: {{item.config.headerBgColor || '#faad14'}}; color: {{item.config.buttonTextColor || '#fff'}};">å»ç ä»·</view>
						</view>
					</view>
				</block>
			</view>
		</view>

		<!-- ========== æœç´¢æ¡† searchBox ========== -->
		<view wx:elif="{{item.type === 'searchBox'}}" class="deco-search" bindtap="onSearchTap">
			<view class="deco-search-box" style="border-radius: {{item.config.borderRadius || 20}}rpx; background-color: {{item.config.bgColor || '#f5f5f5'}};">
				<text class="deco-search-icon">ğŸ”</text>
				<text class="deco-search-placeholder">{{item.config.placeholder || 'æœç´¢å•†å“'}}</text>
			</view>
		</view>

		<!-- ========== æ ‡é¢˜ title ========== -->
		<view wx:elif="{{item.type === 'title'}}" class="deco-title" style="text-align: {{item.config.align || 'left'}};">
			<view class="deco-title-row">
				<view class="deco-title-left">
					<text class="deco-title-text" style="font-size: {{item.config.fontSize || 16}}px; color: {{item.config.color || '#282828'}}; font-weight: {{item.config.bold ? 'bold' : 'normal'}}; font-style: {{item.config.fontStyle || 'normal'}};">{{item.config.text}}</text>
					<text wx:if="{{item.config.subtitle}}" class="deco-subtitle-text" style="font-size: {{item.config.subtitleFontSize || 14}}px; color: {{item.config.subtitleColor || '#999'}};">{{item.config.subtitle}}</text>
				</view>
				<view wx:if="{{item.config.showRight}}" class="deco-title-right" bindtap="goLink" data-link="{{item.config.rightLink}}">
					<text style="font-size: {{item.config.rightFontSize || 12}}px; color: {{item.config.rightColor || '#999'}};">{{item.config.rightText || 'æ›´å¤š'}}</text>
					<text class="more-arrow">â€º</text>
				</view>
			</view>
		</view>

		<!-- ========== å•†å“åˆ—è¡¨ productList ========== -->
		<view wx:elif="{{item.type === 'productList' && item.config.products.length > 0}}" class="deco-products">
			<!-- grid ç½‘æ ¼å¸ƒå±€ -->
			<view wx:if="{{item.config.displayMode === 'grid' || !item.config.displayMode}}" class="deco-product-grid">
				<block wx:for="{{item.config.products}}" wx:for-item="prod" wx:for-index="pIdx" wx:key="_id">
					<view class="deco-product-card" bindtap="goProductDetail" data-id="{{prod._id}}">
						<view class="deco-product-img-wrap">
							<image class="deco-product-img" src="{{prod.thumbnail || prod.images[0] || ''}}" mode="aspectFill"></image>
						</view>
						<view class="deco-product-info">
							<view wx:if="{{item.config.showName !== false}}" class="deco-product-name text-ellipsis-2">{{prod.name}}</view>
							<view class="deco-product-bottom">
								<text wx:if="{{item.config.showPrice !== false}}" class="deco-product-price"><text class="price-symbol">Â¥</text>{{prod.basePrice || prod.price}}</text>
								<text wx:if="{{item.config.showSales && prod.sales}}" class="deco-product-sales">å·²å”®{{prod.sales}}</text>
							</view>
						</view>
					</view>
				</block>
			</view>
			<!-- list åˆ—è¡¨å¸ƒå±€ -->
			<view wx:elif="{{item.config.displayMode === 'list'}}" class="deco-product-list">
				<block wx:for="{{item.config.products}}" wx:for-item="prod" wx:for-index="pIdx" wx:key="_id">
					<view class="deco-product-list-item" bindtap="goProductDetail" data-id="{{prod._id}}">
						<image class="deco-product-list-img" src="{{prod.thumbnail || prod.images[0] || ''}}" mode="aspectFill"></image>
						<view class="deco-product-list-info">
							<view wx:if="{{item.config.showName !== false}}" class="deco-product-name text-ellipsis-2">{{prod.name}}</view>
							<view class="deco-product-bottom">
								<text wx:if="{{item.config.showPrice !== false}}" class="deco-product-price"><text class="price-symbol">Â¥</text>{{prod.basePrice || prod.price}}</text>
								<text wx:if="{{item.config.showSales && prod.sales}}" class="deco-product-sales">å·²å”®{{prod.sales}}</text>
							</view>
						</view>
					</view>
				</block>
			</view>
			<!-- scroll æ¨ªå‘æ»šåŠ¨å¸ƒå±€ -->
			<scroll-view wx:elif="{{item.config.displayMode === 'scroll'}}" class="deco-product-scroll" scroll-x enhanced show-scrollbar="{{false}}">
				<view class="deco-product-scroll-inner">
					<block wx:for="{{item.config.products}}" wx:for-item="prod" wx:for-index="pIdx" wx:key="_id">
						<view class="deco-product-scroll-card" bindtap="goProductDetail" data-id="{{prod._id}}">
							<image class="deco-product-scroll-img" src="{{prod.thumbnail || prod.images[0] || ''}}" mode="aspectFill"></image>
							<view wx:if="{{item.config.showName !== false}}" class="deco-product-name text-ellipsis-2">{{prod.name}}</view>
							<view class="deco-product-bottom">
								<text wx:if="{{item.config.showPrice !== false}}" class="deco-product-price"><text class="price-symbol">Â¥</text>{{prod.basePrice || prod.price}}</text>
								<text wx:if="{{item.config.showSales && prod.sales}}" class="deco-product-sales">å·²å”®{{prod.sales}}</text>
							</view>
						</view>
					</block>
				</view>
			</scroll-view>
		</view>

		<!-- ========== å›¾ç‰‡é­”æ–¹ imageCube ========== -->
		<view wx:elif="{{item.type === 'imageCube' && item.config.images.length > 0}}" class="deco-image-cube" style="border-radius: {{item.style.innerRadius || 0}}rpx; overflow: hidden;">
			<view class="deco-cube-grid deco-cube-col-{{item.config.columns || 2}}">
				<block wx:for="{{item.config.images}}" wx:for-item="img" wx:for-index="iIdx" wx:key="iIdx">
					<view class="deco-cube-item" bindtap="goLink" data-link="{{img.link}}">
						<image class="deco-cube-img" src="{{img.url}}" mode="aspectFill"></image>
					</view>
				</block>
			</view>
		</view>

		<!-- ========== èœå•å¯¼èˆª menuNav ========== -->
		<view wx:elif="{{item.type === 'menuNav' && item.config.items.length > 0}}" class="deco-menu-nav">
			<view class="deco-menu-grid deco-menu-col-{{item.config.columns || 4}}">
				<block wx:for="{{item.config.items}}" wx:for-item="nav" wx:for-index="nIdx" wx:key="nIdx">
					<view class="deco-menu-item" bindtap="goLink" data-link="{{nav.link}}">
						<view class="deco-menu-icon-wrap {{item.config.shape === 'round' ? 'round' : ''}}">
							<image wx:if="{{nav.image}}" class="deco-menu-icon" src="{{nav.image}}" mode="aspectFill"></image>
							<view wx:else class="deco-menu-icon-placeholder">
								<text>{{nav.text[0] || ''}}</text>
							</view>
						</view>
						<text class="deco-menu-text">{{nav.text}}</text>
					</view>
				</block>
			</view>
		</view>

		<!-- ========== ä¼˜æƒ åˆ¸ coupon ========== -->
		<view wx:elif="{{item.type === 'coupon' && item.config.items.length > 0}}" class="deco-coupon">
			<scroll-view class="deco-coupon-scroll" scroll-x enhanced show-scrollbar="{{false}}">
				<view class="deco-coupon-list">
					<block wx:for="{{item.config.items}}" wx:for-item="cp" wx:for-index="cIdx" wx:key="cIdx">
						<view class="deco-coupon-card">
							<view class="deco-coupon-amount">
								<text class="price-symbol">Â¥</text>
								<text class="deco-coupon-value">{{cp.amount || cp.coupon.value || 0}}</text>
							</view>
							<view class="deco-coupon-info">
								<text class="deco-coupon-condition">æ»¡{{cp.threshold || cp.coupon.minAmount || 0}}å¯ç”¨</text>
							</view>
							<view class="deco-coupon-btn">é¢†å–</view>
						</view>
					</block>
				</view>
			</scroll-view>
		</view>

		<!-- ========== è¾…åŠ©ç©ºç™½ spacer ========== -->
		<view wx:elif="{{item.type === 'spacer'}}" class="deco-spacer" style="height: {{item.config.height || 20}}rpx; background-color: {{item.config.bgColor || 'transparent'}};"></view>

		<!-- ========== å¯Œæ–‡æœ¬ richText ========== -->
		<view wx:elif="{{item.type === 'richText' && item.config.content}}" class="deco-rich-text">
			<rich-text nodes="{{item.config.content}}"></rich-text>
		</view>

		<!-- ========== è§†é¢‘ video ========== -->
		<view wx:elif="{{item.type === 'video' && item.config.url}}" class="deco-video" style="border-radius: {{item.style.innerRadius || 0}}rpx; overflow: hidden;">
			<video class="deco-video-player" src="{{item.config.url}}" poster="{{item.config.cover}}" autoplay="{{item.config.autoplay || false}}" controls show-center-play-btn object-fit="cover"></video>
		</view>

		<!-- ========== å¯¼èˆªæ  navBar ========== -->
		<view wx:elif="{{item.type === 'navBar' && item.config.items.length > 0}}" class="deco-navbar">
			<view class="deco-navbar-list">
				<block wx:for="{{item.config.items}}" wx:for-item="nb" wx:for-index="nbIdx" wx:key="nbIdx">
					<view class="deco-navbar-item" bindtap="goLink" data-link="{{nb.link}}">
						<text>{{nb.text}}</text>
					</view>
				</block>
			</view>
		</view>

		</view>
	</block>

	<!-- åº•éƒ¨å ä½ -->
	<view style="height: 160rpx;"></view>
</view>
</scroll-view>

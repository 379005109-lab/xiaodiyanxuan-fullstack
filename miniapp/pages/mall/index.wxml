<navigation-bar title="" back="{{false}}" color="black" background="transparent"></navigation-bar>
<scroll-view class="scrollarea" scroll-y>
<view class="page">
		<!-- é¡¶éƒ¨å¡ç‰‡ï¼šæ ‡é¢˜+æœç´¢+ç­›é€‰ -->
		<view class="top-card">
			<!-- é¡µé¢æ ‡é¢˜æ  -->
			<view class="page-header">
				<view class="page-title">å•†åŸ</view>
				<view class="header-actions">
					<view class="view-toggle {{viewMode === 'grid' ? 'active' : ''}}" bindtap="toggleViewMode" data-mode="grid">
						<view class="grid-icon"></view>
					</view>
					<view class="filter-btn" bindtap="openCategory">
						<view class="filter-icon"></view>
					</view>
				</view>
			</view>

			<!-- æœç´¢æ¡† -->
			<view class="search-bar">
				<view class="search-input">
					<view class="search-icon-svg"></view>
					<input placeholder="æœç´¢æ²™å‘ã€æ¡Œæ¤…..." value="{{searchText}}" bindinput="onSearchInput" confirm-type="search" bindconfirm="onSearchConfirm" />
				</view>
				<view class="image-search-btn" bindtap="goImageSearch">
					<text class="camera-icon">ğŸ“·</text>
				</view>
			</view>

			<!-- é¡¶éƒ¨ç­›é€‰æ¡ï¼šç»¼åˆã€é”€é‡ã€ä»·æ ¼ã€ç±»åˆ«ã€é£æ ¼ -->
			<view class="top-filters">
			<view class="f-item {{sortKey==='comprehensive'?'active':''}}" data-key="comprehensive" bindtap="onTapSort">ç»¼åˆ</view>
			<view class="f-item {{sortKey==='sales'?'active':''}}" data-key="sales" bindtap="onTapSort">é”€é‡</view>
			<view class="f-item {{sortKey==='price'?'active':''}}" data-key="price" bindtap="onTapPrice">ä»·æ ¼<text class="arrow">{{priceAsc? 'â†‘' : 'â†“'}}</text></view>
			<view class="f-item {{selectedCategoryName && selectedCategoryName !== 'å…¨éƒ¨' ? 'active' : ''}}" bindtap="openCategory">ç±»åˆ«{{selectedCategoryName && selectedCategoryName !== 'å…¨éƒ¨' ? 'Â·'+selectedCategoryName : ''}}</view>
			<view class="f-item {{selectedStyle ? 'active' : ''}} {{showStylePopup?'active':''}}" bindtap="toggleStyle">é£æ ¼{{selectedStyle ? 'Â·'+selectedStyle : ''}}</view>
			<!-- é£æ ¼å¼¹å‡º -->
			<view class="style-popup" wx:if="{{showStylePopup}}">
				<view class="style-list">
					<block wx:for="{{styles}}" wx:key="*this">
						<view class="style-tag {{selectedStyle===item?'active':''}}" data-style="{{item}}" bindtap="onSelectStyle">{{item}}</view>
					</block>
				</view>
				<view class="style-actions">
					<button class="btn-reset" bindtap="resetStyle">é‡ç½®</button>
					<button class="btn-apply" bindtap="applyStyle">ç¡®å®š</button>
				</view>
			</view>
			</view>
		</view>

		<!-- ç±»åˆ«æŠ½å±‰é®ç½© -->
		<view class="drawer-mask {{showCategoryDrawer?'active':''}}" wx:if="{{showCategoryDrawer}}" bindtap="closeCategory"></view>
		<!-- å·¦ä¾§ç±»åˆ«æŠ½å±‰ -->
		<view class="drawer" wx:if="{{showCategoryDrawer}}">
			<scroll-view scroll-y class="drawer-list">
				<block wx:for="{{categories}}" wx:key="id">
					<view class="drawer-item {{selectedCategory===item.id?'active':''}}" data-id="{{item.id}}" data-name="{{item.name}}" bindtap="onSelectCategory">{{item.name}}</view>
				</block>
			</scroll-view>
		</view>

		<view class="goods-grid {{viewMode === 'list' ? 'list-mode' : ''}}">
			<block wx:for="{{filteredGoods}}" wx:key="id">
				<view class="goods-item" bindtap="goDetail" data-id="{{item.id}}">
					<view class="thumb-box">
						<image class="thumb-img" src="{{item.thumb || item.cover || item.image || item.pic}}" mode="aspectFill"></image>
						<view class="fav-btn" catchtap="onToggleFav" data-id="{{item.id}}">
							<view class="heart-icon {{item.isFav ? 'favorited' : ''}}"></view>
						</view>
					</view>
					<view class="hot-info">
						<text class="h-name">{{item.name}}</text>
						<text class="h-desc">{{item.desc || item.style || 'ç²¾é€‰å¥½ç‰©'}}</text>
						<view class="h-price">
							<text class="price">Â¥{{item.price}}</text>
							<view class="cart-btn" catchtap="onAddCart" data-id="{{item.id}}">
								<view class="cart-icon-svg"></view>
							</view>
						</view>
					</view>
				</view>
			</block>
		</view>
	</view>
</scroll-view>

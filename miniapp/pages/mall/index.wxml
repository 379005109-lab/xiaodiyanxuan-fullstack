<navigation-bar title="" back="{{false}}" color="black" background="transparent"></navigation-bar>
<scroll-view class="scrollarea" scroll-y>
<view class="page">
		<!-- 顶部卡片：标题+搜索+筛选 -->
		<view class="top-card">
			<!-- 页面标题栏 -->
			<view class="page-header">
				<view class="page-title">商城</view>
				<view class="header-actions">
					<view class="view-toggle" bindtap="toggleViewMode">
						<view class="grid-icon-simple"></view>
					</view>
				</view>
			</view>

			<!-- 搜索框 -->
			<view class="search-bar">
				<view class="search-input">
					<view class="search-icon-svg"></view>
					<input placeholder="搜索沙发、桌椅..." value="{{searchText}}" bindinput="onSearchInput" confirm-type="search" bindconfirm="onSearchConfirm" />
				</view>
				<view class="image-search-btn" bindtap="goImageSearch">
					<view class="camera-icon-svg"></view>
				</view>
			</view>

			<!-- 顶部筛选条：综合、销量、价格、类别、风格 -->
			<view class="top-filters">
			<view class="f-item {{sortKey==='comprehensive'?'active':''}}" data-key="comprehensive" bindtap="onTapSort">综合</view>
			<view class="f-item {{sortKey==='sales'?'active':''}}" data-key="sales" bindtap="onTapSort">销量</view>
			<view class="f-item {{sortKey==='price'?'active':''}}" data-key="price" bindtap="onTapPrice">价格<text class="arrow">{{priceAsc? '↑' : '↓'}}</text></view>
			<view class="f-item {{selectedCategoryName && selectedCategoryName !== '全部' ? 'active' : ''}}" bindtap="openCategory">类别{{selectedCategoryName && selectedCategoryName !== '全部' ? '·'+selectedCategoryName : ''}}</view>
			<view class="f-item {{selectedStyle ? 'active' : ''}} {{showStylePopup?'active':''}}" bindtap="toggleStyle">风格{{selectedStyle ? '·'+selectedStyle : ''}}</view>
			<!-- 风格弹出 -->
			<view class="style-popup" wx:if="{{showStylePopup}}">
				<view class="style-list">
					<block wx:for="{{styles}}" wx:key="*this">
						<view class="style-tag {{selectedStyle===item?'active':''}}" data-style="{{item}}" bindtap="onSelectStyle">{{item}}</view>
					</block>
				</view>
				<view class="style-actions">
					<button class="btn-reset" bindtap="resetStyle">重置</button>
					<button class="btn-apply" bindtap="applyStyle">确定</button>
				</view>
			</view>
			</view>
		</view>

		<!-- 类别抽屉遮罩 -->
		<view class="drawer-mask {{showCategoryDrawer?'active':''}}" wx:if="{{showCategoryDrawer}}" bindtap="closeCategory"></view>
		<!-- 左侧类别抽屉 -->
		<view class="drawer" wx:if="{{showCategoryDrawer}}">
			<scroll-view scroll-y class="drawer-list">
				<block wx:for="{{categories}}" wx:key="id">
					<view class="drawer-item {{selectedCategory===item.id?'active':''}}" data-id="{{item.id}}" data-name="{{item.name}}" bindtap="onSelectCategory">{{item.name}}</view>
				</block>
			</scroll-view>
		</view>

		<view class="goods-grid {{viewMode === 'list' ? 'list-mode' : ''}}">
			<block wx:for="{{filteredGoods}}" wx:key="id">
				<view class="goods-item" bindtap="goDetail" data-id="{{item.id}}">
					<view class="thumb-box">
						<image class="thumb-img" src="{{item.thumb || item.cover || item.image || item.pic}}" mode="aspectFill"></image>
						<view class="fav-btn" catchtap="onToggleFav" data-id="{{item.id}}">
							<view class="heart-icon {{item.isFav ? 'favorited' : ''}}"></view>
						</view>
					</view>
					<view class="hot-info">
						<text class="h-name">{{item.name}}</text>
						<text class="h-desc">{{item.desc || item.style || '精选好物'}}</text>
						<view class="h-price">
							<text class="price">¥{{item.price}}</text>
							<view class="cart-btn" catchtap="onAddCart" data-id="{{item.id}}">
								<view class="cart-icon-svg"></view>
							</view>
						</view>
					</view>
				</view>
			</block>
		</view>
	</view>
</scroll-view>

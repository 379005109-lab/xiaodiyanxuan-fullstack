<!-- 商品详情页 - ZenLife 2.0 设计 -->
<view class="detail-page">
	<!-- 顶部导航栏 - 与微信胶囊并排 -->
	<view class="detail-header" style="padding-top: {{statusBarHeight}}px; height: {{navBarHeight + statusBarHeight}}px;">
		<view class="header-buttons" style="height: {{menuButtonInfo.height}}px; margin-top: {{menuButtonInfo.top - statusBarHeight}}px;">
			<view class="header-btn-group">
				<view class="header-btn" bindtap="onBack">
					<view class="back-icon-svg"></view>
				</view>
				<view class="header-btn" bindtap="onFav">
					<view class="heart-icon {{isFavorited ? 'favorited' : ''}}"></view>
				</view>
			</view>
		</view>
	</view>

	<!-- 主内容区 -->
	<view class="detail-content">
		<!-- 商品大图区 -->
		<view class="product-hero">
			<!-- 左侧尺寸按钮 -->
			<view class="dimension-sidebar">
				<view class="dim-btn" bindtap="showSpecsSheet">
					<view class="dim-icon height-icon"></view>
					<text class="dim-label">高</text>
				</view>
				<view class="dim-btn" bindtap="showSpecsSheet">
					<view class="dim-icon width-icon"></view>
					<text class="dim-label">宽</text>
				</view>
				<view class="dim-btn" bindtap="showSpecsSheet">
					<view class="dim-icon length-icon"></view>
					<text class="dim-label">长</text>
				</view>
				<view class="dim-btn specs-btn" bindtap="showSpecsSheet">
					<text class="specs-label">选规格</text>
				</view>
			</view>

			<!-- 商品图片 -->
			<swiper class="hero-swiper" autoplay circular interval="4000" current="{{imageIndex}}" bindchange="onSwiperChange">
				<swiper-item wx:for="{{images}}" wx:key="*this">
					<image class="hero-img" src="{{item}}" mode="aspectFit" data-src="{{item}}" bindtap="onPreview"></image>
				</swiper-item>
			</swiper>

			<!-- 右下角购物车悬浮按钮 -->
			<view class="float-cart" bindtap="goCart">
				<view class="cart-icon-svg"></view>
				<view class="float-cart-badge" wx:if="{{cartCount > 0}}">{{cartCount > 99 ? '99+' : cartCount}}</view>
			</view>
		</view>

		<!-- 底部白色卡片 -->
		<view class="bottom-card">
			<!-- 颜色/材质选择器 - 显示缩略图 -->
			<view class="color-picker" wx:if="{{materialsGroups.length > 0}}">
				<block wx:for="{{materialsGroups[materialGroupIndex].colors}}" wx:key="name" wx:for-index="ci">
					<view 
						class="color-item {{materialColorIndex === ci ? 'active' : ''}}" 
						data-c="{{ci}}"
						bindtap="onQuickSelectColor"
						wx:if="{{ci < 5}}"
					>
						<image wx:if="{{item.img}}" class="color-thumb" src="{{item.img}}" mode="aspectFill"></image>
						<view wx:else class="color-block" style="background-color: {{item.hex || '#DEB887'}}"></view>
					</view>
				</block>
				<view class="color-more" bindtap="showColorSheet">
					<text>+</text>
				</view>
			</view>

			<!-- 商品名称和数量 -->
			<view class="product-title-row">
				<view class="product-name">{{goods.name}}</view>
				<view class="quantity-stepper">
					<view class="stepper-btn" bindtap="decreaseQty">−</view>
					<text class="stepper-value">{{quantity < 10 ? '0' + quantity : quantity}}</text>
					<view class="stepper-btn" bindtap="increaseQty">+</view>
				</view>
			</view>

			<!-- 已选配置 -->
			<view class="selected-config">
				<text class="config-label">已选配置</text>
				<view class="config-value" bindtap="showSpecsSheet">
					<text>{{selectedConfigText}}</text>
					<text class="config-arrow">选定颜色</text>
				</view>
			</view>

			<!-- 价格和加入购物车 -->
			<view class="price-action-row">
				<view class="price-info">
					<text class="price-value">¥{{totalPrice}}</text>
					<text class="price-label">Total Payable</text>
				</view>
				<view class="add-cart-btn" bindtap="onAddCart">
					<view class="btn-cart-icon"></view>
					<text>加入购物车</text>
				</view>
			</view>
		</view>
	</view>
</view>

<!-- 规格选择弹窗 -->
<view class="sheet-mask {{showSpecs ? 'show' : ''}}" bindtap="hideSpecsSheet"></view>
<view class="spec-sheet {{showSpecs ? 'show' : ''}}">
	<view class="sheet-handle"></view>
	<view class="sheet-title">规格 (含图片)</view>
	<scroll-view class="spec-list" scroll-y>
		<view class="spec-grid">
			<block wx:for="{{sizes}}" wx:key="name">
				<view class="spec-card {{sizeIndex === index ? 'active' : ''}}" data-index="{{index}}" bindtap="onSelectSize">
					<image class="spec-card-img" src="{{item.img}}" mode="aspectFill"></image>
					<view class="spec-card-check" wx:if="{{sizeIndex === index}}">✓</view>
					<view class="spec-card-name">{{item.name}}</view>
					<view class="spec-card-dims">{{item.dims}}</view>
				</view>
			</block>
		</view>
	</scroll-view>
	<view class="sheet-confirm" bindtap="hideSpecsSheet">确认配置</view>
</view>

<!-- 材质颜色选择弹窗 -->
<view class="sheet-mask {{showColors ? 'show' : ''}}" bindtap="hideColorSheet"></view>
<view class="color-sheet {{showColors ? 'show' : ''}}">
	<view class="sheet-handle"></view>
	<view class="sheet-header">
		<text class="sheet-title">所有材质与颜色</text>
		<view class="sheet-close" bindtap="hideColorSheet">✕</view>
	</view>
	<scroll-view class="color-scroll" scroll-y>
		<block wx:for="{{materialsGroups}}" wx:key="name" wx:for-index="gi">
			<view class="material-group">
				<view class="material-group-title">
					<view class="material-indicator"></view>
					<text>{{item.name}}</text>
				</view>
				<view class="color-grid">
					<block wx:for="{{item.colors}}" wx:key="name" wx:for-index="ci">
						<view 
							class="color-option {{materialGroupIndex === gi && materialColorIndex === ci ? 'active' : ''}}" 
							data-g="{{gi}}" 
							data-c="{{ci}}" 
							bindtap="onSelectMaterialColor"
						>
							<image wx:if="{{item.img}}" class="color-swatch-img" src="{{item.img}}" mode="aspectFill"></image>
							<view wx:else class="color-swatch" style="background-color: {{item.hex || '#DEB887'}}"></view>
							<text class="color-name">{{item.name || ('色号' + (ci + 1))}}</text>
						</view>
					</block>
				</view>
			</view>
		</block>
	</scroll-view>
	<view class="sheet-confirm" bindtap="hideColorSheet">确认选择</view>
</view>



<navigation-bar title="" back="{{true}}" color="black" background="#FFFFFF"></navigation-bar>

<scroll-view class="page-scroll" scroll-y enhanced show-scrollbar="{{false}}">
<view class="page">

	<!-- ========== å•†å“å›¾è½®æ’­ ========== -->
	<view class="gallery-section">
		<swiper class="gallery-swiper" autoplay circular interval="4000" duration="500" current="{{imageIndex}}" bindchange="onSwiperChange">
			<swiper-item wx:for="{{images}}" wx:key="*this">
				<image class="gallery-img" src="{{item}}" mode="aspectFill" data-src="{{item}}" bindtap="onPreview"></image>
			</swiper-item>
		</swiper>
		<view class="gallery-counter">{{imageIndex + 1}}/{{images.length}}</view>
	</view>

	<!-- ========== å•†å“åŸºæœ¬ä¿¡æ¯ ========== -->
	<view class="product-info">
		<view class="product-name">{{goods.name}}</view>
		<view class="product-desc" wx:if="{{goods.description}}">{{goods.description}}</view>
		<view class="product-price-row">
			<text class="product-price"><text class="price-symbol">Â¥</text>{{totalPrice}}</text>
			<text class="product-base-price" wx:if="{{goods.basePrice !== totalPrice}}">åŸºç¡€ä»· Â¥{{goods.basePrice}}</text>
		</view>
	</view>

	<view class="detail-divider"></view>

	<!-- ========== è§„æ ¼é€‰æ‹© Tab ========== -->
	<view class="config-tabs">
		<block wx:for="{{tabList}}" wx:key="key">
			<view class="config-tab {{tabIndex===index?'active':''}}" data-index="{{index}}" bindtap="onTabChange">{{item.label}}</view>
		</block>
	</view>

	<!-- ========== è§„æ ¼é€‰é¡¹ ========== -->
	<view wx:if="{{tabList[tabIndex].key === 'spec'}}" class="config-section">
		<view class="config-title">é€‰æ‹©è§„æ ¼</view>
		<view class="size-list">
			<block wx:for="{{sizes}}" wx:key="name">
				<view class="size-card {{sizeIndex===index?'active':''}}" data-index="{{index}}" bindtap="onSelectSize">
					<image class="size-img" src="{{item.img}}" mode="aspectFill" wx:if="{{item.img}}"></image>
					<view class="size-info">
						<view class="size-name">{{item.name}}</view>
						<view class="size-dims" wx:if="{{item.dims}}">{{item.dims}}</view>
						<view class="size-extra {{item.extra > 0 ? 'has-extra' : ''}}">{{item.extra > 0 ? '+Â¥' + item.extra : 'æ ‡å‡†'}}</view>
					</view>
				</view>
			</block>
		</view>
	</view>

	<!-- ========== æè´¨é€‰æ‹© ========== -->
	<view wx:if="{{tabList[tabIndex].key === 'material' && hasMaterials}}" class="config-section">
		<view class="config-title">é€‰æ‹©æè´¨</view>
		<block wx:for="{{materialsGroups}}" wx:key="name" wx:for-index="gi">
			<view class="material-card {{materialGroupIndex===gi?'active':''}}">
				<image class="material-img" src="{{materialGroupIndex===gi && item.colors[materialColorIndex].img ? item.colors[materialColorIndex].img : item.img}}" mode="aspectFill"></image>
				<view class="material-info">
					<view class="material-name-row">
						<text class="material-name">{{item.name}}</text>
						<text class="material-extra {{item.extra > 0 ? 'has-extra' : ''}}">{{item.extra > 0 ? '+Â¥' + item.extra : 'æ ‡å‡†'}}</text>
					</view>
					<view class="color-options">
						<block wx:for="{{item.colors}}" wx:key="name" wx:for-index="ci">
							<view class="color-chip {{materialGroupIndex===gi && materialColorIndex===ci?'active':''}}" data-g="{{gi}}" data-c="{{ci}}" bindtap="onSelectMaterialColor">
								{{item.name}}
							</view>
						</block>
					</view>
				</view>
			</view>
		</block>
	</view>

	<!-- ========== å†…éƒ¨ç»“æ„é€‰æ‹© ========== -->
	<view wx:if="{{tabList[tabIndex].key === 'structure' && hasStructure}}" class="config-section">
		<!-- å¡«å…… -->
		<view class="struct-block" wx:if="{{fills.length > 0}}">
			<view class="config-title">å¡«å……</view>
			<view class="option-grid">
				<block wx:for="{{fills}}" wx:key="name">
					<view class="option-card {{fillIndex===index?'active':''}}" data-index="{{index}}" bindtap="onSelectFill">
						<image class="option-img" src="{{item.img}}" mode="aspectFill" wx:if="{{item.img}}"></image>
						<view class="option-name">{{item.name}}</view>
						<view class="option-extra {{item.extra > 0 ? 'has-extra' : ''}}">{{item.extra > 0 ? '+Â¥' + item.extra : 'æ ‡å‡†'}}</view>
					</view>
				</block>
			</view>
		</view>
		<!-- æ¡†æ¶ -->
		<view class="struct-block" wx:if="{{frames.length > 0}}">
			<view class="config-title">æ¡†æ¶</view>
			<view class="option-grid">
				<block wx:for="{{frames}}" wx:key="name">
					<view class="option-card {{frameIndex===index?'active':''}}" data-index="{{index}}" bindtap="onSelectFrame">
						<image class="option-img" src="{{item.img}}" mode="aspectFill" wx:if="{{item.img}}"></image>
						<view class="option-name">{{item.name}}</view>
						<view class="option-extra {{item.extra > 0 ? 'has-extra' : ''}}">{{item.extra > 0 ? '+Â¥' + item.extra : 'æ ‡å‡†'}}</view>
					</view>
				</block>
			</view>
		</view>
		<!-- è„šæ¶ -->
		<view class="struct-block" wx:if="{{legs.length > 0}}">
			<view class="config-title">è„šæ¶</view>
			<view class="option-grid">
				<block wx:for="{{legs}}" wx:key="name">
					<view class="option-card {{legIndex===index?'active':''}}" data-index="{{index}}" bindtap="onSelectLeg">
						<image class="option-img" src="{{item.img}}" mode="aspectFill" wx:if="{{item.img}}"></image>
						<view class="option-name">{{item.name}}</view>
						<view class="option-extra {{item.extra > 0 ? 'has-extra' : ''}}">{{item.extra > 0 ? '+Â¥' + item.extra : 'æ ‡å‡†'}}</view>
					</view>
				</block>
			</view>
		</view>
	</view>

	<view class="detail-divider"></view>

	<!-- ========== å·²é€‰é…ç½®æ±‡æ€» ========== -->
	<view class="selected-summary">
		<view class="summary-header">
			<text class="summary-title">å·²é€‰é…ç½®</text>
			<text class="summary-total"><text class="price-symbol">Â¥</text>{{totalPrice}}</text>
		</view>
		<view class="summary-items">
			<view class="summary-item">
				<text class="summary-label">è§„æ ¼</text>
				<text class="summary-value">{{sizes[sizeIndex].name || 'é»˜è®¤'}}</text>
			</view>
			<view class="summary-item" wx:if="{{materialsGroups.length > 0}}">
				<text class="summary-label">é¢æ–™</text>
				<text class="summary-value">{{materialsGroups[materialGroupIndex].name}}-{{materialsGroups[materialGroupIndex].colors[materialColorIndex].name}}</text>
			</view>
			<view class="summary-item" wx:if="{{fills.length > 0}}">
				<text class="summary-label">å¡«å……</text>
				<text class="summary-value">{{fills[fillIndex].name}}</text>
			</view>
			<view class="summary-item" wx:if="{{frames.length > 0}}">
				<text class="summary-label">æ¡†æ¶</text>
				<text class="summary-value">{{frames[frameIndex].name}}</text>
			</view>
			<view class="summary-item" wx:if="{{legs.length > 0}}">
				<text class="summary-label">è„šæ¶</text>
				<text class="summary-value">{{legs[legIndex].name}}</text>
			</view>
		</view>
	</view>

	<!-- åº•éƒ¨å ä½ -->
	<view style="height: 200rpx;"></view>
</view>
</scroll-view>

<!-- ========== åº•éƒ¨æ“ä½œæ  ========== -->
<view class="bottom-bar safe-area-bottom">
	<view class="bar-actions">
		<view class="bar-icon-btn" bindtap="onFav">
			<text class="bar-icon {{isFavorited ? 'icon-active' : ''}}">{{isFavorited ? 'â™¥' : 'â™¡'}}</text>
			<text class="bar-icon-label">æ”¶è—</text>
		</view>
		<view class="bar-icon-btn" bindtap="goCart">
			<text class="bar-icon">ğŸ›’</text>
			<text class="bar-icon-label">è´­ç‰©è½¦</text>
			<view class="bar-badge" wx:if="{{cartCount > 0}}">{{cartCount > 99 ? '99+' : cartCount}}</view>
		</view>
	</view>
	<view class="bar-buttons">
		<button class="bar-btn-cart" bindtap="onAddCart">åŠ å…¥è´­ç‰©è½¦</button>
		<button class="bar-btn-buy" bindtap="onBuyNow">ç«‹å³è´­ä¹°</button>
	</view>
</view>

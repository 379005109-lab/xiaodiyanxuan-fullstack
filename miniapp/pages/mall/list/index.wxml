<!-- å•†å“åˆ—è¡¨é¡µ â€” Apple é£æ ¼ -->
<navigation-bar title="{{pageTitle}}" back="{{true}}" color="black" background="#FFFFFF"></navigation-bar>
<view class="page">
	<!-- æœç´¢æ¡† -->
	<view class="search-section">
		<view class="search-box">
			<text class="search-icon">ğŸ”</text>
			<input class="search-input" placeholder="æœç´¢å•†å“" value="{{searchText}}" bindinput="onSearchInput" bindconfirm="onSearchConfirm" />
			<view class="search-tag" wx:if="{{subCategoryName}}" bindtap="clearSubCategory">
				<text>{{subCategoryName}}</text>
				<text class="tag-close">âœ•</text>
			</view>
		</view>
	</view>

	<!-- ç­›é€‰æ¡ -->
	<view class="filter-bar">
		<scroll-view class="filter-scroll" scroll-x enhanced show-scrollbar="{{false}}">
			<view class="filter-items">
				<view class="filter-chip {{showFilter ? 'active' : ''}}" bindtap="toggleFilter">
					<text>ç­›é€‰</text>
				</view>
				<view class="filter-chip {{sortBy === 'price-asc' || sortBy === 'price-desc' ? 'active' : ''}}" bindtap="togglePrice">
					<text>ä»·æ ¼</text>
					<text class="chip-arrow">{{sortBy === 'price-asc' ? 'â†‘' : sortBy === 'price-desc' ? 'â†“' : ''}}</text>
				</view>
				<view class="filter-chip {{sortBy === 'sales' ? 'active' : ''}}" bindtap="setSortSales">
					<text>{{sortBy === 'sales' ? 'âœ“ ' : ''}}é”€é‡</text>
				</view>
				<view class="filter-chip {{stockOnly ? 'active' : ''}}" bindtap="toggleStockOnly">
					<text>{{stockOnly ? 'âœ“ ' : ''}}ä»…çœ‹æœ‰è´§</text>
				</view>
			</view>
		</scroll-view>
	</view>

	<!-- ç­›é€‰é¢æ¿ -->
	<view class="filter-panel" wx:if="{{showFilter}}">
		<!-- é£æ ¼ç­›é€‰ -->
		<view class="filter-group" wx:if="{{styles.length > 0}}">
			<text class="filter-group-title">é£æ ¼</text>
			<view class="filter-tags">
				<block wx:for="{{styles}}" wx:key="id">
					<view class="filter-tag {{selectedStyle === item.name ? 'active' : ''}}" data-name="{{item.name}}" bindtap="onSelectStyle">
						<text wx:if="{{selectedStyle === item.name}}">âœ“ </text>{{item.name}}
					</view>
				</block>
			</view>
		</view>

		<!-- ä»·æ ¼åŒºé—´ -->
		<view class="filter-group">
			<text class="filter-group-title">ä»·æ ¼åŒºé—´</text>
			<view class="price-range-row">
				<input class="price-input" type="number" placeholder="æœ€ä½ä»·" value="{{minPrice}}" bindinput="onMinPriceInput" />
				<text class="price-sep">-</text>
				<input class="price-input" type="number" placeholder="æœ€é«˜ä»·" value="{{maxPrice}}" bindinput="onMaxPriceInput" />
			</view>
		</view>

		<!-- æ“ä½œæŒ‰é’® -->
		<view class="filter-actions">
			<button class="filter-reset-btn" bindtap="resetFilter">é‡ç½®</button>
			<button class="filter-apply-btn" bindtap="applyFilter">ç¡®å®š</button>
		</view>
	</view>

	<!-- å•†å“ç½‘æ ¼ -->
	<scroll-view class="goods-scroll" scroll-y enhanced show-scrollbar="{{false}}" bindscrolltolower="loadMore">
		<view class="goods-grid" wx:if="{{!loading && goodsList.length > 0}}">
			<block wx:for="{{goodsList}}" wx:key="_id">
				<view class="goods-card" bindtap="goDetail" data-id="{{item._id}}">
					<view class="goods-img-wrap">
						<image class="goods-img" src="{{item.thumbnail || item.images[0] || ''}}" mode="aspectFill"></image>
						<view class="goods-tag goods-tag-left" wx:if="{{item.inStock}}">ç°è´§</view>
						<view class="goods-tag goods-tag-right" wx:if="{{item.isHot}}">çƒ­é”€</view>
						<view class="goods-tag goods-tag-right" wx:elif="{{item.isNew}}">æ–°å“</view>
					</view>
					<view class="goods-info">
						<view class="goods-model" wx:if="{{item.model}}">{{item.model}}</view>
						<view class="goods-name text-ellipsis-2">{{item.name}}</view>
						<view class="goods-price-row">
							<text class="goods-price"><text class="price-symbol">Â¥</text>{{item.price}}</text>
							<text class="goods-original" wx:if="{{item.originalPrice}}">Â¥{{item.originalPrice}}</text>
						</view>
						<view class="goods-bottom">
							<text class="goods-sold" wx:if="{{item.sold}}">å·²å”® {{item.sold}}</text>
							<view class="goods-cart-btn" catchtap="addToCart" data-item="{{item}}">ğŸ›’</view>
						</view>
					</view>
				</view>
			</block>
		</view>

		<!-- ç©ºçŠ¶æ€ -->
		<view class="empty-state" wx:if="{{!loading && goodsList.length === 0}}">
			<text class="empty-icon">ğŸ“¦</text>
			<text class="empty-text">æš‚æ— å•†å“</text>
		</view>

		<!-- åŠ è½½ä¸­ -->
		<view class="loading-state" wx:if="{{loading}}">
			<text class="loading-text">åŠ è½½ä¸­...</text>
		</view>

		<!-- åº•éƒ¨æç¤º -->
		<view class="bottom-tip" wx:if="{{!loading && goodsList.length > 0 && !hasMore}}">
			<text>å·²ç»åˆ°åº•äº†</text>
		</view>

		<!-- åº•éƒ¨å ä½ -->
		<view style="height: 60rpx;"></view>
	</scroll-view>
</view>

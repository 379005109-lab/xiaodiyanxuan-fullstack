<navigation-bar title="ç¡®è®¤è®¢å•" back="{{true}}" color="black" background="#FFFFFF"></navigation-bar>
<scroll-view class="scrollarea" scroll-y>
<view class="page">
	<!-- ç”Ÿäº§å‘¨æœŸæé†’ -->
	<view class="notice-bar">
		<text class="notice-icon">!</text>
		<text class="notice-text">æ¸©é¦¨æç¤ºï¼šå•†å“ä¸ºå®šåˆ¶ç”Ÿäº§ï¼Œç”Ÿäº§å‘¨æœŸçº¦6-8å‘¨</text>
	</view>
	
	<!-- æ™®é€šè®¢å• -->
	<block wx:if="{{orderType === 'normal'}}">
		<view class="card goods-card">
			<view class="card-title-bar">
				<view class="card-title-line"></view>
				<text class="card-title-text">å•†å“æ¸…å•</text>
			</view>
			<view class="goods-item-new">
				<image class="goods-thumb" src="{{order.goodsImage || 'https://picsum.photos/200/200?random=1'}}" mode="aspectFill"></image>
				<view class="goods-detail">
					<view class="goods-name-row">
						<text class="goods-name">{{order.goodsName}}</text>
						<view class="goods-delete-btn" bindtap="onDeleteNormalOrder">ğŸ—‘</view>
					</view>
					<view class="goods-spec-text" wx:if="{{order.sizeName}}">è§„æ ¼: {{order.sizeName}}</view>
					<view class="goods-spec-text" wx:if="{{order.sizeDims}}">å°ºå¯¸: {{order.sizeDims}}</view>
					<view class="goods-spec-text" wx:if="{{order.materialName}}">é¢æ–™: {{order.materialName}}{{order.materialColor ? '-' + order.materialColor : ''}}{{order.materialExtra > 0 ? ' (+Â¥' + order.materialExtra + ')' : ''}}</view>
					<view class="goods-spec-text" wx:if="{{order.fillName}}">å¡«å……: {{order.fillName}}{{order.fillExtra > 0 ? ' (+Â¥' + order.fillExtra + ')' : ''}}</view>
					<view class="goods-spec-text" wx:if="{{order.frameName}}">æ¡†æ¶: {{order.frameName}}{{order.frameExtra > 0 ? ' (+Â¥' + order.frameExtra + ')' : ''}}</view>
					<view class="goods-spec-text" wx:if="{{order.legName}}">è„šæ¶: {{order.legName}}{{order.legExtra > 0 ? ' (+Â¥' + order.legExtra + ')' : ''}}</view>
					<view class="goods-price-new">Â¥{{order.totalPrice}}</view>
				</view>
			</view>
			<view class="price-summary-new">
				<view class="summary-row">
					<text class="summary-label">å•†å“å°è®¡</text>
					<text class="summary-value">Â¥{{order.totalPrice}}</text>
				</view>
				<view class="summary-row summary-total">
					<text class="summary-label">è®¢å•æ€»é¢</text>
					<text class="summary-value-total">Â¥{{order.totalPrice}}</text>
				</view>
			</view>
		</view>
	</block>
	
	<!-- è´­ç‰©è½¦è®¢å• -->
	<block wx:if="{{orderType === 'cart'}}">
		<view class="card goods-card">
			<view class="card-title-bar">
				<view class="card-title-line"></view>
				<text class="card-title-text">å•†å“æ¸…å• ({{cartGoodsList.length}}ä»¶)</text>
			</view>
			<block wx:for="{{cartGoodsList}}" wx:key="id" wx:for-index="cartIndex">
				<view class="goods-item-new">
					<image class="goods-thumb" src="{{item.thumb || 'https://picsum.photos/200/200?random=' + cartIndex}}" mode="aspectFill"></image>
					<view class="goods-detail">
						<view class="goods-name-row">
							<text class="goods-name">{{item.name}}</text>
							<view class="goods-delete-btn" catchtap="onDeleteCartGoods" data-index="{{cartIndex}}">ğŸ—‘</view>
						</view>
						<view class="goods-spec-text">è§„æ ¼: {{item.sizeName || 'é»˜è®¤'}}</view>
						<view class="goods-spec-text" wx:if="{{item.dims}}">å°ºå¯¸: {{item.dims}}</view>
						<view class="goods-spec-text" wx:if="{{item.fabric || item.material}}">é¢æ–™: {{item.fabric || item.material}}{{item.materialColor ? '-' + item.materialColor : ''}}</view>
						<view class="goods-spec-text" wx:if="{{item.fill}}">å¡«å……: {{item.fill}}{{item.fillExtra > 0 ? ' (+Â¥' + item.fillExtra + ')' : ''}}</view>
						<view class="goods-spec-text" wx:if="{{item.frame}}">æ¡†æ¶: {{item.frame}}</view>
						<view class="goods-spec-text" wx:if="{{item.leg}}">è„šæ¶: {{item.leg}}</view>
						<view class="goods-price-qty">
							<text class="goods-price-new">Â¥{{item.price}}</text>
							<text class="goods-qty">Ã—{{item.count || 1}}</text>
						</view>
					</view>
				</view>
			</block>
			<view class="price-summary-new">
				<view class="summary-row summary-total">
					<text class="summary-label">è®¢å•æ€»é¢</text>
					<text class="summary-value-total">Â¥{{totalPrice}}</text>
				</view>
			</view>
		</view>
	</block>
	
	<!-- å¥—é¤è®¢å• -->
	<block wx:if="{{orderType === 'package'}}">
		<!-- å¥—é¤æç¤º -->
		<view class="package-notice">
			<view class="package-notice-icon">ğŸ“¦</view>
			<view class="package-notice-content">
				<text class="package-notice-title">å¥—é¤ä¸€å£ä»·</text>
				<text class="package-notice-desc">å¥—é¤å•†å“ä¸ºæ•´ä½“å®šä»·ï¼Œæ— æ³•å•ç‹¬åˆ é™¤æˆ–å‡å°‘å•†å“ã€‚å¦‚éœ€ä¿®æ”¹ï¼Œè¯·è¿”å›é‡æ–°é€‰æ‹©å¥—é¤ã€‚</text>
			</view>
		</view>
		
		<!-- å•†å“æ¸…å• -->
		<view class="card goods-card">
			<view class="card-title-bar">
				<view class="card-title-line"></view>
				<text class="card-title-text">å¥—é¤å•†å“</text>
				<text class="package-tag">å¥—é¤</text>
			</view>
			<block wx:for="{{packageGoodsList}}" wx:key="id" wx:for-index="goodsIndex">
				<view class="goods-item-new package-goods-item">
					<image class="goods-thumb" src="{{item.thumb}}" mode="aspectFill"></image>
					<view class="goods-detail">
						<view class="goods-name-row">
							<text class="goods-name">{{item.code}}</text>
							<view class="package-lock-icon" catchtap="onPackageItemTip">ğŸ”’</view>
						</view>
						<view class="goods-spec-text">è§„æ ¼: {{item.categoryName || 'é»˜è®¤'}}</view>
						<view class="goods-spec-text" wx:if="{{item.dims}}">å°ºå¯¸: {{item.dims}}</view>
						<!-- æè´¨ä¿¡æ¯ -->
						<view class="goods-spec-text" wx:if="{{item.fabric || item.material}}">é¢æ–™: {{item.fabric || item.material}}{{item.materialColor ? '-' + item.materialColor : ''}}</view>
						<view class="goods-spec-text" wx:if="{{item.fill}}">å¡«å……: {{item.fill}}</view>
						<view class="goods-spec-text" wx:if="{{item.frame}}">æ¡†æ¶: {{item.frame}}</view>
						<view class="goods-spec-text" wx:if="{{item.leg}}">è„šæ¶: {{item.leg}}</view>
						<view class="goods-price-new">Â¥{{item.price}}</view>
					</view>
				</view>
			</block>
		</view>
		
		<!-- æ­é…æ¨è - å·²æ·»åŠ çš„å•†å“ -->
		<view class="card goods-card" wx:if="{{addedRecommendations.length > 0}}">
			<view class="card-title-bar">
				<view class="card-title-line"></view>
				<text class="card-title-text">æ­é…æ¨è</text>
			</view>
			<block wx:for="{{addedRecommendations}}" wx:key="id" wx:for-index="recIndex">
				<view class="goods-item-new">
					<image class="goods-thumb" src="{{item.thumb}}" mode="aspectFill"></image>
					<view class="goods-detail">
						<view class="goods-name-row">
							<text class="goods-name">{{item.name}}</text>
							<view class="goods-delete-btn" catchtap="onDeleteRecommendation" data-index="{{recIndex}}">ğŸ—‘</view>
						</view>
						<view class="goods-spec-text">ç±»å‹: æ­é…æ¨è</view>
						<view class="goods-spec-text">æ•°é‡: Ã—{{item.count || 1}}</view>
						<view class="goods-price-new">Â¥{{item.price}}</view>
					</view>
				</view>
			</block>
		</view>
		
		<!-- æ­é…æ¨èå°è®¡ - å§‹ç»ˆæ˜¾ç¤º -->
		<view class="card price-card">
			<view class="price-summary-new">
				<view class="summary-row">
					<text class="summary-label">å•†å“å°è®¡</text>
					<text class="summary-value">Â¥{{packageOrder.totalPrice || 0}}</text>
				</view>
				<view class="summary-row" wx:if="{{addedRecommendations.length > 0}}">
					<text class="summary-label">æ­é…æ¨èå°è®¡</text>
					<text class="summary-value">Â¥{{recommendationTotalPrice}}</text>
				</view>
				<view class="summary-row summary-total">
					<text class="summary-label">è®¢å•æ€»é¢</text>
					<text class="summary-value-total">Â¥{{totalPrice}}</text>
				</view>
			</view>
		</view>
		
		<!-- æ­é…æ¨èé€‰æ‹©åŒº -->
		<view class="card recommendation-select-card">
			<view class="title">æ­é…æ¨è</view>
			<scroll-view class="recommendations-scroll" scroll-x>
				<view class="recommendations-list">
					<block wx:for="{{recommendations}}" wx:key="id" wx:for-index="recIndex">
						<view class="recommendation-item">
							<image class="recommendation-img" src="{{item.thumb}}" mode="aspectFill"></image>
							<view class="recommendation-name">{{item.name}}</view>
							<text class="recommendation-price">Â¥{{item.price}}</text>
							<view class="recommendation-quantity-control">
								<view class="rec-quantity-btn" bindtap="onDecreaseRecQuantity" data-index="{{recIndex}}">-</view>
								<text class="rec-quantity-value">{{item.count || 1}}</text>
								<view class="rec-quantity-btn" bindtap="onIncreaseRecQuantity" data-index="{{recIndex}}">+</view>
							</view>
							<view class="recommendation-add {{item.added ? 'added' : ''}}" bindtap="onAddRecommendation" data-id="{{item.id}}" data-index="{{recIndex}}">
								<text class="add-icon">{{item.added ? 'å·²æ·»åŠ ' : 'æ·»åŠ '}}</text>
							</view>
						</view>
					</block>
				</view>
			</scroll-view>
		</view>
	</block>

	<!-- æ”¶è´§ä¿¡æ¯ -->
	<view class="card address-card">
		<view class="title">æ”¶è´§ä¿¡æ¯</view>
		<!-- é»˜è®¤åœ°å€é€‰æ‹© -->
		<view class="address-select" wx:if="{{defaultAddress}}" bindtap="onSelectAddress">
			<view class="address-info">
				<view class="address-user">
					<text class="address-name">{{defaultAddress.name}}</text>
					<text class="address-phone">{{defaultAddress.phone}}</text>
					<text class="address-tag" wx:if="{{defaultAddress.isDefault}}">é»˜è®¤</text>
				</view>
				<view class="address-detail">{{defaultAddress.address}}</view>
			</view>
			<text class="address-arrow">â€º</text>
		</view>
		<view class="address-form" wx:else>
			<input class="ipt" placeholder="æ”¶è´§äººå§“å" value="{{name}}" bindinput="onName" />
			<input class="ipt" placeholder="æ‰‹æœºå·ç " type="number" value="{{phone}}" bindinput="onPhone" />
			<input class="ipt" placeholder="è¯¦ç»†æ”¶è´§åœ°å€" value="{{address}}" bindinput="onAddress" />
			<view class="default-check" bindtap="onToggleDefault">
				<view class="check-box {{setAsDefault ? 'checked' : ''}}">{{setAsDefault ? 'âœ“' : ''}}</view>
				<text>è®¾ä¸ºé»˜è®¤åœ°å€</text>
			</view>
		</view>
	</view>
	
	<!-- è®¢å•å¤‡æ³¨ -->
	<view class="card remark-card">
		<view class="title">è®¢å•å¤‡æ³¨</view>
		<textarea class="remark-input" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰" value="{{remark}}" bindinput="onRemark" maxlength="200"></textarea>
	</view>
</view>
</scroll-view>

<!-- åº•éƒ¨æäº¤æ  -->
<view class="submit-bar">
	<view class="submit-bar-left">
		<text class="sum-label">åˆè®¡</text>
		<text class="sum-value">Â¥{{totalPrice}}</text>
	</view>
	<button class="btn-submit" bindtap="onSubmit">æäº¤è®¢å•</button>
</view>



<navigation-bar title="ç¡®è®¤è®¢å•" back="{{true}}" color="black" background="#FFFFFF"></navigation-bar>
<scroll-view class="scrollarea" scroll-y enhanced show-scrollbar="{{false}}">
<view class="page">
	<!-- ç”Ÿäº§å‘¨æœŸæé†’ -->
	<view class="notice-bar">
		<text class="notice-icon">â±</text>
		<text class="notice-text">å®šåˆ¶ç”Ÿäº§ï¼Œç”Ÿäº§å‘¨æœŸçº¦6-8å‘¨</text>
	</view>

	<!-- æ™®é€šè®¢å• -->
	<block wx:if="{{orderType === 'normal'}}">
		<view class="section-card">
			<view class="section-title">å•†å“æ¸…å•</view>
			<view class="goods-row">
				<image class="goods-thumb" src="{{order.goodsImage || 'https://picsum.photos/200/200?random=1'}}" mode="aspectFill"></image>
				<view class="goods-info">
					<view class="goods-name">{{order.goodsName}}</view>
					<view class="goods-specs">
						<text class="goods-tag" wx:if="{{order.sizeName}}">{{order.sizeName}}</text>
						<text class="goods-tag" wx:if="{{order.materialName}}">{{order.materialName}}</text>
					</view>
					<view class="goods-price-row">
						<text class="goods-price">Â¥{{order.totalPrice}}</text>
						<text class="goods-del" bindtap="onDeleteNormalOrder">åˆ é™¤</text>
					</view>
				</view>
			</view>
			<view class="total-row">
				<text class="total-label">è®¢å•æ€»é¢</text>
				<text class="total-value">Â¥{{order.totalPrice}}</text>
			</view>
		</view>
	</block>

	<!-- è´­ç‰©è½¦è®¢å• -->
	<block wx:if="{{orderType === 'cart'}}">
		<view class="section-card">
			<view class="section-title">å•†å“æ¸…å• ({{cartGoodsList.length}}ä»¶)</view>
			<block wx:for="{{cartGoodsList}}" wx:key="id" wx:for-index="ci">
				<view class="goods-row">
					<image class="goods-thumb" src="{{item.thumb || 'https://picsum.photos/200/200?random=' + ci}}" mode="aspectFill"></image>
					<view class="goods-info">
						<view class="goods-name">{{item.name}}</view>
						<view class="goods-specs">
							<text class="goods-tag" wx:if="{{item.sizeName}}">{{item.sizeName}}</text>
							<text class="goods-tag" wx:if="{{item.fabric || item.material}}">{{item.fabric || item.material}}</text>
						</view>
						<view class="goods-price-row">
							<text class="goods-price">Â¥{{item.price}} <text class="goods-qty">Ã—{{item.count || 1}}</text></text>
							<text class="goods-del" catchtap="onDeleteCartGoods" data-index="{{ci}}">åˆ é™¤</text>
						</view>
					</view>
				</view>
			</block>
			<view class="total-row">
				<text class="total-label">è®¢å•æ€»é¢</text>
				<text class="total-value">Â¥{{totalPrice}}</text>
			</view>
		</view>
	</block>
	
	<!-- å¥—é¤è®¢å• -->
	<block wx:if="{{orderType === 'package'}}">
		<view class="pkg-notice">
			<text class="pkg-notice-icon">ğŸ“¦</text>
			<view class="pkg-notice-body">
				<text class="pkg-notice-title">å¥—é¤ä¸€å£ä»·</text>
				<text class="pkg-notice-desc">å¥—é¤å•†å“ä¸ºæ•´ä½“å®šä»·ï¼Œå¦‚éœ€ä¿®æ”¹è¯·è¿”å›é‡æ–°é€‰æ‹©ã€‚</text>
			</view>
		</view>

		<view class="section-card">
			<view class="section-title">å¥—é¤å•†å“ <text class="pkg-badge">å¥—é¤</text></view>
			<block wx:for="{{packageGoodsList}}" wx:key="id" wx:for-index="pi">
				<view class="goods-row">
					<image class="goods-thumb" src="{{item.thumb}}" mode="aspectFill"></image>
					<view class="goods-info">
						<view class="goods-name">{{item.code}}</view>
						<view class="goods-specs">
							<text class="goods-tag" wx:if="{{item.categoryName}}">{{item.categoryName}}</text>
							<text class="goods-tag" wx:if="{{item.fabric || item.material}}">{{item.fabric || item.material}}</text>
						</view>
						<text class="goods-price">Â¥{{item.price}}</text>
					</view>
				</view>
			</block>
		</view>

		<!-- å·²æ·»åŠ æ¨è -->
		<view class="section-card" wx:if="{{addedRecommendations.length > 0}}">
			<view class="section-title">æ­é…æ¨è</view>
			<block wx:for="{{addedRecommendations}}" wx:key="id" wx:for-index="ri">
				<view class="goods-row">
					<image class="goods-thumb" src="{{item.thumb}}" mode="aspectFill"></image>
					<view class="goods-info">
						<view class="goods-name">{{item.name}}</view>
						<view class="goods-price-row">
							<text class="goods-price">Â¥{{item.price}} <text class="goods-qty">Ã—{{item.count || 1}}</text></text>
							<text class="goods-del" catchtap="onDeleteRecommendation" data-index="{{ri}}">åˆ é™¤</text>
						</view>
					</view>
				</view>
			</block>
		</view>

		<!-- ä»·æ ¼æ±‡æ€» -->
		<view class="section-card">
			<view class="summary-line">
				<text class="summary-label">å¥—é¤ä»·</text>
				<text class="summary-val">Â¥{{packageOrder.totalPrice || 0}}</text>
			</view>
			<view class="summary-line" wx:if="{{addedRecommendations.length > 0}}">
				<text class="summary-label">æ­é…æ¨è</text>
				<text class="summary-val">Â¥{{recommendationTotalPrice}}</text>
			</view>
			<view class="summary-line summary-main">
				<text class="summary-label">è®¢å•æ€»é¢</text>
				<text class="summary-val-big">Â¥{{totalPrice}}</text>
			</view>
		</view>

		<!-- æ¨èé€‰æ‹© -->
		<view class="section-card">
			<view class="section-title">æ­é…æ¨è</view>
			<scroll-view class="rec-scroll" scroll-x enhanced show-scrollbar="{{false}}">
				<view class="rec-list">
					<block wx:for="{{recommendations}}" wx:key="id" wx:for-index="recI">
						<view class="rec-item">
							<image class="rec-img" src="{{item.thumb}}" mode="aspectFill"></image>
							<text class="rec-name">{{item.name}}</text>
							<text class="rec-price">Â¥{{item.price}}</text>
							<view class="rec-qty-wrap">
								<view class="rec-qty-btn" bindtap="onDecreaseRecQuantity" data-index="{{recI}}">-</view>
								<text class="rec-qty-num">{{item.count || 1}}</text>
								<view class="rec-qty-btn" bindtap="onIncreaseRecQuantity" data-index="{{recI}}">+</view>
							</view>
							<view class="rec-add-btn {{item.added ? 'added' : ''}}" bindtap="onAddRecommendation" data-id="{{item.id}}" data-index="{{recI}}">{{item.added ? 'å·²æ·»åŠ ' : 'æ·»åŠ '}}</view>
						</view>
					</block>
				</view>
			</scroll-view>
		</view>
	</block>

	<!-- æ”¶è´§ä¿¡æ¯ -->
	<view class="section-card">
		<view class="section-title">æ”¶è´§ä¿¡æ¯</view>
		<view class="addr-select" wx:if="{{defaultAddress}}" bindtap="onSelectAddress">
			<view class="addr-body">
				<view class="addr-top">
					<text class="addr-name">{{defaultAddress.name}}</text>
					<text class="addr-phone">{{defaultAddress.phone}}</text>
					<text class="addr-tag" wx:if="{{defaultAddress.isDefault}}">é»˜è®¤</text>
				</view>
				<text class="addr-detail">{{defaultAddress.address}}</text>
			</view>
			<text class="addr-arrow">â€º</text>
		</view>
		<view class="addr-form" wx:else>
			<input class="form-input" placeholder="æ”¶è´§äººå§“å" value="{{name}}" bindinput="onName" />
			<input class="form-input" placeholder="æ‰‹æœºå·ç " type="number" value="{{phone}}" bindinput="onPhone" />
			<input class="form-input" placeholder="è¯¦ç»†æ”¶è´§åœ°å€" value="{{address}}" bindinput="onAddress" />
			<view class="form-check" bindtap="onToggleDefault">
				<view class="check-circle {{setAsDefault ? 'checked' : ''}}">{{setAsDefault ? 'âœ“' : ''}}</view>
				<text class="check-label">è®¾ä¸ºé»˜è®¤åœ°å€</text>
			</view>
		</view>
	</view>

	<!-- è®¢å•å¤‡æ³¨ -->
	<view class="section-card">
		<view class="section-title">è®¢å•å¤‡æ³¨</view>
		<textarea class="remark-area" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰" value="{{remark}}" bindinput="onRemark" maxlength="200"></textarea>
	</view>

	<view style="height: 60rpx;"></view>
</view>
</scroll-view>

<!-- åº•éƒ¨æäº¤æ  -->
<view class="submit-bar">
	<view class="submit-left">
		<text class="submit-label">åˆè®¡</text>
		<text class="submit-price"><text class="price-sym">Â¥</text>{{totalPrice}}</text>
	</view>
	<button class="submit-btn" bindtap="onSubmit">æäº¤è®¢å•</button>
</view>

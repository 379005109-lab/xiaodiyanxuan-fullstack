<navigation-bar title="æ¨èæœ‰ç¤¼" back="{{true}}" color="black" background="transparent"></navigation-bar>
<scroll-view class="scrollarea" scroll-y>
<view class="page">
  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalReferrals}}</text>
        <text class="stat-label">æ€»æ¨è</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.convertedCount}}</text>
        <text class="stat-label">å·²æˆäº¤</text>
      </view>
      <view class="stat-item">
        <text class="stat-value orange">Â¥{{stats.totalReward || 0}}</text>
        <text class="stat-label">å·²è·å¥–åŠ±</text>
      </view>
      <view class="stat-item">
        <text class="stat-value green">Â¥{{stats.pendingReward || 0}}</text>
        <text class="stat-label">å¾…å‘æ”¾</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view class="tab {{activeTab === 'form' ? 'active' : ''}}" data-tab="form" bindtap="switchTab">
      æ¨èå¥½å‹
    </view>
    <view class="tab {{activeTab === 'list' ? 'active' : ''}}" data-tab="list" bindtap="switchTab">
      æˆ‘çš„æ¨è
    </view>
  </view>

  <!-- æ¨èè¡¨å• -->
  <view class="form-section" wx:if="{{activeTab === 'form'}}">
    <view class="form-card">
      <view class="form-header">
        <text class="form-title">æ¨èå¥½å‹ï¼Œæˆäº¤è·5%å¥–åŠ±</text>
        <text class="form-desc">å¡«å†™æ‚¨è¦æ¨èçš„æœ‹å‹ä¿¡æ¯ï¼Œæˆäº¤åæ‚¨å°†è·å¾—è®¢å•é‡‘é¢5%çš„å¥–åŠ±</text>
      </view>

      <!-- å…³è”è®¢å• -->
      <view class="order-info" wx:if="{{orderId}}">
        <text class="order-label">å…³è”è®¢å•</text>
        <view class="order-detail">
          <text class="order-no">{{orderNo}}</text>
          <text class="order-amount">Â¥{{orderAmount}}</text>
        </view>
      </view>

      <!-- è¡¨å•é¡¹ -->
      <view class="form-item">
        <text class="form-label">è¢«æ¨èäººå§“å <text class="required">*</text></text>
        <input 
          class="form-input" 
          placeholder="è¯·è¾“å…¥æœ‹å‹å§“å"
          value="{{refereeName}}"
          bindinput="onInputName"
        />
      </view>

      <view class="form-item">
        <text class="form-label">è”ç³»ç”µè¯ <text class="required">*</text></text>
        <input 
          class="form-input" 
          type="number"
          maxlength="11"
          placeholder="è¯·è¾“å…¥æœ‹å‹æ‰‹æœºå·"
          value="{{refereePhone}}"
          bindinput="onInputPhone"
        />
      </view>

      <view class="form-item">
        <text class="form-label">å¤‡æ³¨è¯´æ˜</text>
        <textarea 
          class="form-textarea" 
          placeholder="å¯ä»¥è¡¥å……ä¸€äº›ä¿¡æ¯ï¼Œå¦‚æœ‹å‹çš„éœ€æ±‚ã€é¢„ç®—ç­‰"
          value="{{refereeRemark}}"
          bindinput="onInputRemark"
          maxlength="200"
        />
      </view>

      <button 
        class="submit-btn {{submitting ? 'disabled' : ''}}" 
        bindtap="submitReferral"
        disabled="{{submitting}}"
      >
        {{submitting ? 'æäº¤ä¸­...' : 'æäº¤æ¨è'}}
      </button>
    </view>

    <!-- è§„åˆ™è¯´æ˜ -->
    <view class="rules-card">
      <view class="rules-title">ğŸ“‹ æ¨èè§„åˆ™</view>
      <view class="rules-list">
        <view class="rule-item">1. æ¨èçš„æœ‹å‹ä¸‹å•æˆäº¤åï¼Œæ‚¨å¯è·å¾—è¯¥è®¢å•é‡‘é¢çš„5%ä½œä¸ºå¥–åŠ±</view>
        <view class="rule-item">2. å¥–åŠ±å°†åœ¨è®¢å•å®Œæˆåå‘æ”¾ï¼Œè¯·ä¿æŒè”ç³»æ–¹å¼ç•…é€š</view>
        <view class="rule-item">3. åŒä¸€æ‰‹æœºå·åªèƒ½è¢«æ¨èä¸€æ¬¡</view>
        <view class="rule-item">4. æœ€ç»ˆè§£é‡Šæƒå½’å°è¿ªä¸¥é€‰æ‰€æœ‰</view>
      </view>
    </view>
  </view>

  <!-- æ¨èåˆ—è¡¨ -->
  <view class="list-section" wx:if="{{activeTab === 'list'}}">
    <view class="loading-text" wx:if="{{loading}}">åŠ è½½ä¸­...</view>
    <view class="empty-text" wx:elif="{{referrals.length === 0}}">æš‚æ— æ¨èè®°å½•</view>
    <view class="referral-list" wx:else>
      <view class="referral-item" wx:for="{{referrals}}" wx:key="_id">
        <view class="referral-header">
          <view class="referral-name">{{item.refereeName}}</view>
          <view class="referral-status status-{{item.status}}">
            {{item.status === 'pending' ? 'å¾…è·Ÿè¿›' : item.status === 'contacted' ? 'å·²è”ç³»' : item.status === 'converted' ? 'å·²æˆäº¤' : item.status === 'rewarded' ? 'å·²å‘å¥–' : 'æ— æ•ˆ'}}
          </view>
        </view>
        <view class="referral-phone">{{item.refereePhone}}</view>
        <view class="referral-footer">
          <text class="referral-date">{{item.createdAt}}</text>
          <text class="referral-reward" wx:if="{{item.status === 'converted' || item.status === 'rewarded'}}">
            å¥–åŠ±: Â¥{{item.rewardAmount}}
          </text>
        </view>
      </view>
    </view>
  </view>
</view>
</scroll-view>

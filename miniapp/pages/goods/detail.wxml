<!--å•†å“è¯¦æƒ…-->
<view class="container" wx:if="{{goods}}">
  <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
  <swiper class="goods-swiper" indicator-dots autoplay circular>
    <swiper-item wx:for="{{goods.images}}" wx:key="index">
      <image src="{{item}}" mode="aspectFill" class="goods-image"
        bindtap="previewImage" data-index="{{index}}"/>
    </swiper-item>
  </swiper>

  <!-- å•†å“ä¿¡æ¯ -->
  <view class="goods-info">
    <view class="price-row">
      <text class="price">Â¥{{totalPrice}}</text>
      <text class="original-price" wx:if="{{goods.originalPrice > goods.price}}">
        Â¥{{goods.originalPrice}}
      </text>
    </view>
    <text class="goods-name">{{goods.name}}</text>
    <view class="tags">
      <text class="tag" wx:if="{{goods.sales}}">å·²å”®{{goods.sales}}ä»¶</text>
      <text class="tag">{{goods.style || 'ç°ä»£é£æ ¼'}}</text>
    </view>
  </view>

  <!-- è§„æ ¼é€‰æ‹© -->
  <view class="spec-section">
    <!-- è§„æ ¼/å°ºå¯¸ -->
    <view class="spec-item" wx:if="{{goods.sizes && goods.sizes.length > 0}}">
      <text class="spec-title">è§„æ ¼</text>
      <view class="spec-options">
        <view class="spec-option {{selectedSize.id === item.id ? 'active' : ''}}"
          wx:for="{{goods.sizes}}" wx:key="id"
          bindtap="selectSize" data-index="{{index}}">
          <text class="spec-name">{{item.name}}</text>
          <text class="dims" wx:if="{{item.dims}}">{{item.dims}}</text>
          <text class="extra" wx:if="{{item.extra > 0}}">+Â¥{{item.extra}}</text>
        </view>
      </view>
    </view>

    <!-- æè´¨åˆ†ç±» -->
    <view class="spec-item" wx:if="{{goods.materialsGroups && goods.materialsGroups.length > 0}}">
      <view class="spec-title-row">
        <text class="spec-title">{{selectedMaterial.name || 'æè´¨'}}</text>
        <text class="spec-count" wx:if="{{selectedSubGroup}}">{{selectedSubGroup.count}}ç§</text>
      </view>
      
      <!-- æè´¨å­åˆ†ç±»é€‰æ‹©ï¼ˆå¦‚Aç±»å¤´å±‚çœŸçš®ï¼‰ -->
      <view class="subgroup-options" wx:if="{{selectedMaterial.subGroups.length > 1}}">
        <view class="subgroup-option {{selectedSubGroup.id === item.id ? 'active' : ''}}"
          wx:for="{{selectedMaterial.subGroups}}" wx:key="id"
          bindtap="selectSubGroup" data-index="{{index}}">
          {{item.name}}
        </view>
      </view>
      
      <!-- å½“å‰å­åˆ†ç±»åç§°ï¼ˆå¦‚åªæœ‰ä¸€ä¸ªå­åˆ†ç±»ï¼‰ -->
      <view class="subgroup-title" wx:if="{{selectedSubGroup && selectedMaterial.subGroups.length === 1}}">
        {{selectedSubGroup.name}}
      </view>
      
      <!-- é¢œè‰²/æè´¨é€‰é¡¹ -->
      <view class="color-grid" wx:if="{{selectedSubGroup.colors.length > 0}}">
        <view class="color-item {{selectedColor.id === item.id ? 'active' : ''}}"
          wx:for="{{selectedSubGroup.colors}}" wx:key="id"
          bindtap="selectColor" data-index="{{index}}">
          <image class="color-image" src="{{item.image}}" mode="aspectFill" 
            wx:if="{{item.image}}"
            bindtap="previewMaterialImage" data-image="{{item.image}}" catchtap="previewMaterialImage"/>
          <view class="color-placeholder" wx:else></view>
          <text class="color-name">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- å†…éƒ¨ç»“æ„ - åªæœ‰åå°é…ç½®äº†æ‰æ˜¾ç¤º -->
    <view class="spec-item" wx:if="{{goods.fills && goods.fills.length > 0}}">
      <text class="spec-title">å†…éƒ¨å¡«å……</text>
      <view class="structure-options">
        <view class="structure-item" wx:for="{{goods.fills}}" wx:key="id">
          <image src="{{item.image}}" mode="aspectFill" wx:if="{{item.image}}"/>
          <text>{{item.name}}</text>
        </view>
      </view>
    </view>

    <view class="spec-item" wx:if="{{goods.frames && goods.frames.length > 0}}">
      <text class="spec-title">å†…éƒ¨æ¡†æ¶</text>
      <view class="structure-options">
        <view class="structure-item" wx:for="{{goods.frames}}" wx:key="id">
          <image src="{{item.image}}" mode="aspectFill" wx:if="{{item.image}}"/>
          <text>{{item.name}}</text>
        </view>
      </view>
    </view>

    <view class="spec-item" wx:if="{{goods.legs && goods.legs.length > 0}}">
      <text class="spec-title">æ²™å‘è„š</text>
      <view class="structure-options">
        <view class="structure-item" wx:for="{{goods.legs}}" wx:key="id">
          <image src="{{item.image}}" mode="aspectFill" wx:if="{{item.image}}"/>
          <text>{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- æ•°é‡ -->
    <view class="spec-item quantity-row">
      <text class="spec-title">æ•°é‡</text>
      <view class="quantity-control">
        <view class="qty-btn" bindtap="changeQuantity" data-type="minus">-</view>
        <text class="qty-num">{{quantity}}</text>
        <view class="qty-btn" bindtap="changeQuantity" data-type="plus">+</view>
      </view>
    </view>
  </view>

  <!-- å•†å“æè¿° -->
  <view class="desc-section" wx:if="{{goods.description}}">
    <text class="section-title">å•†å“æè¿°</text>
    <text class="desc-text">{{goods.description}}</text>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar">
    <view class="action-btns">
      <view class="action-btn" bindtap="addToCart">
        <text class="action-icon">ğŸ›’</text>
        <text>åŠ å…¥è´­ç‰©è½¦</text>
      </view>
    </view>
    <view class="buy-btn" bindtap="buyNow">ç«‹å³è´­ä¹°</view>
  </view>
</view>

<!-- åŠ è½½ä¸­ -->
<view class="loading" wx:if="{{loading}}">
  <text>åŠ è½½ä¸­...</text>
</view>

# 图片上传调试指南

## 🔍 请按以下步骤检查

### 步骤1：打开浏览器控制台

1. 按 `F12` 打开开发者工具
2. 切换到 **Console** 标签页
3. 清空控制台（点击 🚫 图标）

### 步骤2：上传一张图片

上传图片后，在控制台找到这些日志：

```
📤 开始上传文件: xxx.png
📍 API 端点: /files/upload
🔗 完整请求 URL 将是: /api/files/upload
✅ 文件上传成功: { ... }
```

### 步骤3：查看返回的数据

**重点查看**：`✅ 文件上传成功:` 后面的对象，应该包含：

```json
{
  "success": true,
  "data": {
    "fileId": "data:image/png;base64,iVBORw0KG...",  // 应该是完整的 data URL
    "filename": "xxx.png",
    "url": "data:image/png;base64,iVBORw0KG...",
    "storage": "base64"
  }
}
```

### 步骤4：检查 fileId 格式

**正确的格式**：
- ✅ `fileId` 应该以 `data:image/` 开头
- ✅ 是一个很长的字符串（包含完整的图片数据）

**错误的格式**：
- ❌ `fileId: "base64_1763829985705"` （短字符串）
- ❌ `fileId` 不是以 `data:` 开头

### 步骤5：查看图片预览

在**Network**标签页：
1. 过滤 `Img` 类型
2. 看看有没有 404 的请求
3. 如果有 `/api/files/base64_xxx` 的404请求，说明前端还在用旧代码

---

## 🔧 可能的问题

### 问题A：前端还在用旧代码

**症状**：
- 控制台显示 `📍 API 端点: /upload`（旧路径）
- `fileId` 是 `base64_xxx` 格式

**解决**：
1. 强制刷新：`Ctrl + Shift + R`
2. 清除所有缓存
3. 关闭浏览器重新打开

### 问题B：后端还在返回旧格式

**症状**：
- 上传成功
- 但 `fileId` 是 `base64_1763xxx` 而不是 `data:image/...`

**解决**：
后端需要重启（我会帮你）

### 问题C：ImageUploader 组件问题

**症状**：
- 上传返回正确的 data URL
- 但保存时只保存了 fileId 的一部分

**解决**：
需要检查 ImageUploader 组件的代码

---

## 📋 请提供以下信息

从浏览器控制台复制这些信息：

1. **上传日志**：
   ```
   📤 开始上传文件: xxx
   📍 API 端点: ???
   ✅ 文件上传成功: { ... }
   ```

2. **图片URL**：
   在预览图上右键 → 检查元素 → 查看 `<img src="???">`

3. **Network 404错误**（如果有）：
   哪个URL返回了404

---

这样我可以精确定位问题！

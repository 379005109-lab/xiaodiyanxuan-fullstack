# 问题修复说明

## 问题1：域名配置错误

### 错误信息
```
request 合法域名校验出错
https://your-api-domain.com 不在以下 request 合法域名列表中
```

### 原因
`config/api.js` 中的 `baseURL` 还是占位符 `https://your-api-domain.com`，需要替换为实际的域名。

### 解决方案

#### 步骤1：配置实际的后端域名
1. 打开 `config/api.js` 文件
2. 将 `baseURL` 替换为你的实际后端地址（必须是 HTTPS）

```javascript
// config/api.js
const config = {
  // 替换为你的实际后端地址，例如：
  // baseURL: 'https://api.yourdomain.com',
  // 或者 Sealos 提供的域名
  baseURL: 'https://your-actual-domain.com',  // ⚠️ 必须替换
  
  timeout: 10000,
  debug: true
}
```

#### 步骤2：在微信公众平台配置合法域名
1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入 **开发** → **开发管理** → **开发设置**
3. 在 **服务器域名** → **request 合法域名** 中添加你的域名
4. 保存后，在微信开发者工具中：
   - 点击 **详情** → **域名信息**
   - 点击 **刷新** 按钮
   - 重新编译项目

#### 步骤3：确保域名符合要求
- ✅ 必须是 HTTPS 协议
- ✅ 域名必须已备案
- ✅ 端口必须是 443（HTTPS默认端口）

---

## 问题2：模块路径错误

### 错误信息
```
Error: module 'pages/utils/api.js' is not defined, require args is '../../utils/api.js'
```

### 原因
可能是小程序懒加载（LazyCodeLoading）导致的模块加载问题。

### 解决方案

#### 方案1：检查路径是否正确（已验证路径正确）
`pages/order/confirm/index.js` 中的路径 `../../utils/api.js` 是正确的。

#### 方案2：尝试使用绝对路径
如果懒加载导致相对路径有问题，可以尝试使用绝对路径：

```javascript
// 在 pages/order/confirm/index.js 中
// 将
const api = require('../../utils/api.js')
// 改为（如果项目根目录有配置）
const api = require('/utils/api.js')
```

但小程序通常不支持绝对路径，所以这个方案可能不可行。

#### 方案3：关闭懒加载（临时测试）
在 `app.json` 中暂时关闭懒加载测试：

```json
{
  "lazyCodeLoading": "requiredComponents"  // 改为 false 或删除这行
}
```

#### 方案4：确保 utils/api.js 文件存在
检查 `utils/api.js` 文件是否存在且格式正确。

#### 方案5：清理缓存重新编译
1. 在微信开发者工具中：
   - 点击 **工具** → **清除缓存** → **清除文件缓存**
   - 点击 **编译** → **清除缓存并重新编译**

---

## 快速修复步骤

### 1. 修复域名配置
```javascript
// config/api.js
baseURL: 'https://your-actual-domain.com',  // 替换为实际域名
```

### 2. 配置微信小程序合法域名
- 在微信公众平台添加域名
- 在开发者工具中刷新域名信息

### 3. 清理缓存重新编译
- 清除缓存
- 重新编译项目

### 4. 如果模块路径问题仍然存在
- 检查 `utils/api.js` 文件是否存在
- 尝试关闭懒加载测试
- 检查其他页面的引用方式是否一致

---

## 注意事项

1. **开发环境测试**：如果暂时没有配置域名，可以在微信开发者工具中：
   - 点击 **详情** → **本地设置**
   - 勾选 **不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**
   - 这样可以在开发时跳过域名校验（仅开发环境）

2. **生产环境**：必须配置正确的 HTTPS 域名并在微信公众平台添加

3. **域名备案**：小程序使用的域名必须已完成备案

---

## 如果问题仍然存在

1. 检查后端服务是否正常运行
2. 检查域名是否正确配置了 SSL 证书
3. 检查网络连接是否正常
4. 查看微信开发者工具的控制台是否有其他错误信息


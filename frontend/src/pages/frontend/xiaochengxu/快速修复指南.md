# 快速修复指南

## 🚨 当前问题

1. **域名配置错误**：`config/api.js` 中的 `baseURL` 还是占位符
2. **模块路径错误**：懒加载导致的 `require` 路径解析问题

## ✅ 立即修复步骤

### 步骤1：修复域名配置（必须）

打开 `config/api.js`，将占位符替换为实际域名：

```javascript
// config/api.js
const config = {
  // ⚠️ 必须替换为实际的后端 HTTPS 地址
  baseURL: 'https://your-actual-domain.com',  // 替换这里
  
  timeout: 10000,
  debug: true
}
```

**如果没有实际域名，可以暂时使用开发模式：**
1. 在微信开发者工具中：**详情** → **本地设置**
2. 勾选 **"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"**
3. 这样可以在开发时跳过域名校验

### 步骤2：确保所有页面使用全局 api

所有页面文件应该使用以下方式引用 api：

```javascript
// 在页面文件顶部
const app = getApp()
const api = app.api || require('../../utils/api.js')
```

**检查以下文件是否都使用了这种方式：**
- ✅ `pages/index/index.js` - 已使用
- ✅ `pages/mall/index.js` - 已使用
- ✅ `pages/mall/detail/index.js` - 已使用
- ✅ `pages/profile/orders/index.js` - 已使用
- ✅ `pages/profile/favorites/index.js` - 已使用
- ✅ `pages/order/confirm/index.js` - 已使用

### 步骤3：清理缓存并重新编译

1. 在微信开发者工具中：
   - 点击 **工具** → **清除缓存** → **清除文件缓存**
   - 点击 **编译** → **清除缓存并重新编译**

2. 如果问题仍然存在，尝试：
   - 关闭微信开发者工具
   - 删除项目目录下的 `.miniprogram` 文件夹（如果存在）
   - 重新打开项目

### 步骤4：检查 app.js 是否正确

确保 `app.js` 中正确挂载了 api：

```javascript
// app.js
const api = require('./utils/api.js')

App({
  // ... 其他代码
  
  // 将 api 挂载到全局
  api: api
})
```

## 🔍 问题排查

### 如果模块路径问题仍然存在

1. **检查文件结构**：
   ```
   项目根目录/
   ├── app.js
   ├── utils/
   │   └── api.js
   └── pages/
       └── profile/
           └── orders/
               └── index.js
   ```

2. **验证路径**：
   - 从 `pages/profile/orders/index.js` 到 `utils/api.js`
   - 路径应该是：`../../utils/api.js`（向上两级）

3. **尝试临时关闭懒加载**：
   在 `app.json` 中：
   ```json
   {
     "lazyCodeLoading": false  // 改为 false 测试
   }
   ```

### 如果域名问题仍然存在

1. **开发环境**：使用"不校验合法域名"选项（见步骤1）
2. **生产环境**：
   - 必须配置 HTTPS 域名
   - 在微信公众平台添加合法域名
   - 在开发者工具中刷新域名信息

## 📝 注意事项

1. **开发阶段**：可以使用"不校验合法域名"选项快速开发
2. **上线前**：必须配置正确的 HTTPS 域名并在微信公众平台添加
3. **域名要求**：
   - ✅ 必须是 HTTPS
   - ✅ 域名必须已备案
   - ✅ 端口必须是 443

## 🎯 快速测试

修复后，检查控制台是否还有以下错误：
- ❌ `request 合法域名校验出错` - 如果还有，使用开发模式或配置域名
- ❌ `module 'pages/utils/api.js' is not defined` - 如果还有，清理缓存重新编译

如果两个错误都解决了，说明修复成功！

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®¢å•å–æ¶ˆæµ‹è¯•å·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    button {
      background: #dc3545;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover {
      background: #c82333;
    }
    .success {
      background: #28a745;
    }
    .success:hover {
      background: #218838;
    }
    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      margin: 20px 0;
    }
    .orders {
      margin-top: 20px;
    }
    .order {
      padding: 15px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: #fff;
    }
    .order.cancelled {
      background: #f8f9fa;
      opacity: 0.7;
      border-color: #999;
    }
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .status {
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 12px;
      font-weight: bold;
    }
    .status-1 { background: #ffc107; color: #000; }
    .status-2 { background: #17a2b8; color: #fff; }
    .status-5 { background: #dc3545; color: #fff; }
    .tag {
      background: #6c757d;
      color: white;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 11px;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ è®¢å•å–æ¶ˆæµ‹è¯•å·¥å…·</h1>
    
    <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
      <strong>è¯´æ˜ï¼š</strong>è¿™ä¸ªå·¥å…·å¯ä»¥ç›´æ¥æ“ä½œlocalStorageä¸­çš„è®¢å•æ•°æ®ï¼Œå¸®åŠ©æµ‹è¯•è®¢å•å–æ¶ˆåŠŸèƒ½ã€‚
    </div>

    <div>
      <button onclick="loadOrders()" class="success">åˆ·æ–°è®¢å•åˆ—è¡¨</button>
      <button onclick="clearAll()">æ¸…ç©ºæ‰€æœ‰è®¢å•</button>
      <button onclick="createTestOrder()">åˆ›å»ºæµ‹è¯•è®¢å•</button>
    </div>

    <div class="orders" id="ordersList"></div>

    <h3>LocalStorageæ•°æ®ï¼š</h3>
    <pre id="storageData"></pre>
  </div>

  <script>
    function loadOrders() {
      const orders = JSON.parse(localStorage.getItem('local_orders') || '[]');
      const ordersDiv = document.getElementById('ordersList');
      const storageDiv = document.getElementById('storageData');
      
      storageDiv.textContent = JSON.stringify(orders, null, 2);
      
      if (orders.length === 0) {
        ordersDiv.innerHTML = '<p style="color: #999;">æ²¡æœ‰è®¢å•æ•°æ®</p>';
        return;
      }
      
      let html = '<h3>è®¢å•åˆ—è¡¨ï¼š</h3>';
      orders.forEach((order, index) => {
        const isCancelled = order.status === 5 || order.status === 'cancelled';
        const statusText = {
          1: 'å¾…ä»˜æ¬¾',
          2: 'å¾…å‘è´§',
          3: 'å¾…æ”¶è´§',
          4: 'å·²å®Œæˆ',
          5: 'å·²å–æ¶ˆ'
        }[order.status] || 'æœªçŸ¥';
        
        html += `
          <div class="order ${isCancelled ? 'cancelled' : ''}">
            <div class="order-header">
              <div>
                <span class="status status-${order.status}">${statusText}</span>
                ${order.cancelReason ? '<span class="tag">å®¢æˆ·è¦æ±‚å–æ¶ˆ</span>' : ''}
              </div>
              <div>
                <strong style="font-size: 18px; ${isCancelled ? 'color: #999' : 'color: #dc3545'}">
                  Â¥${order.totalAmount || 0}
                </strong>
              </div>
            </div>
            <div>
              <strong>è®¢å•å·ï¼š</strong>${order.orderNo || order._id || 'N/A'}<br>
              <strong>çŠ¶æ€ç ï¼š</strong>${order.status}<br>
              ${order.cancelledAt ? `<strong>å–æ¶ˆæ—¶é—´ï¼š</strong>${new Date(order.cancelledAt).toLocaleString()}<br>` : ''}
            </div>
            <div style="margin-top: 10px;">
              ${!isCancelled ? `
                <button onclick="cancelOrder(${index})" style="padding: 8px 15px; font-size: 14px;">
                  å–æ¶ˆè¿™ä¸ªè®¢å•
                </button>
              ` : `
                <button onclick="deleteOrder(${index})" style="padding: 8px 15px; font-size: 14px; background: #6c757d;">
                  åˆ é™¤è¿™ä¸ªè®¢å•
                </button>
              `}
            </div>
          </div>
        `;
      });
      
      ordersDiv.innerHTML = html;
    }
    
    function cancelOrder(index) {
      if (!confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªè®¢å•å—ï¼Ÿ')) return;
      
      const orders = JSON.parse(localStorage.getItem('local_orders') || '[]');
      if (orders[index]) {
        orders[index].status = 5;
        orders[index].cancelReason = 'customer_request';
        orders[index].cancelledAt = new Date().toISOString();
        
        localStorage.setItem('local_orders', JSON.stringify(orders));
        alert('âœ… è®¢å•å·²å–æ¶ˆï¼åˆ·æ–°é¡µé¢æŸ¥çœ‹æ•ˆæœã€‚');
        loadOrders();
      }
    }
    
    function deleteOrder(index) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢å•å—ï¼Ÿ')) return;
      
      const orders = JSON.parse(localStorage.getItem('local_orders') || '[]');
      orders.splice(index, 1);
      
      localStorage.setItem('local_orders', JSON.stringify(orders));
      alert('âœ… è®¢å•å·²åˆ é™¤ï¼');
      loadOrders();
    }
    
    function clearAll() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®¢å•å—ï¼Ÿ')) return;
      
      localStorage.setItem('local_orders', '[]');
      alert('âœ… æ‰€æœ‰è®¢å•å·²æ¸…ç©ºï¼');
      loadOrders();
    }
    
    function createTestOrder() {
      const orders = JSON.parse(localStorage.getItem('local_orders') || '[]');
      const newOrder = {
        _id: 'test_' + Date.now(),
        orderNo: 'ORDER' + Date.now(),
        status: 1,
        totalAmount: 3960,
        items: [
          {
            productName: 'æµ‹è¯•æ²™å‘',
            quantity: 1,
            price: 3960
          }
        ],
        createdAt: new Date().toISOString()
      };
      
      orders.push(newOrder);
      localStorage.setItem('local_orders', JSON.stringify(orders));
      alert('âœ… æµ‹è¯•è®¢å•å·²åˆ›å»ºï¼');
      loadOrders();
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åˆ·æ–°
    window.addEventListener('load', loadOrders);
  </script>
</body>
</html>

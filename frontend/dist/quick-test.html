<!DOCTYPE html>
<html>
<head>
    <title>å¿«é€ŸAPIæµ‹è¯• - 6ä¸ªé—®é¢˜éªŒè¯</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 1000px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px 5px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 4px; }
        .result { margin-top: 10px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; white-space: pre-wrap; background: #f5f5f5; font-size: 12px; max-height: 300px; overflow-y: auto; }
        .error { background: #ffebee; border-color: #f44336; color: #c62828; }
        .success { background: #e8f5e9; border-color: #4caf50; color: #2e7d32; }
        .warning { background: #fff3e0; border-color: #ff9800; color: #e65100; }
        input { padding: 8px; width: 100%; margin: 5px 0; }
        .status { display: inline-block; padding: 2px 8px; border-radius: 3px; font-size: 11px; }
        .status.ok { background: #4caf50; color: white; }
        .status.fail { background: #f44336; color: white; }
        h2 { border-bottom: 2px solid #4CAF50; padding-bottom: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ”§ APIæµ‹è¯• - éªŒè¯6ä¸ªé—®é¢˜ä¿®å¤çŠ¶æ€</h1>
    
    <div>
        <h3>Token (ä»ç™»å½•è·å–):</h3>
        <input type="text" id="token" placeholder="ç²˜è´´tokenæˆ–ç‚¹å‡»æŒ‰é’®è‡ªåŠ¨è·å–">
        <button onclick="getToken()">ä»LocalStorageè·å–Token</button>
        <button onclick="testAll()">ğŸš€ æµ‹è¯•æ‰€æœ‰é—®é¢˜</button>
    </div>

    <hr>

    <h2>é—®é¢˜1: å¯¹æ¯”åŠŸèƒ½ (åº”è¯¥è¿”å›201æˆ–400ä½†ä¸æ˜¯500)</h2>
    <button onclick="testCompare()">æµ‹è¯•æ·»åŠ å¯¹æ¯”</button>
    <div id="compare-result" class="result"></div>

    <h2>é—®é¢˜2: æ”¶è—åŠŸèƒ½ (åº”è¯¥è¿”å›201æˆ–400ä½†ä¸æ˜¯500)</h2>
    <button onclick="testFavorite()">æµ‹è¯•æ·»åŠ æ”¶è—</button>
    <div id="favorite-result" class="result"></div>

    <h2>é—®é¢˜5: é™ªä¹°éœ€æ±‚æäº¤</h2>
    <button onclick="testBuyingService()">æµ‹è¯•é™ªä¹°æœåŠ¡</button>
    <div id="buying-result" class="result"></div>

    <h2>åç«¯è¿æ¥æµ‹è¯•</h2>
    <button onclick="testProducts()">è·å–äº§å“åˆ—è¡¨</button>
    <div id="products-result" class="result"></div>

    <script>
        const API = 'https://pkochbpmcgaa.sealoshzh.site/api';
        
        function getToken() {
            const token = localStorage.getItem('token');
            document.getElementById('token').value = token || '';
            if (token) {
                alert('âœ… Tokenå·²åŠ è½½');
            } else {
                alert('âŒ æœªæ‰¾åˆ°Tokenï¼Œè¯·å…ˆç™»å½•ç½‘ç«™');
            }
        }

        function showResult(id, content, status = 'info') {
            const el = document.getElementById(id);
            el.textContent = content;
            el.className = 'result ' + (status === 'error' ? 'error' : status === 'success' ? 'success' : status === 'warning' ? 'warning' : '');
        }

        async function testAll() {
            const token = document.getElementById('token').value;
            if (!token) {
                alert('è¯·å…ˆè·å–Token');
                return;
            }
            
            alert('å¼€å§‹æµ‹è¯•æ‰€æœ‰é—®é¢˜...');
            await testCompare();
            await new Promise(r => setTimeout(r, 1000));
            await testFavorite();
            await new Promise(r => setTimeout(r, 1000));
            await testBuyingService();
            await new Promise(r => setTimeout(r, 1000));
            await testProducts();
            alert('æµ‹è¯•å®Œæˆï¼è¯·æŸ¥çœ‹å„ä¸ªç»“æœã€‚');
        }

        async function testCompare() {
            const token = document.getElementById('token').value;
            if (!token) {
                alert('è¯·å…ˆè·å–Token');
                return;
            }

            showResult('compare-result', 'â³ æµ‹è¯•ä¸­...');

            try {
                const response = await fetch(`${API}/compare`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        productId: '6745c22b4f6d7f7885c81f11',
                        skuId: 'test-sku-123'
                    })
                });

                const data = await response.json();
                
                let status = 'error';
                let verdict = '';
                if (response.status === 201) {
                    verdict = 'âœ… æˆåŠŸæ·»åŠ åˆ°å¯¹æ¯”';
                    status = 'success';
                } else if (response.status === 400) {
                    verdict = 'âš ï¸ 400é”™è¯¯ï¼ˆå¯èƒ½å·²å­˜åœ¨æˆ–è¾¾åˆ°ä¸Šé™ï¼‰- è¿™æ˜¯æ­£å¸¸çš„';
                    status = 'warning';
                } else if (response.status === 500) {
                    verdict = 'âŒ 500é”™è¯¯ - åç«¯æœ‰BUGæœªä¿®å¤ï¼';
                    status = 'error';
                }
                
                const result = `${verdict}\n\nçŠ¶æ€ç : ${response.status}\nçŠ¶æ€æ–‡æœ¬: ${response.statusText}\n\nå“åº”æ•°æ®:\n${JSON.stringify(data, null, 2)}`;

                showResult('compare-result', result, status);
            } catch (error) {
                showResult('compare-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testFavorite() {
            const token = document.getElementById('token').value;
            if (!token) {
                alert('è¯·å…ˆè·å–Token');
                return;
            }

            showResult('favorite-result', 'â³ æµ‹è¯•ä¸­...');

            try {
                const response = await fetch(`${API}/favorites`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        productId: '6745c22b4f6d7f7885c81f11'
                    })
                });

                const data = await response.json();
                
                let status = 'error';
                let verdict = '';
                if (response.status === 201) {
                    verdict = 'âœ… æˆåŠŸæ·»åŠ åˆ°æ”¶è—';
                    status = 'success';
                } else if (response.status === 400) {
                    verdict = 'âš ï¸ 400é”™è¯¯ï¼ˆå¯èƒ½å·²å­˜åœ¨ï¼‰- è¿™æ˜¯æ­£å¸¸çš„';
                    status = 'warning';
                } else if (response.status === 500) {
                    verdict = 'âŒ 500é”™è¯¯ - åç«¯æœ‰BUGæœªä¿®å¤ï¼';
                    status = 'error';
                }
                
                const result = `${verdict}\n\nçŠ¶æ€ç : ${response.status}\nçŠ¶æ€æ–‡æœ¬: ${response.statusText}\n\nå“åº”æ•°æ®:\n${JSON.stringify(data, null, 2)}`;

                showResult('favorite-result', result, status);
            } catch (error) {
                showResult('favorite-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testBuyingService() {
            const token = document.getElementById('token').value;
            if (!token) {
                alert('è¯·å…ˆè·å–Token');
                return;
            }

            showResult('buying-result', 'â³ æµ‹è¯•ä¸­...');

            try {
                const response = await fetch(`${API}/buying-service-requests`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        serviceType: 'standard',
                        scheduledDate: '2024-12-15T10:00:00Z',
                        notes: 'æµ‹è¯•é™ªä¹°æœåŠ¡'
                    })
                });

                const data = await response.json();
                
                let status = response.status === 201 ? 'success' : 'error';
                let verdict = response.status === 201 ? 'âœ… é™ªä¹°æœåŠ¡æäº¤æˆåŠŸ' : 'âŒ æäº¤å¤±è´¥';
                
                const result = `${verdict}\n\nçŠ¶æ€ç : ${response.status}\nçŠ¶æ€æ–‡æœ¬: ${response.statusText}\n\nå“åº”æ•°æ®:\n${JSON.stringify(data, null, 2)}`;

                showResult('buying-result', result, status);
            } catch (error) {
                showResult('buying-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testProducts() {
            showResult('products-result', 'â³ æµ‹è¯•ä¸­...');

            try {
                const response = await fetch(`${API}/products?page=1&limit=5`);
                const data = await response.json();
                
                const result = `çŠ¶æ€ç : ${response.status}\n` +
                              `çŠ¶æ€æ–‡æœ¬: ${response.statusText}\n\n` +
                              `äº§å“æ•°é‡: ${data.data?.products?.length || 0}\n\n` +
                              `å“åº”æ•°æ®:\n${JSON.stringify(data, null, 2).substring(0, 500)}...`;

                showResult('products-result', result, response.ok ? 'success' : 'error');
            } catch (error) {
                showResult('products-result', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        window.onload = function() {
            getToken();
        };
    </script>
</body>
</html>

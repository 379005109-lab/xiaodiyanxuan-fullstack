import{s as a,d as r}from"./index-DWFic46w.js";const e=async()=>{try{const e=(await a.get("/packages")).data.data;if(e&&e.length>0){return await Promise.all(e.map(async e=>{var i;let t=[];if(e.categories&&e.categories.length>0)t=e.categories.map(a=>({key:a._id||a.name,name:a.name,required:a.required||1,products:a.products.map(e=>{const i={},t={};let l=e.specs||"";if(e.skus&&e.skus.length>0){const a=new Set,l=new Set,s=new Set,m=new Set;e.skus.forEach(e=>{if(e.material&&(Array.isArray(e.material.fabric)?e.material.fabric.forEach(r=>a.add(r)):e.material.fabric&&a.add(e.material.fabric),Array.isArray(e.material.filling)?e.material.filling.forEach(a=>l.add(a)):e.material.filling&&l.add(e.material.filling),Array.isArray(e.material.frame)?e.material.frame.forEach(a=>s.add(a)):e.material.frame&&s.add(e.material.frame),Array.isArray(e.material.leg)?e.material.leg.forEach(a=>m.add(a)):e.material.leg&&m.add(e.material.leg)),e.images&&e.images.length>0){const a=r(e.images[0]);e.material&&(Array.isArray(e.material.fabric)&&e.material.fabric.forEach(r=>{t[r]||(t[r]=a)}),Array.isArray(e.material.filling)&&e.material.filling.forEach(r=>{t[r]||(t[r]=a)}),Array.isArray(e.material.frame)&&e.material.frame.forEach(r=>{t[r]||(t[r]=a)}),Array.isArray(e.material.leg)&&e.material.leg.forEach(r=>{t[r]||(t[r]=a)}))}}),a.size>0&&(i.fabric=Array.from(a)),l.size>0&&(i.filling=Array.from(l)),s.size>0&&(i.frame=Array.from(s)),m.size>0&&(i.leg=Array.from(m))}let s=e.basePrice||0;if(e.skus&&e.skus.length>0){const a=e.skus[0];a.discountPrice&&a.discountPrice>0?s=a.discountPrice:a.price&&a.price>0&&(s=a.price)}return{id:e.id,name:e.name,category:a.name,basePrice:s,packagePrice:e.packagePrice||s,image:e.image?r(e.image):"/placeholder.svg",images:e.image?[r(e.image)]:[],specs:l,description:e.description||"",materials:i,materialImages:t,skus:e.skus||[],specifications:e.specifications,videos:e.videos}})}));else if(e.products&&e.products.length>0){const i=(await Promise.all(e.products.map(async r=>{try{return{...(await a.get(`/products/${r.productId}`)).data.data,packageQuantity:r.quantity||1,packagePrice:r.price}}catch(e){return null}}))).filter(a=>null!==a),l={};i.forEach(a=>{var e;const i=a.category||a.categoryName||"其他";l[i]||(l[i]=[]);const t={},s={};let m="";if(a.skus&&a.skus.length>0){const e=new Set,i=new Set,l=new Set,c=new Set,n=[];a.skus.forEach(a=>{if(a.material&&(Array.isArray(a.material.fabric)?a.material.fabric.forEach(a=>e.add(a)):a.material.fabric&&e.add(a.material.fabric),Array.isArray(a.material.filling)?a.material.filling.forEach(a=>i.add(a)):a.material.filling&&i.add(a.material.filling),Array.isArray(a.material.frame)?a.material.frame.forEach(a=>l.add(a)):a.material.frame&&l.add(a.material.frame),Array.isArray(a.material.leg)?a.material.leg.forEach(a=>c.add(a)):a.material.leg&&c.add(a.material.leg)),a.length&&a.width&&a.height){const r=`${Math.round(a.length/10)}x${Math.round(a.width/10)}x${Math.round(a.height/10)}cm`;n.includes(r)||n.push(r)}if(a.images&&a.images.length>0){const e=r(a.images[0]);a.material&&(Array.isArray(a.material.fabric)?a.material.fabric.forEach(a=>{s[a]||(s[a]=e)}):a.material.fabric&&!s[a.material.fabric]&&(s[a.material.fabric]=e),Array.isArray(a.material.filling)?a.material.filling.forEach(a=>{s[a]||(s[a]=e)}):a.material.filling&&!s[a.material.filling]&&(s[a.material.filling]=e),Array.isArray(a.material.frame)?a.material.frame.forEach(a=>{s[a]||(s[a]=e)}):a.material.frame&&!s[a.material.frame]&&(s[a.material.frame]=e),Array.isArray(a.material.leg)?a.material.leg.forEach(a=>{s[a]||(s[a]=e)}):a.material.leg&&!s[a.material.leg]&&(s[a.material.leg]=e))}}),e.size>0&&(t.fabric=Array.from(e)),i.size>0&&(t.filling=Array.from(i)),l.size>0&&(t.frame=Array.from(l)),c.size>0&&(t.leg=Array.from(c)),n.length>0&&(m=`尺寸：${n.join("、")}`)}!m&&a.description&&(m=a.description),l[i].push({id:a._id,name:a.name,category:a.category||a.categoryName,basePrice:a.basePrice||0,packagePrice:a.packagePrice,image:(null==(e=a.images)?void 0:e[0])?r(a.images[0]):"/placeholder.svg",images:a.images?a.images.map(a=>r(a)):[],specs:m,description:a.description||"",materials:t,materialImages:s,skus:a.skus||[],specifications:a.specifications,videos:a.videos})});const s=e.categories||[];Object.entries(l).forEach(([a,r])=>{const e=s.find(r=>r.name===a);t.push({key:a,name:a,required:(null==e?void 0:e.required)||1,products:r})})}return{id:e._id,name:e.name,price:e.basePrice||0,banner:e.thumbnail?r(e.thumbnail):(null==(i=e.images)?void 0:i[0])?r(e.images[0]):"/placeholder.svg",gallery:e.images&&e.images.length>0?e.images.map(a=>r(a)):[e.thumbnail?r(e.thumbnail):"/placeholder.svg"],tags:t.map(a=>a.name),description:e.description||"",status:e.status||"active",categories:t}}))}return[]}catch(e){return[]}};export{e as g};

import{b as e,o as s,j as t,d as a,h as l}from"./index-DWFic46w.js";import{i as r,u as n,r as i,L as o}from"./react-vendor-E1AgTUZ9.js";import{g as c}from"./packageService-CaKcAkPb.js";import{L as d,v as x,C as m,d as h,o as u,X as p,y as f,z as b,f as j,u as g,x as v}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";const N={fabric:"面料",filling:"填充",frame:"框架",leg:"脚架",leather:"皮质",wood:"木材"},y=(e,s,t)=>{var l;if(t[s])return a(t[s]);for(const[r,n]of Object.entries(t))if(s.includes(r)||r.includes(s))return a(n);return(null==(l=e.materialImages)?void 0:l[s])?a(e.materialImages[s]):e.image?a(e.image):"/placeholder.svg"};function w(){var v;const{id:N}=r(),y=n(),[w,C]=i.useState(null),[S,O]=i.useState(!0),[L,P]=i.useState({}),[E,$]=i.useState({}),[z,q]=i.useState({}),[M,F]=i.useState({}),[I,A]=i.useState(null),[U,B]=i.useState(null),[_,D]=i.useState(!1),[K,R]=i.useState({name:"",phone:"",address:""}),[T,J]=i.useState(!1),[V,G]=i.useState({}),[H,Q]=i.useState([]),[W,X]=i.useState(!1),Y=i.useRef({}),{isAuthenticated:Z,token:ee}=e();i.useEffect(()=>{te(),se()},[N]);const se=async()=>{try{const e=await s(),t={};e.forEach(e=>{e.name&&e.image&&(t[e.name]=e.image)}),G(t)}catch(e){}},te=async()=>{if(!N)return;O(!0);const e=(await c()).find(e=>e.id===N);C(e||null),O(!1)},ae=(e,s)=>{const t=Y.current[e];t&&t.scrollBy({left:"left"===s?-350:350,behavior:"smooth"})},le=()=>{D(!0),(async()=>{if(Z&&ee){X(!0);try{const e=await fetch("https://pkochbpmcgaa.sealoshzh.site/api/addresses",{headers:{Authorization:`Bearer ${ee}`}});if(e.ok){const s=await e.json();Q(s.data||[])}}catch(e){}finally{X(!1)}}})()},re=e=>{const s=z[e];return s&&0!==Object.keys(s).length?Object.values(s).join(" / "):null},ne=(e,s)=>{$(t=>({...t,[e]:Math.max(1,(t[e]||1)+s)}))},ie=e=>{const s=z[e];if(!s)return 0;const t=null==w?void 0:w.categories.flatMap(e=>e.products).find(s=>s.id===e);if(!t)return 0;let a=0;return Object.entries(s).forEach(([e,s])=>{var l,r;const n=null==(l=t.materials)?void 0:l[e];if(!n||n[0]===s)return;const i=t;if(i.skus)for(const t of i.skus){if(null==(r=t.materialUpgradePrices)?void 0:r[s])return void(a+=t.materialUpgradePrices[s]);for(const[e,l]of Object.entries(t.materialUpgradePrices||{}))if(s.includes(e)||e.includes(s))return void(a+=l)}}),a},oe=i.useMemo(()=>{if(!w)return 0;let e=0;return w.categories.forEach(s=>{(L[s.key]||[]).forEach(s=>{const t=E[s]||1;e+=ie(s)*t})}),e},[w,L,z,E]),ce=w?w.price:0,de=ce+oe,xe=w?Math.round(w.categories.reduce((e,s)=>{return e+Math.min((t=s.key,(L[t]||[]).reduce((e,s)=>e+(E[s]||1),0)),s.required);var t},0)/w.categories.reduce((e,s)=>e+s.required,0)*100):0;return S?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#F2F4F3]",children:t.jsx(d,{className:"h-10 w-10 animate-spin text-primary"})}):w?t.jsxs("div",{className:"min-h-screen bg-[#F2F4F3] pb-20 animate-fade-in-up",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[t.jsxs("div",{className:"flex-1 overflow-y-auto",children:[t.jsxs("div",{className:"relative w-full h-36 md:h-44 overflow-hidden",children:[t.jsx("img",{src:(null==(v=w.gallery)?void 0:v[0])||(w.banner?a(w.banner):"/placeholder.svg"),alt:w.name,className:"w-full h-full object-cover object-center"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-primary/90 via-primary/50 to-transparent"}),t.jsxs("div",{className:"absolute bottom-0 left-0 w-full p-8 text-white",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("span",{className:"bg-accent text-stone-900 text-[10px] font-bold px-2 py-0.5 rounded uppercase",children:"Collection"}),t.jsx("span",{className:"text-white/60 text-[10px] uppercase tracking-widest",children:"NORDIC SERIES"})]}),t.jsx("h1",{className:"text-2xl font-serif font-bold mb-1",children:w.name}),t.jsx("p",{className:"opacity-90 text-xs max-w-2xl line-clamp-2",children:w.description})]}),t.jsxs("button",{onClick:()=>y("/packages"),className:"absolute top-4 left-4 flex items-center gap-1 bg-white/20 backdrop-blur text-white rounded-full px-4 py-2 text-sm hover:bg-white/30 transition-colors",children:[t.jsx(x,{className:"h-4 w-4"})," 返回列表"]})]}),t.jsx("div",{className:"p-6 lg:p-10 space-y-12",children:w.categories.map((e,s)=>{const l=L[e.key]||[];return t.jsxs("div",{id:e.key,children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between mb-4 gap-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[t.jsxs("span",{className:"text-xs font-bold text-stone-300",children:["0",s+1]}),t.jsx("h3",{className:"text-xl font-serif font-bold text-primary",children:e.name}),t.jsxs("span",{className:"text-xs font-medium text-white bg-primary/80 px-2 py-0.5 rounded",children:[e.products.length,"选",e.required]}),l.length>=e.required&&t.jsx("span",{className:"w-5 h-5 rounded-full bg-emerald-500 flex items-center justify-center",children:t.jsx(m,{className:"w-3 h-3 text-white"})})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-stone-500",children:[t.jsx("span",{children:"快速筛选:"}),t.jsx("button",{className:"px-2 py-0.5 rounded bg-primary text-white",children:"全部"}),t.jsx("button",{className:"px-2 py-0.5 rounded hover:bg-stone-200",children:"真皮"}),t.jsx("button",{className:"px-2 py-0.5 rounded hover:bg-stone-200",children:"布艺"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>ae(e.key,"left"),className:"w-10 h-10 rounded-full bg-stone-900 text-white flex items-center justify-center hover:bg-black shadow-lg",children:t.jsx(x,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>ae(e.key,"right"),className:"w-10 h-10 rounded-full bg-stone-900 text-white flex items-center justify-center hover:bg-black shadow-lg",children:t.jsx(h,{className:"w-5 h-5"})})]})]}),t.jsx("div",{ref:s=>Y.current[e.key]=s,className:"flex overflow-x-auto gap-4 pb-4 scrollbar-hide snap-x",style:{scrollBehavior:"smooth"},children:e.products.map(s=>{const r=l.includes(s.id),n=s.isDeleted||"inactive"===s.status;return t.jsxs("div",{className:`snap-start flex-shrink-0 w-[280px] bg-white rounded-xl overflow-hidden border-2 transition-all ${r?"border-primary ring-2 ring-primary/20 shadow-lg":"border-stone-100 hover:shadow-md"} ${n?"opacity-50":""}`,children:[t.jsxs("div",{className:"relative h-36 bg-stone-100",children:[t.jsx("img",{src:s.image?a(s.image):"/placeholder.svg",alt:s.name,className:"w-full h-full object-cover"}),t.jsx("button",{onClick:()=>A(s),className:"absolute top-2 left-2 w-8 h-8 flex items-center justify-center bg-white/90 rounded-full text-stone-600 hover:text-primary shadow-md",children:t.jsx(u,{className:"w-4 h-4"})}),r&&t.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:t.jsx(m,{className:"w-4 h-4 text-white"})})]}),t.jsxs("div",{className:"p-4",children:[t.jsx("h4",{className:"font-bold text-stone-800 line-clamp-1 mb-1",children:s.name}),t.jsxs("div",{className:"text-accent font-serif font-bold text-lg mb-2",children:["¥",(s.price||0).toLocaleString()]}),t.jsxs("div",{className:"text-[10px] text-stone-400 mb-3",children:["可选规格: ",s.materials?Object.keys(s.materials).length:0," 款"]}),t.jsx("button",{onClick:()=>!n&&((e,s)=>{B({categoryKey:e,product:s})})(e.key,s),disabled:n,className:"w-full py-2.5 rounded-lg text-sm font-bold transition-colors "+(n?"bg-gray-200 text-gray-400 cursor-not-allowed":r?"bg-primary text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"),children:n?"已下架":r?"已添加到清单":"加入配置"})]})]},s.id)})})]},e.key)})})]}),t.jsx("div",{className:"hidden lg:block w-[480px] flex-shrink-0",children:t.jsxs("div",{className:"sticky top-4 m-4 bg-white rounded-2xl border border-stone-200 shadow-2xl overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col",children:[t.jsx("div",{className:"p-6 border-b border-stone-100 bg-stone-50/50",children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-serif font-bold text-primary text-lg mb-1",children:"配置清单"}),t.jsx("span",{className:"text-xs text-stone-400 uppercase tracking-widest",children:"PRO FORMA INVOICE"})]}),t.jsx("div",{className:"text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded font-bold",children:"Draft"})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex justify-between text-xs font-bold mb-2",children:[t.jsx("span",{className:"text-stone-500",children:"完成度"}),t.jsxs("span",{className:"text-primary",children:[xe,"%"]})]}),t.jsx("div",{className:"h-2 bg-stone-100 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${xe}%`}})})]}),t.jsxs("div",{className:"space-y-3",children:[w.categories.map(e=>(L[e.key]||[]).map(s=>{const l=e.products.find(e=>e.id===s);if(!l)return null;const r=E[s]||1,n=ie(s),i=((l.price||0)+n)*r,o=n>0;return t.jsxs("div",{className:"flex gap-4 items-start p-3 rounded-xl border "+(o?"bg-amber-50 border-amber-200":"bg-white border-stone-100"),children:[t.jsxs("div",{className:"w-20 h-20 rounded-xl bg-stone-100 overflow-hidden border border-stone-200 flex-shrink-0 relative",children:[t.jsx("img",{src:l.image?a(l.image):"/placeholder.svg",alt:"",className:"w-full h-full object-cover"}),o&&t.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-amber-500 rounded-full flex items-center justify-center shadow",children:t.jsx("span",{className:"text-[10px] text-white font-bold",children:"↑"})})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex justify-between items-start mb-1",children:[t.jsx("span",{className:"text-sm font-bold text-stone-800 line-clamp-2",children:l.name}),t.jsx("button",{onClick:()=>((e,s)=>{P(t=>({...t,[e]:(t[e]||[]).filter(e=>e!==s)})),g.success("已移除")})(e.key,s),className:"p-1 rounded hover:bg-red-100 text-stone-400 hover:text-red-500 ml-2 flex-shrink-0",children:t.jsx(p,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"text-lg font-serif font-bold text-red-600",children:["¥",i.toLocaleString()]}),re(s)&&t.jsx("div",{className:"text-xs text-stone-500 mt-1",children:re(s)}),o&&t.jsxs("div",{className:"text-xs text-amber-600 font-medium mt-1",children:["含材质升级 +¥",(n*r).toLocaleString()]}),t.jsx("div",{className:"flex items-center gap-3 mt-2",children:t.jsxs("div",{className:"flex items-center border border-stone-300 rounded-lg bg-white",children:[t.jsx("button",{onClick:()=>ne(s,-1),className:"px-2 py-1 hover:bg-stone-50",children:t.jsx(f,{className:"w-4 h-4 text-stone-500"})}),t.jsx("span",{className:"text-sm w-6 text-center font-medium",children:r}),t.jsx("button",{onClick:()=>ne(s,1),className:"px-2 py-1 hover:bg-stone-50",children:t.jsx(b,{className:"w-4 h-4 text-stone-500"})})]})})]})]},s)})),Object.values(L).every(e=>0===e.length)&&t.jsxs("div",{className:"text-center py-10 text-stone-400",children:[t.jsx(j,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),t.jsx("p",{children:"还未选择任何商品"})]})]})]}),t.jsxs("div",{className:"p-6 bg-stone-50 border-t border-stone-200 space-y-4",children:[t.jsxs("div",{className:"space-y-2 text-xs text-stone-500",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"套餐基础价"}),t.jsxs("span",{children:["¥",ce.toLocaleString()]})]}),oe>0&&t.jsxs("div",{className:"flex justify-between text-amber-600",children:[t.jsx("span",{children:"材质升级费用"}),t.jsxs("span",{children:["+¥",oe.toLocaleString()]})]})]}),t.jsxs("div",{className:"pt-4 border-t border-stone-200",children:[t.jsxs("div",{className:"flex justify-between items-end mb-4",children:[t.jsx("span",{className:"font-bold text-stone-700",children:"预估总价"}),t.jsxs("span",{className:"font-serif font-bold text-3xl text-red-600",children:["¥",de.toLocaleString()]})]}),t.jsxs("button",{onClick:()=>{if(!Z)return g.error("请先登录"),void l.getState().openLogin();le()},disabled:xe<100,className:"w-full bg-primary text-white py-3.5 rounded-xl font-bold hover:bg-green-900 shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:["提交采购意向 ",t.jsx(h,{className:"w-4 h-4"})]}),t.jsx("p",{className:"text-[10px] text-center text-stone-400 mt-2",children:"* 最终报价以销售顾问确认为准"})]})]})]})}),t.jsxs("div",{className:"lg:hidden fixed bottom-0 left-0 w-full bg-white border-t border-stone-200 p-4 z-50 flex justify-between items-center shadow-[0_-5px_20px_rgba(0,0,0,0.05)]",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-stone-400 uppercase",children:"Total Estimate"}),t.jsxs("div",{className:"font-serif font-bold text-xl text-accent",children:["¥",de.toLocaleString()]})]}),t.jsx("button",{onClick:()=>{if(!Z)return g.error("请先登录"),void l.getState().openLogin();le()},disabled:xe<100,className:"bg-primary text-white px-6 py-3 rounded-xl font-bold shadow-lg disabled:opacity-50",children:"提交意向"})]})]}),I&&t.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:()=>A(null),children:t.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl overflow-hidden shadow-2xl",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"relative h-64 bg-stone-100",children:[t.jsx("img",{src:I.image?a(I.image):"/placeholder.svg",alt:"",className:"w-full h-full object-cover"}),t.jsx("button",{onClick:()=>A(null),className:"absolute top-4 right-4 bg-black/40 hover:bg-black/60 text-white p-2 rounded-full",children:t.jsx(p,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"p-6",children:[t.jsx("h3",{className:"text-xl font-serif font-bold text-primary mb-1",children:I.name}),t.jsxs("div",{className:"text-2xl font-serif font-bold text-accent mb-4",children:["¥",(I.price||0).toLocaleString()]})]}),t.jsx("div",{className:"p-4 border-t border-stone-100 bg-stone-50",children:t.jsx("button",{onClick:()=>A(null),className:"w-full bg-stone-200 text-stone-600 py-3 rounded-xl font-bold hover:bg-stone-300",children:"关闭"})})]})}),_&&t.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:()=>D(!1),children:t.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl overflow-hidden shadow-2xl",onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"p-6 border-b border-stone-100",children:t.jsx("h3",{className:"text-xl font-serif font-bold text-primary",children:"确认订单"})}),t.jsxs("div",{className:"p-6 space-y-4",children:[H.length>0&&t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-stone-400 uppercase mb-2 block",children:"选择已保存的地址"}),t.jsxs("select",{onChange:e=>{const s=H.find(s=>s._id===e.target.value);s&&(e=>{R({name:e.name,phone:e.phone,address:e.address})})(s)},className:"w-full px-4 py-2 border border-stone-200 rounded-lg focus:border-primary outline-none bg-white",children:[t.jsx("option",{value:"",children:"-- 或手动填写新地址 --"}),H.map(e=>t.jsxs("option",{value:e._id,children:[e.name," - ",e.phone," - ",e.address.slice(0,20),"..."]},e._id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-stone-400 uppercase",children:"联系人"}),t.jsx("input",{type:"text",value:K.name,onChange:e=>R(s=>({...s,name:e.target.value})),className:"w-full mt-1 px-4 py-2 border border-stone-200 rounded-lg focus:border-primary outline-none",placeholder:"您的姓名"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-stone-400 uppercase",children:"电话"}),t.jsx("input",{type:"tel",value:K.phone,onChange:e=>R(s=>({...s,phone:e.target.value})),className:"w-full mt-1 px-4 py-2 border border-stone-200 rounded-lg focus:border-primary outline-none",placeholder:"联系电话"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-stone-400 uppercase",children:"地址"}),t.jsx("input",{type:"text",value:K.address,onChange:e=>R(s=>({...s,address:e.target.value})),className:"w-full mt-1 px-4 py-2 border border-stone-200 rounded-lg focus:border-primary outline-none",placeholder:"收货地址"})]}),t.jsx("div",{className:"pt-4 border-t border-stone-100",children:t.jsxs("div",{className:"flex justify-between items-end",children:[t.jsx("span",{className:"text-stone-600",children:"订单总额"}),t.jsxs("span",{className:"font-serif font-bold text-2xl text-accent",children:["¥",de.toLocaleString()]})]})})]}),t.jsxs("div",{className:"p-4 border-t border-stone-100 bg-stone-50 flex gap-3",children:[t.jsx("button",{onClick:()=>D(!1),className:"flex-1 py-3 rounded-xl font-bold bg-stone-200 text-stone-600",children:"取消"}),t.jsx("button",{onClick:async()=>{if(w&&Z){J(!0);try{const s={packageId:w.id,packageName:w.name,packagePrice:w.price,selections:w.categories.map(e=>{const s=L[e.key]||[];return{categoryKey:e.key,categoryName:e.name,required:e.required,products:s.map(s=>{const t=e.products.find(e=>e.id===s);if(!t)return null;const a=E[s]||1,l=z[s]||{},r=ie(s);return{productId:s,productName:t.name,image:t.image,quantity:a,materials:l,materialUpgrade:r*a}}).filter(Boolean)}})},t={packageData:s,recipient:{name:K.name,phone:K.phone,address:K.address},notes:""},a=await fetch("https://pkochbpmcgaa.sealoshzh.site/api/orders/package",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ee}`},body:JSON.stringify(t)});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.message||"提交失败")}g.success("订单提交成功！");try{await fetch("https://pkochbpmcgaa.sealoshzh.site/api/addresses",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ee}`},body:JSON.stringify({name:K.name,phone:K.phone,address:K.address,isDefault:!1})})}catch(e){}D(!1),y("/orders")}catch(s){g.error(`提交失败: ${s.message}`)}finally{J(!1)}}else g.error("请先登录")},disabled:T,className:"flex-1 py-3 rounded-xl font-bold bg-primary text-white disabled:opacity-50",children:T?"提交中...":"确认提交"})]})]})}),U&&t.jsx(k,{product:U.product,categoryKey:U.categoryKey,materialImageMap:V,onConfirm:(e,s,t,a)=>{const l=null==w?void 0:w.categories.find(s=>s.key===e);if(!l)return;const r=L[e]||[];if(r.includes(s.id));else if(1===l.required)P(t=>({...t,[e]:[s.id]}));else{if(r.length>=l.required)return void g.error(`最多选择 ${l.required} 件`);P(t=>({...t,[e]:[...t[e]||[],s.id]}))}q(e=>({...e,[s.id]:t})),a&&F(e=>({...e,[s.id]:a})),E[s.id]||$(e=>({...e,[s.id]:1})),B(null),g.success("已添加到清单")},onClose:()=>B(null)})]}):t.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-[#F2F4F3]",children:[t.jsx("p",{className:"text-lg mb-4 text-stone-600",children:"未找到对应套餐"}),t.jsx(o,{to:"/packages",className:"bg-primary text-white px-6 py-2 rounded-xl",children:"返回套餐列表"})]})}function k({product:e,categoryKey:s,materialImageMap:l,onConfirm:r,onClose:n}){var o;const c=e,[d,x]=i.useState((null==(o=c.skus)?void 0:o[0])||null),[u,f]=i.useState(()=>{const s={};return e.materials&&Object.entries(e.materials).forEach(([e,t])=>{Array.isArray(t)&&t.length>0&&(s[e]=t[0])}),s}),[b,j]=i.useState(e.image?a(e.image):"/placeholder.svg"),[g,w]=i.useState(!1),k=c.skus&&c.skus.length>0,C=e.materials&&Object.keys(e.materials).length>0,S=e=>{var s;if(c.skus)for(const t of c.skus){if(null==(s=t.materialUpgradePrices)?void 0:s[e])return t.materialUpgradePrices[e];for(const[s,a]of Object.entries(t.materialUpgradePrices||{}))if(e.includes(s)||s.includes(e))return a}return 0},O=Object.entries(u).reduce((s,[t,a])=>{var l;const r=null==(l=e.materials)?void 0:l[t];return r&&r[0]!==a?s+S(a):s},0),L=(null==d?void 0:d.price)||(null==d?void 0:d.discountPrice)||e.price||0;return t.jsx("div",{className:"fixed inset-0 z-[100] bg-black/70 flex items-center justify-center p-4",onClick:n,children:t.jsxs("div",{className:"bg-white w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4 flex-shrink-0",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-stone-400",children:"选择规格材质"}),t.jsx("h3",{className:"text-xl font-serif font-bold text-primary",children:e.name})]}),t.jsx("button",{onClick:n,className:"p-2 rounded-full hover:bg-stone-100",children:t.jsx(p,{className:"h-5 w-5 text-stone-500"})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsxs("div",{className:"grid md:grid-cols-2 gap-6 p-6",children:[t.jsx("div",{className:"relative aspect-square bg-stone-100 rounded-2xl overflow-hidden",children:t.jsx("img",{src:b,alt:e.name,className:"w-full h-full object-cover"})}),t.jsxs("div",{className:"space-y-6",children:[k&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-bold text-stone-700 mb-3",children:"选择规格"}),t.jsxs("div",{className:"space-y-2",children:[c.skus.slice(0,g?void 0:3).map((e,s)=>{const l=(null==d?void 0:d.code)===e.code,r=e.price||e.discountPrice||0,n=e.length&&e.width&&e.height?`${Math.round(e.length/10)}×${Math.round(e.width/10)}×${Math.round(e.height/10)}cm`:"";return t.jsxs("button",{onClick:()=>(e=>{var s;x(e),(null==(s=e.images)?void 0:s[0])&&j(a(e.images[0]))})(e),className:"w-full border-2 rounded-xl p-3 text-left transition "+(l?"border-primary bg-primary/5":"border-stone-200 hover:border-stone-300"),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-stone-800",children:e.spec||`规格${s+1}`}),t.jsxs("span",{className:"text-accent font-bold",children:["¥",r.toLocaleString()]})]}),n&&t.jsxs("p",{className:"text-xs text-stone-500 mt-1",children:["尺寸：",n]})]},e.code||s)}),c.skus.length>3&&t.jsxs("button",{onClick:()=>w(!g),className:"w-full text-xs text-stone-500 py-2 hover:text-primary",children:[g?"收起":`展开更多 (${c.skus.length-3}个)`,t.jsx(h,{className:"inline w-3 h-3 ml-1 transition "+(g?"rotate-90":"")})]})]})]}),!k&&t.jsx("div",{className:"border-2 border-primary rounded-xl p-4 bg-primary/5",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"font-medium text-stone-800",children:e.name}),t.jsxs("span",{className:"text-accent font-bold text-lg",children:["¥",(e.price||0).toLocaleString()]})]})}),C&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"text-sm font-bold text-stone-700",children:"选择材质"}),t.jsx("span",{className:"text-[10px] text-stone-400",children:"点击材质可切换"})]}),Object.entries(e.materials).map(([s,a])=>{const r={},n=[];return(a??[]).forEach((e,s)=>{let t="其他",a=e;if(e.includes("-")){const s=e.split("-");t=s[0],a=s.slice(1).join("-")}else["全青皮","真皮","普通皮","牛皮","半皮"].some(s=>e.includes(s))&&(t=e,a="默认");r[t]||(r[t]=[],n.push(t)),r[t].push({value:e,label:a,idx:s})}),t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-xs font-medium text-stone-500 mb-2",children:N[s]||s}),n.map(a=>t.jsxs("div",{className:"mb-3",children:[t.jsx("p",{className:"text-[10px] text-stone-400 mb-1.5",children:a}),t.jsx("div",{className:"grid grid-cols-4 gap-2",children:r[a].map(({value:a,label:r,idx:n})=>{const i=u[s]===a,o=y(e,a,l),c=n>0?S(a):0;return t.jsxs("button",{onClick:()=>((s,t)=>{f(e=>({...e,[s]:t}));const a=y(e,t,l);j(a)})(s,a),className:"flex flex-col items-center gap-1 relative",children:[c>0&&t.jsxs("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-[9px] px-1 py-0.5 rounded-full z-10",children:["+¥",c]}),t.jsx("span",{className:"w-12 h-12 rounded-lg border-2 overflow-hidden "+(i?"border-primary ring-2 ring-primary/30":"border-stone-200"),children:t.jsx("img",{src:o,alt:r,className:"w-full h-full object-cover",onError:e=>e.target.src="/placeholder.svg"})}),t.jsx("span",{className:"text-[10px] text-center leading-tight "+(i?"text-primary font-medium":"text-stone-600"),children:r.length>4?r.slice(0,4)+"..":r})]},a)})})]},a))]},s)})]}),O>0&&t.jsxs("div",{className:"flex items-center gap-2 text-sm bg-amber-50 text-amber-700 px-3 py-2 rounded-lg",children:[t.jsx(v,{className:"w-4 h-4"}),"材质升级费用：",t.jsxs("span",{className:"font-bold",children:["+¥",O.toLocaleString()]})]})]})]})}),t.jsxs("div",{className:"border-t border-stone-100 p-4 flex items-center justify-between flex-shrink-0 bg-stone-50",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm text-stone-500",children:"合计："}),t.jsxs("span",{className:"text-2xl font-serif font-bold text-accent ml-2",children:["¥",(L+O).toLocaleString()]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:n,className:"px-6 py-2.5 rounded-xl border border-stone-300 text-stone-600 font-medium hover:bg-stone-100",children:"取消"}),t.jsxs("button",{onClick:()=>r(s,e,u,d),className:"px-6 py-2.5 rounded-xl bg-primary text-white font-bold hover:bg-green-900 flex items-center gap-2",children:[t.jsx(m,{className:"w-4 h-4"})," 确认添加"]})]})]})]})})}export{w as default};

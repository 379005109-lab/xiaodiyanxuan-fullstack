import{b as e,j as s,t}from"./index-DWFic46w.js";import{u as a,d as r,r as l,L as i}from"./react-vendor-E1AgTUZ9.js";import{u as n,m as c,a3 as m,a4 as o}from"./ui-vendor-CQy3HONI.js";import{m as d}from"./framer-motion-7DcRqacn.js";import"./recharts-wIacPPq0.js";function x(){const x=a(),{login:p}=e(),[u]=r(),[h,j]=l.useState(""),[f,y]=l.useState(""),[g,b]=l.useState(!1),[N,v]=l.useState(0),[w,S]=l.useState(!1),[k,$]=l.useState("");l.useEffect(()=>{const e=u.get("share_token");e&&($(e),n.info("æ‚¨æ­£åœ¨é€šè¿‡å¥½å‹åˆ†äº«é“¾æ¥æ³¨å†Œï¼ŒæˆåŠŸåå°†è·å¾—å¥–åŠ±ï¼"))},[u]),l.useEffect(()=>{if(N<=0)return;const e=setTimeout(()=>v(N-1),1e3);return()=>clearTimeout(e)},[N]);return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-secondary-50 flex items-center justify-center py-12 px-4",children:s.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-md w-full",children:s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsxs(i,{to:"/",className:"inline-flex items-center space-x-2 mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-primary-600 rounded-lg flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-2xl",children:"å®¶"})}),s.jsx("span",{className:"text-2xl font-bold",children:"å“è´¨å®¶å±…"})]}),s.jsx("h2",{className:"text-2xl font-bold",children:"å¿«é€Ÿæ³¨å†Œ"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"ä»…éœ€æ‰‹æœºå·å³å¯æ³¨å†Œ"})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!h)return void n.error("è¯·è¾“å…¥æ‰‹æœºå·");if(!f)return void n.error("è¯·è¾“å…¥éªŒè¯ç ");const s=localStorage.getItem(`sms_code_${h}`);if(f===s){S(!0);try{const e=`user_${h.slice(-4)}`,s=`${h}@temp.local`,a=Math.random().toString(36).slice(-8),r={username:e,email:s,phone:h,password:a,shareToken:k},{data:l}=await t(r);l&&(p(l.user,l.token),n.success("æ³¨å†ŒæˆåŠŸï¼è¯·é€‰æ‹©æ‚¨çš„èº«ä»½"),x("/role-select"))}catch(a){n.error(a.message||"æ³¨å†Œå¤±è´¥")}finally{S(!1)}}else n.error("éªŒè¯ç é”™è¯¯")},className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"æ‰‹æœºå·"}),s.jsxs("div",{className:"relative",children:[s.jsx(c,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),s.jsx("input",{type:"tel",value:h,onChange:e=>j(e.target.value),placeholder:"è¾“å…¥æ‰‹æœºå·",className:"input pl-10",disabled:g})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"éªŒè¯ç "}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{className:"flex-1 relative",children:s.jsx("input",{type:"text",value:f,onChange:e=>y(e.target.value.slice(0,6)),placeholder:"è¾“å…¥6ä½éªŒè¯ç ",className:"input text-center text-lg tracking-widest",maxLength:6})}),s.jsxs("button",{type:"button",onClick:async e=>{if(e.preventDefault(),!h)return void n.error("è¯·è¾“å…¥æ‰‹æœºå·");if(!/^1[3-9]\d{9}$/.test(h))return void n.error("è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·");const s=Math.random().toString().slice(2,8);localStorage.setItem(`sms_code_${h}`,s),b(!0),v(60),n.success(`éªŒè¯ç å·²å‘é€ (æµ‹è¯•ç : ${s})`)},disabled:N>0||!h,className:"px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-all whitespace-nowrap "+(N>0||!h?"bg-gray-100 text-gray-500 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:[s.jsx(m,{className:"h-4 w-4"}),N>0?`${N}s`:"å‘é€"]})]}),!g&&s.jsx("p",{className:"text-xs text-gray-500 mt-2",children:'ğŸ’¡ ç‚¹å‡»"å‘é€"è·å–éªŒè¯ç '}),g&&s.jsx("p",{className:"text-xs text-green-600 mt-2",children:"âœ“ éªŒè¯ç å·²å‘é€"})]}),s.jsxs("label",{className:"flex items-start space-x-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"w-4 h-4 text-primary-600 rounded mt-1",required:!0}),s.jsxs("span",{className:"text-sm text-gray-600",children:["æˆ‘å·²é˜…è¯»å¹¶åŒæ„",s.jsx(i,{to:"/terms",className:"text-primary-600 hover:text-primary-700 mx-1",children:"æœåŠ¡æ¡æ¬¾"}),"å’Œ",s.jsx(i,{to:"/privacy",className:"text-primary-600 hover:text-primary-700 mx-1",children:"éšç§æ”¿ç­–"})]})]}),s.jsx("button",{type:"submit",disabled:w||!g,className:"btn-primary w-full flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:w?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"ç™»å½•ä¸­..."]}):s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"h-5 w-5"}),"ç™»å½•"]})}),s.jsxs("div",{className:"text-center text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"å·²æœ‰è´¦å·ï¼Ÿ"}),s.jsx(i,{to:"/login",className:"text-primary-600 hover:text-primary-700 ml-1",children:"ç«‹å³ç™»å½•"})]})]})]})})})}export{x as default};

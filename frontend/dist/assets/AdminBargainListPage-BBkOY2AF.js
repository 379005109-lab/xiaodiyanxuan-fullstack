import{b as e,j as s}from"./index-DWFic46w.js";import{u as a,r as t,L as r}from"./react-vendor-E1AgTUZ9.js";import{ar as c,z as i,S as l,ap as n,E as d,u as o}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";const x=()=>{a();const{user:x}=e(),[m,h]=t.useState([]),[g,j]=t.useState(""),[p,u]=t.useState(!1),b=async()=>{u(!0);try{const e=localStorage.getItem("token"),s=await fetch("/api/bargains/products",{headers:{Authorization:`Bearer ${e}`}}),a=await s.json();a.success&&h(a.data||[])}catch(e){o.error("加载失败")}finally{u(!1)}};t.useEffect(()=>{b()},[]);const N=m.filter(e=>e.name.toLowerCase().includes(g.toLowerCase()));return s.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"砍价商品管理"}),s.jsxs("p",{className:"text-gray-600 mt-1",children:["共 ",m.length," 个砍价商品"]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:b,className:"btn btn-secondary",disabled:p,children:s.jsx(c,{size:20,className:p?"animate-spin":""})}),s.jsxs(r,{to:"/admin/bargain/new",className:"btn-primary flex items-center gap-2",children:[s.jsx(i,{size:20}),"新建砍价商品"]})]})]}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:s.jsxs("div",{className:"relative",children:[s.jsx(l,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),s.jsx("input",{type:"text",value:g,onChange:e=>j(e.target.value),placeholder:"搜索砍价商品...",className:"input pl-10 w-full"})]})}),s.jsx("div",{className:"space-y-4",children:p?s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[s.jsx(c,{className:"w-8 h-8 animate-spin mx-auto text-gray-400"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"加载中..."})]}):0===N.length?s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:s.jsx("p",{className:"text-gray-600",children:"暂无砍价商品，点击上方按钮新建"})}):N.map(e=>s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-start gap-6",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("img",{src:e.coverImage||"/placeholder.svg",alt:e.name,className:"w-24 h-24 rounded-lg object-cover bg-gray-100"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900",children:e.name}),s.jsx("span",{className:"px-2 py-0.5 rounded text-xs "+("active"===e.status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),children:"active"===e.status?"上架中":"已下架"})]}),s.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[e.category," · ",e.style]}),s.jsxs("div",{className:"mt-3 grid grid-cols-2 md:grid-cols-5 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"原价"}),s.jsxs("p",{className:"text-lg font-bold text-gray-400 line-through",children:["¥",e.originalPrice]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"目标价"}),s.jsxs("p",{className:"text-lg font-bold text-red-600",children:["¥",e.targetPrice]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"可省"}),s.jsxs("p",{className:"text-lg font-bold text-green-600",children:["¥",e.originalPrice-e.targetPrice]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"发起次数"}),s.jsx("p",{className:"text-lg font-bold text-blue-600",children:e.totalBargains||0})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500",children:"成功次数"}),s.jsx("p",{className:"text-lg font-bold text-purple-600",children:e.successBargains||0})]})]})]}),s.jsxs("div",{className:"flex-shrink-0 flex flex-col gap-2",children:[s.jsx("button",{onClick:()=>(async e=>{const s="active"===e.status?"inactive":"active";try{const a=localStorage.getItem("token"),t=await fetch(`/api/bargains/products/${e._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({status:s})});(await t.json()).success&&(o.success("active"===s?"已上架":"已下架"),b())}catch(a){o.error("操作失败")}})(e),className:"btn btn-sm "+("active"===e.status?"btn-secondary":"btn-primary"),children:"active"===e.status?"下架":"上架"}),s.jsxs(r,{to:`/admin/bargain/edit/${e._id}`,className:"btn btn-secondary btn-sm flex items-center gap-1",children:[s.jsx(n,{size:14}),"编辑"]}),s.jsxs("button",{onClick:()=>(async e=>{if(window.confirm("确定要删除这个砍价商品吗？"))try{const s=localStorage.getItem("token"),a=await fetch(`/api/bargains/products/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),t=await a.json();t.success?(o.success("删除成功"),b()):o.error(t.message||"删除失败")}catch(s){o.error("删除失败")}})(e._id),className:"btn btn-secondary btn-sm text-red-600 hover:bg-red-50 flex items-center gap-1",children:[s.jsx(d,{size:14}),"删除"]})]})]})},e._id))})]})};export{x as default};

import{s as e,j as s,v as t}from"./index-DWFic46w.js";import{r as a}from"./react-vendor-E1AgTUZ9.js";import{S as l,aw as r,ap as i,at as n,a4 as c,u as d}from"./ui-vendor-CQy3HONI.js";import{m as x}from"./framer-motion-7DcRqacn.js";import"./recharts-wIacPPq0.js";const o=async(s,t)=>{const{data:a}=await e.put(`/users/${s}`,t);return a},m={super_admin:{label:"超级管理员",color:"bg-red-100 text-red-700"},admin:{label:"管理员",color:"bg-purple-100 text-purple-700"},designer:{label:"设计师",color:"bg-blue-100 text-blue-700"},distributor:{label:"分销商",color:"bg-green-100 text-green-700"},customer:{label:"普通用户",color:"bg-gray-100 text-gray-700"}};function u(){const[u,h]=a.useState(""),[p,j]=a.useState(""),[g,y]=a.useState([]),[b,N]=a.useState(!0),[f,v]=a.useState(null),[w,C]=a.useState(null),[S,k]=a.useState("customer"),[_,$]=a.useState("active");a.useEffect(()=>{(async()=>{N(!0);try{const s=await(async(s={})=>{const{data:t}=await e.get("/users",{params:s});return t})();(null==s?void 0:s.data)?(y(s.data),v(null)):(v("未能获取用户数据"),y([]))}catch(s){v(`获取用户数据失败: ${s.message}`),y([]),d.error("获取用户列表失败")}finally{N(!1)}})()},[]);const L=a.useMemo(()=>g.filter(e=>{if(!e)return!1;const s=e.username||e.phone||"",t=e.email||"";return!(u&&!s.toLowerCase().includes(u.toLowerCase())&&!t.toLowerCase().includes(u.toLowerCase()))&&(!p||e.role===p)}),[g,u,p]),A=async e=>{const s="active"===e.status?"banned":"active";try{await o(e._id,{status:s}),y(t=>t.map(t=>t._id===e._id?{...t,status:s}:t)),d.success(`已将 ${e.username} 状态调整为 ${"active"===s?"正常":"封禁"}`)}catch(t){d.error((null==t?void 0:t.message)||"状态更新失败")}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"用户管理"}),s.jsxs("p",{className:"text-gray-600 mt-1",children:["共 ",g.length," 个账号",f&&s.jsx("span",{className:"text-amber-600 text-xs ml-2",children:f})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[{label:"普通用户",count:g.filter(e=>"customer"===e.role).length},{label:"设计师",count:g.filter(e=>"designer"===e.role).length},{label:"分销商",count:g.filter(e=>"distributor"===e.role).length},{label:"管理员",count:g.filter(e=>["admin","super_admin"].includes(e.role)).length}].map((e,t)=>s.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card",children:[s.jsx("p",{className:"text-sm text-gray-600 mb-1",children:e.label}),s.jsx("p",{className:"text-3xl font-bold text-primary-600",children:e.count})]},e.label))}),s.jsx("div",{className:"card",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(l,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),s.jsx("input",{type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"搜索用户名或邮箱...",className:"input pl-10"})]}),s.jsxs("select",{value:p,onChange:e=>j(e.target.value),className:"input",children:[s.jsx("option",{value:"",children:"所有角色"}),s.jsx("option",{value:"customer",children:"普通用户"}),s.jsx("option",{value:"designer",children:"设计师"}),s.jsx("option",{value:"distributor",children:"分销商"}),s.jsx("option",{value:"admin",children:"管理员"})]}),s.jsxs("button",{className:"btn-secondary flex items-center justify-center",children:[s.jsx(r,{className:"h-5 w-5 mr-2"}),"高级筛选"]})]})}),s.jsx("div",{className:"card overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[s.jsx("th",{className:"text-left py-4 px-4 text-sm font-medium text-gray-700",children:"用户"}),s.jsx("th",{className:"text-left py-4 px-4 text-sm font-medium text-gray-700",children:"角色"}),s.jsx("th",{className:"text-left py-4 px-4 text-sm font-medium text-gray-700",children:"手机号"}),s.jsx("th",{className:"text-left py-4 px-4 text-sm font-medium text-gray-700",children:"余额"}),s.jsx("th",{className:"text-left py-4 px-4 text-sm font-medium text-gray-700",children:"状态"}),s.jsx("th",{className:"text-left py-4 px-4 text-sm font-medium text-gray-700",children:"注册时间"}),s.jsx("th",{className:"text-right py-4 px-4 text-sm font-medium text-gray-700",children:"操作"})]})}),s.jsxs("tbody",{children:[b&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"py-6 text-center text-gray-500",children:"用户信息加载中..."})}),!b&&L.map((e,a)=>s.jsxs(x.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.02*a},className:"border-b border-gray-100 hover:bg-gray-50",children:[s.jsx("td",{className:"py-4 px-4",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center text-white font-semibold",children:(e.username||e.phone||"U").charAt(0)}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.username||e.phone||"未设置"}),s.jsx("p",{className:"text-xs text-gray-500",children:e.email||"-"})]})]})}),s.jsx("td",{className:"py-4 px-4",children:s.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${(m[e.role]||m.customer).color}`,children:(m[e.role]||m.customer).label})}),s.jsx("td",{className:"py-4 px-4 text-sm",children:e.phone}),s.jsxs("td",{className:"py-4 px-4 text-sm font-medium",children:["¥",(e.balance??0).toFixed(2)]}),s.jsx("td",{className:"py-4 px-4",children:s.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("active"===e.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:"active"===e.status?"正常":"已封禁"})}),s.jsx("td",{className:"py-4 px-4 text-sm text-gray-600",children:t(e.createdAt)}),s.jsx("td",{className:"py-4 px-4",children:s.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[s.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",title:"编辑",onClick:()=>(e=>{C(e),k(e.role),$(e.status)})(e),children:s.jsx(i,{className:"h-4 w-4 text-blue-600"})}),"active"===e.status?s.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",title:"封禁",onClick:()=>A(e),children:s.jsx(n,{className:"h-4 w-4 text-red-600"})}):s.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",title:"解封",onClick:()=>A(e),children:s.jsx(c,{className:"h-4 w-4 text-green-600"})})]})})]},e._id))]})]})})}),w&&s.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",children:"编辑账号"}),s.jsxs("p",{className:"text-sm text-gray-500",children:[w.username," · ",w.email]})]}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:()=>C(null),children:"✕"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"角色"}),s.jsxs("select",{className:"input w-full",value:S,onChange:e=>k(e.target.value),children:[s.jsx("option",{value:"customer",children:"普通用户"}),s.jsx("option",{value:"designer",children:"设计师"}),s.jsx("option",{value:"distributor",children:"分销商"}),s.jsx("option",{value:"admin",children:"管理员"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"状态"}),s.jsxs("select",{className:"input w-full",value:_,onChange:e=>$(e.target.value),children:[s.jsx("option",{value:"active",children:"正常"}),s.jsx("option",{value:"banned",children:"封禁"})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[s.jsx("button",{className:"btn btn-ghost",onClick:()=>C(null),children:"取消"}),s.jsx("button",{className:"btn-primary",onClick:async()=>{if(w)try{await o(w._id,{role:S,status:_}),y(e=>e.map(e=>e._id===w._id?{...e,role:S,status:_}:e)),d.success("账号信息已更新"),C(null)}catch(e){d.error((null==e?void 0:e.message)||"更新失败，稍后再试")}},children:"保存"})]})]})})]})}export{u as default};

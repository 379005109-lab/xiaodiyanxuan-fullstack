import{j as e,d as s,c as t,y as a,D as l,E as r,F as n,G as i,H as c,I as d,J as o,K as x}from"./index-DWFic46w.js";import{r as m}from"./react-vendor-E1AgTUZ9.js";import{X as u,as as h,u as p,z as j,L as g,E as b,au as v,ae as f,aE as N,P as y,T as w,S as C,a8 as _,c as k,d as D,ap as I}from"./ui-vendor-CQy3HONI.js";import{m as S}from"./framer-motion-7DcRqacn.js";import"./recharts-wIacPPq0.js";function E({category:n,onClose:i}){const c=!!n&&n._id,[d,o]=m.useState({name:(null==n?void 0:n.name)||"",image:(null==n?void 0:n.image)||"",parentId:(null==n?void 0:n.parentId)||null,level:(null==n?void 0:n.level)||1,status:(null==n?void 0:n.status)||"active",productCount:(null==n?void 0:n.productCount)||0,hasDiscount:(null==n?void 0:n.hasDiscount)||!1,discounts:(null==n?void 0:n.discounts)||[{role:"designer",roleName:"è®¾è®¡å¸ˆ",discount:100},{role:"distributor",roleName:"ç»é”€å•†",discount:100},{role:"customer",roleName:"æ™®é€šå®¢æˆ·",discount:100}]}),[x,j]=m.useState([]);m.useEffect(()=>{(async()=>{const e=(await t()).filter(e=>!e.parentId||null===e.parentId);j(e)})()},[]);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:c?"ç¼–è¾‘åˆ†ç±»":"æ–°å»ºåˆ†ç±»"}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600",children:e.jsx(u,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!d.name.trim())return void p.error("è¯·è¾“å…¥åˆ†ç±»åç§°");let s=d.name.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\u4e00-\u9fa5-]/g,"");s||(s=`category-${Date.now()}`);const a=await t(),o=a.find(e=>e.slug===s);if(o&&(!c||o._id!==(null==n?void 0:n._id)))return void p.error("åˆ†ç±»åç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°");d.parentId?d.level=2:d.level=1;const x=a.filter(e=>e.parentId===d.parentId),m=x.length>0?Math.max(...x.map(e=>e.order)):0;try{const e={name:d.name,image:d.image,parentId:d.parentId,level:d.level,status:d.status,slug:s};c&&n?(await l(n._id,e),p.success("åˆ†ç±»å·²æ›´æ–°")):(await r({...e,order:m+1,productCount:0,hasDiscount:!1,discounts:[]}),p.success("åˆ†ç±»å·²åˆ›å»º")),i()}catch(u){u.response&&u.response.data&&u.response.data.errors?u.response.data.errors.forEach(e=>{p.error(e.message||"éªŒè¯å¤±è´¥")}):p.error(u.message||"æ“ä½œå¤±è´¥")}},className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["åˆ†ç±»åç§° ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:d.name,onChange:e=>o({...d,name:e.target.value}),placeholder:"è¯·è¾“å…¥åˆ†ç±»åç§°",className:"input w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"åˆ†ç±»å›¾ç‰‡"}),e.jsxs("div",{className:"flex items-start gap-4",children:[d.image&&e.jsxs("div",{className:"relative w-32 h-32 border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("img",{src:s(d.image),alt:"åˆ†ç±»å›¾ç‰‡",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>o({...d,image:""}),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(u,{className:"h-3 w-3"})})]}),e.jsxs("label",{className:"flex-1 flex flex-col items-center justify-center h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-primary-500 transition-colors",children:[e.jsx(h,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡"}),e.jsx("span",{className:"text-xs text-gray-400 mt-1",children:"æ”¯æŒJPGã€PNGï¼Œä¸è¶…è¿‡5MB"}),e.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t)if(t.size>5242880)p.error("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB");else try{p.info("æ­£åœ¨ä¸Šä¼ åˆ°GridFS...");const e=await a(t);e.success&&(o({...d,image:e.data.fileId}),p.success("å›¾ç‰‡ä¸Šä¼ æˆåŠŸ"))}catch(l){p.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥")}},className:"hidden"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"çˆ¶åˆ†ç±»"}),e.jsxs("select",{value:d.parentId||"",onChange:e=>o({...d,parentId:e.target.value||null}),className:"input w-full",children:[e.jsx("option",{value:"",children:"æ— ï¼ˆé¡¶çº§åˆ†ç±»ï¼‰"}),x.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"çŠ¶æ€"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"active",checked:"active"===d.status,onChange:e=>o({...d,status:"active"}),className:"mr-2"}),"å¯ç”¨"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"inactive",checked:"inactive"===d.status,onChange:e=>o({...d,status:"inactive"}),className:"mr-2"}),"ç¦ç”¨"]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:i,className:"btn-secondary px-6 py-2",children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:"btn-primary px-6 py-2",children:c?"ä¿å­˜":"åˆ›å»º"})]})]})]})})}const P=[{value:"designer",label:"è®¾è®¡å¸ˆ"},{value:"distributor",label:"ç»é”€å•†"},{value:"customer",label:"æ™®é€šå®¢æˆ·"},{value:"admin",label:"ç®¡ç†å‘˜"},{value:"super_admin",label:"è¶…çº§ç®¡ç†å‘˜"}];function M({category:s,onClose:a,isBatch:l=!1,onSuccess:r}){const[c,d]=m.useState(!1),[o,x]=m.useState((null==s?void 0:s.discounts)||[{role:"designer",roleName:"è®¾è®¡å¸ˆ",discount:100},{role:"distributor",roleName:"ç»é”€å•†",discount:100},{role:"customer",roleName:"æ™®é€šå®¢æˆ·",discount:100}]);m.useEffect(()=>{if(l){(async()=>{d(!0);try{const e=(await t()).find(e=>e.discounts&&e.discounts.length>0);if(e&&e.discounts.length>0){const s=e.discounts.map(e=>{var s;return{role:e.role,roleName:e.roleName||(null==(s=P.find(s=>s.value===e.role))?void 0:s.label)||e.role,discount:e.discount??e.discountPercent??100}});x(s)}else x([{role:"designer",roleName:"è®¾è®¡å¸ˆ",discount:100},{role:"distributor",roleName:"ç»é”€å•†",discount:100},{role:"customer",roleName:"æ™®é€šå®¢æˆ·",discount:100}])}catch(e){p.error("æ— æ³•åŠ è½½å½“å‰æŠ˜æ‰£è®¾ç½®")}finally{d(!1)}})()}},[l]);const h=(e,s,t)=>{const a=[...o];if("role"===s){const s=P.find(e=>e.value===t);s&&(a[e]={...a[e],role:s.value,roleName:s.label})}else a[e]={...a[e],[s]:Number(t)};x(a)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:l?"è®¾ç½®å…¨éƒ¨åˆ†ç±»æŠ˜æ‰£":`è®¾ç½®æŠ˜æ‰£ - ${null==s?void 0:s.name}`}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:e.jsx(u,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const t=o.map(e=>e.role);if(t.length!==new Set(t).size)return void p.error("ä¸èƒ½ä¸ºåŒä¸€è§’è‰²è®¾ç½®å¤šæ¬¡æŠ˜æ‰£");if(o.some(e=>e.discount<0||e.discount>100))p.error("æŠ˜æ‰£å¿…é¡»åœ¨0-100ä¹‹é—´");else try{l?(await n(o),p.success("å·²ä¸ºæ‰€æœ‰åˆ†ç±»è®¾ç½®æŠ˜æ‰£")):s&&(await i(s._id,o),p.success("æŠ˜æ‰£è®¾ç½®å·²æ›´æ–°")),r&&r(),a()}catch(c){p.error(c.message||"æ“ä½œå¤±è´¥")}},className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ä¸ºä¸åŒè§’è‰²è®¾ç½®æŠ˜æ‰£æ¯”ä¾‹ï¼ˆ100è¡¨ç¤ºåŽŸä»·ï¼Œ70è¡¨ç¤º7æŠ˜ï¼‰"}),e.jsxs("button",{type:"button",onClick:()=>{const e=o.map(e=>e.role),s=P.find(s=>!e.includes(s.value));s?x([...o,{role:s.value,roleName:s.label,discount:100}]):p.error("æ‰€æœ‰è§’è‰²å·²æ·»åŠ ")},className:"btn-secondary flex items-center text-sm px-3 py-1.5",children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),"æ·»åŠ è§’è‰²"]})]}),e.jsx("div",{className:"space-y-3 min-h-[200px]",children:c?e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx(g,{className:"h-8 w-8 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"æ­£åœ¨åŠ è½½å½“å‰è®¾ç½®..."})]}):o.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"è§’è‰²ç±»åž‹"}),e.jsx("select",{value:s.role,onChange:e=>h(t,"role",e.target.value),className:"input w-full",required:!0,children:P.map(s=>e.jsx("option",{value:s.value,disabled:o.some((e,a)=>a!==t&&e.role===s.value),children:s.label},s.value))})]}),e.jsxs("div",{className:"w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"æŠ˜æ‰£ï¼ˆ%ï¼‰"}),e.jsx("input",{type:"number",value:s.discount,onChange:e=>h(t,"discount",parseInt(e.target.value)||0),placeholder:"100",className:"input w-full",min:"0",max:"100",required:!0})]}),e.jsx("div",{className:"flex items-end pb-1",children:e.jsx("button",{type:"button",onClick:()=>(e=>{o.length<=1?p.error("è‡³å°‘ä¿ç•™ä¸€ä¸ªè§’è‰²æŠ˜æ‰£è®¾ç½®"):x(o.filter((s,t)=>t!==e))})(t),className:"p-2 text-red-600 hover:bg-red-50 rounded",disabled:o.length<=1,children:e.jsx(b,{className:"h-4 w-4"})})})]},t))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2 font-medium",children:"ðŸ’¡ æŠ˜æ‰£è¯´æ˜Žï¼š"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ 100% = åŽŸä»·ï¼ˆä¸æ‰“æŠ˜ï¼‰"}),e.jsx("li",{children:"â€¢ 90% = 9æŠ˜"}),e.jsx("li",{children:"â€¢ 80% = 8æŠ˜"}),e.jsx("li",{children:"â€¢ 70% = 7æŠ˜"}),e.jsx("li",{children:"â€¢ 50% = 5æŠ˜ï¼ˆåŠä»·ï¼‰"}),e.jsx("li",{children:"â€¢ ä¸åŒè§’è‰²å¯ä»¥è®¾ç½®ä¸åŒçš„æŠ˜æ‰£æ¯”ä¾‹"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:a,className:"btn-secondary px-6 py-2",children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:"btn-primary px-6 py-2",children:"ä¿å­˜è®¾ç½®"})]})]})]})})}function z({categories:s,onClose:t}){if(!Array.isArray(s))return null;const a=(()=>{const e=new Map;return s.forEach(s=>{s.discounts.forEach(t=>{e.has(t.role)||e.set(t.role,{roleName:t.roleName,categories:[],avgDiscount:0,minDiscount:100,maxDiscount:0});e.get(t.role).categories.push({name:s.name,discount:t.discount,level:s.level})})}),e.forEach((e,s)=>{const t=e.categories.map(e=>e.discount);e.avgDiscount=Math.round(t.reduce((e,s)=>e+s,0)/t.length),e.minDiscount=Math.min(...t),e.maxDiscount=Math.max(...t)}),e})(),l=s.filter(e=>e.hasDiscount);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"æ€»æŠ˜æ‰£ä¿¡æ¯"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(u,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 mb-1",children:"æ€»åˆ†ç±»æ•°"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:s.length})]}),e.jsx(v,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-orange-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600 mb-1",children:"æœ‰æŠ˜æ‰£åˆ†ç±»"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:l.length})]}),e.jsx(f,{className:"h-8 w-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 mb-1",children:"è§’è‰²ç±»åž‹æ•°"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:a.size})]}),e.jsx(v,{className:"h-8 w-8 text-green-600"})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"å„è§’è‰²æŠ˜æ‰£ç»Ÿè®¡"}),e.jsx("div",{className:"space-y-4",children:Array.from(a.entries()).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:t.roleName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["åº”ç”¨äºŽ ",t.categories.length," ä¸ªåˆ†ç±»"]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"å¹³å‡æŠ˜æ‰£ï¼š"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[t.avgDiscount,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"æœ€ä½Žï¼š"}),e.jsxs("span",{className:"font-semibold text-orange-600",children:[t.minDiscount,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"æœ€é«˜ï¼š"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[t.maxDiscount,"%"]})]})]})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:t.categories.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded mr-2 "+(1===s.level?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"),children:1===s.level?"ä¸€çº§":"äºŒçº§"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]}),e.jsxs("span",{className:"text-sm font-bold "+(s.discount<100?"text-orange-600":"text-gray-500"),children:[s.discount,"%"]})]},t))})})]},s))})]}),l.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["æœ‰æŠ˜æ‰£çš„åˆ†ç±»æ˜Žç»†",e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["ï¼ˆå…± ",l.length," ä¸ªï¼‰"]})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-700",children:"åˆ†ç±»åç§°"}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-medium text-gray-700",children:"å±‚çº§"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-700",children:"æŠ˜æ‰£è¯¦æƒ…"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:l.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"font-medium",children:s.name})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"text-xs px-2 py-1 rounded "+(1===s.level?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"),children:1===s.level?"ä¸€çº§":"äºŒçº§"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.discounts.filter(e=>e.discount<100).map((s,t)=>e.jsxs("span",{className:"text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded",children:[s.roleName,": ",s.discount,"%"]},t))})})]},s._id))})]})})]})]}),e.jsx("div",{className:"border-t p-4 flex justify-end",children:e.jsx("button",{onClick:t,className:"btn-primary px-6 py-2",children:"å…³é—­"})})]})})}function $(){const[a,r]=m.useState([]),[n,i]=m.useState([]),[u,h]=m.useState(""),[g,P]=m.useState(""),[$,L]=m.useState(""),[A,B]=m.useState(null),[T,G]=m.useState(null),[q,F]=m.useState(!1),[J,K]=m.useState(!1),[H,O]=m.useState(!1),[R,Y]=m.useState(!1),[Q,U]=m.useState(null),[V,W]=m.useState({total:0,active:0,withDiscount:0,totalProducts:0});m.useEffect(()=>{X(),Z()},[]);const X=async()=>{const e=await c();r(e),e.length>0&&i([e[0]._id])},Z=async()=>{const e=await d();W(e)},ee=()=>{F(!1),K(!1),O(!1),U(null),X(),Z()},se=()=>{G(null)},te=()=>{B(null),G(null)},ae=(e,s)=>s.parentId===e||!!s.children&&s.children.some(s=>ae(e,s)),le=(a,r=0)=>{const c=n.includes(a._id),d=a.children&&a.children.length>0,m=30*r;return e.jsxs("div",{children:[e.jsx("div",{className:`border-b border-gray-200 hover:bg-gray-50 transition-all ${T&&T.id===a._id?"before"===T.type?"border-t-2 border-t-blue-500":"after"===T.type?"border-b-2 border-b-blue-500":"inside"===T.type?"bg-blue-50 ring-2 ring-blue-400 ring-inset":"":""} ${(null==A?void 0:A._id)===a._id?"opacity-50":""}`,style:{paddingLeft:`${m}px`},draggable:!0,onDragStart:e=>((e,s)=>{B(s),e.dataTransfer.effectAllowed="move"})(e,a),onDragOver:e=>((e,s)=>{if(e.preventDefault(),e.dataTransfer.dropEffect="move",!A||A._id===s._id)return;if(ae(A._id,s))return;const t=e.currentTarget.getBoundingClientRect(),a=e.clientY-t.top,l=t.height;let r="inside";a<.25*l?r="before":a>.75*l&&(r="after"),G({id:s._id,type:r})})(e,a),onDragLeave:se,onDragEnd:te,onDrop:e=>(async(e,s)=>{if(e.preventDefault(),!A||A._id===s._id||!T)return B(null),void G(null);if(ae(A._id,s))return p.error("ä¸èƒ½å°†åˆ†ç±»æ‹–åˆ°è‡ªå·±çš„å­åˆ†ç±»ä¸‹"),B(null),void G(null);try{if("inside"===T.type)await l(A._id,{parentId:s._id,level:(s.level||1)+1,order:999}),p.success(`ã€Œ${A.name}ã€å·²ç§»åŠ¨åˆ°ã€Œ${s.name}ã€ä¸‹`);else{let e=(await t()).filter(e=>e.parentId===s.parentId).sort((e,s)=>(e.order||0)-(s.order||0));e.findIndex(e=>e._id===A._id);const a=e.findIndex(e=>e._id===s._id);A.parentId!==s.parentId&&(await l(A._id,{parentId:s.parentId||null,level:s.level||1}),e=(await t()).filter(e=>e.parentId===s.parentId).sort((e,s)=>(e.order||0)-(s.order||0)));const r="before"===T.type?a:a+1;for(let s=0;s<e.length;s++){const t=e[s];if(t._id===A._id)continue;let a=s<r?s:s+1;t._id===A._id&&(a=r),await l(t._id,{order:a})}await l(A._id,{order:r}),p.success("é¡ºåºå·²è°ƒæ•´")}setTimeout(()=>{X(),Z()},200)}catch(a){p.error("æ“ä½œå¤±è´¥")}finally{B(null),G(null)}})(e,a),children:e.jsxs("div",{className:"flex items-center py-4 px-4",children:[e.jsx("div",{className:"w-8",children:d&&e.jsx("button",{onClick:()=>{return e=a._id,void i(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},className:"text-gray-500 hover:text-gray-700",children:c?e.jsx(k,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center",children:[a.image&&e.jsx("img",{src:s(a.image),alt:a.name,className:"w-10 h-10 rounded object-cover mr-3",onError:e=>{e.target.style.display="none"}}),e.jsx("span",{className:"font-medium text-gray-900 cursor-move select-none",children:a.name}),(null==T?void 0:T.id)===a._id&&"inside"===T.type&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 bg-blue-100 px-2 py-0.5 rounded",children:"æ”¾å…¥æ­¤åˆ†ç±»ä¸‹"}),a.hasDiscount&&a.discounts&&a.discounts.length>0&&(()=>{const s=Math.min(...a.discounts.map(e=>e.discount));if(s<60){const t=Math.floor(s/10);return e.jsxs("span",{className:"ml-2 px-2 py-0.5 text-xs bg-red-100 text-red-600 rounded font-semibold",children:[t,"æŠ˜"]})}return null})()]})}),e.jsx("div",{className:"w-20 text-center text-sm text-gray-600",children:a.level}),e.jsx("div",{className:"w-20 text-center text-sm text-gray-600",children:a.productCount}),e.jsx("div",{className:"w-32 flex justify-center",children:e.jsx("button",{onClick:e=>(async(e,s)=>{s.stopPropagation(),await o(e)?(p.success("çŠ¶æ€å·²æ›´æ–°"),X(),Z()):p.error("æ›´æ–°å¤±è´¥")})(a._id,e),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+("active"===a.status?"bg-green-500":"bg-gray-300"),children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+("active"===a.status?"translate-x-6":"translate-x-1")})})}),e.jsx("div",{className:"w-40 text-sm text-gray-600",children:new Date(a.createdAt).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"flex-1 text-sm text-gray-600 px-4",children:a.discounts&&a.discounts.length>0?a.discounts.map((s,t)=>e.jsxs("span",{className:"mr-4",children:[s.roleName,":",s.discount,"%"]},t)):e.jsx("span",{className:"text-gray-400",children:"æœªè®¾ç½®"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:e=>((e,s)=>{s.stopPropagation(),U(e),F(!0)})(a,e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded",title:"ç¼–è¾‘",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("button",{onClick:e=>((e,s)=>{s.stopPropagation(),U(e),K(!0)})(a,e),className:"p-2 text-orange-600 hover:bg-orange-50 rounded",title:"æŠ˜æ‰£",children:e.jsx(f,{className:"h-4 w-4"})}),e.jsx("button",{onClick:e=>((e,s)=>{s.stopPropagation(),U({...e,_id:"",name:"",parentId:e._id,level:2}),F(!0)})(a,e),className:"p-2 text-green-600 hover:bg-green-50 rounded transition-colors",title:"æ·»åŠ å­åˆ†ç±»",children:e.jsx(j,{className:"h-5 w-5"})}),e.jsx("button",{onClick:e=>(async(e,s)=>{if(s.stopPropagation(),confirm(`ç¡®å®šè¦åˆ é™¤åˆ†ç±»"${e.name}"å—ï¼Ÿ`))try{await x(e._id)&&(p.success("åˆ†ç±»å·²åˆ é™¤"),X(),Z())}catch(t){p.error(t.message||"åˆ é™¤å¤±è´¥")}})(a,e),className:"p-2 text-red-600 hover:bg-red-50 rounded",title:"åˆ é™¤",children:e.jsx(b,{className:"h-4 w-4"})})]})]})}),d&&c&&a.children&&e.jsx("div",{children:a.children.map(e=>le(e,r+1))})]},a._id)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-3xl font-bold",children:"åˆ†ç±»ç®¡ç†"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-purple-50 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 mb-1",children:"åˆ†ç±»æ€»æ•°"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:V.total})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(N,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-green-50 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 mb-1",children:"å•†å“æ€»æ•°"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:V.totalProducts})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-orange-50 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600 mb-1",children:"æŠ˜æ‰£åˆ†ç±»æ•°"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:V.withDiscount})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(v,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-blue-50 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 mb-1",children:"æ´»è·ƒåˆ†ç±»"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:V.active})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(w,{className:"h-6 w-6 text-blue-600"})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(C,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:u,onChange:e=>h(e.target.value),onKeyPress:e=>"Enter"===e.key&&(async()=>{if(u.trim()){const e=(await t()).filter(e=>e.name.toLowerCase().includes(u.toLowerCase()));r(e.map(e=>({...e,children:[]})))}else X()})(),placeholder:"æœç´¢åˆ†ç±»åç§°...",className:"input pl-10 w-full"})]}),e.jsxs("select",{value:g,onChange:e=>P(e.target.value),className:"input w-40",children:[e.jsx("option",{value:"",children:"å…¨éƒ¨çŠ¶æ€"}),e.jsx("option",{value:"active",children:"å¯ç”¨"}),e.jsx("option",{value:"inactive",children:"ç¦ç”¨"})]}),e.jsxs("select",{value:$,onChange:e=>L(e.target.value),className:"input w-40",children:[e.jsx("option",{value:"",children:"å…¨éƒ¨åˆ†ç±»"}),e.jsx("option",{value:"1",children:"é¡¶çº§åˆ†ç±»"}),e.jsx("option",{value:"2",children:"äºŒçº§åˆ†ç±»"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>O(!0),className:"btn-secondary flex items-center text-sm px-4 py-2",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"è®¾ç½®å…¨éƒ¨åˆ†ç±»æŠ˜æ‰£"]}),e.jsxs("button",{onClick:()=>Y(!0),className:"btn-secondary flex items-center text-sm px-4 py-2",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"æ€»æŠ˜æ‰£ä¿¡æ¯"]}),e.jsxs("button",{onClick:()=>{U(null),F(!0)},className:"btn-primary flex items-center text-sm px-4 py-2",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"æ–°å»ºåˆ†ç±»"]})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center py-3 px-4",children:[e.jsx("div",{className:"w-8"}),e.jsx("div",{className:"flex-1 text-sm font-medium text-gray-700",children:"åˆ†ç±»"}),e.jsx("div",{className:"w-20 text-center text-sm font-medium text-gray-700",children:"å±‚çº§"}),e.jsx("div",{className:"w-20 text-center text-sm font-medium text-gray-700",children:"å•†å“æ•°é‡"}),e.jsx("div",{className:"w-32 text-center text-sm font-medium text-gray-700",children:"çŠ¶æ€"}),e.jsx("div",{className:"w-40 text-sm font-medium text-gray-700",children:"åˆ›å»ºæ—¶é—´"}),e.jsx("div",{className:"flex-1 text-sm font-medium text-gray-700 px-4",children:"è§’è‰²æŠ˜æ‰£"}),e.jsx("div",{className:"w-40 text-center text-sm font-medium text-gray-700",children:"æ“ä½œ"})]})}),e.jsx("div",{children:a.map(e=>le(e))}),e.jsxs("div",{className:"border-t border-gray-200 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["æ˜¾ç¤º 1 åˆ° ",V.total,"ï¼Œå…± ",V.total," æ¡è®°å½•"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"ä¸Šä¸€é¡µ"}),e.jsx("button",{className:"px-4 py-2 bg-primary-600 text-white rounded",children:"1"}),e.jsx("button",{className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50",children:"ä¸‹ä¸€é¡µ"})]})]})]}),q&&e.jsx(E,{category:Q,onClose:ee}),J&&Q&&e.jsx(M,{category:Q,onClose:ee,onSuccess:ee}),H&&e.jsx(M,{category:null,onClose:ee,isBatch:!0,onSuccess:ee}),R&&e.jsx(z,{categories:a,onClose:()=>Y(!1)})]})}export{$ as default};

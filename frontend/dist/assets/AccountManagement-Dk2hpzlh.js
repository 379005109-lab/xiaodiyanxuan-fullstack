import{s as e,j as s,d as a}from"./index-DWFic46w.js";import{r as t}from"./react-vendor-E1AgTUZ9.js";import{X as l,an as r,K as n,ar as i,b as c,u as d,al as x,ax as o,Z as m,Y as u,ay as h,az as g,T as p,aA as j,aB as v,z as y,ap as N,E as b,S as f,aC as w,ab as C}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";const k="designer",S="customer",_={super_admin:"超级管理员",admin:"管理员",platform_admin:"平台管理员",platform_staff:"平台子账号",enterprise_admin:"企业管理员",enterprise_staff:"企业子账号",designer:"设计师",special_guest:"特殊账号",customer:"普通客户",user:"普通用户"},z={platform:"供应链平台",enterprise:"企业"},D=async(s,a={})=>{const{startDate:t,endDate:l,limit:r=100}=a,n=new URLSearchParams;t&&n.append("startDate",t),l&&n.append("endDate",l),n.append("limit",String(r));return(await e.get(`/browse-history/user/${s}/path?${n.toString()}`)).data.data},U=async s=>(await e.get(`/browse-history/user/${s}/stats`)).data.data;function A({userId:e,userName:d,onClose:x}){var o,m;const[u,h]=t.useState("path"),[g,p]=t.useState([]),[j,v]=t.useState(null),[y,N]=t.useState(!0),[b,f]=t.useState({start:"",end:""});t.useEffect(()=>{w()},[e,b]);const w=async()=>{N(!0);try{const[s,a]=await Promise.all([D(e,{startDate:b.start||void 0,endDate:b.end||void 0,limit:200}),U(e)]);p(s),v(a)}catch(s){}finally{N(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-bold",children:"用户浏览路径"}),s.jsx("p",{className:"text-sm text-gray-500",children:d})]}),s.jsx("button",{onClick:x,className:"text-gray-400 hover:text-gray-600",children:s.jsx(l,{className:"h-6 w-6"})})]}),s.jsx("div",{className:"p-4 border-b bg-gray-50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>h("path"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+("path"===u?"bg-primary text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:[s.jsx(r,{className:"w-4 h-4 inline mr-1"}),"浏览路径"]}),s.jsxs("button",{onClick:()=>h("stats"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+("stats"===u?"bg-primary text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:[s.jsx(n,{className:"w-4 h-4 inline mr-1"}),"浏览统计"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"date",value:b.start,onChange:e=>f({...b,start:e.target.value}),className:"input text-sm px-2 py-1"}),s.jsx("span",{className:"text-gray-400",children:"至"}),s.jsx("input",{type:"date",value:b.end,onChange:e=>f({...b,end:e.target.value}),className:"input text-sm px-2 py-1"}),s.jsx("button",{onClick:w,className:"p-2 text-gray-500 hover:text-primary hover:bg-gray-100 rounded",children:s.jsx(i,{className:"w-4 h-4"})})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:y?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):"path"===u?s.jsx("div",{className:"space-y-2",children:0===g.length?s.jsx("div",{className:"text-center py-12 text-gray-500",children:"暂无浏览记录"}):g.map((e,t)=>{return s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-sm font-medium",children:e.step}),t<g.length-1&&s.jsx("div",{className:"w-0.5 h-8 bg-gray-200 my-1"})]}),s.jsxs("div",{className:"flex-1 flex items-center gap-3 bg-gray-50 rounded-lg p-3",children:[e.productImage&&s.jsx("img",{src:a(e.productImage),alt:e.productName,className:"w-12 h-12 rounded object-cover",onError:e=>{e.target.style.display="none"}}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-gray-900 truncate",children:e.productName}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.productCode&&s.jsx("span",{className:"bg-gray-200 px-1.5 py-0.5 rounded",children:e.productCode}),e.categoryName&&s.jsx("span",{children:e.categoryName}),s.jsx("span",{className:"text-blue-500",children:(r=e.source,{web:"网页端",miniapp:"小程序",admin:"管理后台",share:"分享链接"}[r]||r)})]})]}),s.jsxs("div",{className:"text-right text-sm",children:[s.jsx("div",{className:"text-gray-600",children:(l=e.viewedAt,new Date(l).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))}),e.intervalMinutes>0&&s.jsxs("div",{className:"text-xs text-gray-400 flex items-center justify-end gap-1",children:[s.jsx(c,{className:"w-3 h-3"}),e.intervalMinutes<60?`${e.intervalMinutes}分钟后`:`${Math.round(e.intervalMinutes/60)}小时后`]})]})]})]},t);var l,r})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[s.jsx("div",{className:"text-sm text-blue-600 mb-1",children:"总浏览次数"}),s.jsx("div",{className:"text-3xl font-bold text-blue-900",children:(null==j?void 0:j.totalViews)||0})]}),s.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[s.jsx("div",{className:"text-sm text-green-600 mb-1",children:"今日浏览"}),s.jsx("div",{className:"text-3xl font-bold text-green-900",children:(null==j?void 0:j.todayViews)||0})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"常看分类 TOP5"}),s.jsxs("div",{className:"space-y-2",children:[null==(o=null==j?void 0:j.topCategories)?void 0:o.map((e,a)=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-6 h-6 rounded bg-orange-100 text-orange-600 flex items-center justify-center text-xs font-medium",children:a+1}),s.jsx("div",{className:"flex-1 text-gray-700",children:e._id||"未分类"}),s.jsxs("div",{className:"text-sm text-gray-500",children:[e.count,"次"]})]},a)),(!(null==j?void 0:j.topCategories)||0===j.topCategories.length)&&s.jsx("div",{className:"text-gray-400 text-sm",children:"暂无数据"})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"最近浏览商品"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[null==(m=null==j?void 0:j.recentProducts)?void 0:m.map(e=>s.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-3",children:[e.productImage&&s.jsx("img",{src:a(e.productImage),alt:e.productName,className:"w-10 h-10 rounded object-cover"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:e.productName}),s.jsxs("div",{className:"text-xs text-gray-500",children:["浏览",e.viewCount,"次"]})]})]},e._id)),(!(null==j?void 0:j.recentProducts)||0===j.recentProducts.length)&&s.jsx("div",{className:"text-gray-400 text-sm col-span-2",children:"暂无数据"})]})]})]})}),s.jsxs("div",{className:"p-4 border-t bg-gray-50 text-center text-sm text-gray-500",children:["共 ",g.length," 条浏览记录"]})]})})}function P(){const[a,l]=t.useState("dashboard"),[r,n]=t.useState(!1),[i,c]=t.useState(null),[D,U]=t.useState([]),[P,L]=t.useState(""),[T,M]=t.useState([]),[H,q]=t.useState(""),[F,K]=t.useState(""),[V,X]=t.useState([]),[B,O]=t.useState(!1),[R,Y]=t.useState(!1),[Z,G]=t.useState(!1),[J,Q]=t.useState(null),[W,ee]=t.useState(null),[se,ae]=t.useState(!1),[te,le]=t.useState(null);t.useEffect(()=>{"dashboard"===a?re():"organizations"===a?ne():"users"===a||"designers"===a||"customers"===a?ie():"special"===a&&ce()},[a,P,H]);const re=async()=>{n(!0);try{const s=await(async()=>(await e.get("/accounts/dashboard")).data.data)();c(s)}catch(s){d.error(s.message||"加载看板数据失败")}finally{n(!1)}},ne=async()=>{n(!0);try{const s=await(async s=>(await e.get("/accounts/organizations",{params:s})).data.data)({type:P||void 0});U(s.list||[])}catch(s){d.error(s.message||"加载组织列表失败")}finally{n(!1)}},ie=async()=>{n(!0);try{let s;s="designers"===a?k:"customers"===a?S:H||void 0;const t=await(async s=>(await e.get("/accounts/users",{params:s})).data.data)({role:s,keyword:F||void 0});M(t.list||[])}catch(s){d.error(s.message||"加载用户列表失败")}finally{n(!1)}},ce=async()=>{n(!0);try{const s=await(async s=>(await e.get("/accounts/special-accounts",{params:s})).data.data)();X(s.list||[])}catch(s){d.error(s.message||"加载特殊账号失败")}finally{n(!1)}},de=async s=>{if(confirm(`确定要删除组织"${s.name}"吗？`))try{await(async s=>(await e.delete(`/accounts/organizations/${s}`)).data)(s._id),d.success("删除成功"),ne()}catch(a){d.error(a.message||"删除失败")}},xe=async s=>{if(confirm(`确定要删除用户"${s.nickname||s.username}"吗？`))try{await(async s=>(await e.delete(`/accounts/users/${s}`)).data)(s._id),d.success("删除成功"),ie()}catch(a){d.error(a.message||"删除失败")}},oe=[{id:"dashboard",label:"用户看板",icon:x},{id:"organizations",label:"平台/企业",icon:o},{id:"users",label:"管理账号",icon:m},{id:"customers",label:"普通用户",icon:u},{id:"designers",label:"设计师",icon:h},{id:"special",label:"特殊账号",icon:g}];return s.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"账号管理"}),s.jsx("p",{className:"text-gray-500 mt-1",children:"管理平台、企业、设计师和特殊账号"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm mb-6",children:[s.jsx("div",{className:"flex border-b",children:oe.map(e=>s.jsxs("button",{onClick:()=>l(e.id),className:"flex items-center gap-2 px-6 py-4 font-medium transition-colors "+(a===e.id?"text-primary-600 border-b-2 border-primary-600":"text-gray-500 hover:text-gray-700"),children:[s.jsx(e.icon,{className:"w-5 h-5"}),e.label]},e.id))}),"dashboard"===a&&s.jsx("div",{className:"p-6",children:r?s.jsx("div",{className:"text-center py-12 text-gray-500",children:"加载中..."}):i?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mb-2",children:[s.jsx(u,{className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:"总用户数"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-700",children:i.overview.totalUsers})]}),s.jsxs("div",{className:"bg-green-50 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-green-600 mb-2",children:[s.jsx(p,{className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:"今日新增"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-700",children:i.overview.todayNewUsers})]}),s.jsxs("div",{className:"bg-purple-50 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-purple-600 mb-2",children:[s.jsx(p,{className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:"本月新增"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-700",children:i.overview.monthNewUsers})]}),s.jsxs("div",{className:"bg-cyan-50 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-cyan-600 mb-2",children:[s.jsx(j,{className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:"7日活跃"})]}),s.jsx("div",{className:"text-2xl font-bold text-cyan-700",children:i.overview.activeUsers})]}),s.jsxs("div",{className:"bg-orange-50 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-orange-600 mb-2",children:[s.jsx(v,{className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:"被标记用户"})]}),s.jsx("div",{className:"text-2xl font-bold text-orange-700",children:i.overview.taggedUsers})]}),s.jsxs("div",{className:"bg-red-50 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[s.jsx(v,{className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:"批量下载"})]}),s.jsx("div",{className:"text-2xl font-bold text-red-700",children:i.overview.bulkDownloadUsers})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl border p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"角色分布"}),s.jsx("div",{className:"space-y-3",children:i.roleStats.map(e=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600",children:_[e._id]||e._id||"未设置"}),s.jsx("span",{className:"font-medium",children:e.count})]},e._id))})]}),s.jsxs("div",{className:"bg-white rounded-xl border p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"被标记用户"}),s.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:0===i.recentTaggedUsers.length?s.jsx("p",{className:"text-gray-400 text-sm",children:"暂无被标记用户"}):i.recentTaggedUsers.map(e=>{var a;return s.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-0",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-sm",children:e.nickname||e.username}),s.jsx("div",{className:"text-xs text-gray-500",children:e.phone})]}),s.jsx("div",{className:"flex gap-1",children:null==(a=e.tags)?void 0:a.map((e,a)=>s.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full "+("批量下载"===e?"bg-red-100 text-red-700":"bg-orange-100 text-orange-700"),children:e},a))})]},e._id)})})]})]}),s.jsxs("div",{className:"bg-white rounded-xl border p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"最近注册用户"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-600",children:"用户"}),s.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-600",children:"角色"}),s.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-600",children:"状态"}),s.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-600",children:"注册时间"})]})}),s.jsx("tbody",{className:"divide-y",children:i.recentUsers.map(e=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsxs("td",{className:"px-4 py-2",children:[s.jsx("div",{className:"font-medium text-sm",children:e.nickname||e.username}),s.jsx("div",{className:"text-xs text-gray-500",children:e.phone})]}),s.jsx("td",{className:"px-4 py-2",children:s.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-gray-100 text-gray-700",children:_[e.role]||e.role})}),s.jsx("td",{className:"px-4 py-2",children:s.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full "+("active"===e.status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"),children:"active"===e.status?"正常":e.status})}),s.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()})]},e._id))})]})})]})]}):s.jsx("div",{className:"text-center py-12 text-gray-500",children:"暂无数据"})}),"organizations"===a&&s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("select",{value:P,onChange:e=>L(e.target.value),className:"px-4 py-2 border rounded-lg",children:[s.jsx("option",{value:"",children:"全部类型"}),s.jsx("option",{value:"platform",children:"供应链平台"}),s.jsx("option",{value:"enterprise",children:"企业"})]})}),s.jsxs("button",{onClick:()=>{Q(null),O(!0)},className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[s.jsx(y,{className:"w-4 h-4"}),"新建组织"]})]}),s.jsx("div",{className:"space-y-4",children:r?s.jsx("div",{className:"text-center py-12 text-gray-500",children:"加载中..."}):0===D.length?s.jsx("div",{className:"text-center py-12 text-gray-500",children:"暂无数据"}):D.map(e=>{var a,t;return s.jsx("div",{className:"bg-gray-50 rounded-xl p-4 hover:bg-gray-100 transition-colors",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center",children:s.jsx(o,{className:"w-6 h-6 text-primary-600"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:e.name}),s.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-700",children:z[e.type]}),s.jsx("span",{className:"text-xs text-gray-400",children:e.code})]}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["联系人: ",e.contactPerson||"-"," | 用户数: ",(null==(a=e.quota)?void 0:a.usedUsers)||0,"/",(null==(t=e.quota)?void 0:t.maxUsers)||50]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{Q(e),O(!0)},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-white rounded-lg",children:s.jsx(N,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>de(e),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-white rounded-lg",children:s.jsx(b,{className:"w-4 h-4"})})]})]})},e._id)})})]}),("users"===a||"customers"===a||"designers"===a)&&s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-4",children:["users"===a&&s.jsxs("select",{value:H,onChange:e=>q(e.target.value),className:"px-4 py-2 border rounded-lg",children:[s.jsx("option",{value:"",children:"全部角色"}),s.jsx("option",{value:"admin",children:"管理员"}),s.jsx("option",{value:"super_admin",children:"超级管理员"}),s.jsx("option",{value:"platform_admin",children:"平台管理员"}),s.jsx("option",{value:"platform_staff",children:"平台子账号"}),s.jsx("option",{value:"enterprise_admin",children:"企业管理员"}),s.jsx("option",{value:"enterprise_staff",children:"企业子账号"})]}),s.jsxs("div",{className:"relative",children:[s.jsx(f,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"搜索用户...",value:F,onChange:e=>K(e.target.value),onKeyDown:e=>"Enter"===e.key&&ie(),className:"pl-10 pr-4 py-2 border rounded-lg w-64"})]})]}),"customers"!==a&&s.jsxs("button",{onClick:()=>{ee(null),Y(!0)},className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[s.jsx(y,{className:"w-4 h-4"}),"designers"===a?"添加设计师":"新建账号"]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"用户"}),s.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"角色"}),s.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"标签"}),s.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"组织"}),s.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"状态"}),s.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"创建时间"}),s.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-600",children:"操作"})]})}),s.jsx("tbody",{className:"divide-y",children:r?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"text-center py-12 text-gray-500",children:"加载中..."})}):0===T.length?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"text-center py-12 text-gray-500",children:"暂无数据"})}):T.map(e=>{var a,t,l;return s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.avatar?s.jsx("img",{src:e.avatar,alt:"",className:"w-10 h-10 rounded-full"}):s.jsx("span",{className:"text-gray-500 font-medium",children:null==(t=null==(a=e.nickname||e.username)?void 0:a[0])?void 0:t.toUpperCase()})}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900",children:e.nickname||e.username}),s.jsx("div",{className:"text-sm text-gray-500",children:e.phone||e.email||"-"})]})]})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-700",children:_[e.role]||e.role})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("div",{className:"flex flex-wrap gap-1",children:e.tags&&e.tags.length>0?e.tags.map((a,t)=>{var l;return s.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full "+("批量下载"===a?"bg-red-100 text-red-700":"高风险"===a?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"),title:(null==(l=e.downloadStats)?void 0:l.totalDownloads)?`总下载: ${e.downloadStats.totalDownloads}次`:void 0,children:a},t)}):s.jsx("span",{className:"text-gray-400 text-xs",children:"-"})})}),s.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:(null==(l=e.organizationId)?void 0:l.name)||"-"}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("active"===e.status?"bg-green-100 text-green-700":"banned"===e.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:"active"===e.status?"正常":"banned"===e.status?"已禁用":"expired"===e.status?"已过期":"未激活"})}),s.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),s.jsx("td",{className:"px-4 py-3 text-right",children:s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx("button",{onClick:()=>{le({id:e._id,name:e.nickname||e.username||e.phone||"未知用户"}),ae(!0)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-gray-100 rounded-lg",title:"查看浏览路径",children:s.jsx(w,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>{ee(e),Y(!0)},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:s.jsx(N,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>xe(e),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-gray-100 rounded-lg",children:s.jsx(b,{className:"w-4 h-4"})})]})})]},e._id)})})]})})]}),"special"===a&&s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("p",{className:"text-gray-500",children:"特殊账号用于临时让客户查看成本价，有效期和使用次数可配置"}),s.jsxs("button",{onClick:()=>G(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[s.jsx(y,{className:"w-4 h-4"}),"生成访问码"]})]}),s.jsx("div",{className:"space-y-4",children:r?s.jsx("div",{className:"text-center py-12 text-gray-500",children:"加载中..."}):0===V.length?s.jsx("div",{className:"text-center py-12 text-gray-500",children:"暂无特殊账号"}):V.map(a=>{var t,l,r,n,i;return s.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center",children:s.jsx(g,{className:"w-6 h-6 text-amber-600"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-mono text-lg font-bold text-gray-900",children:null==(t=a.specialAccountConfig)?void 0:t.accessCode}),s.jsx("button",{onClick:()=>{var e,s;return s=(null==(e=a.specialAccountConfig)?void 0:e.accessCode)||"",navigator.clipboard.writeText(s),void d.success("访问码已复制")},className:"p-1 text-gray-400 hover:text-gray-600",children:s.jsx(C,{className:"w-4 h-4"})}),s.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full "+("active"===a.status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"),children:"active"===a.status?"有效":"已失效"})]}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["使用次数: ",(null==(l=a.specialAccountConfig)?void 0:l.usedCount)||0,"/",(null==(r=a.specialAccountConfig)?void 0:r.maxUsage)||"∞"," | 过期时间: ",(null==(n=a.specialAccountConfig)?void 0:n.expiresAt)?new Date(a.specialAccountConfig.expiresAt).toLocaleString():"永不过期",(null==(i=a.specialAccountConfig)?void 0:i.note)&&` | 备注: ${a.specialAccountConfig.note}`]})]})]}),"active"===a.status&&s.jsx("button",{onClick:async()=>{if(confirm("确定要使该访问码失效吗？"))try{await(async s=>(await e.post(`/accounts/special-accounts/${s}/invalidate`)).data)(a._id),d.success("已使访问码失效"),ce()}catch(s){d.error(s.message||"操作失败")}},className:"px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg text-sm",children:"使其失效"})]})},a._id)})})]})]}),B&&s.jsx(I,{organization:J,onClose:()=>O(!1),onSave:()=>{O(!1),ne()}}),R&&s.jsx($,{user:W,organizations:D,isDesigner:"designers"===a,onClose:()=>Y(!1),onSave:()=>{Y(!1),ie()}}),Z&&s.jsx(E,{onClose:()=>G(!1),onSave:()=>{G(!1),ce()}}),se&&te&&s.jsx(A,{userId:te.id,userName:te.name,onClose:()=>{ae(!1),le(null)}})]})}function I({organization:a,onClose:l,onSave:r}){const[n,i]=t.useState({name:(null==a?void 0:a.name)||"",type:(null==a?void 0:a.type)||"enterprise",contactPerson:(null==a?void 0:a.contactPerson)||"",contactPhone:(null==a?void 0:a.contactPhone)||"",contactEmail:(null==a?void 0:a.contactEmail)||"",description:(null==a?void 0:a.description)||""}),[c,x]=t.useState(!1);return s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg p-6",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:a?"编辑组织":"新建组织"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"组织名称 *"}),s.jsx("input",{type:"text",value:n.name,onChange:e=>i({...n,name:e.target.value}),className:"w-full px-4 py-2 border rounded-lg",placeholder:"输入组织名称"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"类型 *"}),s.jsxs("select",{value:n.type,onChange:e=>i({...n,type:e.target.value}),className:"w-full px-4 py-2 border rounded-lg",disabled:!!a,children:[s.jsx("option",{value:"platform",children:"供应链平台"}),s.jsx("option",{value:"enterprise",children:"企业"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"联系人"}),s.jsx("input",{type:"text",value:n.contactPerson,onChange:e=>i({...n,contactPerson:e.target.value}),className:"w-full px-4 py-2 border rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"联系电话"}),s.jsx("input",{type:"text",value:n.contactPhone,onChange:e=>i({...n,contactPhone:e.target.value}),className:"w-full px-4 py-2 border rounded-lg"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"描述"}),s.jsx("textarea",{value:n.description,onChange:e=>i({...n,description:e.target.value}),className:"w-full px-4 py-2 border rounded-lg",rows:3})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[s.jsx("button",{onClick:l,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"取消"}),s.jsx("button",{onClick:async()=>{if(n.name){x(!0);try{a?(await(async(s,a)=>(await e.put(`/accounts/organizations/${s}`,a)).data.data)(a._id,n),d.success("更新成功")):(await(async s=>(await e.post("/accounts/organizations",s)).data.data)(n),d.success("创建成功")),r()}catch(s){d.error(s.message||"操作失败")}finally{x(!1)}}else d.error("请输入组织名称")},disabled:c,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:c?"保存中...":"保存"})]})]})})}function $({user:a,organizations:l,isDesigner:r,onClose:n,onSave:i}){var c;const[x,o]=t.useState({username:(null==a?void 0:a.username)||"",password:"",nickname:(null==a?void 0:a.nickname)||"",phone:(null==a?void 0:a.phone)||"",email:(null==a?void 0:a.email)||"",role:(null==a?void 0:a.role)||(r?k:S),organizationId:(null==(c=null==a?void 0:a.organizationId)?void 0:c._id)||"",status:(null==a?void 0:a.status)||"active"}),[m,u]=t.useState(!1);return s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg p-6",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:a?"编辑用户":r?"添加设计师":"新建账号"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"用户名 *"}),s.jsx("input",{type:"text",value:x.username,onChange:e=>o({...x,username:e.target.value}),className:"w-full px-4 py-2 border rounded-lg",disabled:!!a})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a?"新密码（留空不修改）":"密码 *"}),s.jsx("input",{type:"password",value:x.password,onChange:e=>o({...x,password:e.target.value}),className:"w-full px-4 py-2 border rounded-lg"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"昵称"}),s.jsx("input",{type:"text",value:x.nickname,onChange:e=>o({...x,nickname:e.target.value}),className:"w-full px-4 py-2 border rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"手机"}),s.jsx("input",{type:"text",value:x.phone,onChange:e=>o({...x,phone:e.target.value}),className:"w-full px-4 py-2 border rounded-lg"})]})]}),!r&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"角色"}),s.jsxs("select",{value:x.role,onChange:e=>o({...x,role:e.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[s.jsx("option",{value:"platform_admin",children:"平台管理员"}),s.jsx("option",{value:"platform_staff",children:"平台子账号"}),s.jsx("option",{value:"enterprise_admin",children:"企业管理员"}),s.jsx("option",{value:"enterprise_staff",children:"企业子账号"}),s.jsx("option",{value:"designer",children:"设计师"}),s.jsx("option",{value:"customer",children:"普通客户"})]})]}),["platform_admin","platform_staff","enterprise_admin","enterprise_staff"].includes(x.role)&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"所属组织"}),s.jsxs("select",{value:x.organizationId,onChange:e=>o({...x,organizationId:e.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[s.jsx("option",{value:"",children:"选择组织"}),l.map(e=>s.jsx("option",{value:e._id,children:e.name},e._id))]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"状态"}),s.jsxs("select",{value:x.status,onChange:e=>o({...x,status:e.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[s.jsx("option",{value:"active",children:"正常"}),s.jsx("option",{value:"inactive",children:"未激活"}),s.jsx("option",{value:"banned",children:"已禁用"})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[s.jsx("button",{onClick:n,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"取消"}),s.jsx("button",{onClick:async()=>{if(x.username)if(a||x.password){u(!0);try{if(a){const s={...x};delete s.password,delete s.username,await(async(s,a)=>(await e.put(`/accounts/users/${s}`,a)).data.data)(a._id,s),d.success("更新成功")}else await(async s=>(await e.post("/accounts/users",s)).data.data)(x),d.success("创建成功");i()}catch(s){d.error(s.message||"操作失败")}finally{u(!1)}}else d.error("请输入密码");else d.error("请输入用户名")},disabled:m,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:m?"保存中...":"保存"})]})]})})}function E({onClose:a,onSave:l}){const[r,n]=t.useState({note:"",expiresInHours:24,maxUsage:10}),[i,c]=t.useState(!1),[x,o]=t.useState(null);return s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"生成特殊访问码"}),x?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(g,{className:"w-8 h-8 text-green-600"})}),s.jsx("p",{className:"text-gray-500 mb-2",children:"访问码已生成"}),s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[s.jsx("span",{className:"font-mono text-3xl font-bold text-gray-900",children:x.accessCode}),s.jsx("button",{onClick:()=>{x&&(navigator.clipboard.writeText(x.accessCode),d.success("访问码已复制"))},className:"p-2 hover:bg-gray-100 rounded-lg",children:s.jsx(C,{className:"w-5 h-5 text-gray-400"})})]}),s.jsxs("p",{className:"text-sm text-gray-500",children:["有效期至: ",new Date(x.expiresAt).toLocaleString()]}),s.jsx("button",{onClick:l,className:"mt-6 px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"完成"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"备注"}),s.jsx("input",{type:"text",value:r.note,onChange:e=>n({...r,note:e.target.value}),className:"w-full px-4 py-2 border rounded-lg",placeholder:"如：给XX客户看价"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有效期（小时）"}),s.jsx("input",{type:"number",value:r.expiresInHours,onChange:e=>n({...r,expiresInHours:Number(e.target.value)}),className:"w-full px-4 py-2 border rounded-lg",min:1})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"最大使用次数"}),s.jsx("input",{type:"number",value:r.maxUsage,onChange:e=>n({...r,maxUsage:Number(e.target.value)}),className:"w-full px-4 py-2 border rounded-lg",min:1})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[s.jsx("button",{onClick:a,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"取消"}),s.jsx("button",{onClick:async()=>{c(!0);try{const s=await(async s=>(await e.post("/accounts/special-accounts",s)).data.data)(r);o(s),d.success("访问码已生成")}catch(s){d.error(s.message||"生成失败")}finally{c(!1)}},disabled:i,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:i?"生成中...":"生成访问码"})]})]})]})})}export{P as default};

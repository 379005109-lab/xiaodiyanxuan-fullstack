import{k as e,j as s,d as t,f as l}from"./index-DWFic46w.js";import{u as r,r as i,L as a}from"./react-vendor-E1AgTUZ9.js";import{h as n}from"./html2canvas-CeZt5dlh.js";import{B as o,E as d,A as c,t as m,G as u,y as h,z as x,D as p,X as g,u as v}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";function f(){const f=r(),{items:j,removeItem:b,updateQuantity:y,getTotalPrice:N,clearCart:w}=e(),[k,C]=i.useState([]),[_,$]=i.useState("list"),M=j.length>0;i.useEffect(()=>{if(0===j.length)return void C([]);const e=j.map(e=>`${e.product._id}-${e.sku._id}`);C(s=>{const t=s.filter(s=>e.includes(s));return 0===t.length&&j.length>0?e:t})},[j]);const z=e=>{C(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])};j.length,j.reduce((e,s)=>e+s.quantity,0),N();const S=j.filter(e=>k.includes(`${e.product._id}-${e.sku._id}`)),q=S.reduce((e,s)=>e+s.price*s.quantity,0),[B,L]=i.useState(!1),[O,R]=i.useState("landscape"),E=i.useRef(null),P=()=>{const e=S.length;return"landscape"===O?e<=3?{cols:e,width:1280,height:720}:e<=6?{cols:3,width:1280,height:720}:{cols:4,width:1280,height:900}:e<=2?{cols:1,width:720,height:1280}:e<=4?{cols:2,width:720,height:1280}:{cols:2,width:720,height:1600}},D=e=>{const s=e.sku;return(null==s?void 0:s.length)&&(null==s?void 0:s.width)&&(null==s?void 0:s.height)?`${s.length}*${s.width}*${s.height}`:(null==s?void 0:s.length)&&(null==s?void 0:s.width)?`${s.length}*${s.width}`:(null==s?void 0:s.spec)||"标准规格"},T=e=>{var s,t,l,r;const i=(null==(t=null==(s=e.product)?void 0:s.name)?void 0:t.toLowerCase())||"",a=(null==(r=null==(l=e.product)?void 0:l.category)?void 0:r.toLowerCase())||"";return i.includes("沙发")||a.includes("sofa")||a.includes("沙发")},W=S.filter(T),I=S.filter(e=>!T(e)),U=S.reduce((e,s)=>e+s.price*s.quantity,0);return s.jsxs("div",{className:"animate-fade-in-up pb-32",children:[s.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-12",children:[s.jsxs("div",{className:"flex justify-between items-end mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-serif font-bold text-primary mb-2",children:"购物车"}),s.jsxs("p",{className:"text-stone-500 uppercase tracking-widest text-xs",children:["Shopping Cart (",j.length,")"]})]}),j.length>0&&s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("button",{onClick:async()=>{0!==S.length?L(!0):v.error("请选择要生成图片的商品")},disabled:0===k.length,className:"text-sm text-primary hover:text-primary-700 transition-colors flex items-center gap-1 border border-primary rounded-lg px-3 py-1.5 hover:bg-primary/5 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(o,{className:"w-4 h-4"})," 生成商品图片"]}),s.jsxs("button",{onClick:()=>{window.confirm("确定要清空购物车吗？")&&(w(),C([]))},className:"text-sm text-stone-400 hover:text-red-500 transition-colors flex items-center gap-1 border-b border-transparent hover:border-red-500 pb-0.5",children:[s.jsx(d,{className:"w-3 h-3"})," 清空购物车"]})]})]}),0===j.length?s.jsxs("div",{className:"text-center py-20 bg-white rounded-2xl border border-stone-100",children:[s.jsx("p",{className:"text-stone-400 font-serif italic mb-4",children:"您的购物车是空的"}),s.jsxs(a,{to:"/products",className:"inline-flex items-center gap-2 bg-primary text-white px-6 py-3 rounded-full hover:bg-green-900 transition-colors",children:["去选购商品 ",s.jsx(c,{className:"w-4 h-4"})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white p-4 rounded-xl border border-stone-100 flex items-center justify-between",children:[s.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:k.length===j.length&&j.length>0,onChange:()=>{C(e=>e.length===j.length?[]:j.map(e=>`${e.product._id}-${e.sku._id}`))},className:"w-5 h-5 rounded border-stone-300 text-primary focus:ring-primary cursor-pointer accent-primary"}),s.jsxs("span",{className:"font-medium text-stone-700",children:["全选 (",j.length,")"]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-sm text-stone-500",children:["已选择 ",k.length," 件商品"]}),s.jsxs("div",{className:"flex items-center gap-1 border border-gray-200 rounded-lg p-1",children:[s.jsx("button",{onClick:()=>$("list"),className:"p-1.5 rounded "+("list"===_?"bg-primary/10 text-primary":"text-gray-400 hover:text-gray-600"),title:"列表模式",children:s.jsx(m,{className:"h-4 w-4"})}),s.jsx("button",{onClick:()=>$("grid"),className:"p-1.5 rounded "+("grid"===_?"bg-primary/10 text-primary":"text-gray-400 hover:text-gray-600"),title:"矩阵模式",children:s.jsx(u,{className:"h-4 w-4"})})]})]})]}),"grid"===_&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:j.map(e=>{var r,i,a,n,o,c,m,u,h;const x=`${e.product._id}-${e.sku._id}`;return s.jsxs("div",{className:"bg-white rounded-xl border border-stone-100 shadow-sm overflow-hidden hover:border-primary/30 transition-all group",children:[s.jsxs("div",{onClick:()=>window.location.href=`/products/${e.product._id}`,className:"aspect-square bg-stone-50 cursor-pointer relative",children:[s.jsx("img",{src:(null==(i=null==(r=e.sku)?void 0:r.images)?void 0:i[0])||(null==(n=null==(a=e.product)?void 0:a.images)?void 0:n[0])?t((null==(c=null==(o=e.sku)?void 0:o.images)?void 0:c[0])||e.product.images[0]):"/placeholder.svg",alt:(null==(m=e.product)?void 0:m.name)||"商品",className:"w-full h-full object-cover group-hover:scale-105 transition-transform",onError:e=>{e.target.src="/placeholder.svg"}}),s.jsx("div",{className:"absolute top-2 left-2",children:s.jsx("input",{type:"checkbox",checked:k.includes(x),onChange:()=>z(x),onClick:e=>e.stopPropagation(),className:"w-5 h-5 rounded border-stone-300 text-primary focus:ring-primary cursor-pointer accent-primary bg-white"})}),s.jsx("button",{onClick:s=>{s.stopPropagation(),b(e.product._id,e.sku._id,e.selectedMaterials)},className:"absolute top-2 right-2 p-1.5 bg-white/90 rounded-full text-stone-400 hover:text-red-500 hover:bg-white transition-colors",children:s.jsx(d,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"p-3",children:[s.jsx("h3",{className:"font-medium text-sm text-primary line-clamp-1 mb-1",children:null==(u=e.product)?void 0:u.name}),s.jsx("p",{className:"text-xs text-stone-500 line-clamp-1 mb-2",children:(null==(h=e.sku)?void 0:h.spec)||"标准规格"}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-red-600 font-bold",children:["¥",l(e.price)]}),s.jsxs("span",{className:"text-xs text-stone-400",children:["×",e.quantity]})]})]})]},x)})}),"list"===_&&j.map((e,r)=>{var i,a,n,o,c,m,u,p,g,v,f,j,N;const w=`${e.product._id}-${e.sku._id}`;return s.jsxs("div",{className:"bg-white p-4 md:p-6 rounded-2xl border border-stone-100 shadow-sm flex flex-col md:flex-row gap-6 items-center group hover:border-primary/20 transition-all",children:[s.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[s.jsx("input",{type:"checkbox",checked:k.includes(w),onChange:()=>z(w),className:"w-5 h-5 rounded border-stone-300 text-primary focus:ring-primary cursor-pointer accent-primary"}),s.jsx("div",{onClick:()=>window.location.href=`/products/${e.product._id}`,className:"w-24 h-24 md:w-32 md:h-32 bg-stone-50 rounded-xl overflow-hidden border border-stone-200 cursor-pointer hover:border-primary transition-colors",children:s.jsx("img",{src:(null==(a=null==(i=e.sku)?void 0:i.images)?void 0:a[0])||(null==(o=null==(n=e.product)?void 0:n.images)?void 0:o[0])?t((null==(m=null==(c=e.sku)?void 0:c.images)?void 0:m[0])||e.product.images[0]):"/placeholder.svg",alt:(null==(u=e.product)?void 0:u.name)||"商品",className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder.svg"}})})]}),s.jsxs("div",{className:"flex-1 w-full md:w-auto text-left",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("h3",{onClick:()=>window.location.href=`/products/${e.product._id}`,className:"font-bold text-lg text-primary cursor-pointer hover:text-accent transition-colors",children:(null==(p=e.product)?void 0:p.name)||"商品名称"}),s.jsx("button",{onClick:()=>b(e.product._id,e.sku._id,e.selectedMaterials),className:"text-stone-400 hover:text-red-500 transition-colors p-1",children:s.jsx(d,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"space-y-1 text-sm mb-4",children:[s.jsxs("p",{className:"text-stone-500",children:["规格: ",s.jsx("span",{className:"text-stone-800",children:(null==(g=e.sku)?void 0:g.color)||(null==(v=e.sku)?void 0:v.spec)||"标准规格"})]}),((null==(f=e.sku)?void 0:f.length)||(null==(j=e.sku)?void 0:j.width)||(null==(N=e.sku)?void 0:N.height))&&s.jsxs("p",{className:"text-stone-500",children:["尺寸: ",s.jsxs("span",{className:"text-stone-800",children:[e.sku.length||"-","×",e.sku.width||"-","×",e.sku.height||"-"," CM"]})]}),e.selectedMaterials&&Object.keys(e.selectedMaterials).length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Object.entries(e.selectedMaterials).map(([t,l])=>{var r;if(!l)return null;const i=(null==(r=e.materialUpgradePrices)?void 0:r[t])||0;return s.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 bg-stone-100 text-stone-600 text-xs rounded",children:[l,i>0&&s.jsxs("span",{className:"text-red-600 font-semibold ml-1",children:["+¥",i]})]},t)})})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:l(e.price)}),(()=>{const t=e.materialUpgradePrices||{};let r=0;if(e.selectedMaterials){const s=[];e.selectedMaterials.fabric&&s.push(e.selectedMaterials.fabric),e.selectedMaterials.filling&&s.push(e.selectedMaterials.filling),e.selectedMaterials.frame&&s.push(e.selectedMaterials.frame),e.selectedMaterials.leg&&s.push(e.selectedMaterials.leg),r=s.reduce((e,s)=>e+(t[s]||0),0)}return r>0?s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["(含材质升级 +",l(r),")"]}):null})()]}),s.jsxs("div",{className:"flex items-center bg-stone-50 border border-stone-200 rounded-lg",children:[s.jsx("button",{onClick:()=>y(e.product._id,e.sku._id,Math.max(1,e.quantity-1),e.selectedMaterials),className:"p-2 text-stone-500 hover:text-primary transition-colors disabled:opacity-30",disabled:e.quantity<=1,children:s.jsx(h,{className:"w-3 h-3"})}),s.jsx("span",{className:"w-8 text-center font-medium text-sm",children:e.quantity}),s.jsx("button",{onClick:()=>y(e.product._id,e.sku._id,e.quantity+1,e.selectedMaterials),className:"p-2 text-stone-500 hover:text-primary transition-colors",children:s.jsx(x,{className:"w-3 h-3"})})]})]})]})]},w)})]})]}),B&&s.jsx("div",{className:"fixed inset-0 bg-black/60 z-[200] flex items-center justify-center p-4 overflow-auto",children:s.jsxs("div",{className:"bg-white rounded-2xl max-w-full max-h-[95vh] overflow-auto shadow-2xl",children:[s.jsxs("div",{className:"sticky top-0 bg-white border-b p-4 flex items-center justify-between z-10",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h3",{className:"font-bold text-lg",children:"商品清单预览"}),s.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-lg p-1",children:[s.jsx("button",{onClick:()=>R("landscape"),className:"px-3 py-1 text-sm rounded-md transition-colors "+("landscape"===O?"bg-primary text-white":"text-gray-600 hover:bg-gray-200"),children:"横版"}),s.jsx("button",{onClick:()=>R("portrait"),className:"px-3 py-1 text-sm rounded-md transition-colors "+("portrait"===O?"bg-primary text-white":"text-gray-600 hover:bg-gray-200"),children:"竖版"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:async()=>{if(E.current)try{v.loading("正在生成图片...");const e=await n(E.current,{backgroundColor:"#ffffff",scale:2,useCORS:!0,allowTaint:!0,logging:!1}),s=document.createElement("a");s.download=`商品清单_${(new Date).toLocaleDateString("zh-CN").replace(/\//g,"-")}.png`,s.href=e.toDataURL("image/png"),s.click(),v.dismiss(),v.success("图片已生成并下载")}catch(e){v.dismiss(),v.error("生成图片失败")}},className:"flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors",children:[s.jsx(p,{className:"w-4 h-4"})," 下载图片"]}),s.jsx("button",{onClick:()=>L(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(g,{className:"w-5 h-5"})})]})]}),s.jsx("div",{className:"p-6 flex justify-center",children:s.jsxs("div",{ref:E,style:{width:P().width,minHeight:P().height,backgroundColor:"#ffffff",padding:"40px"},children:[s.jsx("div",{className:"text-center mb-8",children:s.jsxs("h1",{style:{fontSize:"48px",fontWeight:"bold",color:"#1a1a1a",marginBottom:"8px"},children:[S.length,"件套：",U.toLocaleString()]})}),W.length>0&&s.jsx("div",{className:"mb-8",children:W.map(e=>{var l,r,i,a,n,o,d,c;return s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx("div",{style:{width:"60%",aspectRatio:"4/3"},className:"bg-gray-50 rounded-xl overflow-hidden flex items-center justify-center",children:s.jsx("img",{src:(null==(r=null==(l=e.sku)?void 0:l.images)?void 0:r[0])||(null==(a=null==(i=e.product)?void 0:i.images)?void 0:a[0])?t((null==(o=null==(n=e.sku)?void 0:n.images)?void 0:o[0])||e.product.images[0]):"/placeholder.svg",alt:null==(d=e.product)?void 0:d.name,className:"max-w-full max-h-full object-contain",crossOrigin:"anonymous"})}),s.jsxs("div",{className:"flex-1 text-right",children:[s.jsx("h2",{style:{fontSize:"32px",fontWeight:"bold",color:"#1a1a1a",marginBottom:"12px"},children:null==(c=e.product)?void 0:c.name}),s.jsxs("p",{style:{fontSize:"20px",color:"#666",marginBottom:"8px"},children:["size: ",D(e)]}),s.jsxs("p",{style:{fontSize:"14px",color:"#999",lineHeight:"1.6"},children:["Italian minimalist furniture",s.jsx("br",{}),"I have everything"]})]})]},`main-${e.product._id}-${e.sku._id}`)})}),I.length>0&&s.jsx("div",{className:"grid gap-6",style:{gridTemplateColumns:`repeat(${Math.min(I.length,5)}, 1fr)`},children:I.map(e=>{var l,r,i,a,n,o,d,c;return s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"bg-gray-50 rounded-lg overflow-hidden mb-3",style:{aspectRatio:"1"},children:s.jsx("img",{src:(null==(r=null==(l=e.sku)?void 0:l.images)?void 0:r[0])||(null==(a=null==(i=e.product)?void 0:i.images)?void 0:a[0])?t((null==(o=null==(n=e.sku)?void 0:n.images)?void 0:o[0])||e.product.images[0]):"/placeholder.svg",alt:null==(d=e.product)?void 0:d.name,className:"w-full h-full object-contain",crossOrigin:"anonymous"})}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:"bold",color:"#1a1a1a",marginBottom:"4px"},children:null==(c=e.product)?void 0:c.name}),s.jsxs("p",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:["size: ",D(e)]}),s.jsx("p",{style:{fontSize:"10px",color:"#999"},children:"xiaodiyanxuan"})]},`other-${e.product._id}-${e.sku._id}`)})}),0===W.length&&s.jsx("div",{className:"grid gap-6",style:{gridTemplateColumns:`repeat(${P().cols}, 1fr)`},children:S.map(e=>{var l,r,i,a,n,o,d,c;return s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"bg-gray-50 rounded-lg overflow-hidden mb-3",style:{aspectRatio:"1"},children:s.jsx("img",{src:(null==(r=null==(l=e.sku)?void 0:l.images)?void 0:r[0])||(null==(a=null==(i=e.product)?void 0:i.images)?void 0:a[0])?t((null==(o=null==(n=e.sku)?void 0:n.images)?void 0:o[0])||e.product.images[0]):"/placeholder.svg",alt:null==(d=e.product)?void 0:d.name,className:"w-full h-full object-contain",crossOrigin:"anonymous"})}),s.jsx("h3",{style:{fontSize:"16px",fontWeight:"bold",color:"#1a1a1a",marginBottom:"4px"},children:null==(c=e.product)?void 0:c.name}),s.jsxs("p",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:["size: ",D(e)]}),s.jsx("p",{style:{fontSize:"10px",color:"#999"},children:"xiaodiyanxuan"})]},`all-${e.product._id}-${e.sku._id}`)})})]})})]})}),M&&s.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-stone-200 p-6 shadow-lg z-[100]",children:s.jsxs("div",{className:"max-w-5xl mx-auto flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-stone-500 text-sm hidden md:inline",children:["已选 ",k.length," 件商品"]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsx("span",{className:"font-bold text-primary",children:"合计:"}),s.jsx("span",{className:"font-serif font-bold text-2xl text-accent",children:l(q)})]})]}),s.jsxs("button",{onClick:()=>{0!==j.filter(e=>k.includes(`${e.product._id}-${e.sku._id}`)).length?f("/checkout"):alert("请选择要结算的商品")},disabled:0===k.length,className:"bg-primary text-white px-8 py-3 rounded-full font-bold hover:bg-green-900 shadow-lg shadow-primary/20 transition-all transform hover:-translate-y-1 flex items-center gap-2 disabled:opacity-50 disabled:transform-none disabled:shadow-none",children:["立即结算",s.jsx(c,{className:"w-4 h-4"})]})]})})]})}export{f as default};

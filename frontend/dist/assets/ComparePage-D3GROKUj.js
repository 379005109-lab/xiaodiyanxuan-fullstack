import{a as e,k as s,q as t,j as r,d as a,f as l,o as c,r as d,m as i}from"./index-DWFic46w.js";import{r as n,L as o}from"./react-vendor-E1AgTUZ9.js";import{x as m,X as x,f as u,u as p}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";function h(){const[h,g]=n.useState([]),[f,b]=n.useState(null),[j,y]=n.useState([]),[N,k]=n.useState(!1),{compareItems:v,removeFromCompare:I,loadCompareItems:M}=e(),{addItem:w}=s();n.useEffect(()=>{M(),P();(async()=>{try{const e=await c();y(Array.isArray(e)?e:[]),k(!0)}catch(e){y([]),k(!0)}})();const e=()=>{M(),P()};return window.addEventListener("compareListUpdated",e),()=>{window.removeEventListener("compareListUpdated",e)}},[]);const P=async()=>{try{const e=await t.compareService.getCompareStats();b(e)}catch(e){}};n.useEffect(()=>{(async()=>{const e=[],s=[];await Promise.all(v.map(async t=>{var r;const a=await d(t.productId)||await i(t.productId);if(!a||!(null==(r=a.skus)?void 0:r.length))return s.push({productId:t.productId,skuId:t.skuId}),null;let l;if(t.skuId&&(l=a.skus.find(e=>e._id===t.skuId)),!l&&a.skus.length>0&&(l=a.skus[0]),!l)return void s.push({productId:t.productId,skuId:t.skuId});const c=t.selectedMaterials?`${t.selectedMaterials.fabric||""}|${t.selectedMaterials.filling||""}|${t.selectedMaterials.frame||""}|${t.selectedMaterials.leg||""}`:"";e.push({product:a,sku:l,compareItemId:`${t.productId}-${t.skuId||""}-${c}`,selectedMaterials:t.selectedMaterials})})),s.length>0&&s.forEach(e=>{const s=v.find(s=>s.productId===e.productId&&s.skuId===e.skuId);I(e.productId,e.skuId,null==s?void 0:s.selectedMaterials)}),g(e)})()},[v]);return 0===h.length?r.jsx("div",{className:"min-h-screen bg-gray-50 py-16",children:r.jsx("div",{className:"container-custom",children:r.jsxs("div",{className:"card p-12 text-center",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"对比列表为空"}),r.jsx("p",{className:"text-gray-600 mb-8",children:"还没有添加任何商品到对比列表"}),r.jsx(o,{to:"/products",className:"btn-primary inline-block",children:"去选购"})]})})}):r.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:r.jsxs("div",{className:"container-custom",children:[r.jsxs("div",{className:"mb-8",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h1",{className:"text-3xl font-bold",children:"商品对比"}),f&&r.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[r.jsxs("div",{className:"bg-white px-4 py-2 rounded-lg border border-gray-200",children:[r.jsx("span",{className:"text-gray-600",children:"已对比:"}),r.jsxs("span",{className:"font-bold text-primary-600 ml-2",children:[h.length,"/",f.maxItems]})]}),f.canAddMore?r.jsxs("div",{className:"bg-green-50 px-4 py-2 rounded-lg border border-green-200 text-green-700",children:["✓ 还可添加 ",f.maxItems-h.length," 个"]}):r.jsxs("div",{className:"bg-orange-50 px-4 py-2 rounded-lg border border-orange-200 text-orange-700 flex items-center gap-1",children:[r.jsx(m,{className:"h-4 w-4"}),"对比列表已满"]})]})]}),r.jsx("p",{className:"text-gray-600",children:"对比不同商品的规格、材质和价格，帮助您做出最佳选择"})]}),r.jsx("div",{className:"card overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("th",{className:"py-4 px-4 text-left text-sm font-semibold bg-gray-50 w-32",children:"对比项"}),h.map(e=>{var s,t;return r.jsxs("th",{className:"py-4 px-4 text-center relative min-w-[240px]",children:[r.jsx("button",{onClick:()=>(async e=>{g(s=>s.filter(s=>!(s.product._id===e.product._id&&s.sku._id===e.sku._id&&JSON.stringify(s.selectedMaterials)===JSON.stringify(e.selectedMaterials)))),p.success("已移除");try{await I(e.product._id,e.sku._id,e.selectedMaterials)}catch(s){}})(e),className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 shadow-lg transition-all hover:scale-110 z-20",children:r.jsx(x,{className:"h-5 w-5"})}),r.jsxs(o,{to:`/products/${e.product._id}`,children:[r.jsx("img",{src:a((null==(s=e.sku.images)?void 0:s[0])||(null==(t=e.product.images)?void 0:t[0])||"/placeholder.png"),alt:e.product.name,className:"w-full h-48 object-cover rounded-lg mb-3"}),r.jsx("h3",{className:"font-semibold text-sm hover:text-primary-600",children:e.product.name}),e.sku.isPro&&r.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs rounded",children:"PRO版"})]})]},e.compareItemId)})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"价格"}),h.map(e=>{const s=e.sku.discountPrice&&e.sku.discountPrice>0&&e.sku.discountPrice<e.sku.price?e.sku.discountPrice:e.sku.price,t=e.sku.materialUpgradePrices||{};let a=0;if(e.selectedMaterials){const s=[];e.selectedMaterials.fabric&&s.push(e.selectedMaterials.fabric),e.selectedMaterials.filling&&s.push(e.selectedMaterials.filling),e.selectedMaterials.frame&&s.push(e.selectedMaterials.frame),e.selectedMaterials.leg&&s.push(e.selectedMaterials.leg),a=s.reduce((e,s)=>e+(t[s]||0),0)}const c=s+a;return r.jsxs("td",{className:"py-4 px-4 text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-red-600",children:l(c)}),e.sku.discountPrice&&e.sku.discountPrice>0&&e.sku.discountPrice<e.sku.price&&r.jsx("div",{className:"text-sm text-gray-400 line-through mt-1",children:l(e.sku.price+a)}),a>0&&r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["(含材质升级 +",l(a),")"]})]},e.compareItemId)})]}),r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"型号"}),h.map(e=>r.jsx("td",{className:"py-4 px-4 text-center",children:r.jsx("div",{className:"text-sm text-gray-700",children:e.sku.code})},e.compareItemId))]}),r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"规格"}),h.map(e=>r.jsx("td",{className:"py-4 px-4 text-center",children:r.jsx("div",{className:"text-sm text-gray-700",children:e.sku.spec||"-"})},e.compareItemId))]}),h.some(e=>{const s=e.sku.material;return s&&"object"==typeof s&&(s.fabric||s.filling||s.frame||s.leg)})&&r.jsxs(r.Fragment,{children:[r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"面料"}),h.map(e=>{var s;const t=e.sku.material;let l,c="-";const d=t&&"object"==typeof t&&t.fabric;if(null==(s=e.selectedMaterials)?void 0:s.fabric){c=e.selectedMaterials.fabric;const s=j.find(s=>{var t;return s.name===(null==(t=e.selectedMaterials)?void 0:t.fabric)});l=null==s?void 0:s.image}else c=d?"未选面料":"-";const i=e.sku.materialUpgradePrices||{};let n=i[c];if(!n&&"-"!==c){if(n=i[c.split(/\s+/)[0]],!n)for(const[e,s]of Object.entries(i))if(c.includes(e)||e.includes(c)){n=s;break}}return r.jsx("td",{className:"py-4 px-4 text-center",children:r.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l&&r.jsx("img",{src:a(l),alt:c,className:"w-16 h-16 object-cover rounded border border-gray-200"}),r.jsxs("div",{className:"text-sm "+("未选面料"===c?"text-orange-500 font-medium":"text-gray-700"),children:[c,n>0&&r.jsxs("span",{className:"block text-red-600 font-semibold text-xs mt-1",children:["+¥",n]})]})]})},e.compareItemId)})]}),r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"填充"}),h.map(e=>{var s;const t=e.sku.material;let l,c="-";const d=t&&"object"==typeof t&&t.filling;if(null==(s=e.selectedMaterials)?void 0:s.filling){c=e.selectedMaterials.filling;const s=j.find(s=>{var t;return s.name===(null==(t=e.selectedMaterials)?void 0:t.filling)});l=null==s?void 0:s.image}else c=d?"未选填充":"-";const i=e.sku.materialUpgradePrices||{};let n=i[c];if(!n&&"-"!==c){if(n=i[c.split(/\s+/)[0]],!n)for(const[e,s]of Object.entries(i))if(c.includes(e)||e.includes(c)){n=s;break}}return r.jsx("td",{className:"py-4 px-4 text-center",children:r.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l&&r.jsx("img",{src:a(l),alt:c,className:"w-16 h-16 object-cover rounded border border-gray-200"}),r.jsxs("div",{className:"text-sm "+("未选填充"===c?"text-orange-500 font-medium":"text-gray-700"),children:[c,n>0&&r.jsxs("span",{className:"block text-red-600 font-semibold text-xs mt-1",children:["+¥",n]})]})]})},e.compareItemId)})]}),r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"框架"}),h.map(e=>{var s;const t=e.sku.material;let l,c="-";const d=t&&"object"==typeof t&&t.frame;if(null==(s=e.selectedMaterials)?void 0:s.frame){c=e.selectedMaterials.frame;const s=j.find(s=>{var t;return s.name===(null==(t=e.selectedMaterials)?void 0:t.frame)});l=null==s?void 0:s.image}else c=d?"未选框架":"-";const i=e.sku.materialUpgradePrices||{};let n=i[c];if(!n&&"-"!==c){if(n=i[c.split(/\s+/)[0]],!n)for(const[e,s]of Object.entries(i))if(c.includes(e)||e.includes(c)){n=s;break}}return r.jsx("td",{className:"py-4 px-4 text-center",children:r.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l&&r.jsx("img",{src:a(l),alt:c,className:"w-16 h-16 object-cover rounded border border-gray-200"}),r.jsxs("div",{className:"text-sm "+("未选框架"===c?"text-orange-500 font-medium":"text-gray-700"),children:[c,n>0&&r.jsxs("span",{className:"block text-red-600 font-semibold text-xs mt-1",children:["+¥",n]})]})]})},e.compareItemId)})]}),r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"脚架"}),h.map(e=>{var s;const t=e.sku.material;let l,c="-";const d=t&&"object"==typeof t&&t.leg;if(null==(s=e.selectedMaterials)?void 0:s.leg){c=e.selectedMaterials.leg;const s=j.find(s=>{var t;return s.name===(null==(t=e.selectedMaterials)?void 0:t.leg)});l=null==s?void 0:s.image}else c=d?"未选脚架":"-";const i=e.sku.materialUpgradePrices||{};let n=i[c];if(!n&&"-"!==c){if(n=i[c.split(/\s+/)[0]],!n)for(const[e,s]of Object.entries(i))if(c.includes(e)||e.includes(c)){n=s;break}}return r.jsx("td",{className:"py-4 px-4 text-center",children:r.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l&&r.jsx("img",{src:a(l),alt:c,className:"w-16 h-16 object-cover rounded border border-gray-200"}),r.jsxs("div",{className:"text-sm "+("未选脚架"===c?"text-orange-500 font-medium":"text-gray-700"),children:[c,n>0&&r.jsxs("span",{className:"block text-red-600 font-semibold text-xs mt-1",children:["+¥",n]})]})]})},e.compareItemId)})]})]}),r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"尺寸"}),h.map(e=>r.jsx("td",{className:"py-4 px-4 text-center",children:e.sku.length&&e.sku.width&&e.sku.height?r.jsxs("div",{className:"text-sm text-gray-700",children:[e.sku.length,"×",e.sku.width,"×",e.sku.height," CM"]}):r.jsx("div",{className:"text-gray-400 text-sm",children:"-"})},e.compareItemId))]}),h.some(e=>e.sku.isPro)&&r.jsxs("tr",{className:"border-b border-gray-200",children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"PRO特性"}),h.map(e=>r.jsx("td",{className:"py-4 px-4",children:e.sku.isPro&&e.sku.proFeature?r.jsx("div",{className:"text-sm text-gray-700 text-left px-2",children:e.sku.proFeature}):r.jsx("div",{className:"text-gray-400 text-sm text-center",children:"-"})},e.compareItemId))]}),r.jsxs("tr",{children:[r.jsx("td",{className:"py-4 px-4 text-sm font-medium bg-gray-50",children:"操作"}),h.map(e=>r.jsx("td",{className:"py-4 px-4 text-center",children:r.jsxs("div",{className:"space-y-2",children:[r.jsxs("button",{onClick:()=>(e=>{const s=e.sku.discountPrice&&e.sku.discountPrice>0&&e.sku.discountPrice<e.sku.price?e.sku.discountPrice:e.sku.price,t=e.sku.materialUpgradePrices||{};let r=0;if(e.selectedMaterials){const s=[];e.selectedMaterials.fabric&&s.push(e.selectedMaterials.fabric),e.selectedMaterials.filling&&s.push(e.selectedMaterials.filling),e.selectedMaterials.frame&&s.push(e.selectedMaterials.frame),e.selectedMaterials.leg&&s.push(e.selectedMaterials.leg),r=s.reduce((e,s)=>e+(t[s]||0),0)}const a=s+r;w(e.product,e.sku,1,e.selectedMaterials,a),p.success("已添加到购物车")})(e),className:"w-full btn-primary py-2 text-sm flex items-center justify-center gap-2",children:[r.jsx(u,{className:"h-4 w-4"}),"加入购物车"]}),r.jsx(o,{to:`/products/${e.product._id}`,className:"block w-full btn-secondary py-2 text-sm text-center",children:"查看详情"})]})},e.compareItemId))]})]})]})}),r.jsx("div",{className:"mt-6 text-center",children:r.jsx(o,{to:"/products",className:"btn-secondary inline-block",children:"继续选购"})})]})})}export{h as default};

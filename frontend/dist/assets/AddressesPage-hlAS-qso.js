import{b as e,j as s}from"./index-DWFic46w.js";import{r as a,u as t}from"./react-vendor-E1AgTUZ9.js";import{u as r,L as l,z as i,M as d,a2 as c,E as n}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";function o(){const[o,h]=a.useState([]),[x,m]=a.useState(!0),[p,u]=a.useState(!1),[g,j]=a.useState(null),[b,y]=a.useState({name:"",phone:"",address:"",isDefault:!1}),[f,N]=a.useState(!1),{token:v,isAuthenticated:w}=e(),k=t();a.useEffect(()=>{if(!w)return r.error("请先登录"),void k("/");D()},[w]);const D=async()=>{try{const e=await fetch("https://pkochbpmcgaa.sealoshzh.site/api/addresses",{headers:{Authorization:`Bearer ${v}`}});if(e.ok){const s=await e.json();h(s.data||[])}}catch(e){}finally{m(!1)}};return x?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsx(l,{className:"w-8 h-8 animate-spin text-primary"})}):s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:s.jsxs("div",{className:"max-w-3xl mx-auto px-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"我的地址"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"管理您的收货地址"})]}),s.jsxs("button",{onClick:()=>{u(!0),j(null),y({name:"",phone:"",address:"",isDefault:!1})},className:"flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg hover:bg-green-900",children:[s.jsx(i,{className:"w-4 h-4"})," 添加地址"]})]}),p&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6 mb-6",children:[s.jsx("h3",{className:"font-bold text-lg mb-4",children:g?"编辑地址":"新增地址"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"收货人"}),s.jsx("input",{type:"text",value:b.name,onChange:e=>y({...b,name:e.target.value}),className:"w-full border rounded-lg px-3 py-2",placeholder:"请输入收货人姓名"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"手机号"}),s.jsx("input",{type:"tel",value:b.phone,onChange:e=>y({...b,phone:e.target.value}),className:"w-full border rounded-lg px-3 py-2",placeholder:"请输入手机号"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"详细地址"}),s.jsx("textarea",{value:b.address,onChange:e=>y({...b,address:e.target.value}),className:"w-full border rounded-lg px-3 py-2 min-h-[80px]",placeholder:"请输入详细地址"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",id:"isDefault",checked:b.isDefault,onChange:e=>y({...b,isDefault:e.target.checked}),className:"rounded"}),s.jsx("label",{htmlFor:"isDefault",className:"text-sm text-gray-600",children:"设为默认地址"})]}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{onClick:()=>{u(!1),j(null)},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"取消"}),s.jsx("button",{onClick:async()=>{if(b.name&&b.phone&&b.address){N(!0);try{const e=g?`https://pkochbpmcgaa.sealoshzh.site/api/addresses/${g}`:"https://pkochbpmcgaa.sealoshzh.site/api/addresses";if(!(await fetch(e,{method:g?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify(b)})).ok)throw new Error("操作失败");r.success(g?"地址更新成功":"地址添加成功"),u(!1),j(null),y({name:"",phone:"",address:"",isDefault:!1}),D()}catch(e){r.error("操作失败，请重试")}finally{N(!1)}}else r.error("请填写完整信息")},disabled:f,className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-green-900 disabled:opacity-50",children:f?"保存中...":"保存"})]})]})]}),s.jsx("div",{className:"space-y-4",children:0===o.length?s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-12 text-center",children:[s.jsx(d,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),s.jsx("p",{className:"text-gray-500",children:"暂无收货地址"}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"点击上方按钮添加新地址"})]}):o.map(e=>s.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-4 "+(e.isDefault?"border-primary":""),children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{className:"font-bold",children:e.name}),s.jsx("span",{className:"text-gray-500",children:e.phone}),e.isDefault&&s.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded",children:"默认"})]}),s.jsx("p",{className:"text-gray-600 text-sm",children:e.address})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[!e.isDefault&&s.jsx("button",{onClick:()=>(async e=>{try{(await fetch(`https://pkochbpmcgaa.sealoshzh.site/api/addresses/${e}/default`,{method:"PUT",headers:{Authorization:`Bearer ${v}`}})).ok&&(r.success("已设为默认地址"),D())}catch(s){r.error("操作失败")}})(e._id),className:"text-xs text-gray-500 hover:text-primary px-2 py-1",children:"设为默认"}),s.jsx("button",{onClick:()=>(e=>{y({name:e.name,phone:e.phone,address:e.address,isDefault:e.isDefault}),j(e._id),u(!0)})(e),className:"p-2 hover:bg-gray-100 rounded-lg",children:s.jsx(c,{className:"w-4 h-4 text-gray-500"})}),s.jsx("button",{onClick:()=>(async e=>{if(confirm("确定删除这个地址吗？"))try{(await fetch(`https://pkochbpmcgaa.sealoshzh.site/api/addresses/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}})).ok&&(r.success("地址已删除"),D())}catch(s){r.error("删除失败")}})(e._id),className:"p-2 hover:bg-red-50 rounded-lg",children:s.jsx(n,{className:"w-4 h-4 text-red-500"})})]})]})},e._id))})]})})}export{o as default};

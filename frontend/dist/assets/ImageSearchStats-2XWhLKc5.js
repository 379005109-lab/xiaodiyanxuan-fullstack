import{j as e,s}from"./index-DWFic46w.js";import{r as t}from"./react-vendor-E1AgTUZ9.js";import{aV as a,Y as l,aw as n,aO as r,an as c,f as d}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";const i={xiaohongshu:"bg-red-500",douyin:"bg-gray-900",kuaishou:"bg-orange-500",weibo:"bg-red-600",taobao:"bg-orange-600",pinterest:"bg-red-700",unknown:"bg-gray-500",none:"bg-green-500"};function x(){var x,o,m;const[h,u]=t.useState(null),[p,g]=t.useState([]),[j,y]=t.useState(!0),[N,f]=t.useState({start:"",end:""}),[b,w]=t.useState(""),[v,S]=t.useState(1),[k,U]=t.useState(0);t.useEffect(()=>{(async()=>{try{const e=new URLSearchParams;N.start&&e.append("startDate",N.start),N.end&&e.append("endDate",N.end);const t=await s.get(`/image-search/stats?${e}`);t.data.success&&u(t.data.data)}catch(e){}})(),(async()=>{try{y(!0);const e=new URLSearchParams;e.append("page",v.toString()),e.append("limit","20"),b&&e.append("source",b);const t=await s.get(`/image-search/history?${e}`);t.data.success&&(g(t.data.data),U(t.data.pagination.total))}catch(e){}finally{y(!1)}})()},[v,b,N]);return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(a,{className:"w-7 h-7 text-cyan-500"}),"ä»¥å›¾æœå›¾ç»Ÿè®¡"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"åˆ†æžç”¨æˆ·ä¸Šä¼ å›¾ç‰‡çš„æ¥æºæ¸ é“"})]}),h&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"æ€»æœç´¢æ¬¡æ•°"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:h.total})]}),e.jsx("div",{className:"w-12 h-12 bg-cyan-100 rounded-xl flex items-center justify-center",children:e.jsx(a,{className:"w-6 h-6 text-cyan-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"å°çº¢ä¹¦æ¥æº"}),e.jsx("p",{className:"text-3xl font-bold text-red-500",children:(null==(x=h.sourceStats.find(e=>"xiaohongshu"===e.source))?void 0:x.count)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"ðŸ“•"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"æŠ–éŸ³æ¥æº"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:(null==(o=h.sourceStats.find(e=>"douyin"===e.source))?void 0:o.count)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"ðŸŽµ"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Webç«¯"}),e.jsx("p",{className:"text-3xl font-bold text-blue-500",children:(null==(m=h.channelStats.find(e=>"web"===e._id))?void 0:m.count)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(l,{className:"w-6 h-6 text-blue-600"})})]})})]}),h&&h.sourceStats.length>0&&e.jsxs("div",{className:"bg-white rounded-xl p-5 shadow-sm mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"æ¥æºåˆ†å¸ƒ"}),e.jsx("div",{className:"space-y-3",children:h.sourceStats.map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${i[s.source]||"bg-gray-400"}`}),e.jsx("span",{className:"w-24 text-sm text-gray-600",children:s.sourceName}),e.jsx("div",{className:"flex-1 bg-gray-100 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full ${i[s.source]||"bg-gray-400"}`,style:{width:(h.total>0?s.count/h.total*100:0)+"%"}})}),e.jsxs("span",{className:"w-16 text-sm font-medium text-gray-900 text-right",children:[s.count,"æ¬¡"]}),e.jsxs("span",{className:"w-20 text-xs text-gray-500 text-right",children:["è½¬åŒ–",s.followUpRate,"%"]})]},s.source))})]}),e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:b,onChange:e=>w(e.target.value),className:"px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"å…¨éƒ¨æ¥æº"}),e.jsx("option",{value:"xiaohongshu",children:"å°çº¢ä¹¦"}),e.jsx("option",{value:"douyin",children:"æŠ–éŸ³"}),e.jsx("option",{value:"kuaishou",children:"å¿«æ‰‹"}),e.jsx("option",{value:"weibo",children:"å¾®åš"}),e.jsx("option",{value:"taobao",children:"æ·˜å®/å¤©çŒ«"}),e.jsx("option",{value:"unknown",children:"å…¶ä»–å¹³å°"}),e.jsx("option",{value:"none",children:"æ— æ°´å°"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"date",value:N.start,onChange:e=>f(s=>({...s,start:e.target.value})),className:"px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("span",{className:"text-gray-400",children:"è‡³"}),e.jsx("input",{type:"date",value:N.end,onChange:e=>f(s=>({...s,end:e.target.value})),className:"px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"æ—¶é—´"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"æ¥æº"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"æ°´å°ä¿¡æ¯"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"æ¸ é“"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"ç”¨æˆ·"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"åŽç»­è¡Œä¸º"})]})}),e.jsx("tbody",{className:"divide-y",children:j?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"åŠ è½½ä¸­..."})}):0===p.length?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"æš‚æ— æœç´¢è®°å½•"})}):p.map(s=>{var t,a,l,n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium text-white ${i[s.detectedSource]||"bg-gray-400"}`,children:(n=s.detectedSource,{xiaohongshu:"å°çº¢ä¹¦",douyin:"æŠ–éŸ³",kuaishou:"å¿«æ‰‹",weibo:"å¾®åš",taobao:"æ·˜å®/å¤©çŒ«",pinterest:"Pinterest",unknown:"å…¶ä»–å¹³å°",none:"æ— æ°´å°"}[n]||n)})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:(null==(t=s.watermarkDetails)?void 0:t.hasWatermark)?e.jsx("span",{className:"text-gray-900",children:s.watermarkDetails.watermarkText||"æœ‰æ°´å°"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs "+("web"===s.channel?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"),children:"web"===s.channel?"Web":"å°ç¨‹åº"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:(null==(a=s.userId)?void 0:a.nickname)||(null==(l=s.userId)?void 0:l.phone)||"æ¸¸å®¢"}),e.jsx("td",{className:"px-4 py-3",children:s.hasFollowUp?e.jsxs("span",{className:"flex items-center gap-1 text-green-600 text-sm",children:["view_product"===s.followUpAction&&e.jsx(c,{className:"w-4 h-4"}),"add_cart"===s.followUpAction&&e.jsx(d,{className:"w-4 h-4"}),"view_product"===s.followUpAction?"æŸ¥çœ‹å•†å“":"add_cart"===s.followUpAction?"åŠ å…¥è´­ç‰©è½¦":"purchase"===s.followUpAction?"è´­ä¹°":"æœ‰è¡Œä¸º"]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"-"})})]},s._id)})})]}),k>20&&e.jsxs("div",{className:"px-4 py-3 border-t flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["å…± ",k," æ¡è®°å½•"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:1===v,onClick:()=>S(e=>e-1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"ä¸Šä¸€é¡µ"}),e.jsx("button",{disabled:20*v>=k,onClick:()=>S(e=>e+1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"ä¸‹ä¸€é¡µ"})]})]})]})]})}export{x as default};

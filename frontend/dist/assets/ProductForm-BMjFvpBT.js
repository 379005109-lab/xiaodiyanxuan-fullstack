import{o as e,C as s,j as t,d as a,s as r,e as l,y as i,c as n,m as c,z as o,B as d}from"./index-DWFic46w.js";import{r as m,u as x,i as u}from"./react-vendor-E1AgTUZ9.js";import{X as p,S as h,I as g,u as b,E as f,aq as y,J as j,z as v,c as N,ar as k,ai as w,as as C}from"./ui-vendor-CQy3HONI.js";import{r as S,u as P}from"./xlsx-DSA9T5jJ.js";import{I as $}from"./ImageUploader-CVsKFz9c.js";import"./recharts-wIacPPq0.js";function U({onSelect:r,onBatchSelect:l,onClose:i,onUpdatePrices:n,multiple:c=!1,selectedMaterials:o=[],materialUpgradePrices:d={},materialType:x,skuIsPro:u=!1}){const[f,y]=m.useState([]),[j,v]=m.useState([]),[N,k]=m.useState(""),[w,C]=m.useState(""),[S,P]=m.useState(o),[$,U]=m.useState(d||{}),I={fabric:"Èù¢Êñô",filling:"Â°´ÂÖÖ",frame:"Ê°ÜÊû∂",leg:"ËÑöÊû∂",cushion:"ÂùêÂû´",armrest:"Êâ∂Êâã",backrest:"Èù†ËÉå",hardware:"‰∫îÈáë"};m.useEffect(()=>{F(),z(),P(o),U(d||{})},[o,d]),m.useEffect(()=>{if(x&&j.length>0){const e=(e=>{if(!x||0===e.length)return"";const s=I[x]||x,t=e=>{for(const a of e){if(a.name===s||a.name.includes(s))return a._id;if(a.children&&a.children.length>0){const e=t(a.children);if(e)return e}}return""};return t(e)})(j);e&&k(e)}},[x,j]);const F=async()=>{try{const s=await e(),t=Array.isArray(s)?s:[];y(t.filter(e=>"approved"===e.status))}catch(s){y([])}},z=async()=>{try{const e=await s();v(Array.isArray(e)?e:[])}catch(e){v([])}},_={"ÊôÆÈÄöÁöÆ":"ÊôÆÈÄöÁöÆÈù©ÔºåÁªèÊµéÂÆûÊÉ†ÔºåÈÄÇÂêàÊó•Â∏∏‰ΩøÁî®„ÄÇÂÖ∑ÊúâËâØÂ•ΩÁöÑËÄêÁî®ÊÄßÂíåÊòìÊ∏ÖÊ¥ÅÁâπÊÄß„ÄÇ","ÂÖ®ÈùíÁöÆ":"ÂÖ®ÈùíÁöÆÊòØÈ´òÁ∫ßÁöÆÈù©ÔºåÈááÁî®Â§©ÁÑ∂Ê§çÁâ©Èû£Âà∂Â∑•Ëâ∫ÔºåÂÖ∑ÊúâÁã¨ÁâπÁöÑË¥®ÊÑüÂíåÊ∞îÂë≥„ÄÇÈöèÁùÄ‰ΩøÁî®Êó∂Èó¥Â¢ûÈïøÔºåÈ¢úËâ≤‰ºöÈÄêÊ∏êÂä†Ê∑±ÔºåÂΩ¢ÊàêÁã¨ÁâπÁöÑÂåÖÊµÜÊïàÊûú„ÄÇ","ÁâõÁöÆ":"‰ºòË¥®ÁâõÁöÆÔºåÁ∫πÁêÜËá™ÁÑ∂ÔºåË¥®ÊÑüÁªÜËÖª„ÄÇÂÖ∑ÊúâÂæàÂ•ΩÁöÑÈÄèÊ∞îÊÄßÂíåËÄêÁ£®ÊÄß„ÄÇ","ÁªíÂ∏É":"ÊüîËΩØËàíÈÄÇÁöÑÁªíÂ∏ÉÈù¢ÊñôÔºåËß¶ÊÑüÊ∏©Êöñ„ÄÇÊòì‰∫éÊ∏ÖÊ¥ÅÔºåÈÄÇÂêàÂÆ∂Â∫≠‰ΩøÁî®„ÄÇ","È∫ªÂ∏É":"Â§©ÁÑ∂È∫ªÂ∏ÉÔºåÁéØ‰øùÈÄèÊ∞îÔºåÂÖ∑ÊúâÁã¨ÁâπÁöÑË¥®ÊÑü„ÄÇÈÄÇÂêàÁé∞‰ª£ÁÆÄÁ∫¶È£éÊ†º„ÄÇ"},A=f.filter(e=>!e.isCategory&&((!N||e.categoryId===N)&&!(w&&!e.name.toLowerCase().includes(w.toLowerCase())))),O=(e,s=0)=>{const a=[];return e.forEach(e=>{a.push(t.jsxs("option",{value:e._id,children:["¬†".repeat(4*s),e.name]},e._id)),e.children&&e.children.length>0&&a.push(...O(e.children,s+1))}),a};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h2",{className:"text-xl font-bold",children:"ÈÄâÊã©ÊùêË¥®"}),t.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600",children:t.jsx(p,{className:"h-6 w-6"})})]}),t.jsx("div",{className:"p-4 border-b bg-gray-50",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"ÂàÜÁ±ªÁ≠õÈÄâ"}),t.jsxs("select",{value:N,onChange:e=>k(e.target.value),className:"input w-full",children:[t.jsx("option",{value:"",children:"ÂÖ®ÈÉ®ÂàÜÁ±ª"}),O(j)]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"ÊêúÁ¥¢ÊùêË¥®"}),t.jsxs("div",{className:"relative",children:[t.jsx(h,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),t.jsx("input",{type:"text",value:w,onChange:e=>C(e.target.value),placeholder:"ËæìÂÖ•ÊùêË¥®ÂêçÁß∞",className:"input pl-9 w-full"})]})]})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:0===A.length?t.jsxs("div",{className:"text-center py-12 text-gray-500",children:[t.jsx("p",{children:"ÊöÇÊó†ÂèØÈÄâÊùêË¥®"}),t.jsx("p",{className:"text-sm mt-2",children:"ËØ∑ÂÖàÂú®ÊùêË¥®ÁÆ°ÁêÜ‰∏≠Ê∑ªÂä†Âπ∂ÂÆ°Ê†∏ÊùêË¥®"})]}):t.jsx("div",{className:"space-y-6",children:(()=>{const e={},s=[];return A.forEach(t=>{let a=t.name;const r=t.name.indexOf("-");r>0&&(a=t.name.substring(0,r)),e[a]||(e[a]=[],s.push(a)),e[a].push(t)}),s.map(s=>{const l=e[s]||[],n=l.map(e=>e.name).every(e=>S.includes(e));return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3 pb-3 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:s}),"other"!==s&&t.jsxs("div",{className:"group relative",children:[t.jsx(g,{className:"w-4 h-4 text-blue-500 cursor-help hover:text-blue-600"}),t.jsx("div",{className:"absolute bottom-full left-0 mb-2 hidden group-hover:block bg-gray-900 text-white text-xs rounded py-2 px-3 whitespace-nowrap z-50",children:_[s]||"ÊöÇÊó†‰ªãÁªç"})]}),c&&t.jsx("button",{onClick:()=>((e,s)=>{if(!c)return;const t=s.map(e=>e.name);if(t.every(e=>S.includes(e)))P(e=>e.filter(e=>!t.includes(e))),b.success(`Â∑≤ÂèñÊ∂àÈÄâÊã© ${e} Á±ªÂà´`);else{const s=new Set(S);t.forEach(e=>s.add(e)),P(Array.from(s)),b.success(`Â∑≤ÂÖ®ÈÄâ ${e} Á±ªÂà´ (${t.length} ‰∏™)`)}})(s,l),className:"ml-2 px-2 py-0.5 text-xs rounded border transition-colors "+(n?"bg-blue-100 text-blue-700 border-blue-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-gray-200"),children:n?"‚úì Â∑≤ÂÖ®ÈÄâ":"ÂÖ®ÈÄâ"})]}),t.jsxs("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[t.jsx("span",{className:"text-xs text-gray-500",children:"ÊâπÈáèËÆæÁΩÆ‰ª∑Ê†ºÔºö"}),t.jsxs("div",{className:"flex items-center gap-1",onClick:e=>e.stopPropagation(),children:[t.jsx("span",{className:"text-xs text-gray-600",children:"+"}),t.jsx("input",{type:"number",placeholder:"0",value:$[s]??"",onChange:e=>{e.stopPropagation();const t=parseFloat(e.target.value)||0;((e,s)=>{const t={...$,[e]:s};U(t)})(s,t)},onClick:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),onKeyUp:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),className:"w-20 px-2 py-1 border border-gray-300 rounded text-xs"}),t.jsx("span",{className:"text-xs text-gray-600",children:"ÂÖÉ"})]})]})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:e[s].map(e=>{const s=S.includes(e.name),l=e.isCategory||e.isPro&&!u;return t.jsxs("div",{onClick:()=>!l&&(e=>{!e.isPro||u?c?P(s=>s.includes(e.name)?s.filter(s=>s!==e.name):[...s,e.name]):(r(e),i(),b.success(`Â∑≤ÈÄâÊã©ÊùêË¥®Ôºö${e.name}`)):b.error("Ê≠§ÊùêË¥®‰∏∫ PRO ÊùêË¥®ÔºåÈúÄË¶ÅÂºÄÂêØ SKU ÁöÑ PRO ÂäüËÉΩÊâçËÉΩ‰ΩøÁî®")})(e),className:`border rounded-lg overflow-hidden transition-all relative ${l?"opacity-50 cursor-not-allowed bg-gray-50":"cursor-pointer hover:border-primary-500 hover:shadow-md"} ${s?"border-primary-500 bg-primary-50 ring-2 ring-primary-200":"border-gray-200"}`,children:[e.isCategory&&t.jsx("div",{className:"absolute top-2 left-2 bg-gray-500 text-white px-2 py-0.5 rounded text-xs font-bold z-20",children:"Á±ªÂà´"}),e.isPro&&!e.isCategory&&t.jsx("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white px-2 py-0.5 rounded text-xs font-bold z-20",children:"PRO"}),e.isCategory&&t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center z-15",children:t.jsx("span",{className:"text-white text-xs font-medium bg-black bg-opacity-50 px-2 py-1 rounded",children:"Á±ªÂà´‰∏çÂèØÈÄâ"})}),e.isPro&&!u&&!e.isCategory&&t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center z-15",children:t.jsx("span",{className:"text-white text-xs font-medium bg-black bg-opacity-50 px-2 py-1 rounded",children:"ÈúÄË¶ÅÂºÄÂêØ PRO"})}),c&&s&&t.jsx("div",{className:"absolute top-2 right-2 bg-primary-600 text-white rounded-full p-1 z-10",children:t.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),t.jsx("div",{className:"relative pb-[100%]",children:t.jsx("img",{src:a(e.image),alt:e.name,className:"absolute inset-0 w-full h-full object-cover",onError:e=>{e.target.src="/placeholder.svg"}})}),t.jsxs("div",{className:"p-3",children:[t.jsx("h3",{className:"font-semibold text-sm mb-1 truncate",title:e.name,children:e.name}),t.jsx("p",{className:"text-xs text-gray-500 truncate",title:e.categoryName,children:e.categoryName}),e.tags.length>0&&t.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[e.tags.slice(0,2).map((e,s)=>t.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:e},s)),e.tags.length>2&&t.jsxs("span",{className:"text-xs text-gray-400",children:["+",e.tags.length-2]})]})]})]},e._id)})})]},s)})})()})}),t.jsxs("div",{className:"flex items-center justify-end gap-4 p-4 border-t bg-gray-50",children:[t.jsxs("p",{className:"text-sm text-gray-600 mr-auto",children:["ÂÖ± ",A.length," ‰∏™ÊùêË¥®",c&&S.length>0&&t.jsxs("span",{className:"ml-2 text-primary-600",children:["Â∑≤ÈÄâÊã© ",S.length," ‰∏™"]})]}),c&&t.jsxs("button",{type:"button",onClick:()=>{if(c){if(l)l(S);else{const e=f.filter(e=>S.includes(e.name));Promise.resolve().then(()=>{e.forEach(e=>{r(e)})})}n&&n($),b.success(`Â∑≤ËÆæÁΩÆ ${S.length} ‰∏™ÊùêË¥®`),i()}},disabled:0===S.length,className:"btn-primary px-6 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:["Á°ÆËÆ§ÈÄâÊã© (",S.length,")"]}),t.jsx("button",{type:"button",onClick:i,className:"btn-secondary px-6 py-2",children:c?"ÂèñÊ∂à":"ÂÖ≥Èó≠"})]})]})})}function I({images:e,onClose:s,onSave:r}){const[l,i]=m.useState(e),[n,c]=m.useState(new Set),[o,d]=m.useState(null),[x,u]=m.useState(null),h=m.useRef(null),g=()=>{d(null),u(null),h.current=null};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"ÂõæÁâáÁÆ°ÁêÜ"}),t.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(p,{className:"w-5 h-5 text-gray-500"})})]}),t.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 bg-gray-50",children:[t.jsx("div",{className:"flex items-center gap-4",children:t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:n.size===l.length&&l.length>0,onChange:()=>{n.size===l.length?c(new Set):c(new Set(l.map((e,s)=>s)))},className:"w-4 h-4 rounded border-gray-300 text-blue-600"}),t.jsx("span",{className:"text-sm text-gray-700",children:n.size>0?`Â∑≤ÈÄâ ${n.size} Âº†`:"ÂÖ®ÈÄâ"})]})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("button",{onClick:()=>{if(0===n.size)return void b.error("ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÂõæÁâá");const e=l.filter((e,s)=>!n.has(s));i(e),c(new Set),b.success(`Â∑≤Âà†Èô§ ${n.size} Âº†ÂõæÁâá`)},disabled:0===n.size,className:"flex items-center gap-2 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[t.jsx(f,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:"Âà†Èô§"})]})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:0===l.length?t.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:t.jsx("p",{children:"ÊöÇÊó†ÂõæÁâá"})}):t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:l.map((e,s)=>t.jsxs("div",{draggable:!0,onDragStart:()=>(e=>{h.current=e,d(e)})(s),onDragEnd:g,onDragOver:e=>((e,s)=>{e.preventDefault(),u(s)})(e,s),onDrop:e=>((e,s)=>{if(e.preventDefault(),u(null),null===h.current||h.current===s)return;const t=[...l],a=t[h.current];t.splice(h.current,1),t.splice(s,0,a),i(t),h.current=s,b.success("ÂõæÁâáÈ°∫Â∫èÂ∑≤Êõ¥Êñ∞")})(e,s),className:"relative group cursor-move rounded-lg overflow-hidden border-2 transition-all "+(o===s?"opacity-50 border-blue-400":x===s?"border-blue-400 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[t.jsx("img",{src:a(e),alt:`SKU ${s+1}`,className:"w-full h-40 object-cover"}),t.jsxs("div",{className:"absolute top-2 left-2 flex items-center gap-1 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs font-medium",children:[t.jsx(y,{className:"w-3 h-3"}),t.jsx("span",{children:s+1})]}),t.jsx("div",{className:"absolute top-2 right-2",children:t.jsx("input",{type:"checkbox",checked:n.has(s),onChange:()=>(e=>{const s=new Set(n);s.has(e)?s.delete(e):s.add(e),c(s)})(s),className:"w-5 h-5 rounded border-gray-300 text-blue-600 cursor-pointer"})}),t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:t.jsx("div",{className:"flex gap-2",children:t.jsx("button",{onClick:()=>{const e=l.filter((e,t)=>t!==s);i(e),c(new Set),b.success("Â∑≤Âà†Èô§ÂõæÁâá")},className:"p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",title:"Âà†Èô§Ê≠§ÂõæÁâá",children:t.jsx(f,{className:"w-4 h-4"})})})}),n.has(s)&&t.jsx("div",{className:"absolute inset-0 border-2 border-blue-500 rounded-lg pointer-events-none"})]},s))})}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[t.jsxs("p",{className:"text-sm text-gray-600",children:["ÂÖ± ",l.length," Âº†ÂõæÁâá"]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:s,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors font-medium",children:"ÂèñÊ∂à"}),t.jsx("button",{onClick:()=>{r(l),s()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"‰øùÂ≠ò"})]})]})]})})}const F="productForm:lastCategory",z=[{key:"fabric",name:"Èù¢Êñô",color:"blue"},{key:"filling",name:"Â°´ÂÖÖ",color:"green"},{key:"frame",name:"Ê°ÜÊû∂",color:"purple"},{key:"leg",name:"ËÑöÊû∂",color:"orange"},{key:"cushion",name:"ÂùêÂû´",color:"pink"},{key:"armrest",name:"Êâ∂Êâã",color:"teal"},{key:"backrest",name:"Èù†ËÉå",color:"indigo"},{key:"hardware",name:"‰∫îÈáë",color:"gray"}],_=e=>{const s=z.find(s=>s.key===e),t={blue:{bg:"bg-blue-100",text:"text-blue-700",hover:"hover:text-blue-800"},green:{bg:"bg-green-100",text:"text-green-700",hover:"hover:text-green-800"},purple:{bg:"bg-purple-100",text:"text-purple-700",hover:"hover:text-purple-800"},orange:{bg:"bg-orange-100",text:"text-orange-700",hover:"hover:text-orange-800"},pink:{bg:"bg-pink-100",text:"text-pink-700",hover:"hover:text-pink-800"},teal:{bg:"bg-teal-100",text:"text-teal-700",hover:"hover:text-teal-800"},indigo:{bg:"bg-indigo-100",text:"text-indigo-700",hover:"hover:text-indigo-800"},gray:{bg:"bg-gray-100",text:"text-gray-700",hover:"hover:text-gray-800"}};return t[(null==s?void 0:s.color)||"gray"]||t.gray};function A(){var e,s;const a=x(),{id:h}=u(),g=!!h,[y,A]=m.useState([]),[O,E]=m.useState([]),[T,M]=m.useState(!1),[R,D]=m.useState(-1),[K,B]=m.useState("fabric"),[L,W]=m.useState(!1),[G,X]=m.useState(-1),[J,q]=m.useState(!1),[V,Y]=m.useState(-1),[H,Q]=m.useState([]),Z=m.useRef(!1),[ee,se]=m.useState({name:"",productCode:"",subCodes:[],category:"",categories:[],basePrice:0,styles:[],mainImages:[],videos:[],videoTitles:[],specifications:[{name:"2‰∫∫‰Ωç",length:200,width:90,height:85,unit:"CM"}],skus:[{id:"sku-1",images:[],code:"sku-1762",spec:"2‰∫∫‰Ωç",length:200,width:90,height:85,material:{},materialCategories:[],materialUpgradePrices:{},price:0,discountPrice:0,stock:100,sales:0,isPro:!1,proFeature:"",status:!0,manufacturerId:"",manufacturerName:""}],description:"",files:[]}),[te,ae]=m.useState({}),[re,le]=m.useState(!1);m.useEffect(()=>{(async()=>{try{const e=await n();A(e)}catch(e){}})()},[]),m.useEffect(()=>{(async()=>{try{const e=await(async()=>{try{return(await r.get("/manufacturers/all")).data.data||[]}catch(e){return[]}})();E(e)}catch(e){}})()},[]),m.useEffect(()=>{if(g||Z.current)return;if("undefined"==typeof window)return;const e=localStorage.getItem(F);e&&se(s=>({...s,category:e})),Z.current=!0},[g,y.length]);const ie=ee.skus.length,ne=ee.productCode.trim().toUpperCase();m.useEffect(()=>{ne&&0!==ie&&se(e=>{const s=ne,t=e.skus.map((e,t)=>{const a=`${s}-${String(t+1).padStart(2,"0")}`;return e.code===a?e:{...e,code:a}}),a=t.some((s,t)=>s!==e.skus[t]),r=e.productCode!==s;return a||r?{...e,productCode:s,skus:t}:e})},[ne,ie]),m.useEffect(()=>{(async()=>{var e;if(g&&h){const s=await c(h);s?se({name:s.name,productCode:(s.productCode||s._id||"").toString().toUpperCase(),subCodes:s.subCodes||[],category:"string"==typeof s.category?s.category:(null==(e=s.category)?void 0:e._id)||"",categories:s.categories||[],basePrice:s.basePrice,mainImages:(s.images||[]).filter(e=>!e.startsWith("data:")),videos:s.videos||[],videoTitles:s.videoTitles||[],specifications:s.specifications?(()=>{const e=s.specifications;return"object"==typeof e&&("sizes"in e||"materials"in e||"fills"in e)?[{name:"2‰∫∫‰Ωç",length:200,width:90,height:85,unit:"CM"}]:Object.entries(e).filter(([e,s])=>"string"==typeof s).map(([e,s])=>{const t=s.match(/(\d+)x(\d+)x(\d+)(\w+)/);return t?{name:e,length:parseInt(t[1]),width:parseInt(t[2]),height:parseInt(t[3]),unit:t[4]}:{name:e,length:0,width:0,height:0,unit:"CM"}})})():[{name:"2‰∫∫‰Ωç",length:200,width:90,height:85,unit:"CM"}],skus:s.skus.map(e=>{const s=(()=>{if("string"==typeof e.material)return e.material?{fabric:[e.material]}:{};if(!e.material)return{};const s={};return Object.entries(e.material).forEach(([e,t])=>{t&&(s[e]=Array.isArray(t)?t:[t])}),s})(),t=e.materialCategories||Object.keys(s).filter(e=>{var t;return(null==(t=s[e])?void 0:t.length)>0});return{id:e._id,images:(e.images||[]).filter(e=>!e.startsWith("data:")),code:e.code||e._id,spec:e.spec||e.color||"",length:e.length||0,width:e.width||0,height:e.height||0,material:s,materialCategories:t,materialUpgradePrices:e.materialUpgradePrices&&Object.keys(e.materialUpgradePrices).length>0?e.materialUpgradePrices:{},price:e.price,discountPrice:e.discountPrice||0,stock:e.stock,sales:0,isPro:e.isPro||!1,proFeature:e.proFeature||"",status:!0,manufacturerId:e.manufacturerId||"",manufacturerName:e.manufacturerName||""}}),description:s.description,styles:s.styles||[],files:(s.files||[]).filter(e=>!e.url||!e.url.startsWith("data:"))}):(b.error("ÂïÜÂìÅ‰∏çÂ≠òÂú®"),a("/admin/products"))}})()},[g,h,a]);const ce=e=>{const s=z.find(s=>s.key===e);return(null==s?void 0:s.name)||e};return t.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:()=>a("/admin/products"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(j,{className:"h-5 w-5"})}),t.jsx("h1",{className:"text-3xl font-bold",children:g?"ÁºñËæëÂïÜÂìÅ":"Êñ∞Âª∫ÂïÜÂìÅ"})]})}),t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Âü∫Êú¨‰ø°ÊÅØ"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-2",children:["ÂïÜÂìÅÂêçÁß∞ ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",value:ee.name,onChange:e=>se({...ee,name:e.target.value}),placeholder:"ËØ∑ËæìÂÖ•ÂïÜÂìÅÂêçÁß∞",className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"‰∏ªÂûãÂè∑"}),t.jsx("input",{type:"text",value:ee.productCode,onChange:e=>se({...ee,productCode:e.target.value.toUpperCase()}),placeholder:"ËØ∑ËæìÂÖ•‰∏ªÂûãÂè∑ÔºåÂ¶Ç: SF-2024-001",className:"input"})]}),t.jsxs("div",{className:"col-span-2",children:[t.jsxs("label",{className:"block text-sm font-medium mb-2",children:["ÂâØÂûãÂè∑ ",t.jsx("span",{className:"text-gray-500 text-xs ml-2",children:"(ÂèØÈÄâÔºåÁî®‰∫éÂÖ≥ËÅîÂÖ∂‰ªñÂûãÂè∑)"})]}),t.jsxs("div",{className:"space-y-2",children:[ee.subCodes.length>0?ee.subCodes.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",value:e,onChange:e=>{const t=[...ee.subCodes];t[s]=e.target.value.toUpperCase(),se({...ee,subCodes:t})},placeholder:`ÂâØÂûãÂè∑ ${s+1}ÔºåÂ¶Ç: SF-2024-001-A`,className:"input flex-1"}),t.jsx("button",{type:"button",onClick:()=>{const e=ee.subCodes.filter((e,t)=>t!==s);se({...ee,subCodes:e})},className:"px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg border border-red-200",children:"Âà†Èô§"})]},s)):t.jsx("p",{className:"text-sm text-gray-500",children:"ÊöÇÊó†ÂâØÂûãÂè∑ÔºåÁÇπÂáª‰∏ãÊñπÊåâÈíÆÊ∑ªÂä†"}),t.jsxs("button",{type:"button",onClick:()=>{se({...ee,subCodes:[...ee.subCodes,""]})},className:"btn-secondary px-4 py-2 flex items-center gap-2",children:[t.jsx(v,{className:"h-4 w-4"}),"Ê∑ªÂä†ÂâØÂûãÂè∑"]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"ÂïÜÂìÅÂàÜÁ±ªÔºàÂèØÂ§öÈÄâÔºâ"}),t.jsx("div",{className:"space-y-2 p-3 border rounded-lg bg-gray-50",children:y.map(e=>{var s;const a=H.includes(e._id),r=(null==(s=e.children)?void 0:s.some(e=>ee.categories.includes(e._id)))||ee.categories.includes(e._id);return t.jsxs("div",{className:"border rounded-lg bg-white overflow-hidden",children:[t.jsxs("button",{type:"button",onClick:()=>{Q(s=>s.includes(e._id)?s.filter(s=>s!==e._id):[...s,e._id])},className:"w-full px-4 py-3 flex items-center justify-between text-left transition-colors "+(r?"bg-blue-50":"hover:bg-gray-50"),children:[t.jsxs("span",{className:"font-medium text-gray-800 flex items-center gap-2",children:[e.name,r&&t.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full",children:"Â∑≤ÈÄâ"})]}),t.jsx(N,{className:"w-5 h-5 text-gray-500 transition-transform "+(a?"rotate-180":"")})]}),a&&t.jsx("div",{className:"px-4 py-3 border-t bg-gray-50",children:t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("label",{className:`\n                                px-3 py-1.5 rounded-lg border-2 cursor-pointer transition-all text-sm font-medium\n                                ${ee.categories.includes(e._id)?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-400"}\n                              `,children:[t.jsx("input",{type:"checkbox",className:"sr-only",checked:ee.categories.includes(e._id),onChange:s=>{const t=s.target.checked?[...ee.categories,e._id]:ee.categories.filter(s=>s!==e._id);se({...ee,categories:t,category:t[0]||""})}}),e.name,"ÔºàÂÖ®ÈÉ®Ôºâ"]}),e.children&&e.children.map(e=>t.jsxs("label",{className:`\n                                  px-3 py-1.5 rounded-lg border-2 cursor-pointer transition-all text-sm font-medium\n                                  ${ee.categories.includes(e._id)?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-400"}\n                                `,children:[t.jsx("input",{type:"checkbox",className:"sr-only",checked:ee.categories.includes(e._id),onChange:s=>{const t=s.target.checked?[...ee.categories,e._id]:ee.categories.filter(s=>s!==e._id);se({...ee,categories:t,category:t[0]||""})}}),e.name]},e._id))]})})]},e._id)})}),0===ee.categories.length&&t.jsx("p",{className:"text-xs text-red-500 mt-1",children:"ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™ÂàÜÁ±ª"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"ÂïÜÂìÅ‰ª∑Ê†º"}),t.jsx("input",{type:"number",value:ee.basePrice,onChange:e=>se({...ee,basePrice:parseFloat(e.target.value)}),placeholder:"ËØ∑ËæìÂÖ•ÂïÜÂìÅ‰ª∑Ê†º",className:"input"})]})]}),t.jsxs("div",{className:"mt-6",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"È£éÊ†ºÊ†áÁ≠æ"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"flex flex-wrap gap-2",children:["Áé∞‰ª£È£é","ËΩªÂ•¢È£é","ÊûÅÁÆÄÈ£é","‰∏≠Âè§È£é"].map(e=>t.jsxs("label",{className:`\n                      px-4 py-2 rounded-lg border-2 cursor-pointer transition-all\n                      ${ee.styles.includes(e)?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-300 bg-white text-gray-700 hover:border-primary-300"}\n                    `,children:[t.jsx("input",{type:"checkbox",checked:ee.styles.includes(e),onChange:s=>{s.target.checked?se({...ee,styles:[...ee.styles,e]}):se({...ee,styles:ee.styles.filter(s=>s!==e)})},className:"hidden"}),t.jsx("span",{className:"text-sm font-medium",children:e})]},e))}),ee.styles.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:ee.styles.map(e=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm",children:[e,t.jsx("button",{type:"button",onClick:()=>se({...ee,styles:ee.styles.filter(s=>s!==e)}),className:"hover:text-primary-900",children:"√ó"})]},e))}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",placeholder:"ËæìÂÖ•Ëá™ÂÆö‰πâÈ£éÊ†ºÔºåÊåâÂõûËΩ¶Ê∑ªÂä†",className:"input flex-1",onKeyPress:e=>{if("Enter"===e.key){e.preventDefault();const s=e.currentTarget,t=s.value.trim();t&&!ee.styles.includes(t)&&(se({...ee,styles:[...ee.styles,t]}),s.value="")}}}),t.jsx("button",{type:"button",onClick:e=>{const s=e.currentTarget.previousElementSibling,t=s.value.trim();t&&!ee.styles.includes(t)&&(se({...ee,styles:[...ee.styles,t]}),s.value="")},className:"btn-secondary px-4 py-2 whitespace-nowrap",children:"Ê∑ªÂä†È£éÊ†º"})]})]})]})]}),t.jsxs("div",{className:"mb-8",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"ËØ¶ÊÉÖÈ°µÂ§¥Âõæ"}),t.jsx($,{images:ee.mainImages,onChange:e=>se({...ee,mainImages:e}),multiple:!0,maxImages:10,label:"ÁÇπÂáª‰∏ä‰º†ÊàñÊãñÊãΩÂïÜÂìÅÂõæÁâáÂà∞Ê≠§Â§Ñ"})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"ÂïÜÂìÅ‰ø°ÊÅØË°®"}),t.jsxs("button",{onClick:()=>{se({...ee,specifications:[...ee.specifications,{name:"",length:0,width:0,height:0,unit:"CM"}]})},className:"text-primary-600 hover:text-primary-700 text-sm flex items-center",children:[t.jsx(v,{className:"h-4 w-4 mr-1"}),"Ê∑ªÂä†ËßÑÊ†º"]})]}),t.jsx("div",{className:"space-y-4",children:ee.specifications.map((e,s)=>t.jsxs("div",{className:"grid grid-cols-6 gap-4 items-end",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"ËßÑÊ†ºÂè∑"}),t.jsx("input",{type:"text",value:e.name,onChange:e=>{const t=[...ee.specifications];t[s].name=e.target.value,se({...ee,specifications:t})},placeholder:"2‰∫∫‰Ωç",className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Èïø"}),t.jsx("input",{type:"number",value:e.length,onChange:e=>{const t=[...ee.specifications];t[s].length=parseFloat(e.target.value),se({...ee,specifications:t})},placeholder:"Èïø",className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"ÂÆΩ"}),t.jsx("input",{type:"number",value:e.width,onChange:e=>{const t=[...ee.specifications];t[s].width=parseFloat(e.target.value),se({...ee,specifications:t})},placeholder:"ÂÆΩ",className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"È´ò"}),t.jsx("input",{type:"number",value:e.height,onChange:e=>{const t=[...ee.specifications];t[s].height=parseFloat(e.target.value),se({...ee,specifications:t})},placeholder:"È´ò",className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Âçï‰Ωç"}),t.jsxs("select",{value:e.unit,onChange:e=>{const t=[...ee.specifications];t[s].unit=e.target.value,se({...ee,specifications:t})},className:"input",children:[t.jsx("option",{value:"CM",children:"CM"}),t.jsx("option",{value:"M",children:"M"})]})]}),t.jsx("div",{children:t.jsx("button",{onClick:()=>(e=>{const s=ee.specifications.filter((s,t)=>t!==e);se({...ee,specifications:s})})(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:t.jsx(f,{className:"h-5 w-5"})})})]},s))})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"SKUÂàóË°®"}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>{if(0===ee.specifications.length)return void b.error("ËØ∑ÂÖàÊ∑ªÂä†ÂïÜÂìÅ‰ø°ÊÅØ");const e=ne||"SKU",s=ee.specifications.map((s,t)=>({id:`sku-${Date.now()}-${t}`,images:[],code:`${e}-${String(t+1).padStart(2,"0")}`,spec:s.name,length:s.length,width:s.width,height:s.height,material:{},materialCategories:[],materialUpgradePrices:{},price:ee.basePrice||0,discountPrice:0,stock:100,sales:0,isPro:!1,proFeature:"",status:!0,manufacturerId:"",manufacturerName:""}));se({...ee,skus:s}),b.success(`Â∑≤ÁîüÊàê ${s.length} ‰∏™SKU`)},className:"btn-secondary flex items-center text-sm px-4 py-2",title:"‰ªéÂïÜÂìÅ‰ø°ÊÅØË°®ÁîüÊàêSKUÂàóË°®",children:[t.jsx(k,{className:"h-4 w-4 mr-2"}),"ÁîüÊàêÂàóË°®"]}),t.jsxs("label",{className:"btn-secondary flex items-center text-sm px-4 py-2 cursor-pointer",title:"ÊâπÈáèÂØºÂÖ•ExcelÊñá‰ª∂",children:[t.jsx(w,{className:"h-4 w-4 mr-2"}),"ÂØºÂÖ•Excel",t.jsx("input",{type:"file",accept:".xlsx,.xls",className:"hidden",onChange:e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(!t)return;const a=new FileReader;a.onload=e=>{var s;try{const t=null==(s=e.target)?void 0:s.result,a=S(t,{type:"binary"}),r=a.SheetNames[0],l=a.Sheets[r],i=P.sheet_to_json(l,{header:1}),n=i[0]||[],c=(n.map(e=>(null==e?void 0:e.toString())||"").join("|"),n.some(e=>{const s=(null==e?void 0:e.toString())||"";return s.includes("Èù¢Êñô")||s.includes("Fabric")})),o=n.some(e=>{const s=(null==e?void 0:e.toString())||"";return s.includes("Â°´ÂÖÖ")||s.includes("Filling")}),d=n.some(e=>{const s=(null==e?void 0:e.toString())||"";return s.includes("Ê°ÜÊû∂")||s.includes("Frame")}),m=n.some(e=>{const s=(null==e?void 0:e.toString())||"";return s.includes("ËÑöÊû∂")||s.includes("Leg")}),x=c&&o&&d&&m||n.length>=15,u=i.slice(1).filter(e=>e.length>0);u.length>0&&u[0].forEach((e,s)=>{});const p=u.map((e,s)=>{var t,a,r,l,i,n,c,o;e[0];const d=e[1]||"",m=e[3]||"",u=((null==(t=e[4])?void 0:t.toString())||"").trim().replace(/\s+/g,"").split("*"),p=u[0]&&parseInt(u[0].replace(/[^\d]/g,""))||0,h=u[1]&&parseInt(u[1].replace(/[^\d]/g,""))||0,g=u[2]&&parseInt(u[2].replace(/[^\d]/g,""))||0;let b,f,y,j,v,N,k;const w=e=>e&&e.trim()?e.split(/[,;ÔºåÔºõ\s]+/).map(e=>e.trim()).filter(e=>e.length>0):[];b=(()=>{var s,t,a,r,l;const i={};if(x){const l=w((null==(s=e[5])?void 0:s.toString())||""),n=w((null==(t=e[6])?void 0:t.toString())||""),c=w((null==(a=e[7])?void 0:a.toString())||""),o=w((null==(r=e[8])?void 0:r.toString())||"");l.length>0&&(i.fabric=l),n.length>0&&(i.filling=n),c.length>0&&(i.frame=c),o.length>0&&(i.leg=o)}else{const s=w((null==(l=e[5])?void 0:l.toString())||"");s.length>0&&(i.fabric=s)}return i})();const C=Object.keys(b).filter(e=>{var s;return(null==(s=b[e])?void 0:s.length)>0});return x?(f=parseFloat(((null==(a=e[9])?void 0:a.toString())||"").replace(/[^\d.]/g,""))||0,y=parseFloat(((null==(r=e[10])?void 0:r.toString())||"").replace(/[^\d.]/g,""))||0,j=parseInt(e[11])||0,v=parseInt(e[12])||0,N="ÊòØ"===e[13]||"PRO"===e[13]||!1,k=((null==(l=e[14])?void 0:l.toString())||"").trim()):(f=parseFloat(((null==(i=e[6])?void 0:i.toString())||"").replace(/[^\d.]/g,""))||0,y=parseFloat(((null==(n=e[7])?void 0:n.toString())||"").replace(/[^\d.]/g,""))||0,j=parseInt(e[8])||0,v=parseInt(e[9])||0,N="ÊòØ"===e[10]||"PRO"===e[10]||!1,k=((null==(c=e[11])?void 0:c.toString())||"").trim()),{id:`sku-${Date.now()}-${s}`,images:[],code:d||`SKU-${s+1}`,spec:m,length:p,width:h,height:g,material:b,materialCategories:C,materialUpgradePrices:{},price:f,discountPrice:y,stock:j,sales:v,isPro:N,proFeature:k,status:!0,manufacturerId:"",manufacturerName:(null==(o=e[15])?void 0:o.toString())||""}});se({...ee,skus:p}),b.success(`ÊàêÂäüÂØºÂÖ• ${p.length} Êù°SKUÊï∞ÊçÆ`)}catch(t){b.error("ÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºè")}},a.readAsBinaryString(t),e.target.value=""}})]}),t.jsxs("button",{onClick:()=>{const e=(()=>{const e=ne||"SKU",s=ee.skus.map(e=>e.code).filter(s=>s.startsWith(e)).map(s=>{const t=s.match(new RegExp(`^${e}-(\\d+)$`));return t?parseInt(t[1]):0}).filter(e=>e>0),t=s.length>0?Math.max(...s)+1:1,a=String(t).padStart(2,"0");return`${e}-${a}`})();se({...ee,skus:[...ee.skus,{id:`sku-${Date.now()}`,images:[],code:e,spec:"",length:0,width:0,height:0,material:{},materialCategories:[],materialUpgradePrices:{},price:0,discountPrice:0,stock:100,sales:0,isPro:!1,proFeature:"",status:!0,manufacturerId:"",manufacturerName:""}]}),b.success(`Â∑≤Ê∑ªÂä†SKU: ${e}`)},className:"btn-primary flex items-center text-sm px-4 py-2",children:[t.jsx(v,{className:"h-4 w-4 mr-2"}),"Ê∑ªÂä†SKU"]})]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full min-w-[1200px]",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"ÂõæÁâá"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"ÂûãÂè∑"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"ËßÑÊ†º"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"Èïø(CM)"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"ÂÆΩ(CM)"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"È´ò(CM)"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium min-w-[300px]",children:"ÊùêË¥®ÈÖçÁΩÆ"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"ÈîÄ‰ª∑(ÂÖÉ)"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"ÊäòÊâ£‰ª∑(ÂÖÉ)"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"ÊòæÁ§∫‰ª∑Ê†º"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"Â∫ìÂ≠ò"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"PRO"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"ÂéÇÂÆ∂"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium",children:"Áä∂ÊÄÅ"}),t.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium",children:"Êìç‰Ωú"})]})}),t.jsx("tbody",{children:ee.skus.map((e,s)=>t.jsxs("tr",{className:"border-b border-gray-100 "+(e.isPro?"bg-amber-50":""),children:[t.jsx("td",{className:"py-3 px-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[e.images&&e.images.length>0?t.jsxs("button",{onClick:()=>{Y(s),q(!0)},className:"flex gap-1 hover:opacity-80 transition-opacity",title:"ÁÇπÂáªÁÆ°ÁêÜÂõæÁâá",children:[e.images.slice(0,3).map((e,s)=>t.jsx("div",{className:"relative w-10 h-10 group",children:t.jsx("img",{src:l(e,80),alt:`SKU ${s+1}`,className:"w-full h-full object-cover rounded border border-gray-300 cursor-pointer",loading:"lazy"})},s)),e.images.length>3&&t.jsxs("div",{className:"w-10 h-10 bg-gray-100 rounded border border-gray-300 flex items-center justify-center text-xs text-gray-500 cursor-pointer",children:["+",e.images.length-3]})]}):null,t.jsxs("label",{className:"w-10 h-10 border border-dashed border-gray-300 rounded flex items-center justify-center hover:border-primary-500 cursor-pointer flex-shrink-0",children:[t.jsx(C,{className:"h-3 w-3 text-gray-400"}),t.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:async e=>{const t=Array.from(e.target.files||[]);if(0!==t.length){b.info(`Ê≠£Âú®‰∏ä‰º† ${t.length} Âº†ÂõæÁâáÂà∞GridFS...`);try{for(const e of t){const t=await i(e);if(t.success){const e=t.data.fileId,a=[...ee.skus],r=a[s].images||[];a[s].images=[...r,e],se({...ee,skus:a})}else b.error(`${e.name} ‰∏ä‰º†Â§±Ë¥•`)}b.success(`${t.length} Âº†ÂõæÁâá‰∏ä‰º†ÊàêÂäü`)}catch(a){b.error("ÂõæÁâá‰∏ä‰º†Â§±Ë¥•ÔºåËØ∑ÈáçËØï")}e.target.value=""}}})]})]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("div",{className:"relative",children:t.jsx("input",{type:"text",value:e.code,readOnly:!0,className:"w-32 px-2 py-1 border border-gray-300 rounded bg-gray-50 text-gray-700",placeholder:"ÂûãÂè∑",title:"ÂûãÂè∑Áî±‰∏äÊñπ‚ÄúÂûãÂè∑‚ÄùÂ≠óÊÆµËá™Âä®ÁîüÊàê"})})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("select",{value:e.spec,onChange:e=>{const t=[...ee.skus];t[s].spec=e.target.value,se({...ee,skus:t})},className:"w-24 px-2 py-1 border border-gray-300 rounded",children:[t.jsx("option",{value:"",children:"ÈÄâÊã©ËßÑÊ†º"}),ee.specifications.map(e=>t.jsx("option",{value:e.name,children:e.name},e.name))]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("input",{type:"number",value:e.length,onChange:e=>{const t=[...ee.skus];t[s].length=parseFloat(e.target.value),se({...ee,skus:t})},className:"w-20 px-2 py-1 border border-gray-300 rounded"})}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("input",{type:"number",value:e.width,onChange:e=>{const t=[...ee.skus];t[s].width=parseFloat(e.target.value),se({...ee,skus:t})},className:"w-20 px-2 py-1 border border-gray-300 rounded"})}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("input",{type:"number",value:e.height,onChange:e=>{const t=[...ee.skus];t[s].height=parseFloat(e.target.value),se({...ee,skus:t})},className:"w-20 px-2 py-1 border border-gray-300 rounded"})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("div",{className:"space-y-2",children:[e.materialCategories.map(a=>{var r;const l=_(a),i=ce(a),n=e.material[a]||[],c=(null==(r=e.materialUpgradePrices)?void 0:r[a])||0;return t.jsxs("div",{className:`p-2 rounded-lg border ${l.bg} border-opacity-50`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("span",{className:`text-xs font-medium ${l.text}`,children:[i,c>0&&t.jsxs("span",{className:"ml-1 text-orange-600 font-semibold",children:["+",c,"ÂÖÉ"]})]}),t.jsx("button",{type:"button",onClick:()=>((e,s)=>{const t=[...ee.skus];t[e].materialCategories=t[e].materialCategories.filter(e=>e!==s),delete t[e].material[s],se({...ee,skus:t}),b.success(`Â∑≤ÁßªÈô§ÊùêË¥®Á±ªÁõÆÔºö${ce(s)}`)})(s,a),className:`${l.text} ${l.hover} text-xs`,title:`ÁßªÈô§${i}Á±ªÁõÆ`,children:t.jsx(p,{className:"h-3 w-3"})})]}),t.jsxs("div",{className:"flex flex-wrap gap-1",children:[n.map((e,r)=>t.jsxs("span",{className:`inline-flex items-center gap-1 px-1.5 py-0.5 ${l.bg} ${l.text} text-xs rounded`,children:[t.jsx("span",{className:"whitespace-nowrap",children:e}),t.jsx("button",{type:"button",onClick:()=>((e,s,t)=>{const a=[...ee.skus],r=a[e].material;r&&r[s]&&(r[s]=r[s].filter(e=>e!==t),0===r[s].length&&(delete r[s],a[e].materialCategories=a[e].materialCategories.filter(e=>e!==s)),a[e].materialUpgradePrices&&delete a[e].materialUpgradePrices[t],se({...ee,skus:a}))})(s,a,e),className:`${l.text} ${l.hover}`,children:t.jsx(p,{className:"h-2.5 w-2.5"})})]},r)),t.jsx("button",{type:"button",onClick:()=>{D(s),B(a),M(!0)},className:`px-1.5 py-0.5 ${l.text} text-xs hover:underline`,children:"+ Ê∑ªÂä†"})]})]},a)}),t.jsx("div",{className:"relative",children:t.jsx("button",{type:"button",onClick:()=>{X(s),W(!0)},className:"w-full px-2 py-1.5 border-2 border-dashed border-gray-300 text-gray-500 text-xs rounded-lg hover:border-primary-400 hover:text-primary-600 transition-colors",children:"+ Ê∑ªÂä†ÊùêË¥®Á±ªÁõÆ"})})]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("input",{type:"number",value:e.price,onChange:e=>{const t=[...ee.skus];t[s].price=parseFloat(e.target.value)||0,se({...ee,skus:t})},placeholder:"Âü∫Á°Ä‰ª∑Ê†º",className:"w-20 px-2 py-1 border border-gray-300 rounded "+(e.discountPrice>0?"line-through text-gray-400":"")}),e.discountPrice>0&&t.jsx("span",{className:"text-xs text-gray-500",children:"Âéü‰ª∑"}),t.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["ÊÄª‰ª∑: ¬•",(e.price||0).toFixed(2)]})]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("input",{type:"number",value:e.discountPrice,onChange:e=>{const t=[...ee.skus];t[s].discountPrice=parseFloat(e.target.value),se({...ee,skus:t})},placeholder:"0",className:"w-20 px-2 py-1 border border-gray-300 rounded"}),e.discountPrice>0&&t.jsx("span",{className:"text-xs text-red-600 font-medium",children:"ÊäòÂêé‰ª∑"})]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["¬•",(e.price||0).toFixed(2)]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("input",{type:"number",value:e.stock,onChange:e=>{const t=[...ee.skus];t[s].stock=parseInt(e.target.value),se({...ee,skus:t})},className:"w-20 px-2 py-1 border border-gray-300 rounded"})}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("div",{className:"flex flex-col gap-2",children:e.isPro?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-700 text-xs font-medium rounded-full",children:"‚≠ê PROÁâà"})}),t.jsx("input",{type:"text",value:e.proFeature,onChange:e=>{const t=[...ee.skus];t[s].proFeature=e.target.value,se({...ee,skus:t})},placeholder:"PROÁâπÊÄß",className:"w-48 px-2 py-1 text-sm border border-amber-300 rounded"})]}):t.jsxs("button",{onClick:()=>(e=>{const s=ee.skus[e],t={...s,id:`sku-${Date.now()}`,code:`${s.code}-PRO`,isPro:!0,proFeature:"È´òÁ∫ßÁâà",material:(r=s.material,r?{fabric:Array.isArray(r.fabric)?[...r.fabric]:[],filling:Array.isArray(r.filling)?[...r.filling]:[],frame:Array.isArray(r.frame)?[...r.frame]:[],leg:Array.isArray(r.leg)?[...r.leg]:[]}:{}),materialUpgradePrices:(a=s.materialUpgradePrices,a&&"object"==typeof a?{...a}:{})};var a,r;const l=[...ee.skus];l.splice(e+1,0,t),se({...ee,skus:l}),b.success("Â∑≤ÂàõÂª∫PROÁâàÊú¨SKU")})(s),className:"px-3 py-1.5 bg-amber-50 text-amber-700 hover:bg-amber-100 rounded-lg text-xs font-medium flex items-center gap-1 transition-colors",title:"Â§çÂà∂Âπ∂ÂàõÂª∫PROÁâàÊú¨",children:[t.jsx(v,{className:"h-3 w-3"}),"ÂàõÂª∫PROÁâà"]})})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("select",{value:e.manufacturerId||"",onChange:e=>{const t=[...ee.skus],a=O.find(s=>s._id===e.target.value);t[s].manufacturerId=e.target.value,t[s].manufacturerName=(null==a?void 0:a.name)||"",se({...ee,skus:t})},className:"w-28 px-2 py-1 text-sm border border-gray-300 rounded",children:[t.jsx("option",{value:"",children:"ÈÄâÊã©ÂéÇÂÆ∂"}),O.map(e=>t.jsx("option",{value:e._id,children:e.name},e._id))]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.status,onChange:e=>{const t=[...ee.skus];t[s].status=e.target.checked,se({...ee,skus:t})},className:"sr-only peer"}),t.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})}),t.jsx("td",{className:"py-3 px-4 text-right",children:t.jsx("div",{className:"flex items-center justify-end gap-2",children:t.jsx("button",{onClick:()=>(e=>{const s=ee.skus.filter((s,t)=>t!==e);se({...ee,skus:s})})(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",title:"Âà†Èô§",children:t.jsx(f,{className:"h-4 w-4"})})})})]},e.id))})]})})]}),t.jsxs("div",{className:"mb-8",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"ÂïÜÂìÅËØ¶ÊÉÖ"}),t.jsx("textarea",{value:ee.description,onChange:e=>se({...ee,description:e.target.value}),placeholder:"ËØ∑ËæìÂÖ•ÂïÜÂìÅÁöÑËØ¶ÁªÜÊèèËø∞‰ø°ÊÅØÔºåÂåÖÊã¨ÂïÜÂìÅÂèÇÊï∞„ÄÅ‰ΩøÁî®ËØ¥Êòé„ÄÅÈ¢ÜÂèñÊñπÊ≥ïÁ≠â",rows:6,className:"input resize-none"})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"ËßÜÈ¢ëÊºîÁ§∫"}),t.jsx("button",{type:"button",onClick:()=>{se({...ee,videos:[...ee.videos,""],videoTitles:[...ee.videoTitles,`${ee.name} - ËßÜÈ¢ë${ee.videos.length+1}`]})},className:"btn-secondary text-sm",children:"+ Ê∑ªÂä†ËßÜÈ¢ë"})]}),t.jsxs("div",{className:"space-y-4",children:[0===ee.videos.length?t.jsx("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50",children:t.jsx("p",{className:"text-sm text-gray-500",children:'ÊöÇÊó†ËßÜÈ¢ëÔºåÁÇπÂáª"Ê∑ªÂä†ËßÜÈ¢ë"ÊåâÈíÆÊ∑ªÂä†'})}):ee.videos.map((e,s)=>t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["ËßÜÈ¢ë ",s+1]}),t.jsx("button",{type:"button",onClick:()=>{const e=ee.videos.filter((e,t)=>t!==s),t=ee.videoTitles.filter((e,t)=>t!==s);se({...ee,videos:e,videoTitles:t})},className:"text-red-500 hover:text-red-700 text-sm",children:"Âà†Èô§"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"ËßÜÈ¢ëÊ†áÈ¢òÔºàÊòæÁ§∫Âú®ËØ¶ÊÉÖÈ°µÔºâ"}),t.jsx("input",{type:"text",placeholder:`${ee.name} - ËßÜÈ¢ë${s+1}`,value:ee.videoTitles[s]||"",onChange:e=>{const t=[...ee.videoTitles];t[s]=e.target.value,se({...ee,videoTitles:t})},className:"input w-full text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"ËßÜÈ¢ëURL"}),t.jsx("input",{type:"text",placeholder:"ËæìÂÖ•ËßÜÈ¢ëURL (ÊîØÊåÅ YouTube, Vimeo, ‰ºòÈÖ∑Á≠â)",value:e,onChange:e=>{const t=[...ee.videos];t[s]=e.target.value,se({...ee,videos:t})},className:"input w-full text-sm"})]})]})]},s)),t.jsx("p",{className:"text-xs text-gray-500",children:"üí° ËßÜÈ¢ëÂ∞ÜÂú®ÂïÜÂìÅËØ¶ÊÉÖÈ°µ‰ª•Êî∂Á∫≥ÂàóË°®ÂΩ¢ÂºèÂ±ïÁ§∫ÔºåÁÇπÂáªÂ±ïÂºÄÊí≠Êîæ"})]})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Êñá‰ª∂‰∏ä‰º†"}),t.jsxs("label",{className:"btn-primary flex items-center cursor-pointer text-sm px-4 py-2",children:[t.jsx(C,{className:"h-4 w-4 mr-2"}),"‰∏ä‰º†Êñá‰ª∂",t.jsx("input",{type:"file",accept:".dwg,.max,.fbx,.obj,.3ds,.dxf,.skp,.blend,.ma,.mb,.c4d",multiple:!0,className:"hidden",onChange:async e=>{var s;const t=Array.from(e.target.files||[]);if(0!==t.length){le(!0),b.info(`Ê≠£Âú®‰∏ä‰º† ${t.length} ‰∏™Êñá‰ª∂...`);try{for(const e of t){const t=e.name,a=await i(e,e=>{ae(s=>({...s,[t]:e}))});if(a.success){const r=a.data.fileId,l={name:e.name,url:r,format:(null==(s=e.name.split(".").pop())?void 0:s.toUpperCase())||"",size:e.size,uploadTime:(new Date).toLocaleString("zh-CN")};se(e=>({...e,files:[...e.files,l]})),ae(e=>{const s={...e};return delete s[t],s})}else b.error(`${e.name} ‰∏ä‰º†Â§±Ë¥•`)}b.success(`${t.length} ‰∏™Êñá‰ª∂‰∏ä‰º†ÊàêÂäü`)}catch(a){b.error(`Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•: ${a.message||"ËØ∑ÈáçËØï"}`)}finally{le(!1),ae({})}e.target.value=""}}})]})]}),Object.keys(te).length>0&&t.jsx("div",{className:"mt-4 space-y-2",children:Object.entries(te).map(([e,s])=>t.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:e}),t.jsxs("span",{className:"text-sm font-semibold text-blue-600",children:[s,"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${s}%`}})})]},e))}),t.jsxs("label",{className:"block cursor-pointer mb-4",children:[t.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-primary-400 hover:bg-primary-50/50 transition-colors text-center",children:[t.jsx(C,{className:"h-10 w-10 text-gray-400 mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"ÁÇπÂáªÊ≠§Â§Ñ‰∏ä‰º†ËÆæËÆ°Êñá‰ª∂"}),t.jsx("p",{className:"text-xs text-gray-400",children:"ÊîØÊåÅ DWG„ÄÅMAX„ÄÅFBX„ÄÅOBJ„ÄÅ3DS„ÄÅDXF„ÄÅSKP„ÄÅBLEND„ÄÅMA„ÄÅMB„ÄÅC4D Á≠âÊ†ºÂºè"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"ÊúÄÂ§ßÊîØÊåÅ 2GB"})]}),t.jsx("input",{type:"file",accept:".dwg,.max,.fbx,.obj,.3ds,.dxf,.skp,.blend,.ma,.mb,.c4d,.pdf",multiple:!0,className:"hidden",onChange:async e=>{var s;const t=Array.from(e.target.files||[]);if(0!==t.length){le(!0),b.info(`Ê≠£Âú®‰∏ä‰º† ${t.length} ‰∏™Êñá‰ª∂...`);try{for(const e of t){const t=e.name,a=await i(e,e=>{ae(s=>({...s,[t]:e}))});if(a.success){const r=a.data.fileId,l={name:e.name,url:r,format:(null==(s=e.name.split(".").pop())?void 0:s.toUpperCase())||"",size:e.size,uploadTime:(new Date).toLocaleString("zh-CN")};se(e=>({...e,files:[...e.files,l]})),ae(e=>{const s={...e};return delete s[t],s})}else b.error(`${e.name} ‰∏ä‰º†Â§±Ë¥•`)}b.success(`${t.length} ‰∏™Êñá‰ª∂‰∏ä‰º†ÊàêÂäü`)}catch(a){b.error(`Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•: ${a.message||"ËØ∑ÈáçËØï"}`)}finally{le(!1),ae({})}e.target.value=""}}})]}),ee.files.length>0&&t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full border border-gray-200 rounded-lg",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-700",children:"Êñá‰ª∂ÂêçÁß∞"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-700",children:"Ê†ºÂºè"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-700",children:"Â§ßÂ∞è"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-700",children:"‰∏ä‰º†Êó∂Èó¥"}),t.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-700",children:"Êìç‰Ωú"})]})}),t.jsx("tbody",{children:ee.files.map((e,s)=>t.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[t.jsx("td",{className:"py-3 px-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-2xl",children:"üìÑ"}),t.jsx("span",{className:"text-sm text-gray-900",children:e.name})]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded",children:e.format})}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:e.size>1048576?`${(e.size/1024/1024).toFixed(2)} MB`:`${(e.size/1024).toFixed(2)} KB`}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:e.uploadTime}),t.jsx("td",{className:"py-3 px-4 text-right",children:t.jsx("button",{onClick:()=>{const e=ee.files.filter((e,t)=>t!==s);se({...ee,files:e}),b.success("Êñá‰ª∂Â∑≤Âà†Èô§")},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:t.jsx(f,{className:"h-4 w-4"})})})]},s))})]})})]}),t.jsxs("div",{className:"flex justify-end space-x-4",children:[t.jsx("button",{onClick:()=>a("/admin/products"),className:"btn-secondary",children:"ÂèñÊ∂à"}),t.jsx("button",{onClick:async()=>{if(ee.name)if(0!==ee.categories.length||ee.category)if(ee.description)if(ee.basePrice<=0)b.error("ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂïÜÂìÅ‰ª∑Ê†º");else if(0!==ee.mainImages.length)try{if(ee.category&&"undefined"!=typeof window&&localStorage.setItem(F,ee.category),!ee.skus||0===ee.skus.length)return void b.error("ËØ∑Ëá≥Â∞ëÊ∑ªÂä†‰∏Ä‰∏™SKU");ee.skus.reduce((e,s)=>e+(s.images||[]).length,0),(ee.mainImages||[]).length;const e={name:ee.name,productCode:ne||ee.productCode,subCodes:ee.subCodes,description:ee.description,category:ee.category||ee.categories[0]||"",categories:ee.categories,basePrice:ee.basePrice,styles:ee.styles,images:ee.mainImages,videos:ee.videos,videoTitles:ee.videoTitles,files:ee.files,skus:ee.skus.map(e=>({...g&&e.id&&!e.id.startsWith("sku-")&&{_id:e.id},code:e.code,color:e.spec||"ÈªòËÆ§",spec:e.spec,length:e.length,width:e.width,height:e.height,material:(()=>{if("string"==typeof e.material)return{fabric:e.material?[e.material]:[]};if(!e.material)return{};const s={};return Object.entries(e.material).forEach(([e,t])=>{t&&(s[e]=Array.isArray(t)?t:[t])}),s})(),materialCategories:e.materialCategories||[],materialUpgradePrices:e.materialUpgradePrices||{},materialId:void 0,stock:e.stock,price:e.price,images:e.images||[],isPro:e.isPro,proFeature:e.proFeature,discountPrice:e.discountPrice,manufacturerId:e.manufacturerId||void 0,manufacturerName:e.manufacturerName||void 0})),isCombo:!1,specifications:ee.specifications.reduce((e,s)=>(s.name&&(e[s.name]=`${s.length}x${s.width}x${s.height}${s.unit}`),e),{}),status:"active",views:0,sales:0,rating:0,reviews:0};if(g&&h){const s=await o(h,e);s&&(s.success||s.data)?(b.success("‚úÖ ÂïÜÂìÅÂ∑≤‰øùÂ≠ò",{description:`ÂïÜÂìÅÂêçÁß∞: ${ee.name}`,duration:3e3}),setTimeout(()=>a("/admin/products"),500)):b.error("ÂïÜÂìÅÊõ¥Êñ∞Â§±Ë¥•")}else{const s=await d(e);s&&(s.success||s.data)?(b.success("‚úÖ ÂïÜÂìÅÂ∑≤ÂàõÂª∫",{description:`ÂïÜÂìÅÂêçÁß∞: ${ee.name}`,duration:3e3}),setTimeout(()=>a("/admin/products"),500)):b.error("ÂïÜÂìÅÂàõÂª∫Â§±Ë¥•")}}catch(e){e.response&&e.response.data&&e.response.data.errors?e.response.data.errors.forEach(e=>{b.error(e.message||"È™åËØÅÂ§±Ë¥•")}):b.error(e.message||"‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}else b.error("ËØ∑Ëá≥Â∞ë‰∏ä‰º†‰∏ÄÂº†ÂïÜÂìÅ‰∏ªÂõæ");else b.error("ËØ∑ËæìÂÖ•ÂïÜÂìÅÊèèËø∞");else b.error("ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™ÂïÜÂìÅÂàÜÁ±ª");else b.error("ËØ∑ËæìÂÖ•ÂïÜÂìÅÂêçÁß∞")},className:"btn-primary",children:"Á°ÆÂÆö"})]})]}),J&&V>=0&&t.jsx(I,{images:(null==(e=ee.skus[V])?void 0:e.images)||[],onClose:()=>{q(!1),Y(-1)},onSave:e=>{const s=[...ee.skus];s[V].images=e,se({...ee,skus:s})}}),T&&R>=0&&t.jsx(U,{multiple:!0,materialType:K,skuIsPro:(null==(s=ee.skus[R])?void 0:s.isPro)||!1,selectedMaterials:(()=>{const e=ee.skus[R];if(!e)return[];const s=(e.material||{})[K]||[];return Array.isArray(s)?s:s?[s]:[]})(),materialUpgradePrices:(()=>{const e=ee.skus[R];return e&&e.materialUpgradePrices?e.materialUpgradePrices:{}})(),onSelect:(e,s)=>((e,s)=>{R>=0&&se(t=>{const a=[...t.skus];a[R].material&&"string"!=typeof a[R].material||(a[R].material={});const r=a[R].material,l=r[s]||[];return a[R].materialUpgradePrices||(a[R].materialUpgradePrices={}),l.includes(e.name)||(r[s]=[...l,e.name]),{...t,skus:a}})})(e,K),onBatchSelect:e=>((e,s)=>{R>=0&&se(t=>{const a=[...t.skus];return a[R].material&&"string"!=typeof a[R].material||(a[R].material={}),a[R].material[s]=e,{...t,skus:a}})})(e,K),onUpdatePrices:e=>{if(R>=0){const s=[...ee.skus];s[R].materialUpgradePrices=e,se({...ee,skus:s})}},onClose:()=>{M(!1),D(-1),B("fabric")}}),L&&G>=0&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Ê∑ªÂä†ÊùêË¥®Á±ªÁõÆ"}),t.jsx("button",{onClick:()=>{W(!1),X(-1)},className:"text-gray-400 hover:text-gray-600",children:t.jsx(p,{className:"h-5 w-5"})})]}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"ÈÄâÊã©Ë¶ÅÊ∑ªÂä†ÁöÑÊùêË¥®Á±ªÁõÆÔºåÊ∑ªÂä†ÂêéÂèØÂú®ËØ•Á±ªÁõÆ‰∏ãÈÖçÁΩÆÂÖ∑‰ΩìÊùêË¥®ÂíåÂä†‰ª∑ËßÑÂàô"}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:z.map(e=>{var s;const a=ee.skus[G],r=null==(s=null==a?void 0:a.materialCategories)?void 0:s.includes(e.key),l=_(e.key);return t.jsxs("button",{onClick:()=>!r&&((e,s)=>{const t=[...ee.skus];t[e].materialCategories.includes(s)||(t[e].materialCategories=[...t[e].materialCategories,s],t[e].material[s]||(t[e].material[s]=[]),se({...ee,skus:t})),W(!1),X(-1),D(e),B(s),M(!0)})(G,e.key),disabled:r,className:"p-3 rounded-lg border-2 text-left transition-all "+(r?"border-gray-200 bg-gray-50 cursor-not-allowed opacity-50":`border-gray-200 hover:border-primary-400 ${l.bg} hover:shadow-md`),children:[t.jsx("span",{className:`text-sm font-medium ${r?"text-gray-400":l.text}`,children:e.name}),r&&t.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"Â∑≤Ê∑ªÂä†"})]},e.key)})}),t.jsx("div",{className:"mt-4 pt-4 border-t",children:t.jsx("button",{onClick:()=>{W(!1),X(-1)},className:"w-full btn-secondary",children:"ÂÖ≥Èó≠"})})]})})]})}export{A as default};

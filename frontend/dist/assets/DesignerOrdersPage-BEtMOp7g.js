import{k as e,j as s,f as t,v as a}from"./index-DWFic46w.js";import{r}from"./react-vendor-E1AgTUZ9.js";import{u as l,S as i,ak as c,c as n,f as d}from"./ui-vendor-CQy3HONI.js";import{m as o}from"./framer-motion-7DcRqacn.js";import"./recharts-wIacPPq0.js";function m(){const[m,x]=r.useState([]),[p,u]=r.useState(!0),[h,g]=r.useState(""),[j,N]=r.useState(""),[f,y]=r.useState(null);e(e=>e.enterConciergeMode),r.useEffect(()=>{b()},[]);const b=()=>{u(!0);try{const e=JSON.parse(localStorage.getItem("designer_orders")||"[]");x(e)}catch(e){l.error("加载订单失败")}finally{u(!1)}},v=m.filter(e=>!(h&&!e.orderNumber.includes(h)&&!e.customerName.includes(h))&&(!j||e.status===j)).sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime()),w=e=>{const t={pending:{bg:"bg-yellow-50",text:"text-yellow-700",label:"待处理"},processing:{bg:"bg-blue-50",text:"text-blue-700",label:"处理中"},completed:{bg:"bg-green-50",text:"text-green-700",label:"已完成"},cancelled:{bg:"bg-red-50",text:"text-red-700",label:"已取消"}},a=t[e]||t.pending;return s.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${a.bg} ${a.text}`,children:a.label})};return p?s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):s.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"我的订单"}),s.jsxs("p",{className:"text-gray-600 mt-1",children:["共 ",m.length," 个订单"]})]}),s.jsx("div",{className:"card",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(i,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),s.jsx("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"搜索订单号或客户名称...",className:"input pl-10 w-full"})]}),s.jsx("div",{className:"w-full md:w-40",children:s.jsxs("select",{value:j,onChange:e=>N(e.target.value),className:"input w-full",children:[s.jsx("option",{value:"",children:"所有状态"}),s.jsx("option",{value:"pending",children:"待处理"}),s.jsx("option",{value:"processing",children:"处理中"}),s.jsx("option",{value:"completed",children:"已完成"}),s.jsx("option",{value:"cancelled",children:"已取消"})]})})]})}),s.jsx("div",{className:"space-y-4",children:0===v.length?s.jsx("div",{className:"card text-center py-12",children:s.jsx("p",{className:"text-gray-600",children:"暂无订单"})}):v.map(e=>s.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[s.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>y(f===e.id?null:e.id),children:[s.jsx("div",{className:"flex-1",children:s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("div",{children:[s.jsxs("p",{className:"font-semibold text-gray-900",children:["订单号: ",e.orderNumber]}),s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["客户: ",e.customerName]})]})})}),s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-lg font-bold text-primary-600",children:t(e.totalAmount)}),s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:a(e.createdAt)})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[w(e.status),f===e.id?s.jsx(c,{className:"h-5 w-5 text-gray-400"}):s.jsx(n,{className:"h-5 w-5 text-gray-400"})]})]})]}),f===e.id&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"订单商品"}),s.jsx("div",{className:"space-y-2 mb-4",children:e.items.map((e,a)=>s.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-gray-50 rounded",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.productName}),s.jsxs("p",{className:"text-xs text-gray-600",children:["数量: ",e.quantity]})]}),s.jsx("p",{className:"font-semibold text-gray-900",children:t(e.price*e.quantity)})]},a))}),s.jsxs("button",{onClick:()=>(async e=>{const s=e.customerPhone||"13800138000",t=e.items.map((s,t)=>({id:`order-item-${e.id}-${t}`,name:s.productName,price:s.price,quantity:s.quantity,image:"/placeholder.svg"}));try{const a=await fetch("/api/concierge/session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({orderId:e.id,customerName:e.customerName,customerPhone:s,orderSource:"self",items:t})}),r=await a.json();if(!r.success)throw new Error(r.message||"创建会话失败");const i=r.data.sessionToken;l.success(`已进入代客下单模式，客户：${e.customerName}`),window.location.href=`/cart?concierge=${i}`}catch(a){l.error("进入代客下单模式失败，请重试")}})(e),className:"w-full btn-primary flex items-center justify-center gap-2",children:[s.jsx(d,{className:"h-4 w-4"}),"代客下单"]})]})]},e.id))})]})}export{m as default};

import{p as e}from"./index-DWFic46w.js";const t="auth_redirecting",s=["https://pkochbpmcgaa.sealoshzh.site/api","https://lgpzubdtdxjf.sealoshzh.site/api","https://xiaodiyanxuan.com/api","/api"],r=()=>localStorage.getItem("api_base_url")||s[0],o=t=>e.create({baseURL:t,timeout:1e4,headers:{"Content-Type":"application/json"}});let a=o(r()),n=s.indexOf(r());-1===n&&(n=0);const i=e=>{e.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),e.interceptors.response.use(t=>{const s=e.defaults.baseURL;var r;return s&&(r=s,localStorage.setItem("api_base_url",r)),t.data},async e=>{var r;if(401===(null==(r=e.response)?void 0:r.status)&&"true"!==sessionStorage.getItem(t))return sessionStorage.setItem(t,"true"),setTimeout(()=>sessionStorage.removeItem(t),5e3),localStorage.removeItem("token"),setTimeout(()=>{window.location.href="/"},100),Promise.reject(e);if((!e.response||502===e.response.status||503===e.response.status||504===e.response.status||"ERR_NETWORK"===e.code)&&(()=>{if(n++,n>=s.length)return n=0,!1;const e=s[n];return a=o(e),i(a),!0})()&&e.config)try{return await a.request(e.config)}catch(c){}return Promise.reject(e)})};i(a);const c=new Proxy(a,{get:(e,t)=>a[t]});export{c as a};

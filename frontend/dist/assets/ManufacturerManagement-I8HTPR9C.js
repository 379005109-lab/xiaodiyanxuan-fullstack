import{j as e,s}from"./index-DWFic46w.js";import{r as a}from"./react-vendor-E1AgTUZ9.js";import{aU as r,z as t,S as l,L as c,m as n,ad as i,M as o,ap as d,az as m,E as x,u}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";function p(){const[p,g]=a.useState([]),[h,y]=a.useState(!0),[b,f]=a.useState(""),[j,v]=a.useState(!1),[N,w]=a.useState(null),[k,C]=a.useState({name:"",code:"",contactName:"",contactPhone:"",contactEmail:"",address:"",description:"",status:"active"}),[S,E]=a.useState(!1),[P,z]=a.useState(!1),[_,$]=a.useState(null),[L,M]=a.useState({username:"",password:""}),U=async()=>{try{y(!0);const e=await s.get("/manufacturers",{params:{keyword:b,pageSize:100}});g(e.data.data||[])}catch(e){u.error("获取厂家列表失败")}finally{y(!1)}};a.useEffect(()=>{U()},[b]);const q=()=>{w(null),C({name:"",code:"",contactName:"",contactPhone:"",contactEmail:"",address:"",description:"",status:"active"}),v(!0)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(r,{className:"w-6 h-6"}),"厂家信息管理"]}),e.jsxs("button",{onClick:q,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(t,{className:"w-4 h-4"}),"新建厂家"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(l,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"搜索厂家名称、编码、联系人...",value:b,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary"})]})}),h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(c,{className:"w-8 h-8 animate-spin text-primary"})}):0===p.length?e.jsxs("div",{className:"text-center py-12 bg-white rounded-xl border border-gray-100",children:[e.jsx(r,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"暂无厂家数据"}),e.jsx("button",{onClick:q,className:"mt-4 text-primary hover:underline",children:"点击创建第一个厂家"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(a=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 p-5 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:a.name}),a.code&&e.jsxs("p",{className:"text-sm text-gray-500",children:["编码：",a.code]})]}),e.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("active"===a.status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"),children:"active"===a.status?"启用":"停用"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[a.contactName&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-400",children:"联系人："}),a.contactName]}),a.contactPhone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"w-3.5 h-3.5 text-gray-400"}),a.contactPhone]}),a.contactEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-3.5 h-3.5 text-gray-400"}),a.contactEmail]}),a.address&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-3.5 h-3.5 text-gray-400"}),e.jsx("span",{className:"line-clamp-1",children:a.address})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>(e=>{w(e),C({name:e.name,code:e.code||"",contactName:e.contactName||"",contactPhone:e.contactPhone||"",contactEmail:e.contactEmail||"",address:e.address||"",description:e.description||"",status:e.status}),v(!0)})(a),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 text-sm text-gray-600 hover:text-primary hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(d,{className:"w-4 h-4"}),"编辑"]}),e.jsxs("button",{onClick:()=>(e=>{$(e),M({username:e.username||e.code||"",password:""}),z(!0)})(a),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 text-sm text-gray-600 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",children:[e.jsx(m,{className:"w-4 h-4"}),"账号"]}),e.jsxs("button",{onClick:()=>(async e=>{var a,r;if(window.confirm("确定要删除这个厂家吗？"))try{await s.delete(`/manufacturers/${e}`),u.success("删除成功"),U()}catch(t){u.error((null==(r=null==(a=t.response)?void 0:a.data)?void 0:r.message)||"删除失败")}})(a._id),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 text-sm text-gray-600 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(x,{className:"w-4 h-4"}),"删除"]})]})]},a._id))}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:N?"编辑厂家":"新建厂家"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["厂家名称 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:k.name,onChange:e=>C({...k,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"请输入厂家名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"厂家编码"}),e.jsx("input",{type:"text",value:k.code,onChange:e=>C({...k,code:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"请输入厂家编码（可选）"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"联系人"}),e.jsx("input",{type:"text",value:k.contactName,onChange:e=>C({...k,contactName:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"联系人姓名"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"联系电话"}),e.jsx("input",{type:"text",value:k.contactPhone,onChange:e=>C({...k,contactPhone:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"联系电话"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"联系邮箱"}),e.jsx("input",{type:"email",value:k.contactEmail,onChange:e=>C({...k,contactEmail:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"请输入联系邮箱"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"地址"}),e.jsx("input",{type:"text",value:k.address,onChange:e=>C({...k,address:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"请输入厂家地址"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"备注说明"}),e.jsx("textarea",{value:k.description,onChange:e=>C({...k,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary resize-none",placeholder:"请输入备注说明"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"状态"}),e.jsxs("select",{value:k.status,onChange:e=>C({...k,status:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary",children:[e.jsx("option",{value:"active",children:"启用"}),e.jsx("option",{value:"inactive",children:"停用"})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-100 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:"取消"}),e.jsxs("button",{onClick:async()=>{var e,a;if(k.name.trim())try{E(!0),N?(await s.put(`/manufacturers/${N._id}`,k),u.success("更新成功")):(await s.post("/manufacturers",k),u.success("创建成功")),v(!1),U()}catch(r){u.error((null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||"操作失败")}finally{E(!1)}else u.error("请输入厂家名称")},disabled:S,className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:[S&&e.jsx(c,{className:"w-4 h-4 animate-spin"}),N?"保存修改":"创建厂家"]})]})]})}),P&&_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md mx-4",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["设置账号密码 - ",_.name]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"用户名"}),e.jsx("input",{type:"text",value:L.username,onChange:e=>M({...L,username:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"请输入登录用户名"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"密码"}),e.jsx("input",{type:"password",value:L.password,onChange:e=>M({...L,password:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"请输入密码（至少6位）"})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["设置后，厂家可通过 ",e.jsx("span",{className:"text-primary font-medium",children:"/manufacturer/login"})," 登录系统管理订单"]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-100 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>z(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:"取消"}),e.jsxs("button",{onClick:async()=>{var e,a;if(_)if(L.username.trim())if(!L.password.trim()||L.password.length<6)u.error("密码至少6位");else try{E(!0),await s.post(`/manufacturers/${_._id}/set-password`,L),u.success("账号密码设置成功"),z(!1),U()}catch(r){u.error((null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||"设置失败")}finally{E(!1)}else u.error("请输入用户名")},disabled:S,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:[S&&e.jsx(c,{className:"w-4 h-4 animate-spin"}),"保存"]})]})]})})]})}export{p as default};

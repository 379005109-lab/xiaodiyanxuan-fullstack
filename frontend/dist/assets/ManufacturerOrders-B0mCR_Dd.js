import{s as e,j as s}from"./index-DWFic46w.js";import{u as a,r as t}from"./react-vendor-E1AgTUZ9.js";import{u as r,aU as l,ar as c,i as n,a4 as i,aR as o,a1 as d,b as x}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";const m={pending:{label:"待确认",color:"bg-yellow-100 text-yellow-700",icon:s.jsx(x,{className:"w-4 h-4"})},confirmed:{label:"已确认",color:"bg-blue-100 text-blue-700",icon:s.jsx(i,{className:"w-4 h-4"})},processing:{label:"生产中",color:"bg-indigo-100 text-indigo-700",icon:s.jsx(o,{className:"w-4 h-4"})},shipped:{label:"已发货",color:"bg-purple-100 text-purple-700",icon:s.jsx(d,{className:"w-4 h-4"})},completed:{label:"已完成",color:"bg-green-100 text-green-700",icon:s.jsx(i,{className:"w-4 h-4"})}};function u(){const x=a(),[u,h]=t.useState([]),[g,p]=t.useState(!0),[j,f]=t.useState(""),[N,b]=t.useState({pending:0,confirmed:0,processing:0,shipped:0,completed:0}),[v,y]=t.useState(null),[w,k]=t.useState(!1),[S,C]=t.useState(null),[I,$]=t.useState(""),[A,_]=t.useState("顺丰速运");t.useEffect(()=>{const e=localStorage.getItem("manufacturerInfo");e&&y(JSON.parse(e)),D()},[j]);const z=()=>({Authorization:`Bearer ${localStorage.getItem("manufacturerToken")}`}),D=async()=>{var s;try{p(!0);const s=new URLSearchParams;j&&s.append("status",j);const a=await e.get(`/manufacturer-orders/manufacturer/orders?${s}`,{headers:z()});a.data.success&&(h(a.data.data),b(a.data.stats))}catch(a){401===(null==(s=a.response)?void 0:s.status)?(r.error("登录已过期，请重新登录"),L()):r.error("获取订单失败")}finally{p(!1)}},L=()=>{localStorage.removeItem("manufacturerToken"),localStorage.removeItem("manufacturerInfo"),x("/manufacturer/login")};return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-10",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-cyan-400 to-emerald-400 rounded-xl flex items-center justify-center",children:s.jsx(l,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"font-bold text-gray-900",children:(null==v?void 0:v.name)||"厂家管理系统"}),s.jsx("p",{className:"text-xs text-gray-500",children:"订单管理"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:D,className:"p-2 text-gray-500 hover:bg-gray-100 rounded-lg",children:s.jsx(c,{className:"w-5 h-5"})}),s.jsx("button",{onClick:L,className:"p-2 text-gray-500 hover:bg-gray-100 rounded-lg",children:s.jsx(n,{className:"w-5 h-5"})})]})]})}),s.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:s.jsx("div",{className:"grid grid-cols-5 gap-3",children:Object.entries(m).map(([e,a])=>s.jsxs("button",{onClick:()=>f(j===e?"":e),className:"p-4 rounded-xl text-center transition-all "+(j===e?"bg-gradient-to-br from-cyan-500 to-emerald-500 text-white shadow-lg":"bg-white hover:shadow-md"),children:[s.jsx("div",{className:"text-2xl font-bold",children:N[e]}),s.jsx("div",{className:"text-sm "+(j===e?"text-white/80":"text-gray-500"),children:a.label})]},e))})}),s.jsx("div",{className:"max-w-7xl mx-auto px-4 pb-8",children:g?s.jsx("div",{className:"text-center py-12 text-gray-500",children:"加载中..."}):0===u.length?s.jsx("div",{className:"text-center py-12 text-gray-500",children:"暂无订单"}):s.jsx("div",{className:"space-y-4",children:u.map(a=>{var t,l,c;return s.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[s.jsxs("div",{className:"px-5 py-4 border-b flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center gap-1 ${null==(t=m[a.status])?void 0:t.color}`,children:[null==(l=m[a.status])?void 0:l.icon,null==(c=m[a.status])?void 0:c.label]}),s.jsx("span",{className:"text-gray-500 text-sm",children:a.orderNo})]}),s.jsx("span",{className:"text-sm text-gray-400",children:new Date(a.createdAt).toLocaleDateString()})]}),s.jsxs("div",{className:"px-5 py-4",children:[a.items.slice(0,2).map((e,a)=>s.jsxs("div",{className:"flex gap-4 py-2",children:[e.image&&s.jsx("img",{src:e.image,className:"w-16 h-16 rounded-lg object-cover bg-gray-100",alt:""}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-gray-900 truncate",children:e.productName}),s.jsx("div",{className:"text-sm text-gray-500",children:e.specs||e.skuName}),s.jsxs("div",{className:"text-sm text-gray-500",children:["数量: ",e.quantity]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"font-semibold text-orange-600",children:["¥",e.subtotal]})})]},a)),a.items.length>2&&s.jsxs("div",{className:"text-sm text-gray-400 py-2",children:["还有 ",a.items.length-2," 件商品..."]})]}),s.jsxs("div",{className:"px-5 py-3 bg-gray-50 text-sm text-gray-600",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("span",{children:["收货人: ",a.customerName]}),s.jsx("span",{children:a.customerPhone})]}),s.jsx("div",{className:"truncate",children:a.customerAddress})]}),s.jsxs("div",{className:"px-5 py-4 border-t flex items-center justify-between",children:[s.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["合计: ",s.jsxs("span",{className:"text-orange-600",children:["¥",a.totalAmount.toFixed(2)]})]}),s.jsxs("div",{className:"flex gap-2",children:["pending"===a.status&&s.jsxs("button",{onClick:()=>(async s=>{try{(await e.post(`/manufacturer-orders/manufacturer/orders/${s._id}/confirm`,{},{headers:z()})).data.success&&(r.success("订单已确认"),D())}catch(a){r.error("操作失败")}})(a),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-1",children:[s.jsx(i,{className:"w-4 h-4"})," 确认订单"]}),"confirmed"===a.status&&s.jsxs("button",{onClick:()=>(async s=>{try{(await e.post(`/manufacturer-orders/manufacturer/orders/${s._id}/start-production`,{},{headers:z()})).data.success&&(r.success("已开始生产"),D())}catch(a){r.error("操作失败")}})(a),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-1",children:[s.jsx(o,{className:"w-4 h-4"})," 开始生产"]}),"processing"===a.status&&s.jsxs("button",{onClick:()=>(e=>{C(e),k(!0)})(a),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-1",children:[s.jsx(d,{className:"w-4 h-4"})," 发货"]}),a.trackingNo&&s.jsxs("div",{className:"text-sm text-gray-500",children:[a.trackingCompany,": ",a.trackingNo]})]})]})]},a._id)})})}),w&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"发货"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"快递公司"}),s.jsxs("select",{value:A,onChange:e=>_(e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[s.jsx("option",{value:"顺丰速运",children:"顺丰速运"}),s.jsx("option",{value:"中通快递",children:"中通快递"}),s.jsx("option",{value:"圆通快递",children:"圆通快递"}),s.jsx("option",{value:"韵达快递",children:"韵达快递"}),s.jsx("option",{value:"申通快递",children:"申通快递"}),s.jsx("option",{value:"德邦物流",children:"德邦物流"}),s.jsx("option",{value:"京东物流",children:"京东物流"}),s.jsx("option",{value:"其他",children:"其他"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"快递单号"}),s.jsx("input",{type:"text",value:I,onChange:e=>$(e.target.value),placeholder:"请输入快递单号",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>k(!1),className:"flex-1 py-2 border rounded-lg hover:bg-gray-50",children:"取消"}),s.jsx("button",{onClick:async()=>{if(S&&I)try{(await e.post(`/manufacturer-orders/manufacturer/orders/${S._id}/ship`,{trackingNo:I,trackingCompany:A},{headers:z()})).data.success&&(r.success("发货成功"),k(!1),C(null),$(""),D())}catch(s){r.error("操作失败")}else r.error("请输入快递单号")},className:"flex-1 py-2 bg-gradient-to-r from-cyan-500 to-emerald-500 text-white rounded-lg hover:from-cyan-600 hover:to-emerald-600",children:"确认发货"})]})]})})]})}export{u as default};

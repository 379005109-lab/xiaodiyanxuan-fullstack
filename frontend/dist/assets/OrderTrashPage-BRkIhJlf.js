import{j as e,f as s,d as a}from"./index-DWFic46w.js";import{r as t}from"./react-vendor-E1AgTUZ9.js";import{E as r,a as l,P as i,c,m as o,M as n,b as d,aF as x,u as m}from"./ui-vendor-CQy3HONI.js";import{m as p}from"./framer-motion-7DcRqacn.js";import"./recharts-wIacPPq0.js";const g={1:{label:"待付款",color:"bg-yellow-100 text-yellow-700"},2:{label:"待发货",color:"bg-blue-100 text-blue-700"},3:{label:"待收货",color:"bg-purple-100 text-purple-700"},4:{label:"已完成",color:"bg-green-100 text-green-700"},5:{label:"已取消",color:"bg-red-100 text-red-700"},pending:{label:"待付款",color:"bg-yellow-100 text-yellow-700"},processing:{label:"处理中",color:"bg-blue-100 text-blue-700"},paid:{label:"已付款",color:"bg-teal-100 text-teal-700"},shipped:{label:"已发货",color:"bg-purple-100 text-purple-700"},completed:{label:"已完成",color:"bg-green-100 text-green-700"},cancelled:{label:"已取消",color:"bg-red-100 text-red-700"}};function h(){const[h,b]=t.useState([]),[u,y]=t.useState(!0),[j,f]=t.useState(1),[N,v]=t.useState(1),[w,k]=t.useState(0),[S,A]=t.useState(null),z=async()=>{var e,s,a;y(!0);try{const t=localStorage.getItem("token"),r=await fetch(`https://pkochbpmcgaa.sealoshzh.site/api/orders/trash/list?page=${j}&pageSize=20`,{headers:{Authorization:`Bearer ${t}`}});if(r.ok){const t=await r.json();b((null==(e=t.data)?void 0:e.orders)||[]),k((null==(s=t.data)?void 0:s.total)||0),v((null==(a=t.data)?void 0:a.totalPages)||1)}}catch(t){m.error("加载失败")}finally{y(!1)}};t.useEffect(()=>{z()},[j]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(r,{className:"h-6 w-6 text-gray-400"}),"订单回收站"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["共 ",w," 个已删除订单"]})]})}),e.jsx("div",{className:"space-y-4",children:u?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary-600 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"加载中..."})]}):0===h.length?e.jsxs("div",{className:"text-center py-16 bg-white rounded-xl border",children:[e.jsx(r,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"回收站为空"})]}):h.map(t=>{var h,b,u,y,j,f,N,v,w,k,C;const T=S===t._id;return e.jsxs(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white rounded-xl border border-gray-200 overflow-hidden opacity-75",children:[e.jsxs("button",{onClick:()=>A(T?null:t._id),className:"w-full px-4 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 "+("package"===t.orderType?"bg-amber-100":"bg-gray-100"),children:"package"===t.orderType?e.jsx(l,{className:"h-5 w-5 text-amber-600"}):e.jsx(i,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-base text-gray-900 font-bold truncate",children:t.orderNo}),e.jsxs("p",{className:"text-sm text-gray-500",children:["删除时间: ",t.deletedAt?new Date(t.deletedAt).toLocaleString():"-"]})]})]}),e.jsx("div",{className:"text-right flex-shrink-0 mr-4",children:e.jsx("p",{className:"text-xl font-bold text-gray-400",children:s(t.totalAmount)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold whitespace-nowrap ${(null==(h=g[t.status])?void 0:h.color)||"bg-gray-100 text-gray-700"}`,children:(null==(b=g[t.status])?void 0:b.label)||t.status}),e.jsx(c,{className:"h-5 w-5 transition-transform text-gray-600 "+(T?"rotate-180":"")})]})]}),T&&e.jsxs("div",{className:"border-t border-gray-100 px-4 py-4 space-y-4",children:["package"===t.orderType&&t.packageInfo?e.jsxs("div",{className:"p-4 rounded-lg bg-amber-50 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 font-semibold mb-4 text-base",children:[e.jsx(l,{className:"h-4 w-4"})," 套餐: ",t.packageInfo.packageName]}),e.jsx("div",{className:"space-y-2",children:null==(u=t.packageInfo.selections)?void 0:u.map((s,a)=>{var t;return e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-amber-100",children:[e.jsx("p",{className:"font-semibold text-gray-800 text-sm mb-2",children:s.categoryName}),null==(t=s.products)?void 0:t.map((s,a)=>e.jsxs("div",{className:"ml-3 text-xs text-gray-600",children:[s.productName," x",s.quantity]},a))]},a)})})]}):t.items&&t.items.length>0&&e.jsx("div",{className:"p-4 rounded-lg bg-gray-50 border border-gray-100",children:e.jsx("div",{className:"space-y-2",children:t.items.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-3 bg-white rounded-lg p-2",children:[t.image&&e.jsx("img",{src:a(t.image),alt:"",className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:t.productName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["数量: ",t.quantity," × ",s(t.price)]})]})]},r))})}),e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 border border-gray-100 space-y-2",children:[((null==(y=t.recipient)?void 0:y.phone)||(null==(j=t.shippingAddress)?void 0:j.phone))&&e.jsxs("p",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[e.jsx(o,{className:"h-4 w-4 text-gray-400"}),(null==(f=t.recipient)?void 0:f.phone)||(null==(N=t.shippingAddress)?void 0:N.phone)]}),((null==(v=t.recipient)?void 0:v.address)||(null==(w=t.shippingAddress)?void 0:w.address))&&e.jsxs("p",{className:"flex items-start gap-2 text-gray-700 text-sm",children:[e.jsx(n,{className:"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-2",children:(null==(k=t.recipient)?void 0:k.address)||(null==(C=t.shippingAddress)?void 0:C.address)})]}),e.jsxs("p",{className:"flex items-center gap-2 text-gray-600 text-sm",children:[e.jsx(d,{className:"h-4 w-4 text-gray-400"}),"创建时间: ",new Date(t.createdAt).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>(async e=>{if(window.confirm("确定要恢复此订单吗？"))try{const s=localStorage.getItem("token");(await fetch(`https://pkochbpmcgaa.sealoshzh.site/api/orders/${e}/restore`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).ok?(m.success("订单已恢复"),z()):m.error("恢复失败")}catch(s){m.error("恢复失败")}})(t._id),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),"恢复订单"]}),e.jsxs("button",{onClick:()=>(async e=>{if(window.confirm("⚠️ 确定要永久删除此订单吗？此操作不可恢复！"))try{const s=localStorage.getItem("token");(await fetch(`https://pkochbpmcgaa.sealoshzh.site/api/orders/${e}/permanent`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).ok?(m.success("订单已永久删除"),z()):m.error("删除失败")}catch(s){m.error("删除失败")}})(t._id),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx(r,{className:"h-4 w-4"}),"永久删除"]})]})]})]},t._id)})}),N>1&&e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("button",{onClick:()=>f(e=>Math.max(1,e-1)),disabled:1===j,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"上一页"}),e.jsxs("span",{className:"px-4 py-2 text-gray-600",children:[j," / ",N]}),e.jsx("button",{onClick:()=>f(e=>Math.min(N,e+1)),disabled:j===N,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"下一页"})]})]})}export{h as default};

import{b as e,q as s,j as r}from"./index-DWFic46w.js";import{u as t,r as a}from"./react-vendor-E1AgTUZ9.js";import{a$ as i,b0 as l,b1 as o,X as n,a8 as c,aW as d,m as x,aV as m,U as h,i as u,u as p}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";function g({toggleSidebar:g}){const{user:b,logout:y}=e(),f=t(),[j,v]=a.useState(!1),[N,w]=a.useState(!1),[k,C]=a.useState("password"),[S,U]=a.useState(""),[$,z]=a.useState(""),[A,E]=a.useState((null==b?void 0:b.phone)||""),[R,T]=a.useState(0),[D,L]=a.useState([]);a.useEffect(()=>{const e=setTimeout(()=>{M()},500),s=()=>{M()};return window.addEventListener("notificationUpdated",s),()=>{clearTimeout(e),window.removeEventListener("notificationUpdated",s)}},[]);const M=async()=>{var e;try{if((null==(e=s)?void 0:e.notificationService)&&"function"==typeof s.notificationService.getRecentNotifications){try{const e=await s.notificationService.getRecentNotifications(10);L(e||[])}catch(r){L([])}try{const e=await s.notificationService.getUnreadCount();T(e||0)}catch(r){T(0)}}}catch(t){L([]),T(0)}},q=e=>{const s=new Date(e),r=(new Date).getTime()-s.getTime(),t=Math.floor(r/6e4),a=Math.floor(r/36e5),i=Math.floor(r/864e5);return t<1?"刚刚":t<60?`${t}分钟前`:a<24?`${a}小时前`:i<7?`${i}天前`:s.toLocaleDateString("zh-CN")};return null==b||b.role,r.jsxs("header",{className:"bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 sticky top-0 z-30",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(i,{className:"h-5 w-5 text-gray-700"})}),r.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"管理后台"})]}),r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("button",{onClick:()=>f("/"),className:"hidden md:flex items-center gap-2 px-3 py-2 text-xs font-medium text-primary-600 bg-primary-50 border border-primary-200 rounded-full hover:bg-primary-100 transition-colors",children:[r.jsx(l,{className:"h-4 w-4"})," 返回前台首页"]}),r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>v(!j),className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[r.jsx(o,{className:"h-5 w-5 text-gray-700"}),R>0&&r.jsx("span",{className:"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:R})]}),j&&r.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-100 z-50",children:[r.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:"通知"}),r.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-600",children:r.jsx(n,{className:"h-4 w-4"})})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:D.length>0?D.map(e=>r.jsxs("div",{onClick:()=>(async(e,r)=>{try{await s.notificationService.markAsRead(e),M(),r&&(f(r),v(!1))}catch(t){p.error("标记已读失败")}})(e.id,e.actionUrl),className:"px-4 py-3 border-b border-gray-50 hover:bg-gray-50 cursor-pointer transition-colors flex items-start justify-between group "+(e.read?"":"bg-blue-50"),children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.title}),!e.read&&r.jsx("span",{className:"inline-block w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:e.message}),r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:q(e.createdAt)})]}),r.jsx("button",{onClick:r=>(async(e,r)=>{r.stopPropagation();try{await s.notificationService.deleteNotification(e),M(),p.success("通知已删除")}catch(t){p.error("删除失败")}})(e.id,r),className:"ml-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:r.jsx(n,{className:"h-4 w-4"})})]},e.id)):r.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:r.jsx("p",{className:"text-sm",children:"暂无通知"})})}),D.length>0&&r.jsx("div",{className:"p-3 border-t border-gray-100 text-center",children:r.jsx("button",{onClick:async()=>{try{await s.notificationService.markAllAsRead(),M(),p.success("已标记为已读")}catch(e){p.error("标记已读失败")}},className:"text-xs text-primary-600 hover:text-primary-700 font-medium",children:"标记全部为已读"})})]})]}),r.jsxs("div",{className:"relative",children:[r.jsx("button",{onClick:()=>w(!N),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(c,{className:"h-5 w-5 text-gray-700"})}),N&&r.jsxs("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-100 z-50",children:[r.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:"用户设置"}),r.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-gray-600",children:r.jsx(n,{className:"h-4 w-4"})})]}),r.jsxs("div",{className:"flex border-b border-gray-100",children:[r.jsxs("button",{onClick:()=>C("password"),className:"flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors "+("password"===k?"border-primary-600 text-primary-600":"border-transparent text-gray-600 hover:text-gray-900"),children:[r.jsx(d,{className:"h-4 w-4 inline mr-2"}),"修改密码"]}),r.jsxs("button",{onClick:()=>C("phone"),className:"flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors "+("phone"===k?"border-primary-600 text-primary-600":"border-transparent text-gray-600 hover:text-gray-900"),children:[r.jsx(x,{className:"h-4 w-4 inline mr-2"}),"电话号码"]}),r.jsxs("button",{onClick:()=>C("avatar"),className:"flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors "+("avatar"===k?"border-primary-600 text-primary-600":"border-transparent text-gray-600 hover:text-gray-900"),children:[r.jsx(m,{className:"h-4 w-4 inline mr-2"}),"头像"]})]}),r.jsxs("div",{className:"p-4",children:["password"===k&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"新密码"}),r.jsx("input",{type:"password",value:S,onChange:e=>U(e.target.value),placeholder:"输入新密码",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"确认密码"}),r.jsx("input",{type:"password",value:$,onChange:e=>z(e.target.value),placeholder:"再次输入密码",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),r.jsx("button",{onClick:()=>{S&&$?S===$?S.length<6?p.error("密码长度至少6位"):(p.success("密码修改成功"),U(""),z(""),w(!1)):p.error("两次密码输入不一致"):p.error("请输入新密码")},className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-medium text-sm",children:"保存密码"})]}),"phone"===k&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"电话号码"}),r.jsx("input",{type:"tel",value:A,onChange:e=>E(e.target.value),placeholder:"输入电话号码",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),r.jsx("button",{onClick:()=>{A?/^1[3-9]\d{9}$/.test(A)?(p.success("电话号码修改成功"),w(!1)):p.error("请输入有效的手机号"):p.error("请输入电话号码")},className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-medium text-sm",children:"保存电话"})]}),"avatar"===k&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"flex justify-center mb-4",children:r.jsx("div",{className:"w-20 h-20 bg-primary-600 rounded-full flex items-center justify-center",children:r.jsx(h,{className:"h-10 w-10 text-white"})})}),r.jsxs("label",{className:"block",children:[r.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:()=>{p.success("头像修改成功"),w(!1)},id:"avatar-upload"}),r.jsx("button",{type:"button",onClick:()=>{const e=document.getElementById("avatar-upload");null==e||e.click()},className:"w-full px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-600 font-medium text-sm text-gray-700 hover:text-primary-600 transition-colors",children:"点击选择头像"})]})]})]})]})]}),r.jsxs("div",{className:"relative group",children:[r.jsxs("button",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[r.jsx("div",{className:"w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center",children:r.jsx(h,{className:"h-5 w-5 text-white"})}),r.jsxs("div",{className:"text-left hidden md:block",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:null==b?void 0:b.username}),r.jsx("p",{className:"text-xs text-gray-500",children:null==b?void 0:b.role})]})]}),r.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200",children:[r.jsxs("button",{onClick:()=>f("/profile"),className:"flex items-center space-x-2 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[r.jsx(h,{className:"h-4 w-4"}),r.jsx("span",{children:"个人资料"})]}),r.jsxs("button",{onClick:()=>{y(),f("/"),p.success("已退出登录")},className:"flex items-center space-x-2 w-full px-4 py-2 text-sm text-red-600 hover:bg-gray-50",children:[r.jsx(u,{className:"h-4 w-4"}),r.jsx("span",{children:"退出登录"})]})]})]})]})]})}export{g as default};

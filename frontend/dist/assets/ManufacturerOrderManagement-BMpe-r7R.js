import{j as e,s}from"./index-DWFic46w.js";import{r as t}from"./react-vendor-E1AgTUZ9.js";import{S as a,an as l,a4 as r,P as d,a1 as c,u as i}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";const x=[{value:"",label:"全部状态"},{value:"pending",label:"待确认"},{value:"confirmed",label:"已确认"},{value:"processing",label:"生产中"},{value:"shipped",label:"已发货"},{value:"completed",label:"已完成"},{value:"cancelled",label:"已取消"}],n={pending:{text:"待确认",color:"bg-yellow-100 text-yellow-800"},confirmed:{text:"已确认",color:"bg-blue-100 text-blue-800"},processing:{text:"生产中",color:"bg-indigo-100 text-indigo-800"},shipped:{text:"已发货",color:"bg-purple-100 text-purple-800"},completed:{text:"已完成",color:"bg-green-100 text-green-800"},cancelled:{text:"已取消",color:"bg-gray-100 text-gray-800"}};function m(){var m,o;const[h,p]=t.useState([]),[u,g]=t.useState(!0),[j,N]=t.useState(""),[y,b]=t.useState(""),[v,f]=t.useState(1),[w,k]=t.useState(0),[S,C]=t.useState(null),[A,_]=t.useState(!1),D=async()=>{try{g(!0);const e=new URLSearchParams;e.append("page",v.toString()),e.append("limit","20"),j&&e.append("keyword",j),y&&e.append("status",y);const t=await s.get(`/api/manufacturer-orders?${e}`);t.data.success&&(p(t.data.data),k(t.data.pagination.total))}catch(e){i.error("获取厂家订单列表失败")}finally{g(!1)}};t.useEffect(()=>{D()},[v,y]);const $=()=>{f(1),D()},L=async(e,t,a)=>{try{(await s.put(`/api/manufacturer-orders/${e}/status`,{status:t,...a})).data.success&&(i.success("状态更新成功"),D(),A&&_(!1))}catch(l){i.error("更新失败")}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"厂家订单管理"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"管理分发给各厂家的订单"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(a,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"搜索订单号/厂家名称/客户名称",value:j,onChange:e=>N(e.target.value),onKeyDown:e=>"Enter"===e.key&&$(),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),e.jsx("select",{value:y,onChange:e=>b(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:x.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("button",{onClick:$,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"搜索"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"订单号"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"厂家"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"商品"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"金额"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"状态"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"创建时间"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y",children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"加载中..."})}):0===h.length?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"暂无厂家订单"})}):h.map(s=>{var t,a;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-sm font-medium",children:s.orderNo})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-sm font-medium",children:s.manufacturerName})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"text-sm",children:[s.items.length>0&&e.jsx("span",{children:s.items[0].productName}),s.items.length>1&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["等",s.items.length,"件"]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"text-sm font-medium",children:["¥",s.totalAmount.toFixed(2)]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${null==(t=n[s.status])?void 0:t.color}`,children:null==(a=n[s.status])?void 0:a.text})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>{C(s),_(!0)},className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded",title:"查看详情",children:e.jsx(l,{className:"w-4 h-4"})})})})]},s._id)})})]}),w>20&&e.jsxs("div",{className:"px-4 py-3 border-t flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["共 ",w," 条记录"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:1===v,onClick:()=>f(e=>e-1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"上一页"}),e.jsx("button",{disabled:20*v>=w,onClick:()=>f(e=>e+1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"下一页"})]})]})]}),A&&S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold",children:"厂家订单详情"}),e.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${null==(m=n[S.status])?void 0:m.color}`,children:null==(o=n[S.status])?void 0:o.text})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"订单号"}),e.jsx("div",{className:"font-medium",children:S.orderNo})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"厂家"}),e.jsx("div",{className:"font-medium",children:S.manufacturerName})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"客户"}),e.jsx("div",{className:"font-medium",children:S.customerName}),e.jsx("div",{className:"text-sm text-gray-500",children:S.customerPhone})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"收货地址"}),e.jsx("div",{className:"text-sm",children:S.customerAddress})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"商品列表"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs text-gray-500",children:"商品"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs text-gray-500",children:"规格"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs text-gray-500",children:"单价"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs text-gray-500",children:"数量"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs text-gray-500",children:"小计"})]})}),e.jsx("tbody",{className:"divide-y",children:S.items.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.image&&e.jsx("img",{src:s.image,className:"w-10 h-10 object-cover rounded",alt:""}),e.jsx("span",{className:"text-sm",children:s.productName})]})}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-500",children:s.specs||s.skuName||"-"}),e.jsxs("td",{className:"px-3 py-2 text-sm text-right",children:["¥",s.price]}),e.jsx("td",{className:"px-3 py-2 text-sm text-right",children:s.quantity}),e.jsxs("td",{className:"px-3 py-2 text-sm text-right font-medium",children:["¥",s.subtotal]})]},t))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-3 py-2 text-right text-sm font-medium",children:"合计"}),e.jsxs("td",{className:"px-3 py-2 text-right text-lg font-bold text-orange-600",children:["¥",S.totalAmount.toFixed(2)]})]})})]})})]}),S.trackingNo&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"物流信息"}),e.jsxs("div",{className:"font-medium",children:[S.trackingCompany,": ",S.trackingNo]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"操作日志"}),e.jsx("div",{className:"space-y-2",children:S.logs.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 mt-1.5 rounded-full bg-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{children:s.content}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.operator," · ",new Date(s.createdAt).toLocaleString()]})]})]},t))})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:["pending"===S.status&&e.jsxs("button",{onClick:()=>L(S._id,"confirmed"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4"})," 确认订单"]}),"confirmed"===S.status&&e.jsxs("button",{onClick:()=>L(S._id,"processing"),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"})," 开始生产"]}),"processing"===S.status&&e.jsxs("button",{onClick:()=>{const e=prompt("请输入快递单号");e&&L(S._id,"shipped",{trackingNo:e,trackingCompany:"顺丰速运"})},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4"})," 发货"]}),"shipped"===S.status&&e.jsxs("button",{onClick:()=>L(S._id,"completed"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4"})," 完成"]}),e.jsx("button",{onClick:()=>_(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50 ml-auto",children:"关闭"})]})]})]})})]})}export{m as default};

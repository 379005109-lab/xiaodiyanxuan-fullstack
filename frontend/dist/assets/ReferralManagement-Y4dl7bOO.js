import{j as e,s as t}from"./index-DWFic46w.js";import{r as s}from"./react-vendor-E1AgTUZ9.js";import{S as a,an as l,a4 as r,aM as d,u as c}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";const n=[{value:"",label:"全部状态"},{value:"pending",label:"待跟进"},{value:"contacted",label:"已联系"},{value:"converted",label:"已成交"},{value:"rewarded",label:"已发奖"},{value:"invalid",label:"无效"}],i={pending:{text:"待跟进",color:"bg-yellow-100 text-yellow-800"},contacted:{text:"已联系",color:"bg-blue-100 text-blue-800"},converted:{text:"已成交",color:"bg-green-100 text-green-800"},rewarded:{text:"已发奖",color:"bg-purple-100 text-purple-800"},invalid:{text:"无效",color:"bg-gray-100 text-gray-800"}},x={pending:{text:"待审核",color:"bg-yellow-100 text-yellow-800"},approved:{text:"已审核",color:"bg-blue-100 text-blue-800"},paid:{text:"已发放",color:"bg-green-100 text-green-800"}};function o(){var o,m,u,p,h;const[g,j]=s.useState([]),[v,N]=s.useState(!0),[y,b]=s.useState(""),[f,w]=s.useState(""),[S,k]=s.useState(1),[C,$]=s.useState(0),[_,A]=s.useState(null),[P,D]=s.useState(!1),[R,U]=s.useState(""),[L,E]=s.useState(""),F=async()=>{try{N(!0);const e=new URLSearchParams;e.append("page",S.toString()),e.append("limit","20"),y&&e.append("keyword",y),f&&e.append("status",f);const s=await t.get(`/api/referrals?${e}`);s.data.success&&(j(s.data.data),$(s.data.pagination.total))}catch(e){c.error("获取推荐列表失败")}finally{N(!1)}};s.useEffect(()=>{F()},[S,f]);const I=()=>{k(1),F()},z=async(e,s)=>{try{(await t.put(`/api/referrals/${e}`,{status:s})).data.success&&(c.success("状态更新成功"),F(),D(!1))}catch(a){c.error("更新失败")}},K=async e=>{try{(await t.put(`/api/referrals/${e}`,{rewardStatus:"paid",status:"rewarded"})).data.success&&(c.success("奖励已发放"),F(),D(!1))}catch(s){c.error("发放失败")}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"推荐管理"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"管理客户推荐记录和奖励发放"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(a,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"搜索推荐人/被推荐人姓名或电话",value:y,onChange:e=>b(e.target.value),onKeyDown:e=>"Enter"===e.key&&I(),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),e.jsx("select",{value:f,onChange:e=>w(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:n.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("button",{onClick:I,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"搜索"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"推荐人"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"被推荐人"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"原订单"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"状态"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"奖励"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"创建时间"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y",children:v?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"加载中..."})}):0===g.length?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"暂无推荐记录"})}):g.map(t=>{var s,a,c,n,o;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm font-medium",children:t.referrerName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.referrerPhone})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm font-medium",children:t.refereeName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.refereePhone})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm",children:(null==(s=t.orderId)?void 0:s.orderNo)||"-"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["¥",t.orderAmount]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${null==(a=i[t.status])?void 0:a.color}`,children:null==(c=i[t.status])?void 0:c.text})}),e.jsx("td",{className:"px-4 py-3",children:"converted"===t.status||"rewarded"===t.status?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-green-600",children:["¥",t.rewardAmount.toFixed(2)]}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${null==(n=x[t.rewardStatus])?void 0:n.color}`,children:null==(o=x[t.rewardStatus])?void 0:o.text})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{A(t),D(!0)},className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded",title:"查看详情",children:e.jsx(l,{className:"w-4 h-4"})}),"pending"===t.status&&e.jsx("button",{onClick:()=>z(t._id,"contacted"),className:"p-1.5 text-green-600 hover:bg-green-50 rounded",title:"标记已联系",children:e.jsx(r,{className:"w-4 h-4"})}),"converted"===t.status&&"paid"!==t.rewardStatus&&e.jsx("button",{onClick:()=>K(t._id),className:"p-1.5 text-purple-600 hover:bg-purple-50 rounded",title:"发放奖励",children:e.jsx(d,{className:"w-4 h-4"})})]})})]},t._id)})})]}),C>20&&e.jsxs("div",{className:"px-4 py-3 border-t flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["共 ",C," 条记录"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:1===S,onClick:()=>k(e=>e-1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"上一页"}),e.jsx("button",{disabled:20*S>=C,onClick:()=>k(e=>e+1),className:"px-3 py-1 border rounded disabled:opacity-50",children:"下一页"})]})]})]}),P&&_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h2",{className:"text-lg font-bold",children:"推荐详情"})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"推荐人"}),e.jsx("div",{className:"font-medium",children:_.referrerName}),e.jsx("div",{className:"text-sm text-gray-500",children:_.referrerPhone})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"被推荐人"}),e.jsx("div",{className:"font-medium",children:_.refereeName}),e.jsx("div",{className:"text-sm text-gray-500",children:_.refereePhone})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"原订单"}),e.jsx("div",{className:"font-medium",children:null==(o=_.orderId)?void 0:o.orderNo}),e.jsxs("div",{className:"text-sm text-gray-500",children:["¥",_.orderAmount]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"状态"}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${null==(m=i[_.status])?void 0:m.color}`,children:null==(u=i[_.status])?void 0:u.text})]})]}),_.refereeRemark&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"推荐备注"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded text-sm",children:_.refereeRemark})]}),("converted"===_.status||"rewarded"===_.status)&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"奖励信息"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["¥",_.rewardAmount.toFixed(2)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["奖励比例: ",100*_.rewardRate,"%"]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full ${null==(p=x[_.rewardStatus])?void 0:p.color}`,children:null==(h=x[_.rewardStatus])?void 0:h.text})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"跟进记录"}),e.jsx("div",{className:"space-y-2 mb-3",children:0===_.followUpNotes.length?e.jsx("div",{className:"text-gray-400 text-sm",children:"暂无跟进记录"}):_.followUpNotes.map((t,s)=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded text-sm",children:[e.jsx("div",{children:t.content}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(t.createdAt).toLocaleString()})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"添加跟进记录...",value:R,onChange:e=>U(e.target.value),className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:async()=>{if(_&&R.trim())try{const e=await t.put(`/api/referrals/${_._id}`,{followUpNote:R.trim()});e.data.success&&(c.success("跟进记录已添加"),U(""),F(),A(e.data.data))}catch(e){c.error("添加失败")}},disabled:!R.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"添加"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:["pending"===_.status&&e.jsx("button",{onClick:()=>z(_._id,"contacted"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"标记已联系"}),"contacted"===_.status&&e.jsx("button",{onClick:()=>z(_._id,"converted"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"标记已成交"}),"converted"===_.status&&"paid"!==_.rewardStatus&&e.jsx("button",{onClick:()=>K(_._id),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"发放奖励"}),"invalid"!==_.status&&"rewarded"!==_.status&&e.jsx("button",{onClick:()=>z(_._id,"invalid"),className:"px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50",children:"标记无效"}),e.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50 ml-auto",children:"关闭"})]})]})]})})]})}export{o as default};

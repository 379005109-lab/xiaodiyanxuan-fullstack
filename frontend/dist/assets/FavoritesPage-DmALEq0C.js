import{b as e,h as s,u as t,a as r,j as a,d as o,f as i}from"./index-DWFic46w.js";import{u as l,r as n,L as c}from"./react-vendor-E1AgTUZ9.js";import{u as d,L as m,E as x,H as h,K as u,N as p,f}from"./ui-vendor-CQy3HONI.js";import"./recharts-wIacPPq0.js";function g(){const g=l(),{user:b}=e(),{openLogin:v}=s(),{favorites:j,loadFavorites:w,removeFavorite:N,clearAll:y}=t(),{addToCompare:k,clearAll:C}=r(),[F,$]=n.useState(!0),[E,L]=n.useState([]);n.useEffect(()=>{if(!b)return d.error("请先登录"),v(),void g("/");(async()=>{$(!0),await w(),$(!1)})()},[b]);const A=e=>{var s;return"string"==typeof e.product?e.product:null==(s=e.product)?void 0:s._id};return F?a.jsx("div",{className:"min-h-screen bg-[#F2F4F3] flex items-center justify-center",children:a.jsx(m,{className:"w-8 h-8 animate-spin text-primary"})}):a.jsx("div",{className:"animate-fade-in-up pb-20",children:a.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-12",children:[a.jsxs("div",{className:"flex justify-between items-end mb-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-serif font-bold text-primary mb-2",children:"我的收藏"}),a.jsxs("p",{className:"text-stone-500 uppercase tracking-widest text-xs",children:["My Favorites (",j.length,")"]})]}),j.length>0&&a.jsxs("button",{onClick:async()=>{if(window.confirm("确定要清空所有收藏吗？"))try{await y(),d.success("已清空收藏")}catch(e){d.error("操作失败")}},className:"text-sm text-stone-400 hover:text-red-500 transition-colors flex items-center gap-1 border-b border-transparent hover:border-red-500 pb-0.5",children:[a.jsx(x,{className:"w-3 h-3"})," 清空收藏"]})]}),0===j.length?a.jsxs("div",{className:"text-center py-20 bg-white rounded-2xl border border-stone-100",children:[a.jsx(h,{className:"w-16 h-16 text-stone-300 mx-auto mb-4"}),a.jsx("p",{className:"text-stone-400 font-serif italic mb-4",children:"还没有收藏任何商品"}),a.jsxs(c,{to:"/products",className:"inline-flex items-center gap-2 bg-primary text-white px-6 py-3 rounded-full hover:bg-green-900 transition-colors",children:["去逛逛 ",a.jsx(u,{className:"w-4 h-4"})]})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:j.map(e=>{var s,t,r;const l=A(e),n=e,m=n.product;return a.jsxs("div",{className:"bg-white rounded-2xl border border-stone-100 shadow-sm hover:shadow-md transition-all group overflow-hidden",children:[a.jsxs("div",{className:"relative",children:[a.jsx(c,{to:`/products/${l}`,children:a.jsx("img",{src:n.thumbnail?o(n.thumbnail):(null==(s=null==m?void 0:m.images)?void 0:s[0])?o(m.images[0]):"/placeholder.svg",alt:n.productName||(null==m?void 0:m.name)||"Product",className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300",onError:e=>{e.target.src="/placeholder.svg"}})}),a.jsx("button",{onClick:()=>(async e=>{try{await N(e),d.success("已取消收藏")}catch(s){d.error("操作失败")}})(l),className:"absolute top-3 right-3 w-8 h-8 bg-white/90 backdrop-blur rounded-full flex items-center justify-center text-red-500 hover:bg-white hover:scale-110 transition-all shadow-sm",children:a.jsx(h,{className:"w-4 h-4 fill-current"})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx(c,{to:`/products/${l}`,children:a.jsx("h3",{className:"font-bold text-primary hover:text-green-900 transition-colors line-clamp-2 mb-2",children:n.productName||(null==m?void 0:m.name)||"Product"})}),a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"font-serif font-bold text-accent",children:i(n.price||(null==(r=null==(t=null==m?void 0:m.skus)?void 0:t[0])?void 0:r.price)||0)}),a.jsxs("button",{onClick:()=>(e=>{L(s=>s.includes(e)?s.filter(s=>s!==e):s.length>=4?(d.error("最多只能对比4个商品"),s):[...s,e])})(l),className:"text-xs px-2 py-1 rounded-full transition-colors flex items-center gap-1 "+(E.includes(l)?"bg-primary text-white":"bg-stone-100 hover:bg-stone-200 text-stone-600"),children:[a.jsx(p,{className:"w-3 h-3"}),E.includes(l)?"已选":"对比"]})]}),a.jsxs("button",{onClick:()=>(e=>{const s=A(e);g(`/products/${s}?action=addToCart`),d.info("请选择规格后加入购物车")})(e),className:"w-full text-xs bg-primary hover:bg-green-900 text-white px-3 py-2 rounded-full transition-colors flex items-center justify-center gap-1",children:[a.jsx(f,{className:"w-3 h-3"})," 加入购物车"]})]})]},e._id)})}),E.length>0&&a.jsxs("div",{className:"fixed bottom-24 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-2xl border border-stone-200 px-6 py-3 flex items-center gap-4 z-[9999]",children:[a.jsxs("span",{className:"text-sm text-stone-600",children:["已选 ",E.length," 件商品"]}),a.jsx("button",{onClick:()=>L([]),className:"text-xs text-stone-400 hover:text-red-500",children:"清空"}),a.jsxs("button",{onClick:async()=>{if(E.length<2)d.error("请至少选择2个商品进行对比");else{if(!b)return d.error("请先登录后再使用对比功能"),void v();try{d.loading("正在添加到对比列表...");try{await C()}catch(e){}let s=0,t="";for(const e of E){const r=await k(e);r.success?s++:t=r.message}d.dismiss(),s>0?(d.success(`已添加 ${s} 个商品到对比列表`),g("/compare")):d.error(t||"添加对比失败，请重试")}catch(s){d.dismiss(),d.error(s.message||"添加对比失败，请检查网络连接")}}},className:"bg-primary text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-green-900 transition-colors flex items-center gap-2",children:[a.jsx(p,{className:"w-4 h-4"})," 开始对比"]})]})]})})}export{g as default};

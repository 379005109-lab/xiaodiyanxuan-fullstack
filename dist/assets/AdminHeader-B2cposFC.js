import{c as k,a as X,e as F,r as o,f as n,j as e,M as G,X as v,g as J,h as K,i as Q,k as w,l as W,m as r}from"./index-BIFKakGw.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=k("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=k("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=k("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);function te({toggleSidebar:$}){const{user:a,logout:T}=X(),d=F(),[C,h]=o.useState(!1),[S,l]=o.useState(!1),[i,u]=o.useState("password"),[x,L]=o.useState(""),[g,M]=o.useState(""),[p,z]=o.useState((a==null?void 0:a.phone)||""),[P,y]=o.useState(0),[f,b]=o.useState([]);o.useEffect(()=>{const t=setTimeout(()=>{c()},500),s=()=>{c()};return window.addEventListener("notificationUpdated",s),()=>{clearTimeout(t),window.removeEventListener("notificationUpdated",s)}},[]);const c=async()=>{var t;try{if((t=n)!=null&&t.notificationService&&typeof n.notificationService.getRecentNotifications=="function"){try{const s=await n.notificationService.getRecentNotifications(10);b(s||[])}catch{b([])}try{const s=await n.notificationService.getUnreadCount();y(s||0)}catch{y(0)}}}catch(s){console.error("加载通知失败:",s),b([]),y(0)}},R=t=>{const s=new Date(t),j=new Date().getTime()-s.getTime(),N=Math.floor(j/6e4),A=Math.floor(j/36e5),E=Math.floor(j/864e5);return N<1?"刚刚":N<60?`${N}分钟前`:A<24?`${A}小时前`:E<7?`${E}天前`:s.toLocaleDateString("zh-CN")},U=()=>{T(),d("/login")},q=()=>{if(!x||!g){r.error("请输入新密码");return}if(x!==g){r.error("两次密码输入不一致");return}if(x.length<6){r.error("密码长度至少6位");return}r.success("密码修改成功"),L(""),M(""),l(!1)},B=()=>{if(!p){r.error("请输入电话号码");return}if(!/^1[3-9]\d{9}$/.test(p)){r.error("请输入有效的手机号");return}r.success("电话号码修改成功"),l(!1)},D=()=>{r.success("头像修改成功"),l(!1)},H=async()=>{try{await n.notificationService.markAllAsRead(),c(),r.success("已标记为已读")}catch(t){console.error("标记已读失败:",t),r.error("标记已读失败")}},I=async(t,s)=>{try{await n.notificationService.markAsRead(t),c(),s&&(d(s),h(!1))}catch(m){console.error("标记已读失败:",m),r.error("标记已读失败")}},V=async(t,s)=>{s.stopPropagation();try{await n.notificationService.deleteNotification(t),c(),r.success("通知已删除")}catch(m){console.error("删除失败:",m),r.error("删除失败")}},O=(a==null?void 0:a.role)==="designer";return e.jsxs("header",{className:"bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 sticky top-0 z-30",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:$,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(G,{className:"h-5 w-5 text-gray-700"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"管理后台"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[O&&e.jsxs("button",{onClick:()=>d("/"),className:"hidden md:flex items-center gap-2 px-3 py-2 text-xs font-medium text-primary-600 bg-primary-50 border border-primary-200 rounded-full hover:bg-primary-100",children:[e.jsx(_,{className:"h-4 w-4"})," 返回前台网站"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>h(!C),className:"relative p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-700"}),P>0&&e.jsx("span",{className:"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold",children:P})]}),C&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-100 z-50",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"通知"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(v,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:f.length>0?f.map(t=>e.jsxs("div",{onClick:()=>I(t.id,t.actionUrl),className:`px-4 py-3 border-b border-gray-50 hover:bg-gray-50 cursor-pointer transition-colors flex items-start justify-between group ${t.read?"":"bg-blue-50"}`,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.title}),!t.read&&e.jsx("span",{className:"inline-block w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:t.message}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:R(t.createdAt)})]}),e.jsx("button",{onClick:s=>V(t.id,s),className:"ml-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx(v,{className:"h-4 w-4"})})]},t.id)):e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:e.jsx("p",{className:"text-sm",children:"暂无通知"})})}),f.length>0&&e.jsx("div",{className:"p-3 border-t border-gray-100 text-center",children:e.jsx("button",{onClick:H,className:"text-xs text-primary-600 hover:text-primary-700 font-medium",children:"标记全部为已读"})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>l(!S),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(J,{className:"h-5 w-5 text-gray-700"})}),S&&e.jsxs("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-100 z-50",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"用户设置"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(v,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>u("password"),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${i==="password"?"border-primary-600 text-primary-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(K,{className:"h-4 w-4 inline mr-2"}),"修改密码"]}),e.jsxs("button",{onClick:()=>u("phone"),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${i==="phone"?"border-primary-600 text-primary-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Q,{className:"h-4 w-4 inline mr-2"}),"电话号码"]}),e.jsxs("button",{onClick:()=>u("avatar"),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${i==="avatar"?"border-primary-600 text-primary-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Z,{className:"h-4 w-4 inline mr-2"}),"头像"]})]}),e.jsxs("div",{className:"p-4",children:[i==="password"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"新密码"}),e.jsx("input",{type:"password",value:x,onChange:t=>L(t.target.value),placeholder:"输入新密码",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"确认密码"}),e.jsx("input",{type:"password",value:g,onChange:t=>M(t.target.value),placeholder:"再次输入密码",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsx("button",{onClick:q,className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-medium text-sm",children:"保存密码"})]}),i==="phone"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"电话号码"}),e.jsx("input",{type:"tel",value:p,onChange:t=>z(t.target.value),placeholder:"输入电话号码",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsx("button",{onClick:B,className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-medium text-sm",children:"保存电话"})]}),i==="avatar"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-20 h-20 bg-primary-600 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"h-10 w-10 text-white"})})}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:D,id:"avatar-upload"}),e.jsx("button",{type:"button",onClick:()=>{const t=document.getElementById("avatar-upload");t==null||t.click()},className:"w-full px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary-600 font-medium text-sm text-gray-700 hover:text-primary-600 transition-colors",children:"点击选择头像"})]})]})]})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"flex items-center space-x-2 p-2 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"text-left hidden md:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a==null?void 0:a.username}),e.jsx("p",{className:"text-xs text-gray-500",children:a==null?void 0:a.role})]})]}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200",children:[e.jsxs("button",{onClick:()=>d("/profile"),className:"flex items-center space-x-2 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:"个人资料"})]}),e.jsxs("button",{onClick:U,className:"flex items-center space-x-2 w-full px-4 py-2 text-sm text-red-600 hover:bg-gray-50",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"退出登录"})]})]})]})]})]})}export{te as default};

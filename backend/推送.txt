# ğŸš€ å®Œæ•´éƒ¨ç½²æµç¨‹æŒ‡å—

**æœ€åæ›´æ–°**: 2025å¹´12æœˆ23æ—¥ 15:22 UTC

---

## ğŸ“‹ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤

å½“æ‚¨éœ€è¦éƒ¨ç½²ä»£ç æ›´æ”¹æ—¶ï¼Œåªéœ€æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

### æ­¥éª¤1ï¼šæäº¤å¹¶æ¨é€ä»£ç åˆ°Git

```bash
cd /home/devbox/project/1114/client

# æ·»åŠ æ‰€æœ‰æ›´æ”¹
git add .

# æäº¤æ›´æ”¹ï¼ˆæè¿°æ‚¨çš„ä¿®æ”¹ï¼‰
git commit -m "feat: æ‚¨çš„åŠŸèƒ½æè¿°"

# æ¨é€åˆ°teståˆ†æ”¯
git push origin test
```

### æ­¥éª¤2ï¼šç­‰å¾…GitHub Actionsæ„å»ºå®Œæˆ

- **ç›‘æ§åœ°å€**: https://github.com/379005109-lab/xiaodiyanxuan-fullstack/actions
- **ç­‰å¾…æ—¶é—´**: 5-10åˆ†é’Ÿ
- **æˆåŠŸæ ‡å¿—**: ç»¿è‰²âœ…ï¼ˆBuild Frontend å’Œ Build Backendï¼‰

### æ­¥éª¤3ï¼šé‡å¯KubernetesæœåŠ¡

```bash
export KUBECONFIG="/home/devbox/project/kubeconfig (7).yaml"

# é‡å¯å‰ç«¯å’Œåç«¯
kubectl rollout restart deployment/xiaodiyanxuan-frontend -n ns-cxxiwxce
kubectl rollout restart deployment/xiaodiyanxuan-api -n ns-cxxiwxce

# ç­‰å¾…éƒ¨ç½²å®Œæˆ
kubectl rollout status deployment/xiaodiyanxuan-api -n ns-cxxiwxce --timeout=120s
kubectl rollout status deployment/xiaodiyanxuan-frontend -n ns-cxxiwxce --timeout=120s
```

### æ­¥éª¤4ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥PodçŠ¶æ€
kubectl get pods -n ns-cxxiwxce | grep xiaodiyanxuan

# æµ‹è¯•APIå¥åº·
curl -k -s https://xuahitfkpixy.sealoshzh.site/health

# è®¿é—®ç½‘ç«™
# https://xuahitfkpixy.sealoshzh.site
```

---

## ğŸ”§ å…³é”®é…ç½®ä¿¡æ¯

### Gitä»“åº“
- **ä»“åº“**: https://github.com/379005109-lab/xiaodiyanxuan-fullstack
- **å·¥ä½œåˆ†æ”¯**: `test`
- **ä»£ç è·¯å¾„**: `/home/devbox/project/1114/client`

### GitHub Actionså·¥ä½œæµ
- **å‰ç«¯å·¥ä½œæµ**: `.github/workflows/build-frontend.yml`
- **åç«¯å·¥ä½œæµ**: `.github/workflows/build-backend.yml`
- **è§¦å‘æ¡ä»¶**: æ¨é€åˆ°`test`æˆ–`main`åˆ†æ”¯ï¼Œä¸”ä¿®æ”¹äº†`frontend/**`æˆ–`backend/**`è·¯å¾„

### GitHub Secretsé…ç½®
- **Secretåç§°**: `REGISTRY_USERNAME` / `REGISTRY_PASSWORD`
- **é…ç½®åœ°å€**: https://github.com/379005109-lab/xiaodiyanxuan-fullstack/settings/secrets/actions

### Dockeré•œåƒ
- **å‰ç«¯é•œåƒ**: `registry.sealoshzh.site/xiaodiyanxuan-frontend:test`
- **åç«¯é•œåƒ**: `registry.sealoshzh.site/xiaodiyanxuan-backend:test`

### Kubernetesé…ç½®
- **Kubeconfig**: `/home/devbox/project/kubeconfig (7).yaml`
- **å‘½åç©ºé—´**: `ns-cxxiwxce`
- **å‰ç«¯Deployment**: `xiaodiyanxuan-frontend`
- **åç«¯Deployment**: `xiaodiyanxuan-api`
- **ç½‘ç«™URL**: https://xuahitfkpixy.sealoshzh.site

---

## ğŸ”„ å®Œæ•´éƒ¨ç½²æµç¨‹å›¾

```
1. ä¿®æ”¹ä»£ç 
   â†“
2. git add . && git commit -m "..." && git push origin test
   â†“
3. GitHub Actionsè‡ªåŠ¨è§¦å‘
   â†“
4. æ„å»ºDockeré•œåƒå¹¶æ¨é€åˆ° Registry
   â†“
5. kubectl rollout restartï¼ˆé‡å¯KubernetesæœåŠ¡ï¼‰
   â†“
6. Kubernetesæ‹‰å–æ–°é•œåƒå¹¶é‡å¯Pod
   â†“
7. éƒ¨ç½²å®Œæˆï¼Œæ–°åŠŸèƒ½ç”Ÿæ•ˆ
```

---

## âš ï¸ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šGitHub Actionså¤±è´¥ - Registry è®¤è¯è¢«æ‹’ç»

**é”™è¯¯ä¿¡æ¯**: `denied: requested access to the resource is denied`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `REGISTRY_USERNAME` / `REGISTRY_PASSWORD` æ˜¯å¦åœ¨ GitHub Settings ä¸­æ­£ç¡®é…ç½®
2. ç¡®è®¤ registry è´¦å·æœ‰æ¨é€æƒé™

### é—®é¢˜2ï¼šæ¨é€åˆ°Gitä½†æ²¡æœ‰è§¦å‘GitHub Actions

**åŸå› **: å·¥ä½œæµçš„`paths`é…ç½®ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ä¿®æ”¹çš„æ–‡ä»¶åœ¨`frontend/**`æˆ–`backend/**`è·¯å¾„ä¸‹
- æˆ–è€…æ‰‹åŠ¨è§¦å‘å·¥ä½œæµï¼ˆworkflow_dispatchï¼‰

### é—®é¢˜3ï¼šKubernetes Podæ²¡æœ‰æ›´æ–°

**åŸå› **: é•œåƒæ ‡ç­¾ç›¸åŒï¼ŒKubernetesä¸ä¼šæ‹‰å–æ–°é•œåƒ

**è§£å†³æ–¹æ¡ˆ**:
```bash
kubectl rollout restart deployment/xiaodiyanxuan-frontend -n ns-cxxiwxce
kubectl rollout restart deployment/xiaodiyanxuan-api -n ns-cxxiwxce
```

### é—®é¢˜4ï¼šç½‘ç«™æ²¡æœ‰å˜åŒ–

**åŸå› **: æµè§ˆå™¨ç¼“å­˜

**è§£å†³æ–¹æ¡ˆ**:
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl+Shift+Deleteï¼‰
- å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+Shift+Rï¼‰
- ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•

---

## ğŸ“ å¿«é€Ÿéƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š
- [ ] ä»£ç å·²åœ¨æœ¬åœ°æµ‹è¯•é€šè¿‡
- [ ] Gitå·¥ä½œç›®å½•å¹²å‡€ï¼ˆ`git status`ï¼‰
- [ ] åœ¨æ­£ç¡®çš„åˆ†æ”¯ï¼ˆ`test`ï¼‰

éƒ¨ç½²ä¸­æ£€æŸ¥ï¼š
- [ ] Gitæ¨é€æˆåŠŸ
- [ ] GitHub Actionsæ˜¾ç¤ºç»¿è‰²âœ…
- [ ] é•œåƒå·²æ¨é€åˆ° Registry

éƒ¨ç½²åæ£€æŸ¥ï¼š
- [ ] Kubernetes Podå·²é‡å¯
- [ ] PodçŠ¶æ€ä¸ºRunning
- [ ] APIå¥åº·æ£€æŸ¥é€šè¿‡
- [ ] ç½‘ç«™å¯è®¿é—®
- [ ] æ–°åŠŸèƒ½å·²ç”Ÿæ•ˆ

---

## ğŸ¯ ä¸€é”®éƒ¨ç½²è„šæœ¬

åˆ›å»ºæ–‡ä»¶ `/home/devbox/project/1114/client/quick-deploy.sh`:

```bash
#!/bin/bash
set -e

echo "ğŸš€ å¼€å§‹éƒ¨ç½²æµç¨‹..."

# 1. æäº¤å¹¶æ¨é€ä»£ç 
echo "ğŸ“ æäº¤ä»£ç åˆ°Git..."
git add .
git commit -m "${1:-feat: update features}"
git push origin test

# 2. ç­‰å¾…GitHub Actions
echo "â³ ç­‰å¾…GitHub Actionsæ„å»ºï¼ˆçº¦5-10åˆ†é’Ÿï¼‰..."
echo "   ç›‘æ§åœ°å€: https://github.com/379005109-lab/xiaodiyanxuan-fullstack/actions"
echo ""
echo "   ç­‰å¾…æ„å»ºå®Œæˆåï¼ŒæŒ‰Enterç»§ç»­..."
read

# 3. é‡å¯KubernetesæœåŠ¡
echo "ğŸ”„ é‡å¯KubernetesæœåŠ¡..."
export KUBECONFIG="/home/devbox/project/kubeconfig (7).yaml"
kubectl rollout restart deployment/xiaodiyanxuan-frontend -n ns-cxxiwxce
kubectl rollout restart deployment/xiaodiyanxuan-api -n ns-cxxiwxce

# 4. ç­‰å¾…éƒ¨ç½²å®Œæˆ
echo "â³ ç­‰å¾…éƒ¨ç½²å®Œæˆ..."
kubectl rollout status deployment/xiaodiyanxuan-api -n ns-cxxiwxce --timeout=120s
kubectl rollout status deployment/xiaodiyanxuan-frontend -n ns-cxxiwxce --timeout=120s

# 5. éªŒè¯éƒ¨ç½²
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo ""
echo "ğŸ“Š PodçŠ¶æ€:"
kubectl get pods -n ns-cxxiwxce | grep xiaodiyanxuan
echo ""
echo "ğŸ§ª APIå¥åº·æ£€æŸ¥:"
curl -k -s https://xuahitfkpixy.sealoshzh.site/health
echo ""
echo ""
echo "ğŸŒ ç½‘ç«™åœ°å€: https://xuahitfkpixy.sealoshzh.site"
echo "   è¯·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åæµ‹è¯•æ–°åŠŸèƒ½"
```

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd /home/devbox/project/1114/client
chmod +x quick-deploy.sh
./quick-deploy.sh "æ‚¨çš„æäº¤ä¿¡æ¯"
```

---

## ğŸ“ ç´§æ€¥æƒ…å†µå¤„ç†

### å¦‚æœGitHub ActionsæŒç»­å¤±è´¥

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆ** - æ‰‹åŠ¨éƒ¨ç½²åˆ°è¿è¡Œä¸­çš„Pod:

```bash
# 1. æ„å»ºå‰ç«¯
cd /home/devbox/project/1114/client/frontend
npm run build

# 2. è·å–è¿è¡Œä¸­çš„Podåç§°
export KUBECONFIG="/home/devbox/project/kubeconfig (7).yaml"
FRONTEND_POD=$(kubectl get pods -n ns-cxxiwxce -l app=xiaodiyanxuan-frontend --field-selector=status.phase=Running -o jsonpath='{.items[0].metadata.name}')
API_POD=$(kubectl get pods -n ns-cxxiwxce -l app=xiaodiyanxuan-api --field-selector=status.phase=Running -o jsonpath='{.items[0].metadata.name}')

# 3. å¤åˆ¶æ–‡ä»¶åˆ°Pod
kubectl exec $FRONTEND_POD -n ns-cxxiwxce -- rm -rf /usr/share/nginx/html/assets/* /usr/share/nginx/html/index.html
kubectl cp ./frontend/dist/. ns-cxxiwxce/$FRONTEND_POD:/usr/share/nginx/html/

# 4. æ›´æ–°åç«¯APIï¼ˆå¦‚æœæœ‰ä¿®æ”¹ï¼‰
kubectl cp ./backend/src/routes/authorizations.js ns-cxxiwxce/$API_POD:/app/src/routes/authorizations.js
```

**æ³¨æ„**: è¿™ç§æ–¹å¼æ˜¯ä¸´æ—¶çš„ï¼ŒPodé‡å¯åä¼šä¸¢å¤±æ›´æ”¹ã€‚

---

## ğŸ“ éƒ¨ç½²é€»è¾‘æ€»ç»“

### Git â†’ GitHub Actions â†’ Registry â†’ Kubernetes

1. **å¼€å‘è€…æ¨é€ä»£ç ** â†’ Gitä»“åº“ï¼ˆteståˆ†æ”¯ï¼‰
2. **GitHub Actionsè§¦å‘** â†’ æ£€æµ‹åˆ°`frontend/**`æˆ–`backend/**`è·¯å¾„å˜æ›´
3. **æ„å»ºDockeré•œåƒ** â†’ æ¨é€åˆ° Registry
4. **Kubernetesæ‹‰å–é•œåƒ** â†’ ä½¿ç”¨`kubectl rollout restart`å¼ºåˆ¶æ‹‰å–æ–°é•œåƒ
5. **Podé‡å¯** â†’ ä½¿ç”¨æ–°é•œåƒå¯åŠ¨ï¼Œæ–°åŠŸèƒ½ç”Ÿæ•ˆ

### å…³é”®è¦ç´ 

- **Gitåˆ†æ”¯**: `test`ï¼ˆå¼€å‘ï¼‰æˆ–`main`ï¼ˆç”Ÿäº§ï¼‰
- **GitHub Secret**: `REGISTRY_USERNAME` / `REGISTRY_PASSWORD`ï¼ˆç”¨äºæ¨é€Dockeré•œåƒï¼‰
- **é•œåƒæ ‡ç­¾**: `test`ï¼ˆteståˆ†æ”¯ï¼‰æˆ–`latest`ï¼ˆmainåˆ†æ”¯ï¼‰
- **Kuberneteså‘½ä»¤**: `kubectl rollout restart`ï¼ˆå¼ºåˆ¶é‡å¯ï¼‰

---

**ä¿å­˜æ­¤æ–‡æ¡£ä»¥ä¾¿å°†æ¥å‚è€ƒï¼**

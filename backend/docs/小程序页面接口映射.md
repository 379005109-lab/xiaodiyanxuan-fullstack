# 小程序页面与后端接口映射文档

> **生成时间**: 2026-02-10  
> **说明**: 本文档梳理小程序（`/miniapp`）各页面所调用的后端接口，便于前后端联调与维护。

---

## 目录

1. [API 函数与后端接口总表](#1-api-函数与后端接口总表)
2. [各页面调用接口明细](#2-各页面调用接口明细)
3. [无 API 调用的页面](#3-无-api-调用的页面)
4. [后端路由文件归属](#4-后端路由文件归属)

---

## 1. API 函数与后端接口总表

### 1.1 配置说明

| 配置项 | 值 | 说明 |
|--------|------|------|
| baseURL | `http://localhost:8080`（开发） | 后端服务地址 |
| miniappPrefix (MP) | `/api/miniapp` | 小程序专用接口前缀 |
| apiPrefix (AP) | `/api` | 通用接口前缀 |

### 1.2 完整接口映射

#### 用户认证

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `wxLogin(code)` | POST | `/api/miniapp/auth/wxlogin` | 否 | `miniapp.js` |
| `accountLogin(account, password)` | POST | `/api/miniapp/auth/login` | 否 | `miniapp.js` |
| `sendSmsCode(phone)` | POST | `/api/miniapp/auth/send-code` | 否 | `miniapp.js` |
| `phoneLogin(phone, code)` | POST | `/api/miniapp/auth/phone-login` | 否 | `miniapp.js` |

#### 用户信息

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getUserInfo()` | GET | `/api/miniapp/user/info` | 是 | `miniapp.js` |
| `updateProfile(data)` | PUT | `/api/miniapp/user/update` | 是 | `miniapp.js` |

#### 首页 & 基础数据

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getHomeData()` | GET | `/api/miniapp/home` | 否 | `miniapp.js` |
| `getStyles()` | GET | `/api/miniapp/styles` | 否 | `miniapp.js` |
| `getCategories()` | GET | `/api/miniapp/categories` | 否 | `miniapp.js` |

#### 商品

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getGoodsList(params)` | GET | `/api/miniapp/goods/list` | 否 | `miniapp.js` |
| `getGoodsDetail(id)` | GET | `/api/miniapp/goods/:id` | 否 | `miniapp.js` |
| `searchGoods(keyword, params)` | GET | `/api/miniapp/goods/search` | 否 | `miniapp.js` |
| `getRecommendations(params)` | GET | `/api/miniapp/recommendations` | 否 | `miniapp.js` |

#### 收藏

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getFavorites()` | GET | `/api/favorites` | 是 | `favorites.js` |
| `addFavorite(productId)` | POST | `/api/favorites` | 是 | `favorites.js` |
| `removeFavorite(id)` | DELETE | `/api/favorites/:id` | 是 | `favorites.js` |
| `checkFavorite(productId)` | GET | `/api/favorites/check/:productId` | 是 | `favorites.js` |

#### 购物车

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getCart()` | GET | `/api/cart` | 是 | `cart.js` |
| `addToCart(data)` | POST | `/api/cart` | 是 | `cart.js` |
| `updateCartItem(cartId, data)` | PUT | `/api/cart/:cartId` | 是 | `cart.js` |
| `removeCartItem(cartId)` | DELETE | `/api/cart/:cartId` | 是 | `cart.js` |
| `clearCart()` | DELETE | `/api/cart/clear` | 是 | `cart.js` |

#### 订单

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `createOrder(orderData)` | POST | `/api/miniapp/orders` | 是 | `miniapp.js` |
| `createOrderV2(data)` | POST | `/api/miniapp/orders/v2` | 是 | `miniapp-extra.js` |
| `getOrders(params)` | GET | `/api/miniapp/orders` | 是 | `miniapp.js` |
| `getOrderDetail(orderId)` | GET | `/api/miniapp/orders/:orderId` | 是 | `miniapp.js` |
| `cancelOrder(orderId, reason)` | POST | `/api/miniapp/orders/:orderId/cancel` | 是 | `miniapp.js` |
| `confirmOrder(orderId)` | POST | `/api/miniapp/orders/:orderId/confirm` | 是 | `miniapp.js` |

#### 套餐

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getPackages(params)` | GET | `/api/miniapp/packages` | 否 | `miniapp.js` |
| `getPackageDetail(id)` | GET | `/api/miniapp/packages/:id` | 否 | `miniapp.js` |

#### 砍价

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getBargainList(params)` | GET | `/api/miniapp/bargains` | 否 | `miniapp-bargain.js` |
| `getBargainDetail(id)` | GET | `/api/miniapp/bargains/:id` | 否 | `miniapp-bargain.js` |
| `startBargain(data)` | POST | `/api/miniapp/bargains` | 是 | `miniapp-bargain.js` |
| `getMyBargains()` | GET | `/api/miniapp/bargains/my` | 是 | `miniapp-bargain.js` |
| `helpBargain(bargainId)` | POST | `/api/miniapp/bargains/:id/help` | 是 | `miniapp-bargain.js` |
| `cancelBargain(bargainId)` | DELETE | `/api/miniapp/bargains/:id` | 是 | `miniapp-bargain.js` |

#### 地址

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getAddresses()` | GET | `/api/addresses` | 是 | `addresses.js` |
| `addAddress(data)` | POST | `/api/addresses` | 是 | `addresses.js` |
| `updateAddress(id, data)` | PUT | `/api/addresses/:id` | 是 | `addresses.js` |
| `deleteAddress(id)` | DELETE | `/api/addresses/:id` | 是 | `addresses.js` |
| `setDefaultAddress(id)` | PUT | `/api/addresses/:id/default` | 是 | `addresses.js` |

#### 优惠券

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getCoupons(params)` | GET | `/api/coupons` | 否 | `coupons.js` |
| `claimCoupon(couponId)` | POST | `/api/coupons/:couponId/claim` | 是 | `coupons.js` |
| `getMyCoupons(params)` | GET | `/api/miniapp/my-coupons` | 否 | `miniapp-extra.js` |

#### 发票

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `getInvoiceList()` | GET | `/api/invoice-info` | 是 | `invoiceInfo.js` |
| `getInvoiceDetail(id)` | GET | `/api/invoice-info/:id` | 是 | `invoiceInfo.js` |
| `addInvoice(data)` | POST | `/api/invoice-info` | 是 | `invoiceInfo.js` |
| `updateInvoice(id, data)` | PUT | `/api/invoice-info/:id` | 是 | `invoiceInfo.js` |
| `deleteInvoice(id)` | DELETE | `/api/invoice-info/:id` | 是 | `invoiceInfo.js` |

#### 预约陪买

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `createBooking(data)` | POST | `/api/buying-service-requests` | 是 | `buyingService.js` |
| `getMyBookings()` | GET | `/api/buying-service-requests` | 是 | `buyingService.js` |

#### 通知

| API 函数 | HTTP 方法 | 请求路径 | 需认证 | 后端路由文件 |
|----------|----------|----------|--------|------------|
| `notifyAdmin(data)` | POST | `/api/miniapp/notify-admin` | 是 | `miniapp-extra.js` |

---

## 2. 各页面调用接口明细

### 2.1 首页模块

#### `pages/index/index.js` — 首页

| 调用函数 | 用途 |
|---------|------|
| `api.getHomeData()` | 加载首页轮播图、推荐套餐等 |
| `api.getBargainList({ pageSize: 6 })` | 加载首页砍价活动列表 |
| `api.getGoodsList({ page: 1, pageSize: 6, sort: 'sales' })` | 加载精选/热销商品 |

---

### 2.2 登录模块

#### `pages/login/index.js` — 登录页

| 调用函数 | 用途 |
|---------|------|
| `api.sendSmsCode(phone)` | 发送短信验证码 |
| `api.accountLogin(account, password)` | 账号密码登录 |
| `api.phoneLogin(phone, verifyCode)` | 手机号验证码登录 |
| `api.wxLogin(res.code)` | 微信授权登录 |

---

### 2.3 商城模块

#### `pages/mall/index.js` — 商城首页（分类空间）

**无 API 调用** — 使用本地硬编码的空间分类数据（`spaceDetails`），导航到子分类页。

#### `pages/mall/category-list/index.js` — 子分类列表

| 调用函数 | 用途 |
|---------|------|
| `api.getCategories()` | 加载分类列表，筛选子分类 |

#### `pages/mall/list/index.js` — 商品列表

| 调用函数 | 用途 |
|---------|------|
| `api.getStyles()` | 加载风格筛选项 |
| `api.getGoodsList(params)` | 按条件加载商品列表（分类、风格、价格、排序等） |

#### `pages/mall/detail/index.js` — 商品详情

| 调用函数 | 用途 |
|---------|------|
| `api.getGoodsDetail(id)` | 加载商品详情（规格、材质、SKU等） |
| `api.getFavorites()` | 检查当前商品是否已收藏 |
| `api.removeFavorite(id)` | 取消收藏 |
| `api.addFavorite(id)` | 添加收藏 |
| `api.addToCart({goodsId, count, specs})` | 加入购物车 |

#### `pages/mall/media/index.js` — 商品媒体（图片/视频）

| 调用函数 | 用途 |
|---------|------|
| `api.getGoodsDetail(id)` | 获取商品图片和视频资源 |

#### `pages/search/index.js` — 搜索页

| 调用函数 | 用途 |
|---------|------|
| `api.searchGoods(keyword, { page, pageSize })` | 关键词搜索商品 |

---

### 2.4 套餐模块

#### `pages/package/index.js` — 套餐列表

| 调用函数 | 用途 |
|---------|------|
| `api.getPackages()` | 加载所有套餐列表 |

#### `pages/package/detail/index.js` — 套餐详情（定制页）

**无 API 调用** — 当前使用本地硬编码数据展示套餐预览效果，通过 URL 参数传递。

#### `pages/package/config/index.js` — 套餐配置（选品）

| 调用函数 | 用途 |
|---------|------|
| `api.getPackageDetail(id)` | 加载套餐详情（分类、可选商品、价格等） |

#### `pages/package/my/index.js` — 我的套餐订单

| 调用函数 | 用途 |
|---------|------|
| `api.getOrders({ type: 'package' })` | 获取套餐类型的订单列表 |

---

### 2.5 砍价模块

#### `pages/bargain/index.js` — 砍价首页

| 调用函数 | 用途 |
|---------|------|
| `api.getBargainList({ style, category })` | 按风格/分类筛选砍价商品 |
| `api.getMyBargains()` | 加载当前用户的砍价活动 |
| `api.helpBargain(id)` | 帮好友砍一刀 |
| `api.cancelBargain(id)` | 取消砍价 |
| `api.startBargain({productId, productName, ...})` | 发起新砍价 |

#### `pages/bargain/detail/index.js` — 砍价详情

| 调用函数 | 用途 |
|---------|------|
| `api.getBargainDetail(id)` | 加载砍价活动详情（当前价格、帮砍记录、倒计时等） |
| `api.cancelBargain(id)` | 取消砍价 |
| `api.helpBargain(id)` | 自己砍一刀 |

#### `pages/bargain/help/index.js` — 帮好友砍价

| 调用函数 | 用途 |
|---------|------|
| `api.getBargainDetail(id)` | 加载砍价详情 |
| `api.helpBargain(bargainId)` | 帮砍一刀 |

#### `pages/bargain/my/index.js` — 我的砍价

| 调用函数 | 用途 |
|---------|------|
| `api.getMyBargains()` | 获取我发起的所有砍价活动 |

---

### 2.6 订单模块（新版 — `pages/orders/*`）

#### `pages/orders/confirm/index.js` — 订单确认页

| 调用函数 | 用途 |
|---------|------|
| `api.getAddresses()` | 加载收货地址，选取默认地址 |
| `api.createOrderV2(orderData)` | 提交订单（增强版，支持 address 对象和 couponId） |

#### `pages/orders/detail/index.js` — 订单详情

| 调用函数 | 用途 |
|---------|------|
| `api.getOrderDetail(id)` | 加载订单详情 |
| `api.cancelOrder(orderId)` | 取消订单 |
| `api.confirmOrder(orderId)` | 确认收货 |

#### `pages/orders/address-select/index.js` — 选择地址

| 调用函数 | 用途 |
|---------|------|
| `api.getAddresses()` | 加载地址列表供选择 |

#### `pages/orders/address-edit/index.js` — 编辑地址

| 调用函数 | 用途 |
|---------|------|
| `api.getAddresses()` | 加载地址列表查找编辑目标 |
| `api.updateAddress(id, form)` | 更新地址 |
| `api.addAddress(form)` | 新增地址 |
| `api.deleteAddress(id)` | 删除地址 |

#### `pages/orders/coupon-select/index.js` — 选择优惠券

| 调用函数 | 用途 |
|---------|------|
| `api.getCoupons({ status: 'available' })` | 加载可用优惠券列表 |

#### `pages/orders/result/index.js` — 下单结果页

**无 API 调用** — 仅展示下单结果信息（通过 URL 参数传入）。

---

### 2.7 订单模块（旧版 — `pages/order/*`）

#### `pages/order/confirm/index.js` — 订单确认页（旧版）

| 调用函数 | 用途 |
|---------|------|
| `api.createOrder(orderData)` | 提交订单（旧版，receiver 嵌套格式） |
| `api.getRecommendations()` | 加载订单确认页的搭配推荐商品 |

#### `pages/order/recommendations/index.js` — 推荐商品选择

| 调用函数 | 用途 |
|---------|------|
| `api.getRecommendations({ limit: 6 })` | 加载推荐商品列表 |

---

### 2.8 个人中心模块

#### `pages/profile/index.js` — 个人中心首页

| 调用函数 | 用途 |
|---------|------|
| `api.getUserInfo()` | 加载用户信息（昵称、头像等） |

#### `pages/profile/edit/index.js` — 编辑个人资料

| 调用函数 | 用途 |
|---------|------|
| `api.updateProfile(userInfo)` | 保存用户资料修改 |

#### `pages/profile/orders/index.js` — 我的订单列表

| 调用函数 | 用途 |
|---------|------|
| `api.getOrders()` | 加载订单列表 |
| `api.cancelOrder(orderId, reason)` | 取消订单 |
| `api.notifyAdmin({type, title, content, ...})` | 通知管理员订单取消 |
| `api.confirmOrder(id)` | 确认收货 |

#### `pages/profile/favorites/index.js` — 我的收藏

| 调用函数 | 用途 |
|---------|------|
| `api.getFavorites()` | 加载收藏列表 |
| `api.addToCart(payload)` | 从收藏加入购物车 |
| `api.removeFavorite(id)` | 删除单个收藏 |
| `api.removeFavorite(id)` ×N | 清空所有收藏（批量调用） |

#### `pages/profile/cart/index.js` — 购物车

| 调用函数 | 用途 |
|---------|------|
| `api.getCart()` | 加载购物车列表 |

#### `pages/profile/coupons/index.js` — 优惠券列表

| 调用函数 | 用途 |
|---------|------|
| `api.getCoupons()` | 加载优惠券列表 |

#### `pages/profile/booking/index.js` — 预约陪买

| 调用函数 | 用途 |
|---------|------|
| `api.getMyBookings()` | 加载我的预约记录 |
| `api.createBooking(bookingData)` | 创建新预约 |

#### `pages/profile/invoice/index.js` — 发票列表

| 调用函数 | 用途 |
|---------|------|
| `api.getInvoiceList()` | 加载发票信息列表 |

#### `pages/profile/invoice/edit/index.js` — 编辑发票

| 调用函数 | 用途 |
|---------|------|
| `api.getInvoiceDetail(id)` | 加载发票详情 |
| `api.updateInvoice(id, form)` | 更新发票信息 |
| `api.addInvoice(form)` | 新增发票信息 |
| `api.deleteInvoice(id)` | 删除发票信息 |

#### `pages/profile/address/edit/index.js` — 编辑地址（个人中心入口）

| 调用函数 | 用途 |
|---------|------|
| `api.getAddresses()` | 加载地址列表 |
| `api.updateAddress(id, form)` | 更新地址 |
| `api.addAddress(form)` | 新增地址 |
| `api.deleteAddress(id)` | 删除地址 |

---

## 3. 无 API 调用的页面

以下页面不调用后端接口，使用本地数据或纯展示：

| 页面路径 | 功能 | 数据来源 |
|---------|------|---------|
| `pages/guide/index.js` | 新手引导页 | 纯前端展示 |
| `pages/ai/index.js` | AI 推荐/聊天 | 纯前端展示 |
| `pages/mall/index.js` | 商城首页（空间分类） | 本地硬编码 `spaceDetails` |
| `pages/package/detail/index.js` | 套餐详情预览 | URL 参数 + 本地数据 |
| `pages/orders/result/index.js` | 下单结果 | URL 参数 |
| `pages/profile/address/index.js` | 地址列表 | 导航页面 |
| `pages/profile/points/index.js` | 积分页 | 本地数据 |
| `pages/profile/privacy/index.js` | 隐私政策 | 纯前端展示 |
| `pages/profile/service/index.js` | 客服页 | 纯前端展示 |
| `pages/profile/settings/index.js` | 设置页 | 本地操作 |

---

## 4. 后端路由文件归属

### 4.1 路由注册顺序（`app.js`）

```
# 通用接口（前缀 /api）
/api/auth          → auth.js
/api/cart          → cart.js
/api/orders        → orders.js
/api/favorites     → favorites.js
/api/addresses     → addresses.js
/api/invoice-info  → invoiceInfo.js
/api/coupons       → coupons.js
/api/buying-service-requests → buyingService.js
/api/bargains      → bargains.js（管理端）
/api/packages      → packages.js（管理端）

# 小程序专用接口（前缀 /api/miniapp，按优先级排列）
/api/miniapp/bargains  → miniapp-bargain.js  ← 优先匹配，修正路由顺序
/api/miniapp/*         → miniapp-extra.js    ← 补充接口（notify-admin, my-coupons, orders/v2）
/api/miniapp/*         → miniapp.js          ← 主路由（auth, user, goods, orders, packages 等）
```

### 4.2 各路由文件接口数统计

| 路由文件 | 注册前缀 | 小程序使用的接口数 | 说明 |
|---------|---------|---------------|------|
| `miniapp.js` | `/api/miniapp` | 18 | 认证、用户、商品、订单、套餐等核心接口 |
| `miniapp-bargain.js` | `/api/miniapp/bargains` | 6 | 砍价专用接口（修正路由顺序） |
| `miniapp-extra.js` | `/api/miniapp` | 3 | 补充接口（通知、用户优惠券、增强订单） |
| `favorites.js` | `/api/favorites` | 4 | 收藏 CRUD |
| `cart.js` | `/api/cart` | 5 | 购物车 CRUD |
| `addresses.js` | `/api/addresses` | 5 | 地址 CRUD |
| `coupons.js` | `/api/coupons` | 2 | 优惠券列表 + 领取 |
| `invoiceInfo.js` | `/api/invoice-info` | 5 | 发票信息 CRUD |
| `buyingService.js` | `/api/buying-service-requests` | 2 | 预约陪买 |

---

## 附录：页面-接口快速索引

```
pages/index              → getHomeData, getBargainList, getGoodsList
pages/login              → wxLogin, accountLogin, sendSmsCode, phoneLogin
pages/search             → searchGoods
pages/mall/index         → （无API）
pages/mall/category-list → getCategories
pages/mall/list          → getStyles, getGoodsList
pages/mall/detail        → getGoodsDetail, getFavorites, addFavorite, removeFavorite, addToCart
pages/mall/media         → getGoodsDetail
pages/package/index      → getPackages
pages/package/detail     → （无API）
pages/package/config     → getPackageDetail
pages/package/my         → getOrders
pages/bargain/index      → getBargainList, getMyBargains, helpBargain, cancelBargain, startBargain
pages/bargain/detail     → getBargainDetail, cancelBargain, helpBargain
pages/bargain/help       → getBargainDetail, helpBargain
pages/bargain/my         → getMyBargains
pages/orders/confirm     → getAddresses, createOrderV2
pages/orders/detail      → getOrderDetail, cancelOrder, confirmOrder
pages/orders/address-sel → getAddresses
pages/orders/address-edi → getAddresses, addAddress, updateAddress, deleteAddress
pages/orders/coupon-sel  → getCoupons
pages/orders/result      → （无API）
pages/order/confirm      → createOrder, getRecommendations
pages/order/recommend    → getRecommendations
pages/profile/index      → getUserInfo
pages/profile/edit       → updateProfile
pages/profile/orders     → getOrders, cancelOrder, notifyAdmin, confirmOrder
pages/profile/favorites  → getFavorites, addToCart, removeFavorite
pages/profile/cart       → getCart
pages/profile/coupons    → getCoupons
pages/profile/booking    → getMyBookings, createBooking
pages/profile/invoice    → getInvoiceList
pages/profile/invoice/ed → getInvoiceDetail, addInvoice, updateInvoice, deleteInvoice
pages/profile/address/ed → getAddresses, addAddress, updateAddress, deleteAddress
```
